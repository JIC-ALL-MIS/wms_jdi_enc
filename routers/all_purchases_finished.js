var a0_0x5c5e10=a0_0x2374;function a0_0xbf83(){var _0x3f10f1=['currency','$product_details._id','getMonth','$maxProducts','$alertquantity','site_title','params','stock_data','prod_code','INC-','$name','express','\x20Order\x20Date\x20:\x20','/view/:id','</td>','English\x20(US)','Return\x20Goods','$product_details.storage','</thead>','prod_name','/all_purchases/view','/view/add_purchases/:id','flash','user_id','/give_payment/:id','$product_details.primary_code','FROZEN\x20GOODS','/all_purchases_finished/view','all_purchases_barcode','Chinese','True','add_purchases_finished','errors','Hindi','RoomAssign','max_product_unit','product_name','$maxStocks','nodemailer','RMSEmail','due_amount','purchases\x20item\x20return\x20successfull','role','Portuguese\x20(BR)','table\x20page','Enclosed','Rack\x202','$product_details','/view/add_purchases','length','secondary_code','suppliers','$product_details.product_stock','message','body','primary_code_hide','2bafMlV','2185995MUGecQ','product_code_hide','room_name','all','primary_code','log','get','suppliers_docs','$product_code','$CBM','staff','<strong>\x20Regards\x20</strong>','paid_amount','$invoice','getDate','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','There\x27s\x20a\x20error\x20in\x20this\x20transaction','Arabic\x20(ae)','/../public','prod_invoice','return_purchase_finished','toString','$unit','English','purchase_quantity','\x20</h2>','$product.level','/invoice/:id','\x20Order\x20Number\x20:\x20','prod_Qty','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','email','level','$product.isle','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','gmail','\x20<>\x20','product_date','<div>','<tr>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','French','isle','$product.pallet','updateOne','$brand','prod_unit','$warehouse_name','$product_details.secondary_code','<hr\x20class=\x22my-3\x22>','post','error','master','/view/return_purchase/:id','$primary_code','Finished\x20Goods','$secondary_unit','<table\x20style=\x22width:\x20100%\x20!important;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','Ambient','1248872uJMAdw','Purchase\x20Mail','$product.quantity','maxperunit','catch','/barcode_scanner','$batch_code','$_id','purchase\x20data\x20update\x20successfully','date','Paid\x20For\x20Purchase','</body></html>','name','stocks','logo','</div>','invoice','Rack\x201','$expiry_date','Router','<tbody\x20style=\x22text-align:\x20center;\x22>','</tr>','room','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Portuguese','slice','payment\x20successfull','status','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','12PvfIfy','render','Arabic','string','../middleware/auth','451161xFZbIz','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','standard_unit','secondary_unit','redirect','user','280265wSQtpS','$paid_amount','$suppliers_docs','findById','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$secondary_code','json','aggregate','</table>','concat','edit_purchases_finished_view','$category','Room_name','Spanish','product_details','/preview/:id','</head><body>','type','return_data','</h5>','prod_primunit','maxStocks','../public/language/languages.json','batch_code','findOne','expiry_date','Purchase\x20Return\x20Mail','currency_placement','language','ejs','$note','$maxProdPerUnit','product_cat','filter','return_qty','Enabled','$product_details.rack','$product_details.bay','Email\x20sent\x20successfully','$product','<html><head><title></title>','host','DRY\x20GOODS','_id','password','prod_level','amount','$due_amount','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','return_product','<h5\x20style=\x22text-align:\x20left;\x22>','purchase_invoice','sendMail','find','MaxStocks_data','production_date','bay','product_code','$product_details.pallet','POnumber','prod_secondunit','83096QpBuhD','image','$product.room_name','<h5>','</tbody>','success','Purchase\x20Return','forEach','JO_number','2607760dOmtZt','warehouse','/view','createTransport','secondary_code_hide','German','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Level\x20</th>','CBM','product','then','add_purchases\x20error','quantity','$date','Logo.png','edit_purchases_finished','</span>','prod_qty','save','An\x20error\x20occurred\x20while\x20saving\x20data.','Error\x20Occurs','/upload/','product_stock','warehouse_name','<h2>\x20','1149744bNocTI','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','pallet','map','$product_details.product_name'];a0_0xbf83=function(){return _0x3f10f1;};return a0_0xbf83();}(function(_0x577660,_0x29fc9a){var _0x5f0e7e=a0_0x2374,_0x2a4f6d=_0x577660();while(!![]){try{var _0x39f9e2=-parseInt(_0x5f0e7e(0x270))/0x1*(-parseInt(_0x5f0e7e(0x1ce))/0x2)+-parseInt(_0x5f0e7e(0x291))/0x3+parseInt(_0x5f0e7e(0x279))/0x4+parseInt(_0x5f0e7e(0x233))/0x5*(parseInt(_0x5f0e7e(0x228))/0x6)+-parseInt(_0x5f0e7e(0x1cf))/0x7+parseInt(_0x5f0e7e(0x20b))/0x8+parseInt(_0x5f0e7e(0x22d))/0x9;if(_0x39f9e2===_0x29fc9a)break;else _0x2a4f6d['push'](_0x2a4f6d['shift']());}catch(_0x43959e){_0x2a4f6d['push'](_0x2a4f6d['shift']());}}}(a0_0xbf83,0x575d7));const express=require(a0_0x5c5e10(0x2a1)),app=express(),router=express[a0_0x5c5e10(0x21e)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x5c5e10(0x22c)),nodemailer=require(a0_0x5c5e10(0x1bc));var ejs=require(a0_0x5c5e10(0x250));function a0_0x2374(_0x2994a5,_0x62ef74){var _0xbf83a8=a0_0xbf83();return a0_0x2374=function(_0x2374a4,_0x20402a){_0x2374a4=_0x2374a4-0x1b9;var _0x5fe0a8=_0xbf83a8[_0x2374a4];return _0x5fe0a8;},a0_0x2374(_0x2994a5,_0x62ef74);}const path=require('path'),users=require(a0_0x5c5e10(0x249));router[a0_0x5c5e10(0x1d5)](a0_0x5c5e10(0x27b),auth,async(_0xc59d1d,_0x2da192)=>{var _0x242e63=a0_0x5c5e10;try{const {username:_0x296c74,email:_0x35ab57,role:_0x2e8d5e}=_0xc59d1d[_0x242e63(0x232)],_0x185d50=_0xc59d1d[_0x242e63(0x232)],_0x27c7a7=await profile[_0x242e63(0x24b)]({'email':_0x185d50[_0x242e63(0x1ee)]}),_0x3ee9c7=await staff[_0x242e63(0x24b)]({'email':_0x185d50['email']});if(_0x185d50[_0x242e63(0x1c0)]==_0x242e63(0x1d9)){const _0x4b091e=await staff[_0x242e63(0x24b)]({'email':_0x185d50[_0x242e63(0x1ee)]});}const _0xdcd28a=await master_shop[_0x242e63(0x268)]();let _0x323a42;if(_0x185d50[_0x242e63(0x1c0)]=='staff'){const _0x3eac15=await staff['findOne']({'email':_0x185d50[_0x242e63(0x1ee)]});_0x323a42=await purchases_finished[_0x242e63(0x23a)]([{'$match':{'warehouse_name':_0x3eac15[_0x242e63(0x27a)]}},{'$lookup':{'from':_0x242e63(0x1c9),'localField':'suppliers','foreignField':_0x242e63(0x217),'as':_0x242e63(0x1d6)}},{'$unwind':_0x242e63(0x235)},{'$unwind':_0x242e63(0x25a)},{'$group':{'_id':'$_id','invoice':{'$first':_0x242e63(0x1dc)},'suppliers':{'$first':'$suppliers'},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x242e63(0x272)},'product':{'$push':_0x242e63(0x25a)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x242e63(0x234)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x242e63(0x211)},'expiry_date':{'$first':_0x242e63(0x21d)},'suppliers_docs':{'$first':_0x242e63(0x235)},'total_product_quantity':{'$sum':_0x242e63(0x20d)},'level':{'$addToSet':_0x242e63(0x1e9)},'isle':{'$addToSet':_0x242e63(0x1f0)},'pallet':{'$addToSet':'$product.pallet'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'pallet':0x1}}]);}else _0x323a42=await purchases_finished[_0x242e63(0x23a)]([{'$lookup':{'from':_0x242e63(0x1c9),'localField':_0x242e63(0x1c9),'foreignField':_0x242e63(0x217),'as':_0x242e63(0x1d6)}},{'$unwind':_0x242e63(0x235)},{'$unwind':_0x242e63(0x25a)},{'$group':{'_id':_0x242e63(0x212),'invoice':{'$first':_0x242e63(0x1dc)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x242e63(0x285)},'warehouse_name':{'$first':_0x242e63(0x1fe)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x242e63(0x25a)},'note':{'$first':_0x242e63(0x251)},'paid_amount':{'$first':_0x242e63(0x234)},'due_amount':{'$first':_0x242e63(0x262)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x242e63(0x211)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x242e63(0x235)},'total_product_quantity':{'$sum':_0x242e63(0x20d)},'level':{'$addToSet':_0x242e63(0x1e9)},'isle':{'$addToSet':_0x242e63(0x1f0)},'pallet':{'$addToSet':_0x242e63(0x1fa)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'pallet':0x1}}]);if(_0xdcd28a[0x0]['language']==_0x242e63(0x2a5)){var _0x41d3e6=users[_0x242e63(0x1e6)];console[_0x242e63(0x1d4)](_0x41d3e6);}else{if(_0xdcd28a[0x0][_0x242e63(0x24f)]==_0x242e63(0x2b7))var _0x41d3e6=users['Hindi'];else{if(_0xdcd28a[0x0][_0x242e63(0x24f)]==_0x242e63(0x27e))var _0x41d3e6=users[_0x242e63(0x27e)];else{if(_0xdcd28a[0x0][_0x242e63(0x24f)]==_0x242e63(0x240))var _0x41d3e6=users[_0x242e63(0x240)];else{if(_0xdcd28a[0x0][_0x242e63(0x24f)]=='French')var _0x41d3e6=users['French'];else{if(_0xdcd28a[0x0][_0x242e63(0x24f)]==_0x242e63(0x1c1))var _0x41d3e6=users[_0x242e63(0x223)];else{if(_0xdcd28a[0x0][_0x242e63(0x24f)]==_0x242e63(0x2b3))var _0x41d3e6=users[_0x242e63(0x2b3)];else{if(_0xdcd28a[0x0]['language']=='Arabic\x20(ae)')var _0x41d3e6=users[_0x242e63(0x22a)];}}}}}}}_0x2da192[_0x242e63(0x229)]('all_purchases_finished',{'success':_0xc59d1d['flash'](_0x242e63(0x275)),'errors':_0xc59d1d[_0x242e63(0x2ac)](_0x242e63(0x2b6)),'purchases':_0x323a42,'role':_0x185d50,'profile':_0x27c7a7,'master_shop':_0xdcd28a,'language':_0x41d3e6});}catch(_0x30fd0f){console[_0x242e63(0x1d4)](_0x242e63(0x1c2),_0x30fd0f),_0x2da192['status'](0xc8)[_0x242e63(0x239)]({'message':_0x30fd0f[_0x242e63(0x1cb)]});}});function BayBinSelected(_0x1a4b1d,_0x5a3fc4){var _0x4a25aa=a0_0x5c5e10,_0x134777=[],_0x4b00a7=[];if(_0x1a4b1d==_0x4a25aa(0x25d)){switch(_0x5a3fc4){case'Rack\x201':_0x134777=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case'Rack\x202':_0x134777=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x4b00a7=['DG'];}else{if(_0x1a4b1d==_0x4a25aa(0x2b0)){switch(_0x5a3fc4){case _0x4a25aa(0x21c):_0x134777=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x4a25aa(0x1c4):_0x134777=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x4b00a7=['FG'];}}return{'levels':_0x134777,'identify':_0x4b00a7};}async function getRandom8DigitNumber(){var _0x4b7b86=a0_0x5c5e10;const _0x57a10b=0x989680,_0x25461c=0x5f5e0ff,_0x1caa84=Math['floor'](Math['random']()*(_0x25461c-_0x57a10b+0x1))+_0x57a10b;var _0x418f77;const _0x3ae30f=await purchases_finished[_0x4b7b86(0x24b)]({'invoice':_0x4b7b86(0x29f)+_0x1caa84});return _0x3ae30f&&_0x3ae30f[_0x4b7b86(0x1c7)]>0x0?_0x418f77=_0x4b7b86(0x29f)+_0x1caa84:_0x418f77=_0x4b7b86(0x29f)+_0x1caa84,_0x418f77;}router[a0_0x5c5e10(0x1d5)](a0_0x5c5e10(0x1c6),auth,async(_0x25886b,_0x16afcc)=>{var _0x36e324=a0_0x5c5e10;try{const {username:_0x3ded17,email:_0x108fd1,role:_0x3d4547}=_0x25886b['user'],_0x264988=_0x25886b[_0x36e324(0x232)],_0x2ec505=await profile['findOne']({'email':_0x264988['email']}),_0x1c8138=await master_shop[_0x36e324(0x268)](),_0x529830=await staff[_0x36e324(0x24b)]({'email':_0x264988[_0x36e324(0x1ee)]}),_0x3dfd6b=await suppliers['find']({});let _0x56f93b;if(_0x264988[_0x36e324(0x1c0)]==_0x36e324(0x1d9)){const _0x54916e=await staff[_0x36e324(0x24b)]({'email':_0x264988[_0x36e324(0x1ee)]});_0x56f93b=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x54916e[_0x36e324(0x27a)]}},{'$group':{'_id':_0x36e324(0x2a0),'name':{'$first':_0x36e324(0x2a0)}}}]);}else _0x56f93b=await warehouse[_0x36e324(0x23a)]([{'$match':{'status':'Enabled','name':{'$ne':_0x36e324(0x2a6)}}},{'$group':{'_id':_0x36e324(0x2a0),'name':{'$first':'$name'}}}]);const _0xe8aa1c=await product[_0x36e324(0x268)]({}),_0x41e83d=await warehouse[_0x36e324(0x268)]({'status':'Enabled'}),_0x4809d7=await purchases_finished[_0x36e324(0x268)]({}),_0x3a23db=_0x4809d7[_0x36e324(0x1c7)]+0x1,_0x462404='INC-'+_0x3a23db[_0x36e324(0x1e4)]()['padStart'](0x5,'0');var _0x4c9dd4=[_0x36e324(0x20a),_0x36e324(0x1c3)];if(_0x1c8138[0x0][_0x36e324(0x24f)]=='English\x20(US)')var _0x5440b0=users[_0x36e324(0x1e6)];else{if(_0x1c8138[0x0][_0x36e324(0x24f)]=='Hindi')var _0x5440b0=users[_0x36e324(0x2b7)];else{if(_0x1c8138[0x0][_0x36e324(0x24f)]=='German')var _0x5440b0=users['German'];else{if(_0x1c8138[0x0]['language']==_0x36e324(0x240))var _0x5440b0=users[_0x36e324(0x240)];else{if(_0x1c8138[0x0][_0x36e324(0x24f)]==_0x36e324(0x1f8))var _0x5440b0=users['French'];else{if(_0x1c8138[0x0][_0x36e324(0x24f)]=='Portuguese\x20(BR)')var _0x5440b0=users[_0x36e324(0x223)];else{if(_0x1c8138[0x0][_0x36e324(0x24f)]==_0x36e324(0x2b3))var _0x5440b0=users[_0x36e324(0x2b3)];else{if(_0x1c8138[0x0][_0x36e324(0x24f)]==_0x36e324(0x1e0))var _0x5440b0=users[_0x36e324(0x22a)];}}}}}}}const _0x76713a=getRandom8DigitNumber();_0x76713a[_0x36e324(0x282)](_0x3c911b=>{var _0xd90afe=_0x36e324;_0x16afcc[_0xd90afe(0x229)](_0xd90afe(0x2b5),{'success':_0x25886b['flash']('success'),'errors':_0x25886b[_0xd90afe(0x2ac)](_0xd90afe(0x2b6)),'role':_0x264988,'profile':_0x2ec505,'suppliers':_0x3dfd6b,'warehouse':_0x56f93b,'product':_0xe8aa1c,'invoice':_0x3c911b,'master_shop':_0x1c8138,'language':_0x5440b0,'find_data':_0x41e83d,'rooms_data':_0x4c9dd4});})[_0x36e324(0x20f)](_0x1e87fb=>{var _0x85be3c=_0x36e324;_0x25886b[_0x85be3c(0x2ac)](_0x85be3c(0x2b6),_0x85be3c(0x1df)),_0x16afcc[_0x85be3c(0x231)]('/all_purchases_finished/view');});}catch(_0x44baea){console[_0x36e324(0x1d4)](_0x44baea);}}),router[a0_0x5c5e10(0x1d5)](a0_0x5c5e10(0x2ab),auth,async(_0x28e63a,_0x26821a)=>{var _0x203561=a0_0x5c5e10;try{const _0x34453e=_0x28e63a['params']['id'];console[_0x203561(0x1d4)](_0x34453e);const _0x2cfded=await master_shop[_0x203561(0x268)]();console[_0x203561(0x1d4)]('master',_0x2cfded);const _0x4506f5=await product[_0x203561(0x24b)]({'name':_0x34453e});console['log'](_0x203561(0x281),_0x4506f5),_0x26821a[_0x203561(0x226)](0xc8)[_0x203561(0x239)]({'product_data':_0x4506f5,'master':_0x2cfded});}catch(_0x211d77){console[_0x203561(0x1d4)](_0x203561(0x283),_0x211d77);}}),router[a0_0x5c5e10(0x201)](a0_0x5c5e10(0x1c6),auth,async(_0x3ab67d,_0x3787ab)=>{var _0x174635=a0_0x5c5e10;try{const {invoice:_0x32a082,date:_0x24d300,warehouse_name:_0x34ddad,prod_name:_0x69c3c3,prod_code:_0x3f55d2,prod_qty:_0x4d20fb,prod_unit:_0x4a2c55,prod_secondunit:_0xfdfa54,prod_level:_0x55733f,prod_isle:_0x88f060,prod_pallet:_0x2328c9,note:_0x272d9e,expiry_date:_0x399b07,batch_code:_0x3a1667,payable:_0x1b4cf2,due_amount:_0x2d6e59,Room_name:_0x497762,primary_code:_0x2af73d,secondary_code:_0x3ffb2c,MaxStocks_data:_0x43517b,PO_number:_0x36a745,SCRN:_0x5141fb,JO_number:_0x165595,ReqBy:_0x177fe2,dateofreq:_0x12895c,typeservicesData:_0x5a2015,driver:_0x3ab038,plate:_0x4999a6,van:_0x1a6db0,DRSI:_0x2cefae,typevehicle:_0x198cd5,TSU:_0x1231b9,TFU:_0x380e59}=_0x3ab67d[_0x174635(0x1cc)];if(typeof _0x69c3c3==_0x174635(0x22b))var _0xdc676f=[_0x3ab67d[_0x174635(0x1cc)][_0x174635(0x2a9)]],_0x1307bb=[_0x3ab67d[_0x174635(0x1cc)][_0x174635(0x29e)]],_0x579649=[_0x3ab67d[_0x174635(0x1cc)][_0x174635(0x1ec)]],_0x1787d9=[_0x3ab67d[_0x174635(0x1cc)][_0x174635(0x247)]],_0x1a9d78=[_0x3ab67d[_0x174635(0x1cc)]['prod_secondunit']],_0x4151de=[_0x3ab67d[_0x174635(0x1cc)]['prod_level']],_0x27ea84=[_0x3ab67d[_0x174635(0x1cc)][_0x174635(0x1d3)]],_0x2c954b=[_0x3ab67d[_0x174635(0x1cc)][_0x174635(0x1c8)]],_0x2997fa=[_0x3ab67d[_0x174635(0x1cc)]['MaxStocks_data']],_0x1da463=[_0x3ab67d[_0x174635(0x1cc)][_0x174635(0x24a)]],_0x1350c0=[_0x3ab67d[_0x174635(0x1cc)][_0x174635(0x24c)]],_0x536400=[_0x3ab67d[_0x174635(0x1cc)][_0x174635(0x1f4)]],_0x443c08=[_0x3ab67d[_0x174635(0x1cc)][_0x174635(0x1b9)]],_0x426a2b=[_0x3ab67d[_0x174635(0x1cc)]['prod_cat']],_0x1848c7=[_0x3ab67d[_0x174635(0x1cc)][_0x174635(0x2b8)]],_0x5f4556=[_0x3ab67d[_0x174635(0x1cc)][_0x174635(0x244)]],_0x321faf=[_0x3ab67d[_0x174635(0x1cc)][_0x174635(0x280)]],_0x4f19e3=[_0x3ab67d[_0x174635(0x1cc)][_0x174635(0x1e2)]];else var _0xdc676f=[..._0x3ab67d[_0x174635(0x1cc)][_0x174635(0x2a9)]],_0x1307bb=[..._0x3ab67d['body']['prod_code']],_0x579649=[..._0x3ab67d[_0x174635(0x1cc)][_0x174635(0x1ec)]],_0x1787d9=[..._0x3ab67d[_0x174635(0x1cc)]['prod_primunit']],_0x1a9d78=[..._0x3ab67d[_0x174635(0x1cc)][_0x174635(0x26f)]],_0x4151de=[..._0x3ab67d[_0x174635(0x1cc)][_0x174635(0x260)]],_0x27ea84=[..._0x3ab67d[_0x174635(0x1cc)][_0x174635(0x1d3)]],_0x2c954b=[..._0x3ab67d[_0x174635(0x1cc)][_0x174635(0x1c8)]],_0x2997fa=[..._0x3ab67d[_0x174635(0x1cc)][_0x174635(0x269)]],_0x1da463=[..._0x3ab67d['body'][_0x174635(0x24a)]],_0x1350c0=[..._0x3ab67d['body'][_0x174635(0x24c)]],_0x536400=[..._0x3ab67d[_0x174635(0x1cc)][_0x174635(0x1f4)]],_0x443c08=[..._0x3ab67d['body']['max_product_unit']],_0x426a2b=[..._0x3ab67d[_0x174635(0x1cc)]['prod_cat']],_0x1848c7=[..._0x3ab67d[_0x174635(0x1cc)][_0x174635(0x2b8)]],_0x5f4556=[..._0x3ab67d[_0x174635(0x1cc)][_0x174635(0x244)]],_0x321faf=[..._0x3ab67d[_0x174635(0x1cc)][_0x174635(0x280)]],_0x4f19e3=[..._0x3ab67d[_0x174635(0x1cc)][_0x174635(0x1e2)]];const _0x3e17cb=_0xdc676f[_0x174635(0x294)](_0x30736f=>{return _0x30736f={'product_name':_0x30736f};});_0x1307bb[_0x174635(0x277)]((_0x351625,_0x5eb32f)=>{var _0x247a2c=_0x174635;_0x3e17cb[_0x5eb32f][_0x247a2c(0x26c)]=_0x351625;}),_0x579649['forEach']((_0x44df90,_0x2089a1)=>{_0x3e17cb[_0x2089a1]['quantity']=_0x44df90;}),_0x1787d9[_0x174635(0x277)]((_0x1cf8a4,_0x4dd738)=>{_0x3e17cb[_0x4dd738]['standard_unit']=_0x1cf8a4;}),_0x1a9d78[_0x174635(0x277)]((_0x4954bd,_0x319347)=>{var _0x155ed0=_0x174635;_0x3e17cb[_0x319347][_0x155ed0(0x230)]=_0x4954bd;}),_0x4151de[_0x174635(0x277)]((_0x2a54ab,_0x47ba37)=>{var _0x3796c5=_0x174635,_0x167437=_0x2a54ab[_0x3796c5(0x224)](0x1);_0x3e17cb[_0x47ba37][_0x3796c5(0x1f9)]=_0x2a54ab[0x0],_0x3e17cb[_0x47ba37][_0x3796c5(0x293)]=_0x167437;}),_0x5f4556[_0x174635(0x277)]((_0x8be889,_0x446e9f)=>{var _0xf5b186=_0x174635;_0x3e17cb[_0x446e9f][_0xf5b186(0x1ef)]=_0x8be889;}),_0x27ea84[_0x174635(0x277)]((_0x300e3c,_0x3a6739)=>{_0x3e17cb[_0x3a6739]['primary_code']=_0x300e3c;}),_0x2c954b['forEach']((_0x1d63c8,_0x52a1ff)=>{_0x3e17cb[_0x52a1ff]['secondary_code']=_0x1d63c8;}),_0x2997fa['forEach']((_0x41ed0c,_0x55bd93)=>{var _0x11725f=_0x174635;_0x3e17cb[_0x55bd93][_0x11725f(0x248)]=_0x41ed0c;}),_0x1da463[_0x174635(0x277)]((_0x1c020f,_0x214f05)=>{var _0x173cd5=_0x174635;_0x3e17cb[_0x214f05][_0x173cd5(0x24a)]=_0x1c020f;}),_0x1350c0[_0x174635(0x277)]((_0x7e7047,_0x43de30)=>{var _0x32547b=_0x174635;_0x3e17cb[_0x43de30][_0x32547b(0x24c)]=_0x7e7047;}),_0x536400[_0x174635(0x277)]((_0xcacd0a,_0x70938e)=>{var _0x38d652=_0x174635;_0x3e17cb[_0x70938e][_0x38d652(0x26a)]=_0xcacd0a;}),_0x443c08[_0x174635(0x277)]((_0x2c2d5d,_0x4b5a9c)=>{var _0x5ac9fe=_0x174635;_0x3e17cb[_0x4b5a9c][_0x5ac9fe(0x20e)]=_0x2c2d5d;}),_0x426a2b[_0x174635(0x277)]((_0x769554,_0x190849)=>{var _0xc4d6f7=_0x174635;_0x3e17cb[_0x190849][_0xc4d6f7(0x253)]=_0x769554;}),_0x1848c7[_0x174635(0x277)]((_0x409eaa,_0x3c454e)=>{var _0x5df687=_0x174635;_0x3e17cb[_0x3c454e][_0x5df687(0x1d1)]=_0x409eaa;}),_0x321faf[_0x174635(0x277)]((_0x40b155,_0xc25624)=>{var _0x8daec6=_0x174635;_0x3e17cb[_0xc25624][_0x8daec6(0x280)]=_0x40b155;}),_0x4f19e3[_0x174635(0x277)]((_0x10d453,_0x471ada)=>{var _0x5285fc=_0x174635;_0x3e17cb[_0x471ada][_0x5285fc(0x21b)]=_0x10d453;});const _0x1d75d4=_0x3e17cb[_0x174635(0x254)](_0x1e6bf3=>_0x1e6bf3['quantity']!=='0'&&_0x1e6bf3[_0x174635(0x284)]!==''),_0x502dec=new purchases_finished({'invoice':_0x32a082,'suppliers':_0x3ab67d[_0x174635(0x1cc)][_0x174635(0x1c9)],'date':_0x24d300,'warehouse_name':_0x34ddad,'product':_0x1d75d4,'note':_0x272d9e,'due_amount':_0x2d6e59,'room':_0x497762,'POnumber':_0x36a745,'SCRN':_0x5141fb,'JO_number':_0x165595,'RequestedBy':_0x177fe2,'DateofRequest':_0x12895c,'typeservices':_0x5a2015,'driver':_0x3ab038,'plate':_0x4999a6,'van':_0x1a6db0,'DRSI':_0x2cefae,'typevehicle':_0x198cd5,'TSU':_0x1231b9,'TFU':_0x380e59}),_0x3c4926=await _0x502dec[_0x174635(0x28a)](),_0xddab2d=await purchases_finished[_0x174635(0x24b)]({'invoice':_0x32a082}),_0xbc8cc1=_0xddab2d[_0x174635(0x281)][_0x174635(0x294)](async _0x46ff6a=>{var _0x3edbf3=_0x174635,_0x2ed469=await warehouse[_0x3edbf3(0x24b)]({'name':_0x34ddad,'room':_0x46ff6a['room_name']}),_0x1e1ae4=0x0;const _0x28827a=_0x2ed469[_0x3edbf3(0x241)][_0x3edbf3(0x294)](_0x3027d8=>{var _0x33ff2a=_0x3edbf3;_0x3027d8[_0x33ff2a(0x1ba)]==_0x46ff6a[_0x33ff2a(0x1ba)]&&_0x3027d8[_0x33ff2a(0x1ef)]==_0x46ff6a[_0x33ff2a(0x1ef)]&&_0x3027d8[_0x33ff2a(0x1f9)]==_0x46ff6a[_0x33ff2a(0x1f9)]&&_0x3027d8['pallet']==_0x46ff6a[_0x33ff2a(0x293)]&&_0x3027d8['expiry_date']==_0x46ff6a[_0x33ff2a(0x24c)]&&_0x3027d8[_0x33ff2a(0x26a)]==_0x46ff6a[_0x33ff2a(0x26a)]&&_0x3027d8[_0x33ff2a(0x24a)]==_0x46ff6a[_0x33ff2a(0x24a)]&&_0x3027d8[_0x33ff2a(0x253)]==_0x46ff6a[_0x33ff2a(0x253)]&&_0x3027d8[_0x33ff2a(0x21b)]==_0xddab2d[_0x33ff2a(0x21b)]&&(_0x3027d8['product_stock']=_0x3027d8[_0x33ff2a(0x28e)]+_0x46ff6a[_0x33ff2a(0x284)],_0x1e1ae4++);});return _0x1e1ae4=='0'&&(_0x2ed469[_0x3edbf3(0x241)]=_0x2ed469['product_details'][_0x3edbf3(0x23c)]({'product_name':_0x46ff6a[_0x3edbf3(0x1ba)],'product_stock':_0x46ff6a[_0x3edbf3(0x284)],'primary_code':_0x46ff6a[_0x3edbf3(0x1d3)],'secondary_code':_0x46ff6a[_0x3edbf3(0x1c8)],'product_code':_0x46ff6a['product_code'],'level':_0x46ff6a[_0x3edbf3(0x1ef)],'isle':_0x46ff6a[_0x3edbf3(0x1f9)],'pallet':_0x46ff6a[_0x3edbf3(0x293)],'maxProducts':_0x46ff6a[_0x3edbf3(0x248)],'unit':_0x46ff6a[_0x3edbf3(0x22f)],'secondary_unit':_0x46ff6a[_0x3edbf3(0x230)],'expiry_date':_0x46ff6a[_0x3edbf3(0x24c)],'production_date':_0x46ff6a[_0x3edbf3(0x26a)],'maxProducts':_0x46ff6a[_0x3edbf3(0x248)],'maxPerUnit':_0x46ff6a['maxperunit'],'batch_code':_0x46ff6a[_0x3edbf3(0x24a)],'product_cat':_0x46ff6a['product_cat'],'CBM':_0x46ff6a['CBM'],'invoice':_0x46ff6a[_0x3edbf3(0x21b)]})),_0x2ed469;});Promise[_0x174635(0x1d2)](_0xbc8cc1)[_0x174635(0x282)](async _0xfee35b=>{var _0x1544f8=_0x174635;try{for(const _0x11a179 of _0xfee35b){await warehouse[_0x1544f8(0x1fb)]({'_id':_0x11a179[_0x1544f8(0x25e)]},{'$addToSet':{'product_details':{'$each':_0x11a179[_0x1544f8(0x241)]}}});}}catch(_0x4dad7a){console[_0x1544f8(0x202)](_0x4dad7a),_0x3787ab[_0x1544f8(0x226)](0x1f4)[_0x1544f8(0x239)]({'error':_0x1544f8(0x28b),'message':_0x4dad7a['message']});}})[_0x174635(0x20f)](_0x27213f=>{var _0xe193fe=_0x174635;console[_0xe193fe(0x202)](_0x27213f),_0x3787ab['status'](0x1f4)[_0xe193fe(0x239)]({'error':'An\x20error\x20occurred.'});});const _0x1fa716=await master_shop[_0x174635(0x268)](),_0x3488d4=await email_settings[_0x174635(0x24b)](),_0x10c240=await suppliers[_0x174635(0x24b)]({'name':_0x3ab67d[_0x174635(0x1cc)][_0x174635(0x1c9)]}),_0x21053a=await supervisor_settings[_0x174635(0x268)]();_0x1fa716[0x0][_0x174635(0x24e)]==0x1?(right_currency=_0x1fa716[0x0][_0x174635(0x296)],left_currency=''):(right_currency='',left_currency=_0x1fa716[0x0][_0x174635(0x296)]);var _0x45d480=_0xdc676f,_0xd0cd56=_0x579649,_0x29265f=_0x1307bb,_0x3dddee=_0x1787d9,_0x2b273b=_0x1a9d78,_0xdb4d55=_0x4151de,_0x328337=_0x5f4556,_0x32fe55='',_0x2cba0e;for(_0x2cba0e in _0x45d480){_0x32fe55+='<tr>'+_0x174635(0x292)+_0x45d480[_0x2cba0e]+'</td>'+_0x174635(0x292)+_0x29265f[_0x2cba0e]+_0x174635(0x2a4)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xd0cd56[_0x2cba0e]+_0x174635(0x2a4)+_0x174635(0x292)+_0x3dddee[_0x2cba0e]+_0x174635(0x2a4)+_0x174635(0x292)+_0x2b273b[_0x2cba0e]+_0x174635(0x2a4)+_0x174635(0x292)+_0x328337[_0x2cba0e]+_0x174635(0x2a4)+_0x174635(0x292)+_0xdb4d55[_0x2cba0e]+'</td>'+_0x174635(0x220);}let _0x22f641=nodemailer[_0x174635(0x27c)]({'host':_0x3488d4[_0x174635(0x25c)],'port':Number(_0x3488d4['port']),'secure':![],'auth':{'user':_0x3488d4[_0x174635(0x1ee)],'pass':_0x3488d4['password']}}),_0x20ad24={'from':_0x3488d4[_0x174635(0x1ee)],'to':_0x21053a[0x0][_0x174635(0x1bd)],'subject':_0x174635(0x20c),'attachments':[{'filename':_0x174635(0x286),'path':__dirname+_0x174635(0x1e1)+_0x174635(0x28d)+_0x1fa716[0x0][_0x174635(0x271)],'cid':_0x174635(0x219)}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+'</head><body>'+_0x174635(0x1f5)+_0x174635(0x1de)+_0x174635(0x1f5)+_0x174635(0x22e)+_0x174635(0x21a)+'<div>'+_0x174635(0x290)+_0x1fa716[0x0]['site_title']+_0x174635(0x1e8)+_0x174635(0x21a)+_0x174635(0x21a)+_0x174635(0x200)+_0x174635(0x1f5)+_0x174635(0x265)+_0x174635(0x1eb)+_0x32a082+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x174635(0x2a2)+_0x24d300+'\x20'+_0x174635(0x288)+_0x174635(0x246)+_0x174635(0x21a)+_0x174635(0x208)+_0x174635(0x1ed)+_0x174635(0x1f6)+_0x174635(0x222)+_0x174635(0x237)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x174635(0x263)+_0x174635(0x227)+_0x174635(0x27f)+_0x174635(0x1f1)+_0x174635(0x220)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x32fe55+'\x20'+_0x174635(0x274)+_0x174635(0x23b)+_0x174635(0x1f5)+_0x174635(0x1da)+_0x174635(0x273)+_0x1fa716[0x0][_0x174635(0x29b)]+_0x174635(0x246)+_0x174635(0x21a)+_0x174635(0x21a)+'</body></html>'};_0x22f641[_0x174635(0x267)](_0x20ad24,function(_0x314a5f,_0x1c26e7){var _0x2a0302=_0x174635;_0x314a5f?(console['log'](_0x314a5f),console[_0x2a0302(0x1d4)](_0x2a0302(0x28c))):console[_0x2a0302(0x1d4)](_0x2a0302(0x259));}),_0x3ab67d[_0x174635(0x2ac)](_0x174635(0x275),'purchase\x20data\x20add\x20successfully'),_0x3787ab[_0x174635(0x231)](_0x174635(0x2b1));}catch(_0x20ae39){console[_0x174635(0x1d4)](_0x20ae39);}}),router[a0_0x5c5e10(0x1d5)](a0_0x5c5e10(0x242),auth,async(_0x316b9e,_0x17d7ba)=>{var _0x49866f=a0_0x5c5e10;try{const {username:_0x2a436e,email:_0x1649e6,role:_0x35e692}=_0x316b9e[_0x49866f(0x232)],_0x24b936=_0x316b9e[_0x49866f(0x232)],_0x3fac84=await profile[_0x49866f(0x24b)]({'email':_0x24b936[_0x49866f(0x1ee)]}),_0x462d12=await master_shop[_0x49866f(0x268)](),_0x5eff1c=_0x316b9e[_0x49866f(0x29c)]['id'],_0x84dc23=await purchases_finished[_0x49866f(0x236)](_0x5eff1c),_0x771904=await suppliers['find']({});let _0x28f74b;if(_0x24b936[_0x49866f(0x1c0)]==_0x49866f(0x1d9)){const _0x9428bf=await staff[_0x49866f(0x24b)]({'email':_0x24b936[_0x49866f(0x1ee)]});_0x28f74b=await warehouse['find']({'status':_0x49866f(0x256),'name':_0x9428bf[_0x49866f(0x27a)]});}else _0x28f74b=await warehouse[_0x49866f(0x23a)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x49866f(0x2a0),'name':{'$first':_0x49866f(0x2a0)}}}]);const _0xb3e494=await product['find']({}),_0x4e249f=BayBinSelected(_0x84dc23['warehouse_name'],_0x84dc23[_0x49866f(0x221)]);let _0x3f8e7e=new Date(_0x84dc23['expiry_date']),_0x279f75=('0'+_0x3f8e7e['getDate']())[_0x49866f(0x224)](-0x2),_0x505e83=('0'+(_0x3f8e7e['getMonth']()+0x1))[_0x49866f(0x224)](-0x2),_0x2786b6=_0x3f8e7e['getFullYear'](),_0x91ed9e=_0x2786b6+'-'+_0x505e83+'-'+_0x279f75;if(_0x462d12[0x0][_0x49866f(0x24f)]=='English\x20(US)'){var _0x1f01af=users['English'];console[_0x49866f(0x1d4)](_0x1f01af);}else{if(_0x462d12[0x0][_0x49866f(0x24f)]==_0x49866f(0x2b7))var _0x1f01af=users[_0x49866f(0x2b7)];else{if(_0x462d12[0x0][_0x49866f(0x24f)]==_0x49866f(0x27e))var _0x1f01af=users['German'];else{if(_0x462d12[0x0][_0x49866f(0x24f)]==_0x49866f(0x240))var _0x1f01af=users['Spanish'];else{if(_0x462d12[0x0][_0x49866f(0x24f)]==_0x49866f(0x1f8))var _0x1f01af=users['French'];else{if(_0x462d12[0x0][_0x49866f(0x24f)]=='Portuguese\x20(BR)')var _0x1f01af=users[_0x49866f(0x223)];else{if(_0x462d12[0x0]['language']=='Chinese')var _0x1f01af=users[_0x49866f(0x2b3)];else{if(_0x462d12[0x0][_0x49866f(0x24f)]==_0x49866f(0x1e0))var _0x1f01af=users[_0x49866f(0x22a)];}}}}}}}_0x17d7ba[_0x49866f(0x229)](_0x49866f(0x23d),{'success':_0x316b9e['flash'](_0x49866f(0x275)),'errors':_0x316b9e['flash'](_0x49866f(0x2b6)),'role':_0x24b936,'profile':_0x3fac84,'purchases':_0x84dc23,'suppliers':_0x771904,'warehouse':_0x28f74b,'product':_0xb3e494,'master_shop':_0x462d12,'language':_0x1f01af,'ed_fullDate':_0x91ed9e,'dataSelected':_0x4e249f});}catch(_0x3492e3){console['log'](_0x3492e3);}}),router[a0_0x5c5e10(0x1d5)]('/view/:id',auth,async(_0x1e0589,_0x5df13d)=>{var _0x2e7820=a0_0x5c5e10;try{const {username:_0x3cf513,email:_0x4fc79d,role:_0x423845}=_0x1e0589[_0x2e7820(0x232)],_0x15ef33=_0x1e0589['user'],_0x2f1f69=await profile['findOne']({'email':_0x15ef33['email']}),_0xb2d7fd=await master_shop[_0x2e7820(0x268)](),_0x6a68aa=_0x1e0589[_0x2e7820(0x29c)]['id'],_0x51a468=await purchases_finished[_0x2e7820(0x236)](_0x6a68aa),_0x3cb987=await suppliers[_0x2e7820(0x268)]({});let _0x2a2e96;if(_0x15ef33[_0x2e7820(0x1c0)]=='staff'){const _0x17f049=await staff[_0x2e7820(0x24b)]({'email':_0x15ef33['email']});_0x2a2e96=await warehouse[_0x2e7820(0x268)]({'status':_0x2e7820(0x256),'name':_0x17f049['warehouse'],'warehouse_category':_0x2e7820(0x206)});}else _0x2a2e96=await warehouse[_0x2e7820(0x23a)]([{'$match':{'status':'Enabled','warehouse_category':_0x2e7820(0x206)}},{'$group':{'_id':_0x2e7820(0x2a0),'name':{'$first':'$name'}}}]);const _0xb3d886=await product[_0x2e7820(0x268)]({}),_0x1a0c10=BayBinSelected(_0x51a468[_0x2e7820(0x28f)],_0x51a468[_0x2e7820(0x221)]);let _0x48a2df=new Date(_0x51a468[_0x2e7820(0x24c)]),_0x2a7234=('0'+_0x48a2df['getDate']())[_0x2e7820(0x224)](-0x2),_0x33549e=('0'+(_0x48a2df[_0x2e7820(0x298)]()+0x1))[_0x2e7820(0x224)](-0x2),_0x3b3730=_0x48a2df['getFullYear'](),_0x4b6e33=_0x3b3730+'-'+_0x33549e+'-'+_0x2a7234;if(_0xb2d7fd[0x0][_0x2e7820(0x24f)]=='English\x20(US)'){var _0x2b3dee=users[_0x2e7820(0x1e6)];console['log'](_0x2b3dee);}else{if(_0xb2d7fd[0x0]['language']==_0x2e7820(0x2b7))var _0x2b3dee=users[_0x2e7820(0x2b7)];else{if(_0xb2d7fd[0x0][_0x2e7820(0x24f)]==_0x2e7820(0x27e))var _0x2b3dee=users[_0x2e7820(0x27e)];else{if(_0xb2d7fd[0x0][_0x2e7820(0x24f)]==_0x2e7820(0x240))var _0x2b3dee=users['Spanish'];else{if(_0xb2d7fd[0x0][_0x2e7820(0x24f)]==_0x2e7820(0x1f8))var _0x2b3dee=users['French'];else{if(_0xb2d7fd[0x0][_0x2e7820(0x24f)]=='Portuguese\x20(BR)')var _0x2b3dee=users[_0x2e7820(0x223)];else{if(_0xb2d7fd[0x0][_0x2e7820(0x24f)]==_0x2e7820(0x2b3))var _0x2b3dee=users[_0x2e7820(0x2b3)];else{if(_0xb2d7fd[0x0]['language']==_0x2e7820(0x1e0))var _0x2b3dee=users[_0x2e7820(0x22a)];}}}}}}}_0x5df13d[_0x2e7820(0x229)](_0x2e7820(0x287),{'success':_0x1e0589[_0x2e7820(0x2ac)](_0x2e7820(0x275)),'errors':_0x1e0589[_0x2e7820(0x2ac)](_0x2e7820(0x2b6)),'role':_0x15ef33,'profile':_0x2f1f69,'purchases':_0x51a468,'suppliers':_0x3cb987,'warehouse':_0x2a2e96,'product':_0xb3d886,'master_shop':_0xb2d7fd,'language':_0x2b3dee,'ed_fullDate':_0x4b6e33,'dataSelected':_0x1a0c10});}catch(_0x182a22){console['log'](_0x182a22);}}),router['post'](a0_0x5c5e10(0x2a3),auth,async(_0x5a4487,_0x30250c)=>{var _0x5ccfca=a0_0x5c5e10;try{const _0x51f0e7=_0x5a4487['params']['id'],_0x4aced4=await purchases_finished[_0x5ccfca(0x24b)]({'_id':_0x5a4487[_0x5ccfca(0x29c)]['id']}),_0x1856b6=await warehouse['findOne']({'name':_0x4aced4[_0x5ccfca(0x28f)],'room':_0x4aced4['room']});_0x4aced4[_0x5ccfca(0x281)][_0x5ccfca(0x277)](_0x41ad3f=>{var _0x240048=_0x5ccfca;const _0x257278=_0x1856b6[_0x240048(0x241)]['map'](_0x5981a0=>{var _0x3dd1a0=_0x240048;_0x5981a0[_0x3dd1a0(0x1ba)]==_0x41ad3f[_0x3dd1a0(0x1ba)]&&_0x5981a0[_0x3dd1a0(0x26b)]==_0x41ad3f['bay']&&(_0x5981a0[_0x3dd1a0(0x28e)]=parseInt(_0x5981a0[_0x3dd1a0(0x28e)])-parseInt(_0x41ad3f[_0x3dd1a0(0x284)]));});}),await _0x1856b6[_0x5ccfca(0x28a)]();const {invoice:_0x17ce5c,suppliers:_0x1629af,date:_0x5c8871,warehouse_name:_0x5521ad,prod_name:_0x3f8c59,prod_code:_0x383cd0,prod_qty:_0x8e5e9b,prod_unit:_0x2a6003,prod_secondunit:_0x26b14e,prod_level:_0x33897a,prod_isle:_0x37a2aa,prod_pallet:_0x69503b,note:_0x32835c,expiry_date:_0x3e06f5,batch_code:_0x161876,paid_amount:_0x1d331a,due_amount:_0x2b9a28,Room_name:_0x434e8f,primary_code:_0x9db6f4,secondary_code:_0x710b7a,PO_number:_0x56a959,JO_number:_0x55fe94}=_0x5a4487['body'];if(typeof _0x3f8c59==_0x5ccfca(0x22b))var _0x2ad165=[_0x5a4487[_0x5ccfca(0x1cc)][_0x5ccfca(0x2a9)]],_0x376e14=[_0x5a4487[_0x5ccfca(0x1cc)][_0x5ccfca(0x29e)]],_0x5ef037=[_0x5a4487['body']['prod_qty']],_0x29b851=[_0x5a4487[_0x5ccfca(0x1cc)][_0x5ccfca(0x1fd)]],_0x20db90=[_0x5a4487[_0x5ccfca(0x1cc)]['prod_secondunit']],_0x1d108d=[_0x5a4487[_0x5ccfca(0x1cc)]['prod_level']],_0x1eba9c=[_0x5a4487[_0x5ccfca(0x1cc)][_0x5ccfca(0x1d3)]],_0x44b7b9=[_0x5a4487[_0x5ccfca(0x1cc)][_0x5ccfca(0x1c8)]],_0x179ca2=[_0x5a4487[_0x5ccfca(0x1cc)][_0x5ccfca(0x269)]],_0x10bc3d=[_0x5a4487['body'][_0x5ccfca(0x24a)]],_0x172486=[_0x5a4487['body'][_0x5ccfca(0x24c)]];else var _0x2ad165=[..._0x5a4487[_0x5ccfca(0x1cc)][_0x5ccfca(0x2a9)]],_0x376e14=[..._0x5a4487[_0x5ccfca(0x1cc)][_0x5ccfca(0x29e)]],_0x5ef037=[..._0x5a4487[_0x5ccfca(0x1cc)][_0x5ccfca(0x289)]],_0x29b851=[..._0x5a4487['body'][_0x5ccfca(0x1fd)]],_0x20db90=[..._0x5a4487[_0x5ccfca(0x1cc)][_0x5ccfca(0x26f)]],_0x1d108d=[..._0x5a4487[_0x5ccfca(0x1cc)][_0x5ccfca(0x260)]],_0x1eba9c=[..._0x5a4487['body'][_0x5ccfca(0x1d3)]],_0x44b7b9=[..._0x5a4487[_0x5ccfca(0x1cc)][_0x5ccfca(0x1c8)]],_0x179ca2=[..._0x5a4487[_0x5ccfca(0x1cc)][_0x5ccfca(0x269)]],_0x10bc3d=[..._0x5a4487[_0x5ccfca(0x1cc)][_0x5ccfca(0x24a)]],_0x172486=[..._0x5a4487[_0x5ccfca(0x1cc)][_0x5ccfca(0x24c)]];const _0x24cd47=_0x2ad165[_0x5ccfca(0x294)](_0x30a4fb=>{return _0x30a4fb={'product_name':_0x30a4fb};});_0x376e14['forEach']((_0x31bb6e,_0x5c8abe)=>{var _0x39f335=_0x5ccfca;_0x24cd47[_0x5c8abe][_0x39f335(0x26c)]=_0x31bb6e;}),_0x5ef037[_0x5ccfca(0x277)]((_0x5a9c1a,_0x45eaf6)=>{_0x24cd47[_0x45eaf6]['quantity']=_0x5a9c1a;}),_0x29b851['forEach']((_0x596d61,_0x3f1ff7)=>{var _0x1c948d=_0x5ccfca;_0x24cd47[_0x3f1ff7][_0x1c948d(0x22f)]=_0x596d61;}),_0x20db90[_0x5ccfca(0x277)]((_0x58e8c5,_0x44e52c)=>{var _0x5e76c2=_0x5ccfca;_0x24cd47[_0x44e52c][_0x5e76c2(0x230)]=_0x58e8c5;}),_0x1d108d[_0x5ccfca(0x277)]((_0x2854d2,_0x39d507)=>{var _0x55d299=_0x5ccfca;_0x24cd47[_0x39d507][_0x55d299(0x26b)]=_0x2854d2;}),_0x1eba9c[_0x5ccfca(0x277)]((_0x484e38,_0x57e706)=>{var _0x24135b=_0x5ccfca;_0x24cd47[_0x57e706][_0x24135b(0x1d3)]=_0x484e38;}),_0x44b7b9['forEach']((_0x4e12be,_0x1d2327)=>{var _0x324bf8=_0x5ccfca;_0x24cd47[_0x1d2327][_0x324bf8(0x1c8)]=_0x4e12be;}),_0x179ca2[_0x5ccfca(0x277)]((_0x4fd110,_0x159314)=>{_0x24cd47[_0x159314]['maxStocks']=_0x4fd110;}),_0x10bc3d['forEach']((_0x3b865b,_0x1122da)=>{var _0x2703b7=_0x5ccfca;_0x24cd47[_0x1122da][_0x2703b7(0x24a)]=_0x3b865b;}),_0x172486['forEach']((_0x264070,_0x5eebfa)=>{_0x24cd47[_0x5eebfa]['expiry_date']=_0x264070;});const _0x1b5e4=_0x24cd47['filter'](_0x7e5baa=>_0x7e5baa['quantity']!=='0'&&_0x7e5baa[_0x5ccfca(0x284)]!=='');_0x4aced4[_0x5ccfca(0x21b)]=_0x17ce5c,_0x4aced4[_0x5ccfca(0x1c9)]=_0x1629af,_0x4aced4[_0x5ccfca(0x214)]=_0x5c8871,_0x4aced4[_0x5ccfca(0x28f)]=_0x5521ad,_0x4aced4[_0x5ccfca(0x281)]=_0x1b5e4,_0x4aced4['note']=_0x32835c,_0x4aced4[_0x5ccfca(0x1db)]=_0x1d331a,_0x4aced4[_0x5ccfca(0x1be)]=_0x2b9a28,_0x4aced4[_0x5ccfca(0x221)]=_0x434e8f,_0x4aced4[_0x5ccfca(0x26e)]=_0x56a959,_0x4aced4[_0x5ccfca(0x278)]=_0x55fe94;const _0x1c2679=await _0x4aced4[_0x5ccfca(0x28a)](),_0xca69b6=await warehouse[_0x5ccfca(0x24b)]({'name':_0x5a4487[_0x5ccfca(0x1cc)][_0x5ccfca(0x28f)],'room':_0x5a4487[_0x5ccfca(0x1cc)][_0x5ccfca(0x23f)]});_0x4aced4[_0x5ccfca(0x281)][_0x5ccfca(0x277)](_0x5dd118=>{var _0x2e62c2=_0x5ccfca,_0x44449e=0x0;const _0x4a3475=_0xca69b6[_0x2e62c2(0x241)][_0x2e62c2(0x294)](_0x48335c=>{var _0x1c7734=_0x2e62c2;_0x48335c[_0x1c7734(0x1ba)]==_0x5dd118['product_name']&&_0x48335c[_0x1c7734(0x26b)]==_0x5dd118[_0x1c7734(0x26b)]&&(_0x48335c[_0x1c7734(0x28e)]=parseInt(_0x48335c['product_stock'])+parseInt(_0x5dd118[_0x1c7734(0x284)]),_0x44449e++);});_0x44449e=='0'&&(_0xca69b6[_0x2e62c2(0x241)]=_0xca69b6[_0x2e62c2(0x241)][_0x2e62c2(0x23c)]({'product_name':_0x5dd118[_0x2e62c2(0x1ba)],'product_stock':_0x5dd118[_0x2e62c2(0x284)],'primary_code':_0x5dd118[_0x2e62c2(0x1d3)],'secondary_code':_0x5dd118[_0x2e62c2(0x1c8)],'product_code':_0x5dd118['product_code'],'bay':_0x5dd118['bay'],'maxProducts':_0x5dd118['maxStocks'],'unit':_0x5dd118[_0x2e62c2(0x22f)],'secondary_unit':_0x5dd118[_0x2e62c2(0x230)],'expiry_date':_0x5dd118['expiry_date']}));}),await _0xca69b6[_0x5ccfca(0x28a)]();const _0x336d99=await s_payment_data[_0x5ccfca(0x24b)]({'invoice':_0x5a4487['body'][_0x5ccfca(0x21b)]});if(_0x336d99===null){}else console[_0x5ccfca(0x1d4)](_0x5ccfca(0x1c9),_0x336d99,_0x5a4487[_0x5ccfca(0x1cc)]['invoice']),_0x336d99['suppliers']=_0x5a4487['body'][_0x5ccfca(0x1c9)],await _0x336d99['save']();_0x5a4487[_0x5ccfca(0x2ac)](_0x5ccfca(0x275),_0x5ccfca(0x213)),_0x30250c['redirect'](_0x5ccfca(0x2b1));}catch(_0x4a247a){console['log'](_0x4a247a);}}),router[a0_0x5c5e10(0x201)](a0_0x5c5e10(0x2ae),auth,async(_0x4bf4a7,_0x445432)=>{var _0xedba27=a0_0x5c5e10;try{const _0x28b808=_0x4bf4a7[_0xedba27(0x29c)]['id'],{invoice:_0x53b3c9,suppliers:_0x1c467e,payable:_0xb6bded,due_amount:_0x5645ab}=_0x4bf4a7['body'],_0x4709e0=await purchases[_0xedba27(0x236)](_0x28b808);var _0x3195e2=_0xb6bded-_0x5645ab;_0x4709e0[_0xedba27(0x1db)]=parseFloat(_0x4709e0[_0xedba27(0x1db)])+parseFloat(_0x5645ab),_0x4709e0[_0xedba27(0x1be)]=_0x3195e2;const _0x2da50d=await _0x4709e0[_0xedba27(0x28a)]();console[_0xedba27(0x1d4)](_0x2da50d);const _0x5aa69d=await s_payment_data[_0xedba27(0x24b)]({'invoice':_0x53b3c9});_0x5aa69d[_0xedba27(0x261)]=_0x3195e2,await _0x5aa69d[_0xedba27(0x28a)]();let _0x40c463=new Date(),_0x186cbc=('0'+_0x40c463[_0xedba27(0x1dd)]())[_0xedba27(0x224)](-0x2),_0x47db07=('0'+(_0x40c463[_0xedba27(0x298)]()+0x1))[_0xedba27(0x224)](-0x2),_0x23e735=_0x40c463['getFullYear'](),_0x2cf59f=_0x23e735+'-'+_0x47db07+'-'+_0x186cbc;const _0x27b65c=new suppliers_payment({'invoice':_0x53b3c9,'date':_0x23e735+'-'+_0x47db07+'-'+_0x186cbc,'suppliers':_0x1c467e,'reason':_0xedba27(0x215),'amount':_0x5645ab}),_0x1a9003=await _0x27b65c[_0xedba27(0x28a)]();_0x4bf4a7['flash'](_0xedba27(0x275),_0xedba27(0x225)),_0x445432[_0xedba27(0x231)](_0xedba27(0x2aa));}catch(_0x557c94){console['log'](_0x557c94);}}),router['get'](a0_0x5c5e10(0x1ea),auth,async(_0x5d1e1e,_0x38afbf)=>{var _0x50aa39=a0_0x5c5e10;try{const {username:_0x346df2,email:_0x44ebf9,role:_0xadfde6}=_0x5d1e1e[_0x50aa39(0x232)],_0x132fed=_0x5d1e1e[_0x50aa39(0x232)],_0xc7598=await profile[_0x50aa39(0x24b)]({'email':_0x132fed[_0x50aa39(0x1ee)]}),_0x150c09=await master_shop[_0x50aa39(0x268)]();console[_0x50aa39(0x1d4)](_0x50aa39(0x203),_0x150c09);const _0x4ab05b=_0x5d1e1e['params']['id'],_0x14d969=await purchases[_0x50aa39(0x236)](_0x4ab05b);console[_0x50aa39(0x1d4)](_0x14d969);const _0xf7a27b=await suppliers[_0x50aa39(0x24b)]({'name':_0x14d969['suppliers']});console[_0x50aa39(0x1d4)](_0xf7a27b);if(_0x150c09[0x0][_0x50aa39(0x24f)]==_0x50aa39(0x2a5)){var _0xbe669e=users[_0x50aa39(0x1e6)];console[_0x50aa39(0x1d4)](_0xbe669e);}else{if(_0x150c09[0x0][_0x50aa39(0x24f)]==_0x50aa39(0x2b7))var _0xbe669e=users[_0x50aa39(0x2b7)];else{if(_0x150c09[0x0][_0x50aa39(0x24f)]==_0x50aa39(0x27e))var _0xbe669e=users[_0x50aa39(0x27e)];else{if(_0x150c09[0x0][_0x50aa39(0x24f)]==_0x50aa39(0x240))var _0xbe669e=users[_0x50aa39(0x240)];else{if(_0x150c09[0x0]['language']==_0x50aa39(0x1f8))var _0xbe669e=users[_0x50aa39(0x1f8)];else{if(_0x150c09[0x0][_0x50aa39(0x24f)]==_0x50aa39(0x1c1))var _0xbe669e=users['Portuguese'];else{if(_0x150c09[0x0][_0x50aa39(0x24f)]==_0x50aa39(0x2b3))var _0xbe669e=users[_0x50aa39(0x2b3)];else{if(_0x150c09[0x0][_0x50aa39(0x24f)]==_0x50aa39(0x1e0))var _0xbe669e=users[_0x50aa39(0x22a)];}}}}}}}_0x38afbf['render'](_0x50aa39(0x266),{'success':_0x5d1e1e[_0x50aa39(0x2ac)](_0x50aa39(0x275)),'errors':_0x5d1e1e[_0x50aa39(0x2ac)](_0x50aa39(0x2b6)),'role':_0x132fed,'profile':_0xc7598,'master_shop':_0x150c09,'supplier':_0xf7a27b,'purchase':_0x14d969,'language':_0xbe669e});}catch(_0x5f4feb){console[_0x50aa39(0x1d4)](_0x5f4feb);}}),router[a0_0x5c5e10(0x1d5)](a0_0x5c5e10(0x204),auth,async(_0x43d604,_0x48f2e0)=>{var _0xdf310d=a0_0x5c5e10;try{const {username:_0x3b9bff,email:_0x4d3187,role:_0xc3a47d}=_0x43d604[_0xdf310d(0x232)],_0x572484=_0x43d604[_0xdf310d(0x232)],_0x2b76d9=await profile[_0xdf310d(0x24b)]({'email':_0x572484['email']}),_0x28acf2=await master_shop[_0xdf310d(0x268)]();console[_0xdf310d(0x1d4)]('master',_0x28acf2);const _0xfb7d4b=_0x43d604[_0xdf310d(0x29c)]['id'];console[_0xdf310d(0x1d4)](_0xfb7d4b);const _0x5f2982=await purchases_finished['findById'](_0xfb7d4b);console[_0xdf310d(0x1d4)](_0xdf310d(0x2ad),_0x5f2982);const _0x53cc92=await product['find']({}),_0x442f85=await warehouse['aggregate']([{'$match':{'name':_0x5f2982[_0xdf310d(0x28f)],'room':_0x5f2982[_0xdf310d(0x221)]}},{'$unwind':_0xdf310d(0x1c5)},{'$group':{'_id':_0xdf310d(0x297),'name':{'$first':_0xdf310d(0x295)},'product_stock':{'$first':_0xdf310d(0x1ca)},'bay':{'$first':_0xdf310d(0x258)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0xdf310d(0x2af)},'secondary_code':{'$first':_0xdf310d(0x1ff)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0xdf310d(0x2a7)},'rack':{'$first':_0xdf310d(0x257)}}}]);console[_0xdf310d(0x1d4)](_0xdf310d(0x29d),_0x442f85);let _0x5e0af9;if(_0x572484[_0xdf310d(0x1c0)]==_0xdf310d(0x1d9)){const _0x1deaf7=await staff[_0xdf310d(0x24b)]({'email':_0x572484[_0xdf310d(0x1ee)]});_0x5e0af9=await warehouse[_0xdf310d(0x268)]({'status':_0xdf310d(0x256),'name':_0x1deaf7[_0xdf310d(0x27a)],'warehouse_category':_0xdf310d(0x206),'name':'Return\x20Goods'});}else _0x5e0af9=await warehouse[_0xdf310d(0x23a)]([{'$match':{'status':_0xdf310d(0x256),'warehouse_category':'Finished\x20Goods','name':_0xdf310d(0x2a6)}},{'$group':{'_id':'$name','name':{'$first':_0xdf310d(0x2a0)}}}]);if(_0x28acf2[0x0][_0xdf310d(0x24f)]==_0xdf310d(0x2a5)){var _0x3827e6=users['English'];console[_0xdf310d(0x1d4)](_0x3827e6);}else{if(_0x28acf2[0x0][_0xdf310d(0x24f)]==_0xdf310d(0x2b7))var _0x3827e6=users[_0xdf310d(0x2b7)];else{if(_0x28acf2[0x0][_0xdf310d(0x24f)]=='German')var _0x3827e6=users[_0xdf310d(0x27e)];else{if(_0x28acf2[0x0][_0xdf310d(0x24f)]==_0xdf310d(0x240))var _0x3827e6=users[_0xdf310d(0x240)];else{if(_0x28acf2[0x0][_0xdf310d(0x24f)]==_0xdf310d(0x1f8))var _0x3827e6=users[_0xdf310d(0x1f8)];else{if(_0x28acf2[0x0][_0xdf310d(0x24f)]=='Portuguese\x20(BR)')var _0x3827e6=users[_0xdf310d(0x223)];else{if(_0x28acf2[0x0]['language']==_0xdf310d(0x2b3))var _0x3827e6=users[_0xdf310d(0x2b3)];else{if(_0x28acf2[0x0][_0xdf310d(0x24f)]==_0xdf310d(0x1e0))var _0x3827e6=users['Arabic'];}}}}}}}_0x48f2e0['render'](_0xdf310d(0x1e3),{'success':_0x43d604[_0xdf310d(0x2ac)](_0xdf310d(0x275)),'errors':_0x43d604[_0xdf310d(0x2ac)](_0xdf310d(0x2b6)),'role':_0x572484,'profile':_0x2b76d9,'user':_0x5f2982,'stock':_0x442f85,'master_shop':_0x28acf2,'product':_0x53cc92,'language':_0x3827e6,'warehouse':_0x5e0af9});}catch(_0x452a87){console[_0xdf310d(0x1d4)](_0x452a87);}}),router['post'](a0_0x5c5e10(0x204),auth,async(_0x5928ac,_0x3999a1)=>{var _0x41a40d=a0_0x5c5e10;try{const {invoice:_0x2fac70,date:_0x421823,warehouse_name:_0x44cd18,Room_name:_0x21f323,product_name:_0x95f555,purchase_quantity:_0x175b0d,stocks:_0x589940,return_qty:_0x2a40b4,note:_0x5b20b8,level:_0x1c9399,isle:_0x4592cd,pallet:_0x124659,to_warehouse_name:_0x4c5a17,to_Room_name:_0x326b7b}=_0x5928ac['body'],_0x8d07fb=await purchases_finished[_0x41a40d(0x24b)]({'_id':_0x5928ac[_0x41a40d(0x29c)]['id']}),_0x42df0b=await warehouse[_0x41a40d(0x24b)]({'name':_0x44cd18,'room':_0x21f323,'warehouse_category':'Finished\x20Goods'});if(typeof _0x95f555==_0x41a40d(0x22b))var _0x2404cd=[_0x5928ac[_0x41a40d(0x1cc)][_0x41a40d(0x1ba)]],_0x4613c5=[_0x5928ac[_0x41a40d(0x1cc)][_0x41a40d(0x1e7)]],_0x117a31=[_0x5928ac[_0x41a40d(0x1cc)][_0x41a40d(0x218)]],_0x1c8fa9=[_0x5928ac[_0x41a40d(0x1cc)][_0x41a40d(0x255)]],_0x21cced=[_0x5928ac['body']['level']],_0x3e4613=[_0x5928ac[_0x41a40d(0x1cc)]['product_code_hide']],_0x4b48e1=[_0x5928ac[_0x41a40d(0x1cc)]['primary_code_hide']],_0x11352a=[_0x5928ac[_0x41a40d(0x1cc)]['secondary_code_hide']];else var _0x2404cd=[..._0x5928ac['body']['product_name']],_0x4613c5=[..._0x5928ac[_0x41a40d(0x1cc)][_0x41a40d(0x1e7)]],_0x117a31=[..._0x5928ac[_0x41a40d(0x1cc)][_0x41a40d(0x218)]],_0x1c8fa9=[..._0x5928ac[_0x41a40d(0x1cc)][_0x41a40d(0x255)]],_0x21cced=[..._0x5928ac['body'][_0x41a40d(0x1ef)]],_0x3e4613=[..._0x5928ac['body'][_0x41a40d(0x1d0)]],_0x4b48e1=[..._0x5928ac[_0x41a40d(0x1cc)][_0x41a40d(0x1cd)]],_0x11352a=[..._0x5928ac[_0x41a40d(0x1cc)][_0x41a40d(0x27d)]];const _0x242ff5=_0x2404cd['map'](_0x153e14=>{return _0x153e14={'product_name':_0x153e14};});_0x4613c5['forEach']((_0x4cbaf1,_0x213141)=>{var _0x3225ca=_0x41a40d;_0x242ff5[_0x213141][_0x3225ca(0x1e7)]=_0x4cbaf1;}),_0x117a31[_0x41a40d(0x277)]((_0x107b1d,_0x225624)=>{_0x242ff5[_0x225624]['stock_quantity']=_0x107b1d;}),_0x1c8fa9[_0x41a40d(0x277)]((_0x45fda6,_0x116329)=>{var _0x37db7b=_0x41a40d;_0x242ff5[_0x116329][_0x37db7b(0x255)]=_0x45fda6;}),_0x21cced[_0x41a40d(0x277)]((_0x1883d2,_0x5f2234)=>{var _0x515d71=_0x41a40d;_0x242ff5[_0x5f2234][_0x515d71(0x26b)]=_0x1883d2;}),_0x3e4613['forEach']((_0x339920,_0x338bae)=>{var _0x11dc52=_0x41a40d;_0x242ff5[_0x338bae][_0x11dc52(0x26c)]=_0x339920;}),_0x4b48e1['forEach']((_0x4eef3b,_0x4d2534)=>{_0x242ff5[_0x4d2534]['primary_code']=_0x4eef3b;}),_0x11352a[_0x41a40d(0x277)]((_0x4da06c,_0x19dc6b)=>{_0x242ff5[_0x19dc6b]['secondary_code']=_0x4da06c;}),_0x242ff5[_0x41a40d(0x277)](_0x59e516=>{var _0x2bd990=_0x41a40d;console[_0x2bd990(0x1d4)](_0x59e516);const _0x31d03f=_0x42df0b[_0x2bd990(0x241)][_0x2bd990(0x294)](_0x5a1ed6=>{var _0x232cca=_0x2bd990;_0x5a1ed6[_0x232cca(0x1ba)]==_0x59e516[_0x232cca(0x1ba)]&&_0x5a1ed6[_0x232cca(0x26b)]==_0x59e516[_0x232cca(0x26b)]&&(console[_0x232cca(0x1d4)](parseInt(_0x5a1ed6[_0x232cca(0x28e)])+_0x232cca(0x1f3)+parseInt(_0x59e516['return_qty'])),_0x5a1ed6[_0x232cca(0x28e)]=parseInt(_0x5a1ed6[_0x232cca(0x28e)])-parseInt(_0x59e516[_0x232cca(0x255)]));});}),await _0x42df0b[_0x41a40d(0x28a)]();var _0x3ab570=0x0;_0x242ff5[_0x41a40d(0x277)](_0x2058f4=>{var _0x5d0219=_0x41a40d;(parseInt(_0x2058f4[_0x5d0219(0x1e7)])<parseInt(_0x2058f4[_0x5d0219(0x255)])||parseInt(_0x2058f4['stock_quantity'])<parseInt(_0x2058f4[_0x5d0219(0x255)]))&&_0x3ab570++;});if(_0x3ab570!=0x0)return _0x5928ac['flash']('errors','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x3999a1['redirect']('back');const _0x3b31ba=new purchases_return_finished({'invoice':_0x2fac70,'suppliers':_0x5928ac[_0x41a40d(0x1cc)]['suppliers'],'date':_0x421823,'warehouse_name':_0x44cd18,'return_product':_0x242ff5,'note':_0x5b20b8,'room':_0x21f323,'to_warehouse_name':_0x4c5a17,'to_room':_0x326b7b}),_0x5355fb=await _0x3b31ba[_0x41a40d(0x28a)](),_0x4ad642=await purchases_return_finished[_0x41a40d(0x24b)]({'invoice':_0x2fac70}),_0x3d3d0f=await warehouse[_0x41a40d(0x24b)]({'name':_0x4c5a17,'room':_0x326b7b,'warehouse_category':_0x41a40d(0x206)});_0x4ad642[_0x41a40d(0x264)][_0x41a40d(0x277)](_0x2629ae=>{var _0x4e779f=_0x41a40d,_0x546e62=0x0;const _0xd35e70=_0x3d3d0f[_0x4e779f(0x241)][_0x4e779f(0x294)](_0x1f30f3=>{var _0x2d133d=_0x4e779f;console[_0x2d133d(0x1d4)](_0x1f30f3['product_name']+'=='+_0x2629ae['product_name']+'&&'+_0x1f30f3[_0x2d133d(0x26b)]+'=='+_0x2629ae[_0x2d133d(0x26b)]),_0x1f30f3[_0x2d133d(0x1ba)]==_0x2629ae[_0x2d133d(0x1ba)]&&_0x1f30f3[_0x2d133d(0x26b)]==_0x2629ae[_0x2d133d(0x26b)]&&(_0x1f30f3[_0x2d133d(0x28e)]=parseInt(_0x1f30f3[_0x2d133d(0x28e)])-parseInt(_0x2629ae[_0x2d133d(0x255)]),_0x546e62++);});_0x546e62=='0'&&(_0x3d3d0f['product_details']=_0x3d3d0f[_0x4e779f(0x241)]['concat']({'product_name':_0x2629ae[_0x4e779f(0x1ba)],'product_stock':_0x2629ae[_0x4e779f(0x255)],'primary_code':_0x2629ae[_0x4e779f(0x1d3)],'secondary_code':_0x2629ae[_0x4e779f(0x1c8)],'product_code':_0x2629ae['product_code'],'bay':_0x2629ae[_0x4e779f(0x26b)],'maxProducts':0xf423f}));}),await _0x3d3d0f[_0x41a40d(0x28a)]();const _0x30ff9a=await purchases_finished[_0x41a40d(0x24b)]({'invoice':_0x2fac70});_0x30ff9a[_0x41a40d(0x245)]=_0x41a40d(0x2b4);const _0x410ebb=await _0x30ff9a[_0x41a40d(0x28a)](),_0x366642=new s_payment_data({'invoice':_0x2fac70,'suppliers':_0x5928ac[_0x41a40d(0x1cc)][_0x41a40d(0x1c9)],'reason':_0x41a40d(0x276)});await _0x366642['save']();const _0x1ce689=await master_shop[_0x41a40d(0x268)](),_0x5dbbe9=await email_settings['findOne'](),_0x25d8e3=await suppliers['findOne']({'name':_0x5928ac[_0x41a40d(0x1cc)]['suppliers']});_0x1ce689[0x0][_0x41a40d(0x24e)]==0x1?(right_currency=_0x1ce689[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x1ce689[0x0]['currency']);var _0x222f69=_0x2404cd,_0x36a1ce=_0x1c8fa9,_0x59089c='',_0x2589b6;for(_0x2589b6 in _0x222f69){_0x59089c+=_0x41a40d(0x1f6)+_0x41a40d(0x292)+_0x222f69[_0x2589b6]+'</td>'+_0x41a40d(0x292)+_0x36a1ce[_0x2589b6]+_0x41a40d(0x2a4)+_0x41a40d(0x220);}let _0x1255ab=nodemailer[_0x41a40d(0x27c)]({'service':_0x41a40d(0x1f2),'auth':{'user':_0x5dbbe9[_0x41a40d(0x1ee)],'pass':_0x5dbbe9[_0x41a40d(0x25f)]}}),_0x2c16c3={'from':_0x5dbbe9['email'],'to':_0x25d8e3[_0x41a40d(0x1ee)],'subject':_0x41a40d(0x24d),'attachments':[{'filename':_0x41a40d(0x286),'path':__dirname+_0x41a40d(0x1e1)+_0x41a40d(0x28d)+_0x1ce689[0x0]['image'],'cid':_0x41a40d(0x219)}],'html':'<!DOCTYPE\x20html>'+_0x41a40d(0x25b)+_0x41a40d(0x243)+_0x41a40d(0x1f5)+_0x41a40d(0x1de)+'<div>'+_0x41a40d(0x22e)+_0x41a40d(0x21a)+_0x41a40d(0x1f5)+_0x41a40d(0x290)+_0x1ce689[0x0][_0x41a40d(0x29b)]+_0x41a40d(0x1e8)+_0x41a40d(0x21a)+_0x41a40d(0x21a)+'<hr\x20class=\x22my-3\x22>'+_0x41a40d(0x1f5)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x41a40d(0x1eb)+_0x2fac70+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x41a40d(0x2a2)+_0x421823+'\x20'+_0x41a40d(0x288)+_0x41a40d(0x246)+'</div>'+_0x41a40d(0x208)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x41a40d(0x1f6)+_0x41a40d(0x222)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x41a40d(0x209)+_0x41a40d(0x1f7)+'</tr>'+_0x41a40d(0x2a8)+_0x41a40d(0x21f)+'\x20'+_0x59089c+'\x20'+_0x41a40d(0x274)+'</table>'+_0x41a40d(0x1f5)+_0x41a40d(0x1da)+'<h5>'+_0x1ce689[0x0][_0x41a40d(0x29b)]+'</h5>'+_0x41a40d(0x21a)+'</div>'+_0x41a40d(0x216)};_0x1255ab['sendMail'](_0x2c16c3,function(_0x4f54c0,_0x26bd50){var _0x5af44d=_0x41a40d;_0x4f54c0?console[_0x5af44d(0x1d4)](_0x5af44d(0x28c)):console[_0x5af44d(0x1d4)](_0x5af44d(0x259));}),_0x5928ac['flash'](_0x41a40d(0x275),_0x41a40d(0x1bf)),_0x3999a1['redirect'](_0x41a40d(0x2b1));}catch(_0x390413){_0x3999a1[_0x41a40d(0x226)](0xc8)['json']({'message':_0x390413['message']});}}),router[a0_0x5c5e10(0x1d5)]('/barcode/:id',auth,async(_0x23df24,_0x176d82)=>{var _0x5bccf1=a0_0x5c5e10;try{const {username:_0x31b506,email:_0x24d2fd,role:_0x580467}=_0x23df24[_0x5bccf1(0x232)],_0x11db73=_0x23df24[_0x5bccf1(0x232)],_0x581154=await profile[_0x5bccf1(0x24b)]({'email':_0x11db73[_0x5bccf1(0x1ee)]}),_0x40b3be=await master_shop[_0x5bccf1(0x268)](),_0x3bd305=_0x23df24[_0x5bccf1(0x29c)]['id'],_0x27ab20=await purchases_finished['findById'](_0x3bd305);if(_0x40b3be[0x0]['language']==_0x5bccf1(0x2a5))var _0x4e9fba=users[_0x5bccf1(0x1e6)];else{if(_0x40b3be[0x0][_0x5bccf1(0x24f)]==_0x5bccf1(0x2b7))var _0x4e9fba=users[_0x5bccf1(0x2b7)];else{if(_0x40b3be[0x0][_0x5bccf1(0x24f)]==_0x5bccf1(0x27e))var _0x4e9fba=users[_0x5bccf1(0x27e)];else{if(_0x40b3be[0x0][_0x5bccf1(0x24f)]=='Spanish')var _0x4e9fba=users['Spanish'];else{if(_0x40b3be[0x0][_0x5bccf1(0x24f)]==_0x5bccf1(0x1f8))var _0x4e9fba=users[_0x5bccf1(0x1f8)];else{if(_0x40b3be[0x0][_0x5bccf1(0x24f)]==_0x5bccf1(0x1c1))var _0x4e9fba=users[_0x5bccf1(0x223)];else{if(_0x40b3be[0x0]['language']==_0x5bccf1(0x2b3))var _0x4e9fba=users['Chinese'];else{if(_0x40b3be[0x0]['language']==_0x5bccf1(0x1e0))var _0x4e9fba=users['Arabic'];}}}}}}}_0x176d82[_0x5bccf1(0x229)](_0x5bccf1(0x2b2),{'success':_0x23df24['flash']('success'),'errors':_0x23df24[_0x5bccf1(0x2ac)](_0x5bccf1(0x2b6)),'role':_0x11db73,'profile':_0x581154,'alldata':_0x27ab20,'master_shop':_0x40b3be,'language':_0x4e9fba});}catch(_0x46b759){console[_0x5bccf1(0x1d4)](_0x46b759);}}),router[a0_0x5c5e10(0x201)](a0_0x5c5e10(0x210),async(_0x102c27,_0x51183d)=>{var _0x55e1ff=a0_0x5c5e10;const {product_code:_0x34f307}=_0x102c27['body'];var _0x1a39b4;const _0x4aa461=await product[_0x55e1ff(0x23a)]([{'$match':{'primary_code':_0x34f307}},{'$group':{'_id':'$_id','name':{'$first':_0x55e1ff(0x2a0)},'category':{'$first':_0x55e1ff(0x23e)},'brand':{'$first':_0x55e1ff(0x1fc)},'unit':{'$first':_0x55e1ff(0x1e5)},'alertquantity':{'$first':_0x55e1ff(0x29a)},'product_code':{'$first':_0x55e1ff(0x1d7)},'primary_code':{'$first':_0x55e1ff(0x205)},'secondary_code':{'$first':_0x55e1ff(0x238)},'maxStocks':{'$first':_0x55e1ff(0x1bb)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x55e1ff(0x207)},'maxProducts':{'$first':_0x55e1ff(0x299)},'CBM':{'$first':{'$toDouble':_0x55e1ff(0x1d8)}}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'CBM':0x1}}]),_0x4c85d2=await product[_0x55e1ff(0x23a)]([{'$match':{'secondary_code':_0x34f307}},{'$group':{'_id':_0x55e1ff(0x212),'name':{'$first':_0x55e1ff(0x2a0)},'category':{'$first':_0x55e1ff(0x23e)},'brand':{'$first':'$brand'},'unit':{'$first':_0x55e1ff(0x1e5)},'alertquantity':{'$first':_0x55e1ff(0x29a)},'product_code':{'$first':_0x55e1ff(0x1d7)},'primary_code':{'$first':_0x55e1ff(0x205)},'secondary_code':{'$first':_0x55e1ff(0x238)},'maxStocks':{'$first':_0x55e1ff(0x1bb)},'maxProdPerUnit':{'$first':_0x55e1ff(0x252)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x55e1ff(0x207)},'CBM':{'$first':{'$toDouble':'$CBM'}}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'CBM':0x1}}]);if(_0x4aa461[_0x55e1ff(0x1c7)]>0x0)_0x1a39b4=_0x4aa461;else _0x4c85d2[_0x55e1ff(0x1c7)]>0x0&&(_0x1a39b4=_0x4c85d2);_0x51183d['json'](_0x1a39b4);}),router[a0_0x5c5e10(0x201)]('/CheckingWarehouse',async(_0x5df6e1,_0x5a8739)=>{var _0xa4f110=a0_0x5c5e10;const {productCode:_0x59b60d,bay:_0x31a36b,warehouses:_0x4d8aba,room:_0x41ba09}=_0x5df6e1['body'];console[_0xa4f110(0x1d4)](_0x5df6e1[_0xa4f110(0x1cc)]);try{const _0x1694b2=await warehouse[_0xa4f110(0x23a)]([{'$match':{'name':_0x4d8aba,'room':_0x41ba09}},{'$unwind':_0xa4f110(0x1c5)},{'$match':{'product_details.pallet':parseInt(_0x31a36b)}},{'$group':{'_id':_0xa4f110(0x295),'name':{'$first':_0xa4f110(0x295)},'product_stock':{'$sum':_0xa4f110(0x1ca)},'pallet':{'$first':_0xa4f110(0x26d)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);console[_0xa4f110(0x1d4)]('data',_0x1694b2),_0x5a8739[_0xa4f110(0x226)](0xc8)[_0xa4f110(0x239)](_0x1694b2);}catch(_0x8b7823){_0x5a8739[_0xa4f110(0x226)](0x194)[_0xa4f110(0x239)]({'message':_0x8b7823[_0xa4f110(0x1cb)]});}}),module['exports']=router;