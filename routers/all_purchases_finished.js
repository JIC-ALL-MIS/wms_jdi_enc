var a0_0x5274b9=a0_0x34af;(function(_0x2b4d2a,_0x3aa4c1){var _0x48ea5a=a0_0x34af,_0x3f1f22=_0x2b4d2a();while(!![]){try{var _0xd0cfff=parseInt(_0x48ea5a(0x10d))/0x1*(parseInt(_0x48ea5a(0x1d1))/0x2)+-parseInt(_0x48ea5a(0x13a))/0x3+parseInt(_0x48ea5a(0x102))/0x4+parseInt(_0x48ea5a(0x15a))/0x5+parseInt(_0x48ea5a(0x116))/0x6+-parseInt(_0x48ea5a(0x14e))/0x7*(parseInt(_0x48ea5a(0x129))/0x8)+-parseInt(_0x48ea5a(0x131))/0x9;if(_0xd0cfff===_0x3aa4c1)break;else _0x3f1f22['push'](_0x3f1f22['shift']());}catch(_0x135381){_0x3f1f22['push'](_0x3f1f22['shift']());}}}(a0_0x3dc5,0xb8815));const express=require(a0_0x5274b9(0x1de)),app=express(),router=express[a0_0x5274b9(0x10b)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x5274b9(0x156)),auth=require(a0_0x5274b9(0x1b8)),nodemailer=require(a0_0x5274b9(0x1da));var ejs=require(a0_0x5274b9(0x13b));const path=require(a0_0x5274b9(0xff)),users=require(a0_0x5274b9(0x189));router[a0_0x5274b9(0x13c)](a0_0x5274b9(0x1af),auth,async(_0x3c1d15,_0x3875bc)=>{var _0x513eda=a0_0x5274b9;try{const {username:_0xaad92d,email:_0x403e80,role:_0x579564}=_0x3c1d15[_0x513eda(0x11b)],_0x36fec0=_0x3c1d15[_0x513eda(0x11b)],_0x2ed736=await profile['findOne']({'email':_0x36fec0['email']}),_0x5ec969=await staff[_0x513eda(0x16b)]({'email':_0x36fec0[_0x513eda(0x123)]});if(_0x36fec0['role']==_0x513eda(0x148)){const _0x563650=await staff['findOne']({'email':_0x36fec0['email']});}const _0x461c92=await master_shop[_0x513eda(0x115)]();let _0x22bb5a;if(_0x36fec0[_0x513eda(0x1a2)]==_0x513eda(0x148)){const _0x2b8131=await staff[_0x513eda(0x16b)]({'email':_0x36fec0[_0x513eda(0x123)]});_0x22bb5a=await purchases_finished[_0x513eda(0x16a)]([{'$match':{'warehouse_name':_0x2b8131[_0x513eda(0xfd)]}},{'$lookup':{'from':_0x513eda(0x1c0),'localField':_0x513eda(0x1c0),'foreignField':_0x513eda(0x193),'as':_0x513eda(0x137)}},{'$unwind':_0x513eda(0x1cc)},{'$unwind':_0x513eda(0x1a6)},{'$group':{'_id':_0x513eda(0x177),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x513eda(0x1db)},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x513eda(0x1ab)},'product':{'$push':_0x513eda(0x1a6)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x513eda(0x143)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x513eda(0x194)},'expiry_date':{'$first':_0x513eda(0x104)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x513eda(0x17e)},'level':{'$addToSet':_0x513eda(0x1ea)},'isle':{'$addToSet':'$product.isle'},'pallet':{'$addToSet':'$product.pallet'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'pallet':0x1}}]);}else _0x22bb5a=await purchases_finished['aggregate']([{'$lookup':{'from':_0x513eda(0x1c0),'localField':_0x513eda(0x1c0),'foreignField':_0x513eda(0x193),'as':_0x513eda(0x137)}},{'$unwind':'$suppliers_docs'},{'$unwind':'$product'},{'$group':{'_id':'$_id','invoice':{'$first':_0x513eda(0x16c)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x513eda(0xfb)},'warehouse_name':{'$first':_0x513eda(0x128)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':'$product'},'note':{'$first':_0x513eda(0x107)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x513eda(0x15e)},'return_data':{'$first':_0x513eda(0x15b)},'batch_code':{'$first':_0x513eda(0x194)},'expiry_date':{'$first':_0x513eda(0x104)},'suppliers_docs':{'$first':_0x513eda(0x1cc)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x513eda(0x1ea)},'isle':{'$addToSet':'$product.isle'},'pallet':{'$addToSet':'$product.pallet'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'pallet':0x1}}]);if(_0x461c92[0x0]['language']==_0x513eda(0x1e1)){var _0x17d00a=users[_0x513eda(0x1ec)];console[_0x513eda(0x185)](_0x17d00a);}else{if(_0x461c92[0x0]['language']==_0x513eda(0x19b))var _0x17d00a=users['Hindi'];else{if(_0x461c92[0x0]['language']=='German')var _0x17d00a=users[_0x513eda(0x1dc)];else{if(_0x461c92[0x0]['language']==_0x513eda(0x1e0))var _0x17d00a=users[_0x513eda(0x1e0)];else{if(_0x461c92[0x0]['language']==_0x513eda(0x1c8))var _0x17d00a=users[_0x513eda(0x1c8)];else{if(_0x461c92[0x0][_0x513eda(0x1f7)]==_0x513eda(0x132))var _0x17d00a=users[_0x513eda(0x161)];else{if(_0x461c92[0x0][_0x513eda(0x1f7)]=='Chinese')var _0x17d00a=users['Chinese'];else{if(_0x461c92[0x0][_0x513eda(0x1f7)]==_0x513eda(0x12a))var _0x17d00a=users[_0x513eda(0x10c)];}}}}}}}_0x3875bc[_0x513eda(0x195)](_0x513eda(0x176),{'success':_0x3c1d15[_0x513eda(0x1f8)](_0x513eda(0x1cd)),'errors':_0x3c1d15[_0x513eda(0x1f8)](_0x513eda(0x10e)),'purchases':_0x22bb5a,'role':_0x36fec0,'profile':_0x2ed736,'master_shop':_0x461c92,'language':_0x17d00a});}catch(_0x1f50bb){console[_0x513eda(0x185)](_0x513eda(0x170),_0x1f50bb),_0x3875bc['status'](0xc8)[_0x513eda(0x1c4)]({'message':_0x1f50bb[_0x513eda(0x16e)]});}});function a0_0x34af(_0x115826,_0x3172aa){var _0x3dc585=a0_0x3dc5();return a0_0x34af=function(_0x34af11,_0x8c53f4){_0x34af11=_0x34af11-0xf9;var _0x8d4ed6=_0x3dc585[_0x34af11];return _0x8d4ed6;},a0_0x34af(_0x115826,_0x3172aa);}function BayBinSelected(_0x3defd3,_0x23ab0e){var _0x4c2cb6=a0_0x5274b9,_0xdb1eb=[],_0x157d37=[];if(_0x3defd3==_0x4c2cb6(0x171)){switch(_0x23ab0e){case _0x4c2cb6(0x120):_0xdb1eb=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x4c2cb6(0x155):_0xdb1eb=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x157d37=['DG'];}else{if(_0x3defd3==_0x4c2cb6(0x126)){switch(_0x23ab0e){case _0x4c2cb6(0x120):_0xdb1eb=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x4c2cb6(0x155):_0xdb1eb=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x157d37=['FG'];}}return{'levels':_0xdb1eb,'identify':_0x157d37};}async function getRandom8DigitNumber(){var _0x15f9ec=a0_0x5274b9;const _0x349de8=0x989680,_0x472823=0x5f5e0ff,_0xd286d7=Math['floor'](Math['random']()*(_0x472823-_0x349de8+0x1))+_0x349de8;var _0x242e22;const _0x348974=await purchases_finished[_0x15f9ec(0x16b)]({'invoice':'INC-'+_0xd286d7});return _0x348974&&_0x348974[_0x15f9ec(0x11f)]>0x0?_0x242e22=_0x15f9ec(0x1bb)+_0xd286d7:_0x242e22=_0x15f9ec(0x1bb)+_0xd286d7,_0x242e22;}router['get'](a0_0x5274b9(0x1b4),auth,async(_0x52aa04,_0x341594)=>{var _0x76ccbd=a0_0x5274b9;try{const {username:_0x1ab2a2,email:_0x9fbd4d,role:_0x2516dd}=_0x52aa04[_0x76ccbd(0x11b)],_0x4ee69a=_0x52aa04[_0x76ccbd(0x11b)],_0x66e1b9=await profile[_0x76ccbd(0x16b)]({'email':_0x4ee69a[_0x76ccbd(0x123)]}),_0x4e8fb0=await master_shop['find'](),_0x522f31=await staff[_0x76ccbd(0x16b)]({'email':_0x4ee69a[_0x76ccbd(0x123)]}),_0x387ed9=await suppliers[_0x76ccbd(0x115)]({});let _0x37f77d;if(_0x4ee69a['role']=='staff'){const _0x4369ba=await staff[_0x76ccbd(0x16b)]({'email':_0x4ee69a[_0x76ccbd(0x123)]});_0x37f77d=await warehouse[_0x76ccbd(0x16a)]([{'$match':{'status':_0x76ccbd(0x188),'name':_0x4369ba['warehouse']}},{'$group':{'_id':_0x76ccbd(0x1fd),'name':{'$first':'$name'}}}]);}else _0x37f77d=await warehouse[_0x76ccbd(0x16a)]([{'$match':{'status':_0x76ccbd(0x188),'name':{'$ne':_0x76ccbd(0x1c5)}}},{'$group':{'_id':'$name','name':{'$first':_0x76ccbd(0x1fd)}}}]);const _0x5033b1=await product[_0x76ccbd(0x115)]({}),_0x491cce=await warehouse['find']({'status':'Enabled'}),_0x4602c2=await purchases_finished['find']({}),_0x1606b5=_0x4602c2['length']+0x1,_0x3166dd=_0x76ccbd(0x1bb)+_0x1606b5['toString']()['padStart'](0x5,'0');var _0x2fb322=['Ambient',_0x76ccbd(0x1dd)];if(_0x4e8fb0[0x0][_0x76ccbd(0x1f7)]=='English\x20(US)')var _0x3278fc=users[_0x76ccbd(0x1ec)];else{if(_0x4e8fb0[0x0][_0x76ccbd(0x1f7)]==_0x76ccbd(0x19b))var _0x3278fc=users[_0x76ccbd(0x19b)];else{if(_0x4e8fb0[0x0][_0x76ccbd(0x1f7)]==_0x76ccbd(0x1dc))var _0x3278fc=users[_0x76ccbd(0x1dc)];else{if(_0x4e8fb0[0x0][_0x76ccbd(0x1f7)]==_0x76ccbd(0x1e0))var _0x3278fc=users['Spanish'];else{if(_0x4e8fb0[0x0][_0x76ccbd(0x1f7)]==_0x76ccbd(0x1c8))var _0x3278fc=users[_0x76ccbd(0x1c8)];else{if(_0x4e8fb0[0x0][_0x76ccbd(0x1f7)]==_0x76ccbd(0x132))var _0x3278fc=users[_0x76ccbd(0x161)];else{if(_0x4e8fb0[0x0][_0x76ccbd(0x1f7)]==_0x76ccbd(0x138))var _0x3278fc=users[_0x76ccbd(0x138)];else{if(_0x4e8fb0[0x0][_0x76ccbd(0x1f7)]==_0x76ccbd(0x12a))var _0x3278fc=users['Arabic'];}}}}}}}const _0x320caa=getRandom8DigitNumber();_0x320caa['then'](_0x31ae20=>{var _0x3294f9=_0x76ccbd;_0x341594[_0x3294f9(0x195)](_0x3294f9(0x1f6),{'success':_0x52aa04[_0x3294f9(0x1f8)](_0x3294f9(0x1cd)),'errors':_0x52aa04['flash']('errors'),'role':_0x4ee69a,'profile':_0x66e1b9,'suppliers':_0x387ed9,'warehouse':_0x37f77d,'product':_0x5033b1,'invoice':_0x31ae20,'master_shop':_0x4e8fb0,'language':_0x3278fc,'find_data':_0x491cce,'rooms_data':_0x2fb322});})[_0x76ccbd(0x1e9)](_0x2a931d=>{var _0x451198=_0x76ccbd;_0x52aa04[_0x451198(0x1f8)]('errors',_0x451198(0x1b7)),_0x341594['redirect'](_0x451198(0x1c6));});}catch(_0x25ebfb){console[_0x76ccbd(0x185)](_0x25ebfb);}}),router[a0_0x5274b9(0x13c)](a0_0x5274b9(0x14f),auth,async(_0x3ceeb7,_0x54e41c)=>{var _0xce1af9=a0_0x5274b9;try{const _0x561aa9=_0x3ceeb7[_0xce1af9(0x130)]['id'];console[_0xce1af9(0x185)](_0x561aa9);const _0x342f65=await master_shop['find']();console['log'](_0xce1af9(0x150),_0x342f65);const _0x2ced4e=await product[_0xce1af9(0x16b)]({'name':_0x561aa9});console[_0xce1af9(0x185)]('product',_0x2ced4e),_0x54e41c[_0xce1af9(0x141)](0xc8)['json']({'product_data':_0x2ced4e,'master':_0x342f65});}catch(_0x366200){console[_0xce1af9(0x185)](_0xce1af9(0x19a),_0x366200);}}),router[a0_0x5274b9(0x14c)](a0_0x5274b9(0x1b4),auth,async(_0x3361bd,_0x59fdfa)=>{var _0x35c2e9=a0_0x5274b9;try{const {invoice:_0xdb8b84,date:_0x24e464,warehouse_name:_0x1ae665,prod_name:_0x2685fe,prod_code:_0x125b72,prod_qty:_0x20420d,prod_unit:_0x1a0bcc,prod_secondunit:_0x3a6387,prod_level:_0x263e15,prod_isle:_0x21cfba,prod_pallet:_0x523bf7,note:_0x5aed5d,expiry_date:_0x2cf3d4,batch_code:_0x47d777,payable:_0x4bfbc4,due_amount:_0x153f81,Room_name:_0x5d0ab0,primary_code:_0x46cf13,secondary_code:_0x7065a4,MaxStocks_data:_0x51e53e,PO_number:_0x5b04fc,SCRN:_0x1c99b5,JO_number:_0x230717,ReqBy:_0x1f065b,dateofreq:_0x469b2a,typeservicesData:_0x17c776,driver:_0x4d93f2,plate:_0x11b5bd,van:_0x3906b9,DRSI:_0x148546,typevehicle:_0x46453a,TSU:_0x1a7768,TFU:_0x36f188}=_0x3361bd[_0x35c2e9(0x135)];if(typeof _0x2685fe==_0x35c2e9(0x1ae))var _0x23ba79=[_0x3361bd['body'][_0x35c2e9(0x191)]],_0x4e3d0d=[_0x3361bd['body'][_0x35c2e9(0x1a1)]],_0x8d5761=[_0x3361bd[_0x35c2e9(0x135)][_0x35c2e9(0x1ba)]],_0x98944c=[_0x3361bd[_0x35c2e9(0x135)][_0x35c2e9(0x160)]],_0x13b301=[_0x3361bd['body'][_0x35c2e9(0x140)]],_0x429212=[_0x3361bd[_0x35c2e9(0x135)][_0x35c2e9(0x1f0)]],_0x4ba292=[_0x3361bd['body'][_0x35c2e9(0x1b5)]],_0x148e9c=[_0x3361bd[_0x35c2e9(0x135)][_0x35c2e9(0x1e7)]],_0x25a139=[_0x3361bd['body'][_0x35c2e9(0x144)]],_0x45407e=[_0x3361bd[_0x35c2e9(0x135)][_0x35c2e9(0x113)]],_0x20536e=[_0x3361bd['body']['expiry_date']],_0x4b0c3d=[_0x3361bd[_0x35c2e9(0x135)][_0x35c2e9(0x15f)]],_0x38e99c=[_0x3361bd['body'][_0x35c2e9(0x1e3)]],_0xa91f06=[_0x3361bd[_0x35c2e9(0x135)]['prod_cat']],_0x253bd7=[_0x3361bd['body'][_0x35c2e9(0x18b)]],_0x3b14b6=[_0x3361bd[_0x35c2e9(0x135)]['type']],_0x50b834=[_0x3361bd[_0x35c2e9(0x135)][_0x35c2e9(0x112)]],_0x4ad941=[_0x3361bd[_0x35c2e9(0x135)][_0x35c2e9(0x19e)]];else var _0x23ba79=[..._0x3361bd[_0x35c2e9(0x135)]['prod_name']],_0x4e3d0d=[..._0x3361bd[_0x35c2e9(0x135)]['prod_code']],_0x8d5761=[..._0x3361bd[_0x35c2e9(0x135)][_0x35c2e9(0x1ba)]],_0x98944c=[..._0x3361bd[_0x35c2e9(0x135)][_0x35c2e9(0x160)]],_0x13b301=[..._0x3361bd[_0x35c2e9(0x135)][_0x35c2e9(0x140)]],_0x429212=[..._0x3361bd[_0x35c2e9(0x135)][_0x35c2e9(0x1f0)]],_0x4ba292=[..._0x3361bd[_0x35c2e9(0x135)]['primary_code']],_0x148e9c=[..._0x3361bd[_0x35c2e9(0x135)][_0x35c2e9(0x1e7)]],_0x25a139=[..._0x3361bd[_0x35c2e9(0x135)]['MaxStocks_data']],_0x45407e=[..._0x3361bd['body'][_0x35c2e9(0x113)]],_0x20536e=[..._0x3361bd[_0x35c2e9(0x135)][_0x35c2e9(0x145)]],_0x4b0c3d=[..._0x3361bd[_0x35c2e9(0x135)]['product_date']],_0x38e99c=[..._0x3361bd[_0x35c2e9(0x135)][_0x35c2e9(0x1e3)]],_0xa91f06=[..._0x3361bd[_0x35c2e9(0x135)][_0x35c2e9(0x152)]],_0x253bd7=[..._0x3361bd['body'][_0x35c2e9(0x18b)]],_0x3b14b6=[..._0x3361bd[_0x35c2e9(0x135)][_0x35c2e9(0x117)]],_0x50b834=[..._0x3361bd[_0x35c2e9(0x135)]['CBM']],_0x4ad941=[..._0x3361bd[_0x35c2e9(0x135)][_0x35c2e9(0x19e)]];const _0x43540c=_0x23ba79[_0x35c2e9(0x184)](_0x3a6596=>{return _0x3a6596={'product_name':_0x3a6596};});_0x4e3d0d[_0x35c2e9(0x108)]((_0x579076,_0xd7b8e4)=>{var _0x7ef2b7=_0x35c2e9;_0x43540c[_0xd7b8e4][_0x7ef2b7(0x1ad)]=_0x579076;}),_0x8d5761[_0x35c2e9(0x108)]((_0x2ccce3,_0x257979)=>{var _0x2ab016=_0x35c2e9;_0x43540c[_0x257979][_0x2ab016(0x151)]=_0x2ccce3;}),_0x98944c[_0x35c2e9(0x108)]((_0x34ebd4,_0x2b8111)=>{var _0x1d289c=_0x35c2e9;_0x43540c[_0x2b8111][_0x1d289c(0x1be)]=_0x34ebd4;}),_0x13b301['forEach']((_0x5d2053,_0x2f2aff)=>{var _0x42b259=_0x35c2e9;_0x43540c[_0x2f2aff][_0x42b259(0x127)]=_0x5d2053;}),_0x429212['forEach']((_0x4880b8,_0x233164)=>{var _0x404a23=_0x35c2e9,_0x3c3282=_0x4880b8[_0x404a23(0x1b6)](0x1);_0x43540c[_0x233164]['isle']=_0x4880b8[0x0],_0x43540c[_0x233164][_0x404a23(0xfc)]=_0x3c3282;}),_0x3b14b6[_0x35c2e9(0x108)]((_0x3027da,_0x1dfc42)=>{var _0xb6d540=_0x35c2e9;_0x43540c[_0x1dfc42][_0xb6d540(0x167)]=_0x3027da;}),_0x4ba292[_0x35c2e9(0x108)]((_0x1a15b0,_0x2ece26)=>{var _0x42a71f=_0x35c2e9;_0x43540c[_0x2ece26][_0x42a71f(0x1b5)]=_0x1a15b0;}),_0x148e9c['forEach']((_0x15db9f,_0x4f0540)=>{var _0x3419f9=_0x35c2e9;_0x43540c[_0x4f0540][_0x3419f9(0x1e7)]=_0x15db9f;}),_0x25a139[_0x35c2e9(0x108)]((_0x9a940d,_0x2e899f)=>{_0x43540c[_0x2e899f]['maxStocks']=_0x9a940d;}),_0x45407e[_0x35c2e9(0x108)]((_0x1cbf90,_0x222661)=>{var _0x3e6c16=_0x35c2e9;_0x43540c[_0x222661][_0x3e6c16(0x113)]=_0x1cbf90;}),_0x20536e['forEach']((_0x437818,_0x99709)=>{var _0x58910c=_0x35c2e9;_0x43540c[_0x99709][_0x58910c(0x145)]=_0x437818;}),_0x4b0c3d[_0x35c2e9(0x108)]((_0xa12c5e,_0x2105fd)=>{var _0xd57c31=_0x35c2e9;_0x43540c[_0x2105fd][_0xd57c31(0x1b2)]=_0xa12c5e;}),_0x38e99c['forEach']((_0x589256,_0x27f053)=>{var _0x2d9da5=_0x35c2e9;_0x43540c[_0x27f053][_0x2d9da5(0x10a)]=_0x589256;}),_0xa91f06[_0x35c2e9(0x108)]((_0x387ec1,_0xadbc56)=>{_0x43540c[_0xadbc56]['product_cat']=_0x387ec1;}),_0x253bd7[_0x35c2e9(0x108)]((_0xea2580,_0x4769d1)=>{var _0x51e005=_0x35c2e9;_0x43540c[_0x4769d1][_0x51e005(0x1d4)]=_0xea2580;}),_0x50b834[_0x35c2e9(0x108)]((_0x59ac19,_0x4638a7)=>{var _0xf45727=_0x35c2e9;_0x43540c[_0x4638a7][_0xf45727(0x112)]=_0x59ac19;}),_0x4ad941[_0x35c2e9(0x108)]((_0x57f4a6,_0x559a34)=>{var _0x3cb6b1=_0x35c2e9;_0x43540c[_0x559a34][_0x3cb6b1(0x1c3)]=_0x57f4a6;});const _0x965be3=_0x43540c['filter'](_0x8a9713=>_0x8a9713[_0x35c2e9(0x151)]!=='0'&&_0x8a9713[_0x35c2e9(0x151)]!==''),_0x3fb5a6=new purchases_finished({'invoice':_0xdb8b84,'suppliers':_0x3361bd[_0x35c2e9(0x135)][_0x35c2e9(0x1c0)],'date':_0x24e464,'warehouse_name':_0x1ae665,'product':_0x965be3,'note':_0x5aed5d,'due_amount':_0x153f81,'room':_0x5d0ab0,'POnumber':_0x5b04fc,'SCRN':_0x1c99b5,'JO_number':_0x230717,'RequestedBy':_0x1f065b,'DateofRequest':_0x469b2a,'typeservices':_0x17c776,'driver':_0x4d93f2,'plate':_0x11b5bd,'van':_0x3906b9,'DRSI':_0x148546,'typevehicle':_0x46453a,'TSU':_0x1a7768,'TFU':_0x36f188}),_0x3b7240=await _0x3fb5a6[_0x35c2e9(0x105)](),_0x8d3846=await purchases_finished[_0x35c2e9(0x16b)]({'invoice':_0xdb8b84}),_0x5b9d12=_0x8d3846['product'][_0x35c2e9(0x184)](async _0x5eb2d7=>{var _0x122de6=_0x35c2e9,_0x246dc0=await warehouse[_0x122de6(0x16b)]({'name':_0x1ae665,'room':_0x5eb2d7['room_name']}),_0x1e949e=0x0;const _0x15e8fd=_0x246dc0[_0x122de6(0x1ee)][_0x122de6(0x184)](_0x2277a7=>{var _0x394197=_0x122de6;_0x2277a7[_0x394197(0x1f5)]==_0x5eb2d7[_0x394197(0x1f5)]&&_0x2277a7[_0x394197(0x167)]==_0x5eb2d7[_0x394197(0x167)]&&_0x2277a7['isle']==_0x5eb2d7['isle']&&_0x2277a7[_0x394197(0xfc)]==_0x5eb2d7[_0x394197(0xfc)]&&_0x2277a7['expiry_date']==_0x5eb2d7[_0x394197(0x145)]&&_0x2277a7[_0x394197(0x1b2)]==_0x5eb2d7['production_date']&&_0x2277a7[_0x394197(0x113)]==_0x5eb2d7['batch_code']&&_0x2277a7[_0x394197(0x147)]==_0x5eb2d7[_0x394197(0x147)]&&_0x2277a7['invoice']==_0x8d3846[_0x394197(0x1c3)]&&(_0x2277a7[_0x394197(0x14d)]=_0x2277a7[_0x394197(0x14d)]+_0x5eb2d7['quantity'],_0x1e949e++);});return _0x1e949e=='0'&&(_0x246dc0[_0x122de6(0x1ee)]=_0x246dc0[_0x122de6(0x1ee)][_0x122de6(0x106)]({'product_name':_0x5eb2d7['product_name'],'product_stock':_0x5eb2d7['quantity'],'primary_code':_0x5eb2d7[_0x122de6(0x1b5)],'secondary_code':_0x5eb2d7[_0x122de6(0x1e7)],'product_code':_0x5eb2d7[_0x122de6(0x1ad)],'level':_0x5eb2d7[_0x122de6(0x167)],'isle':_0x5eb2d7['isle'],'pallet':_0x5eb2d7[_0x122de6(0xfc)],'maxProducts':_0x5eb2d7['maxStocks'],'unit':_0x5eb2d7[_0x122de6(0x1be)],'secondary_unit':_0x5eb2d7['secondary_unit'],'expiry_date':_0x5eb2d7[_0x122de6(0x145)],'production_date':_0x5eb2d7[_0x122de6(0x1b2)],'maxProducts':_0x5eb2d7[_0x122de6(0x18a)],'maxPerUnit':_0x5eb2d7[_0x122de6(0x10a)],'batch_code':_0x5eb2d7['batch_code'],'product_cat':_0x5eb2d7[_0x122de6(0x147)],'CBM':_0x5eb2d7['CBM'],'invoice':_0x5eb2d7[_0x122de6(0x1c3)]})),_0x246dc0;});Promise[_0x35c2e9(0x17c)](_0x5b9d12)[_0x35c2e9(0x1f4)](async _0x50ee95=>{var _0x3d3618=_0x35c2e9;try{for(const _0xf4b0b8 of _0x50ee95){await warehouse[_0x3d3618(0x1b3)]({'_id':_0xf4b0b8['_id']},{'$addToSet':{'product_details':{'$each':_0xf4b0b8[_0x3d3618(0x1ee)]}}});}}catch(_0x45a21d){console[_0x3d3618(0x15d)](_0x45a21d),_0x59fdfa[_0x3d3618(0x141)](0x1f4)['json']({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.','message':_0x45a21d[_0x3d3618(0x16e)]});}})['catch'](_0x2a139c=>{var _0x3cd67e=_0x35c2e9;console[_0x3cd67e(0x15d)](_0x2a139c),_0x59fdfa[_0x3cd67e(0x141)](0x1f4)['json']({'error':'An\x20error\x20occurred.'});});const _0x1b49a1=await master_shop['find'](),_0xb9a067=await email_settings[_0x35c2e9(0x16b)](),_0x4f0dff=await suppliers[_0x35c2e9(0x16b)]({'name':_0x3361bd[_0x35c2e9(0x135)][_0x35c2e9(0x1c0)]}),_0x4eacc2=await supervisor_settings[_0x35c2e9(0x115)]();_0x1b49a1[0x0][_0x35c2e9(0x103)]==0x1?(right_currency=_0x1b49a1[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x1b49a1[0x0][_0x35c2e9(0x110)]);var _0x32dc0c=_0x23ba79,_0x59a57a=_0x8d5761,_0x2c819d=_0x4e3d0d,_0x299be2=_0x98944c,_0x311d88=_0x13b301,_0x34820d=_0x429212,_0x258355=_0x3b14b6,_0x5171eb='',_0x1dae93;for(_0x1dae93 in _0x32dc0c){_0x5171eb+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x32dc0c[_0x1dae93]+'</td>'+_0x35c2e9(0x1b9)+_0x2c819d[_0x1dae93]+_0x35c2e9(0x12e)+_0x35c2e9(0x1b9)+_0x59a57a[_0x1dae93]+'</td>'+_0x35c2e9(0x1b9)+_0x299be2[_0x1dae93]+'</td>'+_0x35c2e9(0x1b9)+_0x311d88[_0x1dae93]+_0x35c2e9(0x12e)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x258355[_0x1dae93]+_0x35c2e9(0x12e)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x34820d[_0x1dae93]+_0x35c2e9(0x12e)+_0x35c2e9(0x182);}let _0x512b4b=nodemailer[_0x35c2e9(0x153)]({'host':_0xb9a067[_0x35c2e9(0x1f1)],'port':Number(_0xb9a067[_0x35c2e9(0x10f)]),'secure':![],'auth':{'user':_0xb9a067['email'],'pass':_0xb9a067[_0x35c2e9(0x183)]}}),_0x297220={'from':_0xb9a067['email'],'to':_0x4eacc2[0x0][_0x35c2e9(0x125)],'subject':'Purchase\x20Mail','attachments':[{'filename':_0x35c2e9(0x17d),'path':__dirname+_0x35c2e9(0x1ce)+_0x35c2e9(0x1b0)+_0x1b49a1[0x0][_0x35c2e9(0x18d)],'cid':_0x35c2e9(0x1a8)}],'html':_0x35c2e9(0x101)+_0x35c2e9(0x1d2)+_0x35c2e9(0x169)+_0x35c2e9(0x1e4)+_0x35c2e9(0x1ca)+_0x35c2e9(0x1e4)+_0x35c2e9(0x1b1)+_0x35c2e9(0x1e6)+_0x35c2e9(0x1e4)+_0x35c2e9(0x1a9)+_0x1b49a1[0x0][_0x35c2e9(0x13e)]+_0x35c2e9(0x1fa)+_0x35c2e9(0x1e6)+'</div>'+'<hr\x20class=\x22my-3\x22>'+_0x35c2e9(0x1e4)+_0x35c2e9(0x1c9)+_0x35c2e9(0x1f9)+_0xdb8b84+'\x20'+_0x35c2e9(0x181)+_0x35c2e9(0x111)+_0x24e464+'\x20'+_0x35c2e9(0x1eb)+_0x35c2e9(0xfa)+_0x35c2e9(0x1e6)+_0x35c2e9(0x1cf)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x35c2e9(0x165)+_0x35c2e9(0x17f)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x35c2e9(0x199)+_0x35c2e9(0x1a5)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x35c2e9(0x1fb)+_0x35c2e9(0x1e8)+'</tr>'+_0x35c2e9(0x1d9)+_0x35c2e9(0x1ef)+'\x20'+_0x5171eb+'\x20'+_0x35c2e9(0x136)+_0x35c2e9(0x168)+'<div>'+_0x35c2e9(0x159)+_0x35c2e9(0x1d6)+_0x1b49a1[0x0][_0x35c2e9(0x13e)]+'</h5>'+_0x35c2e9(0x1e6)+'</div>'+_0x35c2e9(0x14b)};_0x512b4b[_0x35c2e9(0x118)](_0x297220,function(_0x7d49ec,_0x32c7b2){var _0x47665=_0x35c2e9;_0x7d49ec?(console[_0x47665(0x185)](_0x7d49ec),console['log'](_0x47665(0x1bd))):console[_0x47665(0x185)](_0x47665(0x1c7));}),_0x3361bd[_0x35c2e9(0x1f8)]('success',_0x35c2e9(0x1d3)),_0x59fdfa[_0x35c2e9(0x122)](_0x35c2e9(0x1c6));}catch(_0x5a018d){console[_0x35c2e9(0x185)](_0x5a018d);}}),router['get'](a0_0x5274b9(0x1d5),auth,async(_0x1d7b53,_0x368c50)=>{var _0x356e18=a0_0x5274b9;try{const {username:_0x42fc93,email:_0x35021f,role:_0x49a413}=_0x1d7b53[_0x356e18(0x11b)],_0x3ca81d=_0x1d7b53['user'],_0x3980ee=await profile[_0x356e18(0x16b)]({'email':_0x3ca81d[_0x356e18(0x123)]}),_0x545ee7=await master_shop[_0x356e18(0x115)](),_0x510a09=_0x1d7b53['params']['id'],_0x520686=await purchases_finished[_0x356e18(0x19f)](_0x510a09),_0xbba1c1=await suppliers['find']({});let _0x4651a5;if(_0x3ca81d['role']==_0x356e18(0x148)){const _0x3419dc=await staff[_0x356e18(0x16b)]({'email':_0x3ca81d['email']});_0x4651a5=await warehouse[_0x356e18(0x115)]({'status':_0x356e18(0x188),'name':_0x3419dc['warehouse']});}else _0x4651a5=await warehouse[_0x356e18(0x16a)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x356e18(0x1fd),'name':{'$first':_0x356e18(0x1fd)}}}]);const _0x11e13f=await product['find']({}),_0x480c2b=BayBinSelected(_0x520686['warehouse_name'],_0x520686[_0x356e18(0x172)]);let _0x3d1fd8=new Date(_0x520686[_0x356e18(0x145)]),_0x5136f6=('0'+_0x3d1fd8[_0x356e18(0x146)]())[_0x356e18(0x1b6)](-0x2),_0x4eeb12=('0'+(_0x3d1fd8[_0x356e18(0x158)]()+0x1))[_0x356e18(0x1b6)](-0x2),_0x29f621=_0x3d1fd8[_0x356e18(0x15c)](),_0x24f1bf=_0x29f621+'-'+_0x4eeb12+'-'+_0x5136f6;if(_0x545ee7[0x0][_0x356e18(0x1f7)]==_0x356e18(0x1e1)){var _0x498697=users[_0x356e18(0x1ec)];console[_0x356e18(0x185)](_0x498697);}else{if(_0x545ee7[0x0][_0x356e18(0x1f7)]==_0x356e18(0x19b))var _0x498697=users['Hindi'];else{if(_0x545ee7[0x0]['language']==_0x356e18(0x1dc))var _0x498697=users[_0x356e18(0x1dc)];else{if(_0x545ee7[0x0]['language']==_0x356e18(0x1e0))var _0x498697=users['Spanish'];else{if(_0x545ee7[0x0]['language']==_0x356e18(0x1c8))var _0x498697=users[_0x356e18(0x1c8)];else{if(_0x545ee7[0x0]['language']==_0x356e18(0x132))var _0x498697=users[_0x356e18(0x161)];else{if(_0x545ee7[0x0][_0x356e18(0x1f7)]==_0x356e18(0x138))var _0x498697=users[_0x356e18(0x138)];else{if(_0x545ee7[0x0][_0x356e18(0x1f7)]==_0x356e18(0x12a))var _0x498697=users['Arabic'];}}}}}}}_0x368c50[_0x356e18(0x195)](_0x356e18(0x164),{'success':_0x1d7b53['flash'](_0x356e18(0x1cd)),'errors':_0x1d7b53[_0x356e18(0x1f8)](_0x356e18(0x10e)),'role':_0x3ca81d,'profile':_0x3980ee,'purchases':_0x520686,'suppliers':_0xbba1c1,'warehouse':_0x4651a5,'product':_0x11e13f,'master_shop':_0x545ee7,'language':_0x498697,'ed_fullDate':_0x24f1bf,'dataSelected':_0x480c2b});}catch(_0x375dd1){console[_0x356e18(0x185)](_0x375dd1);}}),router['get'](a0_0x5274b9(0x1d0),auth,async(_0x4e477b,_0x1079ee)=>{var _0x7a13b7=a0_0x5274b9;try{const {username:_0x5c419e,email:_0x362c8c,role:_0x1a3859}=_0x4e477b[_0x7a13b7(0x11b)],_0x129f68=_0x4e477b[_0x7a13b7(0x11b)],_0x399fda=await profile['findOne']({'email':_0x129f68[_0x7a13b7(0x123)]}),_0x39910a=await master_shop['find'](),_0x277c1=_0x4e477b[_0x7a13b7(0x130)]['id'],_0x49e5dc=await purchases_finished[_0x7a13b7(0x19f)](_0x277c1),_0x1f2ab6=await suppliers[_0x7a13b7(0x115)]({});let _0x312fa7;if(_0x129f68['role']=='staff'){const _0x1b84ec=await staff[_0x7a13b7(0x16b)]({'email':_0x129f68[_0x7a13b7(0x123)]});_0x312fa7=await warehouse[_0x7a13b7(0x115)]({'status':_0x7a13b7(0x188),'name':_0x1b84ec[_0x7a13b7(0xfd)],'warehouse_category':'Finished\x20Goods'});}else _0x312fa7=await warehouse[_0x7a13b7(0x16a)]([{'$match':{'status':'Enabled','warehouse_category':_0x7a13b7(0x1ff)}},{'$group':{'_id':_0x7a13b7(0x1fd),'name':{'$first':_0x7a13b7(0x1fd)}}}]);const _0xbd6135=await product['find']({}),_0x4bc808=BayBinSelected(_0x49e5dc[_0x7a13b7(0x119)],_0x49e5dc[_0x7a13b7(0x172)]);let _0x521bf3=new Date(_0x49e5dc[_0x7a13b7(0x145)]),_0x31a195=('0'+_0x521bf3['getDate']())[_0x7a13b7(0x1b6)](-0x2),_0x57f683=('0'+(_0x521bf3['getMonth']()+0x1))['slice'](-0x2),_0x3b9cff=_0x521bf3[_0x7a13b7(0x15c)](),_0xcf8b7c=_0x3b9cff+'-'+_0x57f683+'-'+_0x31a195;if(_0x39910a[0x0][_0x7a13b7(0x1f7)]==_0x7a13b7(0x1e1)){var _0x17a7a1=users[_0x7a13b7(0x1ec)];console[_0x7a13b7(0x185)](_0x17a7a1);}else{if(_0x39910a[0x0][_0x7a13b7(0x1f7)]==_0x7a13b7(0x19b))var _0x17a7a1=users[_0x7a13b7(0x19b)];else{if(_0x39910a[0x0]['language']==_0x7a13b7(0x1dc))var _0x17a7a1=users['German'];else{if(_0x39910a[0x0][_0x7a13b7(0x1f7)]=='Spanish')var _0x17a7a1=users[_0x7a13b7(0x1e0)];else{if(_0x39910a[0x0][_0x7a13b7(0x1f7)]==_0x7a13b7(0x1c8))var _0x17a7a1=users[_0x7a13b7(0x1c8)];else{if(_0x39910a[0x0][_0x7a13b7(0x1f7)]==_0x7a13b7(0x132))var _0x17a7a1=users['Portuguese'];else{if(_0x39910a[0x0]['language']==_0x7a13b7(0x138))var _0x17a7a1=users[_0x7a13b7(0x138)];else{if(_0x39910a[0x0]['language']==_0x7a13b7(0x12a))var _0x17a7a1=users[_0x7a13b7(0x10c)];}}}}}}}_0x1079ee[_0x7a13b7(0x195)](_0x7a13b7(0x179),{'success':_0x4e477b['flash'](_0x7a13b7(0x1cd)),'errors':_0x4e477b[_0x7a13b7(0x1f8)]('errors'),'role':_0x129f68,'profile':_0x399fda,'purchases':_0x49e5dc,'suppliers':_0x1f2ab6,'warehouse':_0x312fa7,'product':_0xbd6135,'master_shop':_0x39910a,'language':_0x17a7a1,'ed_fullDate':_0xcf8b7c,'dataSelected':_0x4bc808});}catch(_0x490c9a){console[_0x7a13b7(0x185)](_0x490c9a);}}),router[a0_0x5274b9(0x14c)]('/view/:id',auth,async(_0x327e97,_0xd50e10)=>{var _0x570f86=a0_0x5274b9;try{const _0x20cfd1=_0x327e97['params']['id'],_0x5b859f=await purchases_finished[_0x570f86(0x16b)]({'_id':_0x327e97[_0x570f86(0x130)]['id']}),_0x16d12c=await warehouse['findOne']({'name':_0x5b859f[_0x570f86(0x119)],'room':_0x5b859f[_0x570f86(0x172)]});_0x5b859f[_0x570f86(0x1a3)][_0x570f86(0x108)](_0x362347=>{var _0x3716c9=_0x570f86;const _0x22b3bb=_0x16d12c['product_details'][_0x3716c9(0x184)](_0xa9bae2=>{var _0x1d5fbd=_0x3716c9;_0xa9bae2['product_name']==_0x362347['product_name']&&_0xa9bae2[_0x1d5fbd(0x12d)]==_0x362347[_0x1d5fbd(0x12d)]&&(_0xa9bae2[_0x1d5fbd(0x14d)]=parseInt(_0xa9bae2[_0x1d5fbd(0x14d)])-parseInt(_0x362347[_0x1d5fbd(0x151)]));});}),await _0x16d12c['save']();const {invoice:_0x519e41,suppliers:_0x576c60,date:_0x2e348f,warehouse_name:_0x2c54ef,prod_name:_0x258845,prod_code:_0x4b951a,prod_qty:_0x27a998,prod_unit:_0x5b7c86,prod_secondunit:_0x3d4d1a,prod_level:_0x172b58,prod_isle:_0x54e726,prod_pallet:_0x86161f,note:_0xd9d0ce,expiry_date:_0x4a4710,batch_code:_0x286569,paid_amount:_0x9f8c17,due_amount:_0x337afd,Room_name:_0x59066d,primary_code:_0x40cc7f,secondary_code:_0xfa2399,PO_number:_0x12c9b8,JO_number:_0x40dc88}=_0x327e97[_0x570f86(0x135)];if(typeof _0x258845==_0x570f86(0x1ae))var _0x1c8e0c=[_0x327e97['body'][_0x570f86(0x191)]],_0x1f0622=[_0x327e97['body'][_0x570f86(0x1a1)]],_0x4bc9c3=[_0x327e97['body']['prod_qty']],_0x5a84c9=[_0x327e97[_0x570f86(0x135)][_0x570f86(0x100)]],_0x4a8caf=[_0x327e97[_0x570f86(0x135)][_0x570f86(0x140)]],_0x27e71d=[_0x327e97[_0x570f86(0x135)][_0x570f86(0x1f0)]],_0x551bc1=[_0x327e97[_0x570f86(0x135)][_0x570f86(0x1b5)]],_0x281588=[_0x327e97[_0x570f86(0x135)][_0x570f86(0x1e7)]],_0x31ed01=[_0x327e97['body'][_0x570f86(0x144)]],_0x12fdfb=[_0x327e97['body'][_0x570f86(0x113)]],_0x34dbc4=[_0x327e97[_0x570f86(0x135)][_0x570f86(0x145)]];else var _0x1c8e0c=[..._0x327e97[_0x570f86(0x135)][_0x570f86(0x191)]],_0x1f0622=[..._0x327e97[_0x570f86(0x135)][_0x570f86(0x1a1)]],_0x4bc9c3=[..._0x327e97[_0x570f86(0x135)][_0x570f86(0x157)]],_0x5a84c9=[..._0x327e97[_0x570f86(0x135)][_0x570f86(0x100)]],_0x4a8caf=[..._0x327e97[_0x570f86(0x135)]['prod_secondunit']],_0x27e71d=[..._0x327e97['body']['prod_level']],_0x551bc1=[..._0x327e97[_0x570f86(0x135)][_0x570f86(0x1b5)]],_0x281588=[..._0x327e97[_0x570f86(0x135)][_0x570f86(0x1e7)]],_0x31ed01=[..._0x327e97[_0x570f86(0x135)]['MaxStocks_data']],_0x12fdfb=[..._0x327e97['body']['batch_code']],_0x34dbc4=[..._0x327e97[_0x570f86(0x135)][_0x570f86(0x145)]];const _0x2ab224=_0x1c8e0c[_0x570f86(0x184)](_0x1d411a=>{return _0x1d411a={'product_name':_0x1d411a};});_0x1f0622['forEach']((_0xcdedba,_0x19d5f3)=>{var _0xd692f=_0x570f86;_0x2ab224[_0x19d5f3][_0xd692f(0x1ad)]=_0xcdedba;}),_0x4bc9c3[_0x570f86(0x108)]((_0x446550,_0x4c4815)=>{_0x2ab224[_0x4c4815]['quantity']=_0x446550;}),_0x5a84c9[_0x570f86(0x108)]((_0x2fd883,_0x4e5221)=>{var _0x1e94e8=_0x570f86;_0x2ab224[_0x4e5221][_0x1e94e8(0x1be)]=_0x2fd883;}),_0x4a8caf[_0x570f86(0x108)]((_0x3061f0,_0xc6e3b9)=>{var _0x1a7dc1=_0x570f86;_0x2ab224[_0xc6e3b9][_0x1a7dc1(0x127)]=_0x3061f0;}),_0x27e71d['forEach']((_0x2087dc,_0x4604b7)=>{var _0x559710=_0x570f86;_0x2ab224[_0x4604b7][_0x559710(0x12d)]=_0x2087dc;}),_0x551bc1[_0x570f86(0x108)]((_0xc7530,_0x138ccf)=>{var _0x479cbd=_0x570f86;_0x2ab224[_0x138ccf][_0x479cbd(0x1b5)]=_0xc7530;}),_0x281588[_0x570f86(0x108)]((_0xd55814,_0x5e0142)=>{var _0x1d66a4=_0x570f86;_0x2ab224[_0x5e0142][_0x1d66a4(0x1e7)]=_0xd55814;}),_0x31ed01['forEach']((_0x260683,_0xd04669)=>{var _0x4f0f96=_0x570f86;_0x2ab224[_0xd04669][_0x4f0f96(0x18a)]=_0x260683;}),_0x12fdfb['forEach']((_0x462cb8,_0x344eaa)=>{var _0x2904e8=_0x570f86;_0x2ab224[_0x344eaa][_0x2904e8(0x113)]=_0x462cb8;}),_0x34dbc4[_0x570f86(0x108)]((_0x52a455,_0x33e7a6)=>{var _0x487707=_0x570f86;_0x2ab224[_0x33e7a6][_0x487707(0x145)]=_0x52a455;});const _0x4fd760=_0x2ab224[_0x570f86(0x139)](_0x1b7559=>_0x1b7559[_0x570f86(0x151)]!=='0'&&_0x1b7559[_0x570f86(0x151)]!=='');_0x5b859f[_0x570f86(0x1c3)]=_0x519e41,_0x5b859f[_0x570f86(0x1c0)]=_0x576c60,_0x5b859f[_0x570f86(0x1fe)]=_0x2e348f,_0x5b859f[_0x570f86(0x119)]=_0x2c54ef,_0x5b859f[_0x570f86(0x1a3)]=_0x4fd760,_0x5b859f[_0x570f86(0x1fc)]=_0xd9d0ce,_0x5b859f[_0x570f86(0x1a0)]=_0x9f8c17,_0x5b859f[_0x570f86(0x163)]=_0x337afd,_0x5b859f['room']=_0x59066d,_0x5b859f[_0x570f86(0x174)]=_0x12c9b8,_0x5b859f[_0x570f86(0x149)]=_0x40dc88;const _0x31d415=await _0x5b859f[_0x570f86(0x105)](),_0x3c31eb=await warehouse['findOne']({'name':_0x327e97[_0x570f86(0x135)][_0x570f86(0x119)],'room':_0x327e97[_0x570f86(0x135)][_0x570f86(0x175)]});_0x5b859f['product'][_0x570f86(0x108)](_0x5c427f=>{var _0x45b687=_0x570f86,_0x1d06d1=0x0;const _0x218061=_0x3c31eb[_0x45b687(0x1ee)][_0x45b687(0x184)](_0x513fe0=>{var _0x5a099f=_0x45b687;_0x513fe0[_0x5a099f(0x1f5)]==_0x5c427f['product_name']&&_0x513fe0[_0x5a099f(0x12d)]==_0x5c427f[_0x5a099f(0x12d)]&&(_0x513fe0[_0x5a099f(0x14d)]=parseInt(_0x513fe0[_0x5a099f(0x14d)])+parseInt(_0x5c427f[_0x5a099f(0x151)]),_0x1d06d1++);});_0x1d06d1=='0'&&(_0x3c31eb[_0x45b687(0x1ee)]=_0x3c31eb[_0x45b687(0x1ee)][_0x45b687(0x106)]({'product_name':_0x5c427f[_0x45b687(0x1f5)],'product_stock':_0x5c427f[_0x45b687(0x151)],'primary_code':_0x5c427f[_0x45b687(0x1b5)],'secondary_code':_0x5c427f['secondary_code'],'product_code':_0x5c427f[_0x45b687(0x1ad)],'bay':_0x5c427f['bay'],'maxProducts':_0x5c427f[_0x45b687(0x18a)],'unit':_0x5c427f[_0x45b687(0x1be)],'secondary_unit':_0x5c427f[_0x45b687(0x127)],'expiry_date':_0x5c427f[_0x45b687(0x145)]}));}),await _0x3c31eb[_0x570f86(0x105)]();const _0x55b78a=await s_payment_data[_0x570f86(0x16b)]({'invoice':_0x327e97[_0x570f86(0x135)][_0x570f86(0x1c3)]});if(_0x55b78a===null){}else console[_0x570f86(0x185)](_0x570f86(0x1c0),_0x55b78a,_0x327e97[_0x570f86(0x135)][_0x570f86(0x1c3)]),_0x55b78a['suppliers']=_0x327e97[_0x570f86(0x135)][_0x570f86(0x1c0)],await _0x55b78a['save']();_0x327e97[_0x570f86(0x1f8)](_0x570f86(0x1cd),_0x570f86(0x11c)),_0xd50e10['redirect'](_0x570f86(0x1c6));}catch(_0x149363){console[_0x570f86(0x185)](_0x149363);}}),router[a0_0x5274b9(0x14c)](a0_0x5274b9(0x17a),auth,async(_0x205118,_0x1a26ab)=>{var _0x52d576=a0_0x5274b9;try{const _0x1c2d42=_0x205118['params']['id'],{invoice:_0x2d83a,suppliers:_0x39c723,payable:_0x4654e2,due_amount:_0x4eb2b3}=_0x205118[_0x52d576(0x135)],_0x39c592=await purchases[_0x52d576(0x19f)](_0x1c2d42);var _0x1da9b2=_0x4654e2-_0x4eb2b3;_0x39c592[_0x52d576(0x1a0)]=parseFloat(_0x39c592[_0x52d576(0x1a0)])+parseFloat(_0x4eb2b3),_0x39c592['due_amount']=_0x1da9b2;const _0x5bdea5=await _0x39c592['save']();console[_0x52d576(0x185)](_0x5bdea5);const _0x15fc65=await s_payment_data[_0x52d576(0x16b)]({'invoice':_0x2d83a});_0x15fc65[_0x52d576(0x1c1)]=_0x1da9b2,await _0x15fc65['save']();let _0x241043=new Date(),_0x4747b8=('0'+_0x241043[_0x52d576(0x146)]())[_0x52d576(0x1b6)](-0x2),_0x5b8232=('0'+(_0x241043[_0x52d576(0x158)]()+0x1))[_0x52d576(0x1b6)](-0x2),_0x2a1537=_0x241043[_0x52d576(0x15c)](),_0x50c6d3=_0x2a1537+'-'+_0x5b8232+'-'+_0x4747b8;const _0x3c9df8=new suppliers_payment({'invoice':_0x2d83a,'date':_0x2a1537+'-'+_0x5b8232+'-'+_0x4747b8,'suppliers':_0x39c723,'reason':_0x52d576(0x1f3),'amount':_0x4eb2b3}),_0x312f1a=await _0x3c9df8[_0x52d576(0x105)]();_0x205118[_0x52d576(0x1f8)](_0x52d576(0x1cd),_0x52d576(0x1ac)),_0x1a26ab['redirect']('/all_purchases/view');}catch(_0x503f80){console[_0x52d576(0x185)](_0x503f80);}}),router[a0_0x5274b9(0x13c)](a0_0x5274b9(0x1bf),auth,async(_0x3fd9a1,_0x14adca)=>{var _0x3584cc=a0_0x5274b9;try{const {username:_0x5a9147,email:_0x440c1c,role:_0x194067}=_0x3fd9a1[_0x3584cc(0x11b)],_0x4a6ed2=_0x3fd9a1[_0x3584cc(0x11b)],_0x61ffd1=await profile[_0x3584cc(0x16b)]({'email':_0x4a6ed2[_0x3584cc(0x123)]}),_0x1fb2e4=await master_shop[_0x3584cc(0x115)]();console[_0x3584cc(0x185)](_0x3584cc(0x150),_0x1fb2e4);const _0x1295e0=_0x3fd9a1[_0x3584cc(0x130)]['id'],_0x49143f=await purchases[_0x3584cc(0x19f)](_0x1295e0);console['log'](_0x49143f);const _0x14a763=await suppliers[_0x3584cc(0x16b)]({'name':_0x49143f[_0x3584cc(0x1c0)]});console['log'](_0x14a763);if(_0x1fb2e4[0x0][_0x3584cc(0x1f7)]==_0x3584cc(0x1e1)){var _0x26a735=users[_0x3584cc(0x1ec)];console[_0x3584cc(0x185)](_0x26a735);}else{if(_0x1fb2e4[0x0][_0x3584cc(0x1f7)]==_0x3584cc(0x19b))var _0x26a735=users[_0x3584cc(0x19b)];else{if(_0x1fb2e4[0x0]['language']==_0x3584cc(0x1dc))var _0x26a735=users[_0x3584cc(0x1dc)];else{if(_0x1fb2e4[0x0][_0x3584cc(0x1f7)]==_0x3584cc(0x1e0))var _0x26a735=users[_0x3584cc(0x1e0)];else{if(_0x1fb2e4[0x0][_0x3584cc(0x1f7)]==_0x3584cc(0x1c8))var _0x26a735=users[_0x3584cc(0x1c8)];else{if(_0x1fb2e4[0x0][_0x3584cc(0x1f7)]==_0x3584cc(0x132))var _0x26a735=users[_0x3584cc(0x161)];else{if(_0x1fb2e4[0x0][_0x3584cc(0x1f7)]==_0x3584cc(0x138))var _0x26a735=users[_0x3584cc(0x138)];else{if(_0x1fb2e4[0x0][_0x3584cc(0x1f7)]==_0x3584cc(0x12a))var _0x26a735=users[_0x3584cc(0x10c)];}}}}}}}_0x14adca[_0x3584cc(0x195)]('purchase_invoice',{'success':_0x3fd9a1[_0x3584cc(0x1f8)](_0x3584cc(0x1cd)),'errors':_0x3fd9a1[_0x3584cc(0x1f8)](_0x3584cc(0x10e)),'role':_0x4a6ed2,'profile':_0x61ffd1,'master_shop':_0x1fb2e4,'supplier':_0x14a763,'purchase':_0x49143f,'language':_0x26a735});}catch(_0x3bda9b){console[_0x3584cc(0x185)](_0x3bda9b);}}),router['get'](a0_0x5274b9(0x11d),auth,async(_0xe0bb9f,_0x160733)=>{var _0xf19781=a0_0x5274b9;try{const {username:_0x47adc7,email:_0x4ff4c7,role:_0x476be7}=_0xe0bb9f['user'],_0x39b051=_0xe0bb9f[_0xf19781(0x11b)],_0x5d8185=await profile[_0xf19781(0x16b)]({'email':_0x39b051[_0xf19781(0x123)]}),_0xf92956=await master_shop[_0xf19781(0x115)]();console['log'](_0xf19781(0x150),_0xf92956);const _0x31e65c=_0xe0bb9f[_0xf19781(0x130)]['id'];console['log'](_0x31e65c);const _0x56c101=await purchases_finished[_0xf19781(0x19f)](_0x31e65c);console[_0xf19781(0x185)](_0xf19781(0x198),_0x56c101);const _0x182204=await product['find']({}),_0x3fb11c=await warehouse[_0xf19781(0x16a)]([{'$match':{'name':_0x56c101[_0xf19781(0x119)],'room':_0x56c101['room']}},{'$unwind':_0xf19781(0x18e)},{'$group':{'_id':_0xf19781(0x154),'name':{'$first':_0xf19781(0x134)},'product_stock':{'$first':_0xf19781(0x18f)},'bay':{'$first':_0xf19781(0x178)},'bin':{'$first':_0xf19781(0x14a)},'type':{'$first':_0xf19781(0x133)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0xf19781(0x11e)},'secondary_code':{'$first':_0xf19781(0x1d7)},'product_code':{'$first':_0xf19781(0x200)},'storage':{'$first':_0xf19781(0x114)},'rack':{'$first':'$product_details.rack'}}}]);console[_0xf19781(0x185)](_0xf19781(0x1a7),_0x3fb11c);let _0x41d228;if(_0x39b051[_0xf19781(0x1a2)]=='staff'){const _0x392599=await staff[_0xf19781(0x16b)]({'email':_0x39b051[_0xf19781(0x123)]});_0x41d228=await warehouse['find']({'status':_0xf19781(0x188),'name':_0x392599[_0xf19781(0xfd)],'warehouse_category':_0xf19781(0x1ff),'name':'Return\x20Goods'});}else _0x41d228=await warehouse[_0xf19781(0x16a)]([{'$match':{'status':_0xf19781(0x188),'warehouse_category':_0xf19781(0x1ff),'name':_0xf19781(0x1c5)}},{'$group':{'_id':_0xf19781(0x1fd),'name':{'$first':_0xf19781(0x1fd)}}}]);if(_0xf92956[0x0]['language']==_0xf19781(0x1e1)){var _0x8aeda=users[_0xf19781(0x1ec)];console['log'](_0x8aeda);}else{if(_0xf92956[0x0][_0xf19781(0x1f7)]==_0xf19781(0x19b))var _0x8aeda=users[_0xf19781(0x19b)];else{if(_0xf92956[0x0][_0xf19781(0x1f7)]==_0xf19781(0x1dc))var _0x8aeda=users[_0xf19781(0x1dc)];else{if(_0xf92956[0x0][_0xf19781(0x1f7)]==_0xf19781(0x1e0))var _0x8aeda=users[_0xf19781(0x1e0)];else{if(_0xf92956[0x0][_0xf19781(0x1f7)]==_0xf19781(0x1c8))var _0x8aeda=users[_0xf19781(0x1c8)];else{if(_0xf92956[0x0][_0xf19781(0x1f7)]==_0xf19781(0x132))var _0x8aeda=users[_0xf19781(0x161)];else{if(_0xf92956[0x0][_0xf19781(0x1f7)]==_0xf19781(0x138))var _0x8aeda=users[_0xf19781(0x138)];else{if(_0xf92956[0x0][_0xf19781(0x1f7)]=='Arabic\x20(ae)')var _0x8aeda=users[_0xf19781(0x10c)];}}}}}}}_0x160733[_0xf19781(0x195)](_0xf19781(0x1bc),{'success':_0xe0bb9f[_0xf19781(0x1f8)](_0xf19781(0x1cd)),'errors':_0xe0bb9f[_0xf19781(0x1f8)]('errors'),'role':_0x39b051,'profile':_0x5d8185,'user':_0x56c101,'stock':_0x3fb11c,'master_shop':_0xf92956,'product':_0x182204,'language':_0x8aeda,'warehouse':_0x41d228});}catch(_0x5c7090){console[_0xf19781(0x185)](_0x5c7090);}}),router['post']('/view/return_purchase/:id',auth,async(_0x310790,_0x56a511)=>{var _0x14c8d2=a0_0x5274b9;try{const {invoice:_0x45bc49,date:_0x1e5c3e,warehouse_name:_0x2f0ec9,Room_name:_0x4ae011,product_name:_0x37b532,purchase_quantity:_0xa7401a,stocks:_0x3bfd48,return_qty:_0x1cf38e,note:_0x1b584f,level:_0x1cc044,isle:_0x2ae0b6,pallet:_0x56520e,to_warehouse_name:_0x1f905b,to_Room_name:_0x515ffa}=_0x310790[_0x14c8d2(0x135)],_0x1c00a6=await purchases_finished['findOne']({'_id':_0x310790[_0x14c8d2(0x130)]['id']}),_0x22e2fa=await warehouse[_0x14c8d2(0x16b)]({'name':_0x2f0ec9,'room':_0x4ae011,'warehouse_category':_0x14c8d2(0x1ff)});if(typeof _0x37b532=='string')var _0x431a41=[_0x310790[_0x14c8d2(0x135)][_0x14c8d2(0x1f5)]],_0x12f004=[_0x310790[_0x14c8d2(0x135)][_0x14c8d2(0x1ed)]],_0x423dfc=[_0x310790['body'][_0x14c8d2(0x12b)]],_0x2d6d07=[_0x310790[_0x14c8d2(0x135)][_0x14c8d2(0x180)]],_0x1e547f=[_0x310790['body'][_0x14c8d2(0x167)]],_0x2aa6af=[_0x310790[_0x14c8d2(0x135)][_0x14c8d2(0x16f)]],_0x3255a7=[_0x310790[_0x14c8d2(0x135)]['primary_code_hide']],_0x5b10ac=[_0x310790[_0x14c8d2(0x135)][_0x14c8d2(0x162)]];else var _0x431a41=[..._0x310790[_0x14c8d2(0x135)][_0x14c8d2(0x1f5)]],_0x12f004=[..._0x310790[_0x14c8d2(0x135)][_0x14c8d2(0x1ed)]],_0x423dfc=[..._0x310790['body'][_0x14c8d2(0x12b)]],_0x2d6d07=[..._0x310790[_0x14c8d2(0x135)]['return_qty']],_0x1e547f=[..._0x310790[_0x14c8d2(0x135)][_0x14c8d2(0x167)]],_0x2aa6af=[..._0x310790[_0x14c8d2(0x135)][_0x14c8d2(0x16f)]],_0x3255a7=[..._0x310790[_0x14c8d2(0x135)][_0x14c8d2(0x13d)]],_0x5b10ac=[..._0x310790['body'][_0x14c8d2(0x162)]];const _0x1dd4f0=_0x431a41[_0x14c8d2(0x184)](_0x13bd7e=>{return _0x13bd7e={'product_name':_0x13bd7e};});_0x12f004[_0x14c8d2(0x108)]((_0x29c102,_0x594faf)=>{_0x1dd4f0[_0x594faf]['purchase_quantity']=_0x29c102;}),_0x423dfc['forEach']((_0xc1d62b,_0x245892)=>{_0x1dd4f0[_0x245892]['stock_quantity']=_0xc1d62b;}),_0x2d6d07[_0x14c8d2(0x108)]((_0x27990a,_0x3a49ef)=>{_0x1dd4f0[_0x3a49ef]['return_qty']=_0x27990a;}),_0x1e547f[_0x14c8d2(0x108)]((_0x2ac206,_0x4698f0)=>{_0x1dd4f0[_0x4698f0]['bay']=_0x2ac206;}),_0x2aa6af[_0x14c8d2(0x108)]((_0x3ac57d,_0xcef57a)=>{var _0x4b35f8=_0x14c8d2;_0x1dd4f0[_0xcef57a][_0x4b35f8(0x1ad)]=_0x3ac57d;}),_0x3255a7[_0x14c8d2(0x108)]((_0x45765b,_0xe0d530)=>{var _0x431edd=_0x14c8d2;_0x1dd4f0[_0xe0d530][_0x431edd(0x1b5)]=_0x45765b;}),_0x5b10ac['forEach']((_0x429311,_0x317089)=>{_0x1dd4f0[_0x317089]['secondary_code']=_0x429311;}),_0x1dd4f0['forEach'](_0x3a499c=>{var _0x116062=_0x14c8d2;console['log'](_0x3a499c);const _0x1940c5=_0x22e2fa[_0x116062(0x1ee)][_0x116062(0x184)](_0x1f1364=>{var _0x5b08da=_0x116062;_0x1f1364['product_name']==_0x3a499c[_0x5b08da(0x1f5)]&&_0x1f1364[_0x5b08da(0x12d)]==_0x3a499c[_0x5b08da(0x12d)]&&(console['log'](parseInt(_0x1f1364[_0x5b08da(0x14d)])+_0x5b08da(0x121)+parseInt(_0x3a499c[_0x5b08da(0x180)])),_0x1f1364[_0x5b08da(0x14d)]=parseInt(_0x1f1364[_0x5b08da(0x14d)])-parseInt(_0x3a499c['return_qty']));});}),await _0x22e2fa[_0x14c8d2(0x105)]();var _0x3b9c40=0x0;_0x1dd4f0['forEach'](_0x4621c9=>{var _0x1cc690=_0x14c8d2;(parseInt(_0x4621c9['purchase_quantity'])<parseInt(_0x4621c9[_0x1cc690(0x180)])||parseInt(_0x4621c9[_0x1cc690(0x1aa)])<parseInt(_0x4621c9[_0x1cc690(0x180)]))&&_0x3b9c40++;});if(_0x3b9c40!=0x0)return _0x310790[_0x14c8d2(0x1f8)]('errors',_0x14c8d2(0x1df)),_0x56a511[_0x14c8d2(0x122)](_0x14c8d2(0x109));const _0x23d222=new purchases_return_finished({'invoice':_0x45bc49,'suppliers':_0x310790[_0x14c8d2(0x135)][_0x14c8d2(0x1c0)],'date':_0x1e5c3e,'warehouse_name':_0x2f0ec9,'return_product':_0x1dd4f0,'note':_0x1b584f,'room':_0x4ae011,'to_warehouse_name':_0x1f905b,'to_room':_0x515ffa}),_0x1f7c22=await _0x23d222['save'](),_0x26666d=await purchases_return_finished[_0x14c8d2(0x16b)]({'invoice':_0x45bc49}),_0x325814=await warehouse['findOne']({'name':_0x1f905b,'room':_0x515ffa,'warehouse_category':_0x14c8d2(0x1ff)});_0x26666d['return_product'][_0x14c8d2(0x108)](_0x50b299=>{var _0x23e3d7=_0x14c8d2,_0x1883f1=0x0;const _0xe702cf=_0x325814[_0x23e3d7(0x1ee)][_0x23e3d7(0x184)](_0xd2c4d4=>{var _0x410c71=_0x23e3d7;console['log'](_0xd2c4d4['product_name']+'=='+_0x50b299[_0x410c71(0x1f5)]+'&&'+_0xd2c4d4['bay']+'=='+_0x50b299['bay']),_0xd2c4d4[_0x410c71(0x1f5)]==_0x50b299['product_name']&&_0xd2c4d4[_0x410c71(0x12d)]==_0x50b299[_0x410c71(0x12d)]&&(_0xd2c4d4[_0x410c71(0x14d)]=parseInt(_0xd2c4d4[_0x410c71(0x14d)])-parseInt(_0x50b299[_0x410c71(0x180)]),_0x1883f1++);});_0x1883f1=='0'&&(_0x325814[_0x23e3d7(0x1ee)]=_0x325814[_0x23e3d7(0x1ee)]['concat']({'product_name':_0x50b299[_0x23e3d7(0x1f5)],'product_stock':_0x50b299[_0x23e3d7(0x180)],'primary_code':_0x50b299[_0x23e3d7(0x1b5)],'secondary_code':_0x50b299[_0x23e3d7(0x1e7)],'product_code':_0x50b299['product_code'],'bay':_0x50b299['bay'],'maxProducts':0xf423f}));}),await _0x325814[_0x14c8d2(0x105)]();const _0x5d78a0=await purchases_finished[_0x14c8d2(0x16b)]({'invoice':_0x45bc49});_0x5d78a0[_0x14c8d2(0x19d)]=_0x14c8d2(0x1cb);const _0x50781a=await _0x5d78a0[_0x14c8d2(0x105)](),_0x2e8036=new s_payment_data({'invoice':_0x45bc49,'suppliers':_0x310790[_0x14c8d2(0x135)][_0x14c8d2(0x1c0)],'reason':_0x14c8d2(0x18c)});await _0x2e8036[_0x14c8d2(0x105)]();const _0x2902ba=await master_shop[_0x14c8d2(0x115)](),_0x548c0d=await email_settings[_0x14c8d2(0x16b)](),_0x575f75=await suppliers[_0x14c8d2(0x16b)]({'name':_0x310790['body'][_0x14c8d2(0x1c0)]});_0x2902ba[0x0][_0x14c8d2(0x103)]==0x1?(right_currency=_0x2902ba[0x0][_0x14c8d2(0x110)],left_currency=''):(right_currency='',left_currency=_0x2902ba[0x0][_0x14c8d2(0x110)]);var _0x1c9b71=_0x431a41,_0x20e22f=_0x2d6d07,_0x2f0262='',_0xa21bed;for(_0xa21bed in _0x1c9b71){_0x2f0262+=_0x14c8d2(0x165)+_0x14c8d2(0x1b9)+_0x1c9b71[_0xa21bed]+_0x14c8d2(0x12e)+_0x14c8d2(0x1b9)+_0x20e22f[_0xa21bed]+'</td>'+'</tr>';}let _0x383ff3=nodemailer['createTransport']({'service':'gmail','auth':{'user':_0x548c0d[_0x14c8d2(0x123)],'pass':_0x548c0d['password']}}),_0x3c0716={'from':_0x548c0d['email'],'to':_0x575f75[_0x14c8d2(0x123)],'subject':_0x14c8d2(0x11a),'attachments':[{'filename':_0x14c8d2(0x17d),'path':__dirname+_0x14c8d2(0x1ce)+_0x14c8d2(0x1b0)+_0x2902ba[0x0][_0x14c8d2(0x18d)],'cid':_0x14c8d2(0x1a8)}],'html':'<!DOCTYPE\x20html>'+_0x14c8d2(0x1d2)+_0x14c8d2(0x169)+_0x14c8d2(0x1e4)+_0x14c8d2(0x1ca)+'<div>'+_0x14c8d2(0x1b1)+'</div>'+_0x14c8d2(0x1e4)+_0x14c8d2(0x1a9)+_0x2902ba[0x0]['site_title']+_0x14c8d2(0x1fa)+'</div>'+_0x14c8d2(0x1e6)+_0x14c8d2(0x186)+_0x14c8d2(0x1e4)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x14c8d2(0x1f9)+_0x45bc49+'\x20'+_0x14c8d2(0x181)+_0x14c8d2(0x111)+_0x1e5c3e+'\x20'+'</span>'+_0x14c8d2(0xfa)+_0x14c8d2(0x1e6)+_0x14c8d2(0x1cf)+_0x14c8d2(0x166)+_0x14c8d2(0x165)+_0x14c8d2(0x17f)+_0x14c8d2(0x197)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>'+_0x14c8d2(0x1c2)+_0x14c8d2(0x182)+'</thead>'+_0x14c8d2(0x1ef)+'\x20'+_0x2f0262+'\x20'+_0x14c8d2(0x136)+_0x14c8d2(0x168)+'<div>'+_0x14c8d2(0x159)+_0x14c8d2(0x1d6)+_0x2902ba[0x0]['site_title']+_0x14c8d2(0xfa)+_0x14c8d2(0x1e6)+_0x14c8d2(0x1e6)+_0x14c8d2(0x14b)};_0x383ff3[_0x14c8d2(0x118)](_0x3c0716,function(_0x44e4ae,_0x1655af){var _0x1c22a5=_0x14c8d2;_0x44e4ae?console[_0x1c22a5(0x185)](_0x1c22a5(0x1bd)):console[_0x1c22a5(0x185)](_0x1c22a5(0x1c7));}),_0x310790['flash'](_0x14c8d2(0x1cd),_0x14c8d2(0x192)),_0x56a511[_0x14c8d2(0x122)](_0x14c8d2(0x1c6));}catch(_0x59f20c){_0x56a511[_0x14c8d2(0x141)](0xc8)[_0x14c8d2(0x1c4)]({'message':_0x59f20c[_0x14c8d2(0x16e)]});}}),router[a0_0x5274b9(0x13c)](a0_0x5274b9(0x190),auth,async(_0x27f49d,_0x26c670)=>{var _0x529220=a0_0x5274b9;try{const {username:_0x5df7fb,email:_0x304bc6,role:_0x34f845}=_0x27f49d[_0x529220(0x11b)],_0x1d5e0d=_0x27f49d[_0x529220(0x11b)],_0x588581=await profile[_0x529220(0x16b)]({'email':_0x1d5e0d[_0x529220(0x123)]}),_0x1eab9f=await master_shop[_0x529220(0x115)](),_0x464387=_0x27f49d['params']['id'],_0x538576=await purchases_finished[_0x529220(0x19f)](_0x464387);if(_0x1eab9f[0x0]['language']==_0x529220(0x1e1))var _0x915b34=users[_0x529220(0x1ec)];else{if(_0x1eab9f[0x0][_0x529220(0x1f7)]==_0x529220(0x19b))var _0x915b34=users[_0x529220(0x19b)];else{if(_0x1eab9f[0x0]['language']==_0x529220(0x1dc))var _0x915b34=users['German'];else{if(_0x1eab9f[0x0][_0x529220(0x1f7)]==_0x529220(0x1e0))var _0x915b34=users[_0x529220(0x1e0)];else{if(_0x1eab9f[0x0][_0x529220(0x1f7)]==_0x529220(0x1c8))var _0x915b34=users[_0x529220(0x1c8)];else{if(_0x1eab9f[0x0][_0x529220(0x1f7)]==_0x529220(0x132))var _0x915b34=users[_0x529220(0x161)];else{if(_0x1eab9f[0x0][_0x529220(0x1f7)]==_0x529220(0x138))var _0x915b34=users['Chinese'];else{if(_0x1eab9f[0x0][_0x529220(0x1f7)]==_0x529220(0x12a))var _0x915b34=users['Arabic'];}}}}}}}_0x26c670[_0x529220(0x195)](_0x529220(0x1e2),{'success':_0x27f49d[_0x529220(0x1f8)]('success'),'errors':_0x27f49d['flash'](_0x529220(0x10e)),'role':_0x1d5e0d,'profile':_0x588581,'alldata':_0x538576,'master_shop':_0x1eab9f,'language':_0x915b34});}catch(_0x2c157c){console[_0x529220(0x185)](_0x2c157c);}}),router['post'](a0_0x5274b9(0x187),async(_0x591062,_0x14b989)=>{var _0x1a568c=a0_0x5274b9;const {product_code:_0x517cc6}=_0x591062[_0x1a568c(0x135)];var _0x16465d;const _0x404161=await product[_0x1a568c(0x16a)]([{'$match':{'primary_code':_0x517cc6}},{'$group':{'_id':_0x1a568c(0x177),'name':{'$first':'$name'},'category':{'$first':_0x1a568c(0xfe)},'brand':{'$first':_0x1a568c(0x201)},'unit':{'$first':_0x1a568c(0x19c)},'alertquantity':{'$first':_0x1a568c(0x196)},'product_code':{'$first':_0x1a568c(0x17b)},'primary_code':{'$first':_0x1a568c(0x1e5)},'secondary_code':{'$first':_0x1a568c(0x13f)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x1a568c(0x124)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'},'maxProducts':{'$first':_0x1a568c(0x16d)},'CBM':{'$first':{'$toDouble':_0x1a568c(0x1d8)}}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'CBM':0x1}}]),_0x469509=await product[_0x1a568c(0x16a)]([{'$match':{'secondary_code':_0x517cc6}},{'$group':{'_id':_0x1a568c(0x177),'name':{'$first':_0x1a568c(0x1fd)},'category':{'$first':'$category'},'brand':{'$first':_0x1a568c(0x201)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x1a568c(0x196)},'product_code':{'$first':_0x1a568c(0x17b)},'primary_code':{'$first':_0x1a568c(0x1e5)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x1a568c(0x1a4)},'maxProdPerUnit':{'$first':_0x1a568c(0x124)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x1a568c(0x173)},'CBM':{'$first':{'$toDouble':_0x1a568c(0x1d8)}}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'CBM':0x1}}]);if(_0x404161[_0x1a568c(0x11f)]>0x0)_0x16465d=_0x404161;else _0x469509[_0x1a568c(0x11f)]>0x0&&(_0x16465d=_0x469509);_0x14b989[_0x1a568c(0x1c4)](_0x16465d);}),router[a0_0x5274b9(0x14c)](a0_0x5274b9(0x142),async(_0x2969fc,_0x46d024)=>{var _0x3d0bcf=a0_0x5274b9;const {productCode:_0x488cca,bay:_0xa762bf,warehouses:_0x4da64a,room:_0x580251}=_0x2969fc[_0x3d0bcf(0x135)];console[_0x3d0bcf(0x185)](_0x2969fc[_0x3d0bcf(0x135)]);try{const _0x48bb0f=await warehouse['aggregate']([{'$match':{'name':_0x4da64a,'room':_0x580251}},{'$unwind':_0x3d0bcf(0x18e)},{'$match':{'product_details.pallet':parseInt(_0xa762bf)}},{'$group':{'_id':_0x3d0bcf(0x134),'name':{'$first':_0x3d0bcf(0x134)},'product_stock':{'$sum':'$product_details.product_stock'},'pallet':{'$first':_0x3d0bcf(0xf9)},'maxProducts':{'$first':_0x3d0bcf(0x12c)}}}]);console[_0x3d0bcf(0x185)](_0x3d0bcf(0x12f),_0x48bb0f),_0x46d024[_0x3d0bcf(0x141)](0xc8)[_0x3d0bcf(0x1c4)](_0x48bb0f);}catch(_0x367119){_0x46d024[_0x3d0bcf(0x141)](0x194)[_0x3d0bcf(0x1c4)]({'message':_0x367119['message']});}}),module[a0_0x5274b9(0x1f2)]=router;function a0_0x3dc5(){var _0x1b9ce1=['prod_name','purchases\x20item\x20return\x20successfull','name','$batch_code','render','$alertquantity','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','user_id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','add_purchases\x20error','Hindi','$unit','return_data','prod_invoice','findById','paid_amount','prod_code','role','product','$maxStocks','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$product','stock_data','logo','<h2>\x20','stock_quantity','$product.room_name','payment\x20successfull','product_code','string','/view','/upload/','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','production_date','updateOne','/view/add_purchases','primary_code','slice','There\x27s\x20a\x20error\x20in\x20this\x20transaction','../middleware/auth','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','prod_Qty','INC-','return_purchase_finished','Error\x20Occurs','standard_unit','/invoice/:id','suppliers','amount','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','invoice','json','Return\x20Goods','/all_purchases_finished/view','Email\x20sent\x20successfully','French','<h5\x20style=\x22text-align:\x20left;\x22>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','True','$suppliers_docs','success','/../public','<table\x20style=\x22width:\x20100%\x20!important;\x22>','/view/:id','573058dLNrUJ','<html><head><title></title>','purchase\x20data\x20add\x20successfully','room_name','/preview/:id','<h5>','$product_details.secondary_code','$CBM','</thead>','nodemailer','$suppliers','German','Enclosed','express','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','Spanish','English\x20(US)','all_purchases_barcode','max_product_unit','<div>','$primary_code','</div>','secondary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','catch','$product.level','</span>','English','purchase_quantity','product_details','<tbody\x20style=\x22text-align:\x20center;\x22>','prod_level','host','exports','Paid\x20For\x20Purchase','then','product_name','add_purchases_finished','language','flash','\x20Order\x20Number\x20:\x20','\x20</h2>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Level\x20</th>','note','$name','date','Finished\x20Goods','$product_details.product_code','$brand','$product_details.pallet','</h5>','$date','pallet','warehouse','$category','path','prod_unit','<!DOCTYPE\x20html>','59484ZxiblB','currency_placement','$expiry_date','save','concat','$note','forEach','back','maxperunit','Router','Arabic','3ZbWyDG','errors','port','currency','\x20Order\x20Date\x20:\x20','CBM','batch_code','$product_details.storage','find','7640436gwtYTN','type','sendMail','warehouse_name','Purchase\x20Return\x20Mail','user','purchase\x20data\x20update\x20successfully','/view/return_purchase/:id','$product_details.primary_code','length','Rack\x201','\x20<>\x20','redirect','email','$maxProdPerUnit','RMSEmail','FROZEN\x20GOODS','secondary_unit','$warehouse_name','467960CbkrVy','Arabic\x20(ae)','stocks','$product_details.maxProducts','bay','</td>','data','params','12546396PgXHTw','Portuguese\x20(BR)','$product_details.type','$product_details.product_name','body','</tbody>','suppliers_docs','Chinese','filter','1920360dUhkKV','ejs','get','primary_code_hide','site_title','$secondary_code','prod_secondunit','status','/CheckingWarehouse','$paid_amount','MaxStocks_data','expiry_date','getDate','product_cat','staff','JO_number','$product_details.bin','</body></html>','post','product_stock','70OGjdRh','/view/add_purchases/:id','master','quantity','prod_cat','createTransport','$product_details._id','Rack\x202','../models/all_models','prod_qty','getMonth','<strong>\x20Regards\x20</strong>','6134915csvyli','$return_data','getFullYear','error','$due_amount','product_date','prod_primunit','Portuguese','secondary_code_hide','due_amount','edit_purchases_finished_view','<tr>','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','level','</table>','</head><body>','aggregate','findOne','$invoice','$maxProducts','message','product_code_hide','table\x20page','DRY\x20GOODS','room','$secondary_unit','POnumber','Room_name','all_purchases_finished','$_id','$product_details.bay','edit_purchases_finished','/give_payment/:id','$product_code','all','Logo.png','$product.quantity','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','return_qty','<span\x20style=\x22float:\x20right;\x22>','</tr>','password','map','log','<hr\x20class=\x22my-3\x22>','/barcode_scanner','Enabled','../public/language/languages.json','maxStocks','RoomAssign','Purchase\x20Return','image','$product_details','$product_details.product_stock','/barcode/:id'];a0_0x3dc5=function(){return _0x1b9ce1;};return a0_0x3dc5();}