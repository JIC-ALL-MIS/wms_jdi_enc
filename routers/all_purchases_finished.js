var a0_0x363552=a0_0x2e1b;(function(_0x4528c9,_0x45a4a0){var _0x33e6c6=a0_0x2e1b,_0x21b271=_0x4528c9();while(!![]){try{var _0x2f422d=-parseInt(_0x33e6c6(0x197))/0x1+-parseInt(_0x33e6c6(0x1cc))/0x2*(parseInt(_0x33e6c6(0x165))/0x3)+-parseInt(_0x33e6c6(0x210))/0x4+parseInt(_0x33e6c6(0x1b6))/0x5+-parseInt(_0x33e6c6(0x1ee))/0x6+parseInt(_0x33e6c6(0x16a))/0x7+parseInt(_0x33e6c6(0x214))/0x8;if(_0x2f422d===_0x45a4a0)break;else _0x21b271['push'](_0x21b271['shift']());}catch(_0x41c066){_0x21b271['push'](_0x21b271['shift']());}}}(a0_0x2bbb,0x76bc0));const express=require(a0_0x363552(0x189)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x363552(0x15e)),auth=require(a0_0x363552(0x213)),nodemailer=require(a0_0x363552(0x1fd));var ejs=require(a0_0x363552(0x1fa));const path=require('path'),users=require(a0_0x363552(0x18b));function a0_0x2bbb(){var _0x1a94eb=['Arabic','post','Paid\x20For\x20Purchase','$warehouse_name','message','catch','invoice','due_amount','random','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','purchase_invoice','gmail','RMSEmail','prod_secondunit','$product_details.floorlevel','suppliers_docs','4464800NfCCKv','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','getFullYear','INC-','prod_invoice','save','$name','filter','quantity','getMonth','room_name','$category','find','return_purchase_finished','\x20</h2>','$maxStocks','<tbody\x20style=\x22text-align:\x20center;\x22>','<tr>','<h2>\x20','product_details','<hr\x20class=\x22my-3\x22>','$maxProdPerUnit','11006dWDpyQ','</thead>','bay','success','$product_details.bin','warehouse','warehouse_name','staff','<span\x20style=\x22float:\x20right;\x22>','$primary_code','</div>','$product.pallet','$product','primary_code_hide','/upload/','forEach','batch_code','/view/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','get','stock_quantity','purchase_quantity','Purchase\x20Return','createTransport','$_id','$secondary_code','flash','params','user','maxperunit','Finished\x20Goods','German','Portuguese\x20(BR)','expiry_date','4418562aqgNaf','<!DOCTYPE\x20html>','</body></html>','<h5\x20style=\x22text-align:\x20left;\x22>','name','$product.room_name','</table>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','Spanish','findById','$note','return_product','ejs','note','</td>','nodemailer','findOne','$paid_amount','secondary_unit','string','$product_details.primary_code','product','$product.level','log','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','/view/add_purchases/:id','edit_purchases_finished_view','<table\x20style=\x22width:\x20100%\x20!important;\x22>','pallet','table\x20page','email','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','site_title','language','856112DeChtu','</h5>','map','../middleware/auth','10622424TtvhBp','French','/view','prod_level','date','$product_details','then','stock_data','Logo.png','errors','currency','Enclosed','$product_details.type','$product_details.product_code','prod_unit','/preview/:id','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$maxProducts','add_purchases_finished','<div>','$suppliers','user_id','logo','prod_primunit','all','$CBM','production_date','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','product_cat','Arabic\x20(ae)','primary_code','return_qty','room','secondary_code_hide','host','render','suppliers','prod_cat','Ambient','level','Portuguese','paid_amount','$unit','standard_unit','\x20Order\x20Date\x20:\x20','purchase\x20data\x20add\x20successfully','password','product_date','CBM','role','/all_purchases_finished/view','product_code','slice','$product_details.product_name','$alertquantity','Enabled','\x20<>\x20','all_purchases_barcode','purchase\x20data\x20update\x20successfully','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','/barcode/:id','\x20Order\x20Number\x20:\x20','</tbody>','error','getDate','payment\x20successfull','Return\x20Goods','$secondary_unit','/../public','$product_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$product.isle','../models/all_models','stocks','$invoice','$product_details.storage','</span>','$suppliers_docs','secondary_code','297ZQSsJy','Chinese','/view/add_purchases','type','English\x20(US)','2285731NAFvnm','/view/return_purchase/:id','sendMail','/barcode_scanner','product_stock','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','/CheckingWarehouse','prod_name','<html><head><title></title>','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','Rack\x202','DRY\x20GOODS','English','Email\x20sent\x20successfully','aggregate','image','currency_placement','product_name','prod_qty','length','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$product_details.product_stock','updateOne','$due_amount','body','Room_name','Error\x20Occurs','prod_Qty','</head><body>','concat','$product.quantity','express','$product_details.bay','../public/language/languages.json','redirect','MaxStocks_data','padStart','An\x20error\x20occurred.','</tr>','product_code_hide','toString','Hindi','An\x20error\x20occurred\x20while\x20saving\x20data.','$date','$expiry_date','565708sXsrZq','$return_data','maxStocks','$brand','max_product_unit','master','isle','return_data','<h5>','status','prod_code','/invoice/:id','_id','json','JO_number'];a0_0x2bbb=function(){return _0x1a94eb;};return a0_0x2bbb();}router[a0_0x363552(0x1df)](a0_0x363552(0x216),auth,async(_0x27b6a7,_0x1b5eb9)=>{var _0x3f2a0a=a0_0x363552;try{const {username:_0x358cad,email:_0xbcf59b,role:_0x53a8b5}=_0x27b6a7[_0x3f2a0a(0x1e8)],_0x288253=_0x27b6a7['user'],_0x572b66=await profile[_0x3f2a0a(0x1fe)]({'email':_0x288253[_0x3f2a0a(0x20c)]}),_0x296907=await staff[_0x3f2a0a(0x1fe)]({'email':_0x288253[_0x3f2a0a(0x20c)]});if(_0x288253[_0x3f2a0a(0x147)]=='staff'){const _0x3d18fd=await staff['findOne']({'email':_0x288253[_0x3f2a0a(0x20c)]});}const _0x7b796f=await master_shop['find']();let _0x4dfc9f;if(_0x288253[_0x3f2a0a(0x147)]==_0x3f2a0a(0x1d3)){const _0x2c186e=await staff[_0x3f2a0a(0x1fe)]({'email':_0x288253[_0x3f2a0a(0x20c)]});_0x4dfc9f=await purchases_finished[_0x3f2a0a(0x178)]([{'$match':{'warehouse_name':_0x2c186e[_0x3f2a0a(0x1d1)]}},{'$lookup':{'from':'suppliers','localField':_0x3f2a0a(0x238),'foreignField':_0x3f2a0a(0x1f2),'as':_0x3f2a0a(0x1b5)}},{'$unwind':_0x3f2a0a(0x163)},{'$unwind':_0x3f2a0a(0x1d8)},{'$group':{'_id':'$_id','invoice':{'$first':_0x3f2a0a(0x160)},'suppliers':{'$first':_0x3f2a0a(0x228)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x3f2a0a(0x1a9)},'room':{'$addToSet':_0x3f2a0a(0x1f3)},'product':{'$push':_0x3f2a0a(0x1d8)},'note':{'$first':_0x3f2a0a(0x1f8)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x3f2a0a(0x181)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x3f2a0a(0x196)},'suppliers_docs':{'$first':_0x3f2a0a(0x163)},'total_product_quantity':{'$sum':_0x3f2a0a(0x188)},'level':{'$addToSet':_0x3f2a0a(0x204)},'isle':{'$addToSet':_0x3f2a0a(0x15d)},'pallet':{'$addToSet':'$product.pallet'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'pallet':0x1}}]);}else _0x4dfc9f=await purchases_finished['aggregate']([{'$lookup':{'from':_0x3f2a0a(0x238),'localField':_0x3f2a0a(0x238),'foreignField':_0x3f2a0a(0x1f2),'as':'suppliers_docs'}},{'$unwind':'$suppliers_docs'},{'$unwind':'$product'},{'$group':{'_id':_0x3f2a0a(0x1e4),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x3f2a0a(0x228)},'date':{'$first':_0x3f2a0a(0x195)},'warehouse_name':{'$first':_0x3f2a0a(0x1a9)},'room':{'$addToSet':_0x3f2a0a(0x1f3)},'product':{'$push':_0x3f2a0a(0x1d8)},'note':{'$first':_0x3f2a0a(0x1f8)},'paid_amount':{'$first':_0x3f2a0a(0x1ff)},'due_amount':{'$first':_0x3f2a0a(0x181)},'return_data':{'$first':_0x3f2a0a(0x198)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x3f2a0a(0x196)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x3f2a0a(0x188)},'level':{'$addToSet':_0x3f2a0a(0x204)},'isle':{'$addToSet':_0x3f2a0a(0x15d)},'pallet':{'$addToSet':_0x3f2a0a(0x1d7)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'pallet':0x1}}]);if(_0x7b796f[0x0]['language']==_0x3f2a0a(0x169)){var _0x5e3bd0=users[_0x3f2a0a(0x176)];console[_0x3f2a0a(0x205)](_0x5e3bd0);}else{if(_0x7b796f[0x0][_0x3f2a0a(0x20f)]=='Hindi')var _0x5e3bd0=users[_0x3f2a0a(0x193)];else{if(_0x7b796f[0x0]['language']==_0x3f2a0a(0x1eb))var _0x5e3bd0=users['German'];else{if(_0x7b796f[0x0][_0x3f2a0a(0x20f)]=='Spanish')var _0x5e3bd0=users['Spanish'];else{if(_0x7b796f[0x0][_0x3f2a0a(0x20f)]=='French')var _0x5e3bd0=users[_0x3f2a0a(0x215)];else{if(_0x7b796f[0x0][_0x3f2a0a(0x20f)]==_0x3f2a0a(0x1ec))var _0x5e3bd0=users[_0x3f2a0a(0x23c)];else{if(_0x7b796f[0x0][_0x3f2a0a(0x20f)]=='Chinese')var _0x5e3bd0=users[_0x3f2a0a(0x166)];else{if(_0x7b796f[0x0][_0x3f2a0a(0x20f)]==_0x3f2a0a(0x231))var _0x5e3bd0=users['Arabic'];}}}}}}}_0x1b5eb9[_0x3f2a0a(0x237)]('all_purchases_finished',{'success':_0x27b6a7['flash']('success'),'errors':_0x27b6a7[_0x3f2a0a(0x1e6)]('errors'),'purchases':_0x4dfc9f,'role':_0x288253,'profile':_0x572b66,'master_shop':_0x7b796f,'language':_0x5e3bd0});}catch(_0x2ba08f){console[_0x3f2a0a(0x205)](_0x3f2a0a(0x20b),_0x2ba08f),_0x1b5eb9['status'](0xc8)['json']({'message':_0x2ba08f[_0x3f2a0a(0x1aa)]});}});function BayBinSelected(_0x266fca,_0x52ddc4){var _0x342bf5=a0_0x363552,_0x1178f2=[],_0x27afbb=[];if(_0x266fca==_0x342bf5(0x175)){switch(_0x52ddc4){case'Rack\x201':_0x1178f2=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x342bf5(0x174):_0x1178f2=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x27afbb=['DG'];}else{if(_0x266fca=='FROZEN\x20GOODS'){switch(_0x52ddc4){case'Rack\x201':_0x1178f2=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x342bf5(0x174):_0x1178f2=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x27afbb=['FG'];}}return{'levels':_0x1178f2,'identify':_0x27afbb};}async function getRandom8DigitNumber(){var _0x2b3748=a0_0x363552;const _0x4d039f=0x989680,_0x532693=0x5f5e0ff,_0x1d2ac3=Math['floor'](Math[_0x2b3748(0x1ae)]()*(_0x532693-_0x4d039f+0x1))+_0x4d039f;var _0x27959e;const _0x285d07=await purchases_finished[_0x2b3748(0x1fe)]({'invoice':_0x2b3748(0x1b9)+_0x1d2ac3});return _0x285d07&&_0x285d07['length']>0x0?_0x27959e=_0x2b3748(0x1b9)+_0x1d2ac3:_0x27959e=_0x2b3748(0x1b9)+_0x1d2ac3,_0x27959e;}function a0_0x2e1b(_0x37e4ba,_0x4dd787){var _0x2bbbfd=a0_0x2bbb();return a0_0x2e1b=function(_0x2e1b25,_0x1327d4){_0x2e1b25=_0x2e1b25-0x142;var _0x37b364=_0x2bbbfd[_0x2e1b25];return _0x37b364;},a0_0x2e1b(_0x37e4ba,_0x4dd787);}router[a0_0x363552(0x1df)](a0_0x363552(0x167),auth,async(_0x51cf4c,_0x4391fe)=>{var _0x35c8d0=a0_0x363552;try{const {username:_0x567ad2,email:_0x5c943e,role:_0x3d7aa7}=_0x51cf4c['user'],_0x2555d9=_0x51cf4c['user'],_0x4a23bd=await profile['findOne']({'email':_0x2555d9[_0x35c8d0(0x20c)]}),_0x958728=await master_shop[_0x35c8d0(0x1c2)](),_0xdc5c5=await staff[_0x35c8d0(0x1fe)]({'email':_0x2555d9[_0x35c8d0(0x20c)]}),_0x16d7ca=await suppliers['find']({});let _0x455bcc;if(_0x2555d9['role']==_0x35c8d0(0x1d3)){const _0x433a0c=await staff['findOne']({'email':_0x2555d9['email']});_0x455bcc=await warehouse[_0x35c8d0(0x178)]([{'$match':{'status':_0x35c8d0(0x14d),'name':_0x433a0c['warehouse']}},{'$group':{'_id':_0x35c8d0(0x1bc),'name':{'$first':_0x35c8d0(0x1bc)}}}]);}else _0x455bcc=await warehouse[_0x35c8d0(0x178)]([{'$match':{'status':_0x35c8d0(0x14d),'name':{'$ne':_0x35c8d0(0x158)}}},{'$group':{'_id':_0x35c8d0(0x1bc),'name':{'$first':_0x35c8d0(0x1bc)}}}]);const _0x204063=await product[_0x35c8d0(0x1c2)]({}),_0x2dd370=await warehouse[_0x35c8d0(0x1c2)]({'status':_0x35c8d0(0x14d)}),_0x17e071=await purchases_finished[_0x35c8d0(0x1c2)]({}),_0x4b4913=_0x17e071['length']+0x1,_0x217e50=_0x35c8d0(0x1b9)+_0x4b4913[_0x35c8d0(0x192)]()[_0x35c8d0(0x18e)](0x5,'0');var _0x52223d=[_0x35c8d0(0x23a),_0x35c8d0(0x21f)];if(_0x958728[0x0][_0x35c8d0(0x20f)]==_0x35c8d0(0x169))var _0x3d7eb2=users[_0x35c8d0(0x176)];else{if(_0x958728[0x0][_0x35c8d0(0x20f)]==_0x35c8d0(0x193))var _0x3d7eb2=users[_0x35c8d0(0x193)];else{if(_0x958728[0x0][_0x35c8d0(0x20f)]==_0x35c8d0(0x1eb))var _0x3d7eb2=users[_0x35c8d0(0x1eb)];else{if(_0x958728[0x0][_0x35c8d0(0x20f)]=='Spanish')var _0x3d7eb2=users[_0x35c8d0(0x1f6)];else{if(_0x958728[0x0][_0x35c8d0(0x20f)]==_0x35c8d0(0x215))var _0x3d7eb2=users[_0x35c8d0(0x215)];else{if(_0x958728[0x0][_0x35c8d0(0x20f)]=='Portuguese\x20(BR)')var _0x3d7eb2=users['Portuguese'];else{if(_0x958728[0x0][_0x35c8d0(0x20f)]==_0x35c8d0(0x166))var _0x3d7eb2=users[_0x35c8d0(0x166)];else{if(_0x958728[0x0][_0x35c8d0(0x20f)]==_0x35c8d0(0x231))var _0x3d7eb2=users['Arabic'];}}}}}}}const _0x180dd7=getRandom8DigitNumber();_0x180dd7[_0x35c8d0(0x21a)](_0x5f2747=>{var _0x32943d=_0x35c8d0;_0x4391fe[_0x32943d(0x237)](_0x32943d(0x226),{'success':_0x51cf4c[_0x32943d(0x1e6)](_0x32943d(0x1cf)),'errors':_0x51cf4c[_0x32943d(0x1e6)]('errors'),'role':_0x2555d9,'profile':_0x4a23bd,'suppliers':_0x16d7ca,'warehouse':_0x455bcc,'product':_0x204063,'invoice':_0x5f2747,'master_shop':_0x958728,'language':_0x3d7eb2,'find_data':_0x2dd370,'rooms_data':_0x52223d});})[_0x35c8d0(0x1ab)](_0xdf06ce=>{var _0xdb3149=_0x35c8d0;_0x51cf4c[_0xdb3149(0x1e6)]('errors','There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x4391fe[_0xdb3149(0x18c)]('/all_purchases_finished/view');});}catch(_0x362d06){console['log'](_0x362d06);}}),router['get'](a0_0x363552(0x207),auth,async(_0x383772,_0x3483c1)=>{var _0x56daed=a0_0x363552;try{const _0x4c3440=_0x383772[_0x56daed(0x1e7)]['id'];console[_0x56daed(0x205)](_0x4c3440);const _0x22a818=await master_shop[_0x56daed(0x1c2)]();console[_0x56daed(0x205)](_0x56daed(0x19c),_0x22a818);const _0x21aad9=await product['findOne']({'name':_0x4c3440});console['log'](_0x56daed(0x203),_0x21aad9),_0x3483c1[_0x56daed(0x1a0)](0xc8)[_0x56daed(0x1a4)]({'product_data':_0x21aad9,'master':_0x22a818});}catch(_0x5beb16){console[_0x56daed(0x205)]('add_purchases\x20error',_0x5beb16);}}),router[a0_0x363552(0x1a7)](a0_0x363552(0x167),auth,async(_0x25e77d,_0x3528c4)=>{var _0x433817=a0_0x363552;try{const {invoice:_0x195ba1,date:_0x1b28ff,warehouse_name:_0x5923aa,prod_name:_0x1b5ac3,prod_code:_0x2b5b4d,prod_qty:_0x33f647,prod_unit:_0x11565e,prod_secondunit:_0x428112,prod_level:_0x584cb0,prod_isle:_0x474ce6,prod_pallet:_0x5414eb,note:_0x38e989,expiry_date:_0x5da0cf,batch_code:_0xc792f6,payable:_0xd1edfe,due_amount:_0x58f9f4,Room_name:_0x19379b,primary_code:_0x263c5a,secondary_code:_0x1ebfe5,MaxStocks_data:_0x7b5500,PO_number:_0x4d1673,SCRN:_0x26cced,JO_number:_0x21904f,ReqBy:_0xd595fa,dateofreq:_0xd4f4b1,typeservicesData:_0x3d9382,driver:_0x379b48,plate:_0x3e3c8b,van:_0x1f5867,DRSI:_0x49b187,typevehicle:_0x92cfe7,TSU:_0x2ad341,TFU:_0x27e5cb}=_0x25e77d['body'];if(typeof _0x1b5ac3==_0x433817(0x201))var _0x22121e=[_0x25e77d['body']['prod_name']],_0x1ce38a=[_0x25e77d[_0x433817(0x182)][_0x433817(0x1a1)]],_0xa777b4=[_0x25e77d['body'][_0x433817(0x185)]],_0x19abc6=[_0x25e77d['body'][_0x433817(0x22b)]],_0x153f53=[_0x25e77d['body'][_0x433817(0x1b3)]],_0x912bca=[_0x25e77d[_0x433817(0x182)][_0x433817(0x217)]],_0x4c66af=[_0x25e77d[_0x433817(0x182)]['primary_code']],_0x460dc4=[_0x25e77d[_0x433817(0x182)]['secondary_code']],_0x54a2c=[_0x25e77d[_0x433817(0x182)][_0x433817(0x18d)]],_0x2eba59=[_0x25e77d[_0x433817(0x182)]['batch_code']],_0x39791c=[_0x25e77d[_0x433817(0x182)]['expiry_date']],_0x12b5c9=[_0x25e77d[_0x433817(0x182)][_0x433817(0x145)]],_0x35b209=[_0x25e77d[_0x433817(0x182)][_0x433817(0x19b)]],_0x4485ca=[_0x25e77d[_0x433817(0x182)][_0x433817(0x239)]],_0x54f56a=[_0x25e77d[_0x433817(0x182)]['RoomAssign']],_0x585f9e=[_0x25e77d[_0x433817(0x182)][_0x433817(0x168)]],_0x4ad5ec=[_0x25e77d[_0x433817(0x182)]['CBM']],_0x1fce45=[_0x25e77d[_0x433817(0x182)][_0x433817(0x1ba)]];else var _0x22121e=[..._0x25e77d['body'][_0x433817(0x171)]],_0x1ce38a=[..._0x25e77d[_0x433817(0x182)][_0x433817(0x1a1)]],_0xa777b4=[..._0x25e77d[_0x433817(0x182)][_0x433817(0x185)]],_0x19abc6=[..._0x25e77d[_0x433817(0x182)]['prod_primunit']],_0x153f53=[..._0x25e77d[_0x433817(0x182)][_0x433817(0x1b3)]],_0x912bca=[..._0x25e77d[_0x433817(0x182)]['prod_level']],_0x4c66af=[..._0x25e77d[_0x433817(0x182)][_0x433817(0x232)]],_0x460dc4=[..._0x25e77d['body'][_0x433817(0x164)]],_0x54a2c=[..._0x25e77d['body'][_0x433817(0x18d)]],_0x2eba59=[..._0x25e77d[_0x433817(0x182)][_0x433817(0x1dc)]],_0x39791c=[..._0x25e77d[_0x433817(0x182)][_0x433817(0x1ed)]],_0x12b5c9=[..._0x25e77d[_0x433817(0x182)][_0x433817(0x145)]],_0x35b209=[..._0x25e77d[_0x433817(0x182)][_0x433817(0x19b)]],_0x4485ca=[..._0x25e77d[_0x433817(0x182)][_0x433817(0x239)]],_0x54f56a=[..._0x25e77d['body']['RoomAssign']],_0x585f9e=[..._0x25e77d[_0x433817(0x182)][_0x433817(0x168)]],_0x4ad5ec=[..._0x25e77d['body'][_0x433817(0x146)]],_0x1fce45=[..._0x25e77d[_0x433817(0x182)]['prod_invoice']];const _0x13627f=_0x22121e[_0x433817(0x212)](_0x2a30e3=>{return _0x2a30e3={'product_name':_0x2a30e3};});_0x1ce38a[_0x433817(0x1db)]((_0x36d5a9,_0x8da76b)=>{_0x13627f[_0x8da76b]['product_code']=_0x36d5a9;}),_0xa777b4[_0x433817(0x1db)]((_0x3a866d,_0x22d749)=>{_0x13627f[_0x22d749]['quantity']=_0x3a866d;}),_0x19abc6[_0x433817(0x1db)]((_0x2b638c,_0x5a5b26)=>{var _0x2cef4f=_0x433817;_0x13627f[_0x5a5b26][_0x2cef4f(0x23f)]=_0x2b638c;}),_0x153f53[_0x433817(0x1db)]((_0x2b5a2d,_0x3390c5)=>{_0x13627f[_0x3390c5]['secondary_unit']=_0x2b5a2d;}),_0x912bca[_0x433817(0x1db)]((_0x1d6fdf,_0x1e1777)=>{var _0x4ae413=_0x433817,_0x175dcc=_0x1d6fdf[_0x4ae413(0x14a)](0x1);_0x13627f[_0x1e1777][_0x4ae413(0x19d)]=_0x1d6fdf[0x0],_0x13627f[_0x1e1777][_0x4ae413(0x20a)]=_0x175dcc;}),_0x585f9e[_0x433817(0x1db)]((_0x49bc95,_0x45bfc7)=>{var _0xf46a8c=_0x433817;_0x13627f[_0x45bfc7][_0xf46a8c(0x23b)]=_0x49bc95;}),_0x4c66af[_0x433817(0x1db)]((_0x24f07b,_0x31b699)=>{_0x13627f[_0x31b699]['primary_code']=_0x24f07b;}),_0x460dc4[_0x433817(0x1db)]((_0x40f20a,_0x39cae0)=>{_0x13627f[_0x39cae0]['secondary_code']=_0x40f20a;}),_0x54a2c[_0x433817(0x1db)]((_0x4e03cd,_0x242a4f)=>{var _0x3b2b97=_0x433817;_0x13627f[_0x242a4f][_0x3b2b97(0x199)]=_0x4e03cd;}),_0x2eba59[_0x433817(0x1db)]((_0x722d4a,_0x4d2aa0)=>{var _0x1f9727=_0x433817;_0x13627f[_0x4d2aa0][_0x1f9727(0x1dc)]=_0x722d4a;}),_0x39791c[_0x433817(0x1db)]((_0x2bb789,_0x2b5322)=>{var _0x236c44=_0x433817;_0x13627f[_0x2b5322][_0x236c44(0x1ed)]=_0x2bb789;}),_0x12b5c9[_0x433817(0x1db)]((_0x9def1d,_0x5943dc)=>{var _0x44bbb1=_0x433817;_0x13627f[_0x5943dc][_0x44bbb1(0x22e)]=_0x9def1d;}),_0x35b209[_0x433817(0x1db)]((_0x3fab8e,_0x4cab4f)=>{var _0x355d23=_0x433817;_0x13627f[_0x4cab4f][_0x355d23(0x1e9)]=_0x3fab8e;}),_0x4485ca['forEach']((_0xea5dcc,_0x2fe6b2)=>{var _0x2b6ad6=_0x433817;_0x13627f[_0x2fe6b2][_0x2b6ad6(0x230)]=_0xea5dcc;}),_0x54f56a[_0x433817(0x1db)]((_0x409c12,_0x1726e9)=>{var _0x856462=_0x433817;_0x13627f[_0x1726e9][_0x856462(0x1c0)]=_0x409c12;}),_0x4ad5ec[_0x433817(0x1db)]((_0x364447,_0x128148)=>{var _0xdbd908=_0x433817;_0x13627f[_0x128148][_0xdbd908(0x146)]=_0x364447;}),_0x1fce45['forEach']((_0x5e708b,_0x2ebf13)=>{_0x13627f[_0x2ebf13]['invoice']=_0x5e708b;});const _0x5480d2=_0x13627f[_0x433817(0x1bd)](_0xf06feb=>_0xf06feb[_0x433817(0x1be)]!=='0'&&_0xf06feb['quantity']!==''),_0x4c2498=new purchases_finished({'invoice':_0x195ba1,'suppliers':_0x25e77d['body'][_0x433817(0x238)],'date':_0x1b28ff,'warehouse_name':_0x5923aa,'product':_0x5480d2,'note':_0x38e989,'due_amount':_0x58f9f4,'room':_0x19379b,'POnumber':_0x4d1673,'SCRN':_0x26cced,'JO_number':_0x21904f,'RequestedBy':_0xd595fa,'DateofRequest':_0xd4f4b1,'typeservices':_0x3d9382,'driver':_0x379b48,'plate':_0x3e3c8b,'van':_0x1f5867,'DRSI':_0x49b187,'typevehicle':_0x92cfe7,'TSU':_0x2ad341,'TFU':_0x27e5cb}),_0x12f799=await _0x4c2498['save'](),_0x5cf5fb=await purchases_finished['findOne']({'invoice':_0x195ba1}),_0xcf5254=_0x5cf5fb[_0x433817(0x203)]['map'](async _0x15e4ac=>{var _0x33b7c1=_0x433817,_0x47ded2=await warehouse[_0x33b7c1(0x1fe)]({'name':_0x5923aa,'room':_0x15e4ac[_0x33b7c1(0x1c0)]}),_0x49ce7c=0x0;const _0x1f84c1=_0x47ded2[_0x33b7c1(0x1c9)][_0x33b7c1(0x212)](_0x27675d=>{var _0x4aad72=_0x33b7c1;_0x27675d[_0x4aad72(0x17b)]==_0x15e4ac['product_name']&&_0x27675d[_0x4aad72(0x23b)]==_0x15e4ac['level']&&_0x27675d['isle']==_0x15e4ac[_0x4aad72(0x19d)]&&_0x27675d[_0x4aad72(0x20a)]==_0x15e4ac[_0x4aad72(0x20a)]&&_0x27675d[_0x4aad72(0x1ed)]==_0x15e4ac[_0x4aad72(0x1ed)]&&_0x27675d[_0x4aad72(0x22e)]==_0x15e4ac[_0x4aad72(0x22e)]&&_0x27675d[_0x4aad72(0x1dc)]==_0x15e4ac[_0x4aad72(0x1dc)]&&_0x27675d[_0x4aad72(0x230)]==_0x15e4ac[_0x4aad72(0x230)]&&_0x27675d[_0x4aad72(0x1ac)]==_0x5cf5fb[_0x4aad72(0x1ac)]&&(_0x27675d['product_stock']=_0x27675d[_0x4aad72(0x16e)]+_0x15e4ac[_0x4aad72(0x1be)],_0x49ce7c++);});return _0x49ce7c=='0'&&(_0x47ded2[_0x33b7c1(0x1c9)]=_0x47ded2['product_details']['concat']({'product_name':_0x15e4ac[_0x33b7c1(0x17b)],'product_stock':_0x15e4ac[_0x33b7c1(0x1be)],'primary_code':_0x15e4ac['primary_code'],'secondary_code':_0x15e4ac[_0x33b7c1(0x164)],'product_code':_0x15e4ac['product_code'],'level':_0x15e4ac[_0x33b7c1(0x23b)],'isle':_0x15e4ac[_0x33b7c1(0x19d)],'pallet':_0x15e4ac[_0x33b7c1(0x20a)],'maxProducts':_0x15e4ac['maxStocks'],'unit':_0x15e4ac['standard_unit'],'secondary_unit':_0x15e4ac[_0x33b7c1(0x200)],'expiry_date':_0x15e4ac['expiry_date'],'production_date':_0x15e4ac[_0x33b7c1(0x22e)],'maxProducts':_0x15e4ac[_0x33b7c1(0x199)],'maxPerUnit':_0x15e4ac[_0x33b7c1(0x1e9)],'batch_code':_0x15e4ac[_0x33b7c1(0x1dc)],'product_cat':_0x15e4ac[_0x33b7c1(0x230)],'CBM':_0x15e4ac[_0x33b7c1(0x146)],'invoice':_0x15e4ac[_0x33b7c1(0x1ac)]})),_0x47ded2;});Promise[_0x433817(0x22c)](_0xcf5254)[_0x433817(0x21a)](async _0x5df99c=>{var _0x35356a=_0x433817;try{for(const _0x3d34b6 of _0x5df99c){await warehouse[_0x35356a(0x180)]({'_id':_0x3d34b6[_0x35356a(0x1a3)]},{'$addToSet':{'product_details':{'$each':_0x3d34b6[_0x35356a(0x1c9)]}}});}}catch(_0x5da706){console[_0x35356a(0x155)](_0x5da706),_0x3528c4['status'](0x1f4)[_0x35356a(0x1a4)]({'error':_0x35356a(0x194),'message':_0x5da706[_0x35356a(0x1aa)]});}})[_0x433817(0x1ab)](_0x52f564=>{var _0x27a890=_0x433817;console[_0x27a890(0x155)](_0x52f564),_0x3528c4[_0x27a890(0x1a0)](0x1f4)[_0x27a890(0x1a4)]({'error':_0x27a890(0x18f)});});const _0x20f65a=await master_shop[_0x433817(0x1c2)](),_0x3eac68=await email_settings[_0x433817(0x1fe)](),_0x51d82b=await suppliers['findOne']({'name':_0x25e77d[_0x433817(0x182)][_0x433817(0x238)]}),_0x661c56=await supervisor_settings['find']();_0x20f65a[0x0][_0x433817(0x17a)]==0x1?(right_currency=_0x20f65a[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x20f65a[0x0][_0x433817(0x21e)]);var _0x334f67=_0x22121e,_0x8e806c=_0xa777b4,_0x41042b=_0x1ce38a,_0x3dae0b=_0x19abc6,_0x593462=_0x153f53,_0x9084e5=_0x912bca,_0x5dcb29=_0x585f9e,_0x45033e='',_0x59a4c3;for(_0x59a4c3 in _0x334f67){_0x45033e+=_0x433817(0x1c7)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x334f67[_0x59a4c3]+_0x433817(0x1fc)+_0x433817(0x224)+_0x41042b[_0x59a4c3]+_0x433817(0x1fc)+_0x433817(0x224)+_0x8e806c[_0x59a4c3]+_0x433817(0x1fc)+_0x433817(0x224)+_0x3dae0b[_0x59a4c3]+_0x433817(0x1fc)+_0x433817(0x224)+_0x593462[_0x59a4c3]+_0x433817(0x1fc)+_0x433817(0x224)+_0x5dcb29[_0x59a4c3]+_0x433817(0x1fc)+_0x433817(0x224)+_0x9084e5[_0x59a4c3]+_0x433817(0x1fc)+'</tr>';}let _0x88d8d6=nodemailer['createTransport']({'host':_0x3eac68[_0x433817(0x236)],'port':Number(_0x3eac68['port']),'secure':![],'auth':{'user':_0x3eac68[_0x433817(0x20c)],'pass':_0x3eac68[_0x433817(0x144)]}}),_0x5e45ea={'from':_0x3eac68[_0x433817(0x20c)],'to':_0x661c56[0x0][_0x433817(0x1b2)],'subject':'Purchase\x20Mail','attachments':[{'filename':_0x433817(0x21c),'path':__dirname+_0x433817(0x15a)+_0x433817(0x1da)+_0x20f65a[0x0][_0x433817(0x179)],'cid':_0x433817(0x22a)}],'html':_0x433817(0x1ef)+_0x433817(0x172)+_0x433817(0x186)+_0x433817(0x227)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x433817(0x227)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x433817(0x1d6)+_0x433817(0x227)+'<h2>\x20'+_0x20f65a[0x0]['site_title']+_0x433817(0x1c4)+_0x433817(0x1d6)+_0x433817(0x1d6)+_0x433817(0x1ca)+_0x433817(0x227)+_0x433817(0x1f1)+_0x433817(0x153)+_0x195ba1+'\x20'+_0x433817(0x1d4)+_0x433817(0x142)+_0x1b28ff+'\x20'+_0x433817(0x162)+'</h5>'+_0x433817(0x1d6)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x433817(0x1c7)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x433817(0x17e)+_0x433817(0x15c)+_0x433817(0x206)+_0x433817(0x1de)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Level\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x433817(0x190)+_0x433817(0x1cd)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x45033e+'\x20'+_0x433817(0x154)+_0x433817(0x1f4)+_0x433817(0x227)+'<strong>\x20Regards\x20</strong>'+_0x433817(0x19f)+_0x20f65a[0x0][_0x433817(0x20e)]+_0x433817(0x211)+_0x433817(0x1d6)+_0x433817(0x1d6)+_0x433817(0x1f0)};_0x88d8d6[_0x433817(0x16c)](_0x5e45ea,function(_0xa81afe,_0x5b1419){var _0xa1636e=_0x433817;_0xa81afe?(console['log'](_0xa81afe),console[_0xa1636e(0x205)]('Error\x20Occurs')):console[_0xa1636e(0x205)]('Email\x20sent\x20successfully');}),_0x25e77d[_0x433817(0x1e6)](_0x433817(0x1cf),_0x433817(0x143)),_0x3528c4['redirect'](_0x433817(0x148));}catch(_0xd490a5){console[_0x433817(0x205)](_0xd490a5);}}),router[a0_0x363552(0x1df)](a0_0x363552(0x223),auth,async(_0x529b23,_0x310b9c)=>{var _0x2ee6d5=a0_0x363552;try{const {username:_0x116e3a,email:_0x1ae6d7,role:_0x56682b}=_0x529b23[_0x2ee6d5(0x1e8)],_0x362a09=_0x529b23[_0x2ee6d5(0x1e8)],_0x117502=await profile[_0x2ee6d5(0x1fe)]({'email':_0x362a09[_0x2ee6d5(0x20c)]}),_0x5842c2=await master_shop[_0x2ee6d5(0x1c2)](),_0xfe2340=_0x529b23[_0x2ee6d5(0x1e7)]['id'],_0x2177f5=await purchases_finished[_0x2ee6d5(0x1f7)](_0xfe2340),_0x105ca0=await suppliers[_0x2ee6d5(0x1c2)]({});let _0x45d0ac;if(_0x362a09[_0x2ee6d5(0x147)]==_0x2ee6d5(0x1d3)){const _0x5e1354=await staff[_0x2ee6d5(0x1fe)]({'email':_0x362a09[_0x2ee6d5(0x20c)]});_0x45d0ac=await warehouse[_0x2ee6d5(0x1c2)]({'status':'Enabled','name':_0x5e1354[_0x2ee6d5(0x1d1)]});}else _0x45d0ac=await warehouse[_0x2ee6d5(0x178)]([{'$match':{'status':_0x2ee6d5(0x14d)}},{'$group':{'_id':_0x2ee6d5(0x1bc),'name':{'$first':_0x2ee6d5(0x1bc)}}}]);const _0x46fba0=await product[_0x2ee6d5(0x1c2)]({}),_0x2cb1dd=BayBinSelected(_0x2177f5['warehouse_name'],_0x2177f5[_0x2ee6d5(0x234)]);let _0xbc48f2=new Date(_0x2177f5[_0x2ee6d5(0x1ed)]),_0x3f4d6=('0'+_0xbc48f2[_0x2ee6d5(0x156)]())['slice'](-0x2),_0x3f27d5=('0'+(_0xbc48f2[_0x2ee6d5(0x1bf)]()+0x1))[_0x2ee6d5(0x14a)](-0x2),_0x2f1d88=_0xbc48f2['getFullYear'](),_0x36a7c4=_0x2f1d88+'-'+_0x3f27d5+'-'+_0x3f4d6;if(_0x5842c2[0x0][_0x2ee6d5(0x20f)]=='English\x20(US)'){var _0x269d8c=users[_0x2ee6d5(0x176)];console[_0x2ee6d5(0x205)](_0x269d8c);}else{if(_0x5842c2[0x0][_0x2ee6d5(0x20f)]=='Hindi')var _0x269d8c=users[_0x2ee6d5(0x193)];else{if(_0x5842c2[0x0][_0x2ee6d5(0x20f)]=='German')var _0x269d8c=users[_0x2ee6d5(0x1eb)];else{if(_0x5842c2[0x0][_0x2ee6d5(0x20f)]=='Spanish')var _0x269d8c=users[_0x2ee6d5(0x1f6)];else{if(_0x5842c2[0x0]['language']==_0x2ee6d5(0x215))var _0x269d8c=users[_0x2ee6d5(0x215)];else{if(_0x5842c2[0x0][_0x2ee6d5(0x20f)]==_0x2ee6d5(0x1ec))var _0x269d8c=users[_0x2ee6d5(0x23c)];else{if(_0x5842c2[0x0][_0x2ee6d5(0x20f)]=='Chinese')var _0x269d8c=users[_0x2ee6d5(0x166)];else{if(_0x5842c2[0x0][_0x2ee6d5(0x20f)]=='Arabic\x20(ae)')var _0x269d8c=users[_0x2ee6d5(0x1a6)];}}}}}}}_0x310b9c[_0x2ee6d5(0x237)](_0x2ee6d5(0x208),{'success':_0x529b23[_0x2ee6d5(0x1e6)](_0x2ee6d5(0x1cf)),'errors':_0x529b23['flash'](_0x2ee6d5(0x21d)),'role':_0x362a09,'profile':_0x117502,'purchases':_0x2177f5,'suppliers':_0x105ca0,'warehouse':_0x45d0ac,'product':_0x46fba0,'master_shop':_0x5842c2,'language':_0x269d8c,'ed_fullDate':_0x36a7c4,'dataSelected':_0x2cb1dd});}catch(_0xbdf591){console['log'](_0xbdf591);}}),router[a0_0x363552(0x1df)]('/view/:id',auth,async(_0x2399af,_0x2c7560)=>{var _0x2c46f3=a0_0x363552;try{const {username:_0x395c4a,email:_0x242a2c,role:_0xca4719}=_0x2399af[_0x2c46f3(0x1e8)],_0x450abb=_0x2399af[_0x2c46f3(0x1e8)],_0x25836f=await profile['findOne']({'email':_0x450abb[_0x2c46f3(0x20c)]}),_0x2ec62f=await master_shop['find'](),_0x439aa5=_0x2399af[_0x2c46f3(0x1e7)]['id'],_0x408a9b=await purchases_finished[_0x2c46f3(0x1f7)](_0x439aa5),_0x5b2499=await suppliers[_0x2c46f3(0x1c2)]({});let _0x545329;if(_0x450abb[_0x2c46f3(0x147)]=='staff'){const _0x896829=await staff[_0x2c46f3(0x1fe)]({'email':_0x450abb['email']});_0x545329=await warehouse[_0x2c46f3(0x1c2)]({'status':'Enabled','name':_0x896829[_0x2c46f3(0x1d1)],'warehouse_category':_0x2c46f3(0x1ea)});}else _0x545329=await warehouse[_0x2c46f3(0x178)]([{'$match':{'status':_0x2c46f3(0x14d),'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':'$name','name':{'$first':_0x2c46f3(0x1bc)}}}]);const _0x3b0619=await product['find']({}),_0x1a8ece=BayBinSelected(_0x408a9b[_0x2c46f3(0x1d2)],_0x408a9b[_0x2c46f3(0x234)]);let _0x35c313=new Date(_0x408a9b[_0x2c46f3(0x1ed)]),_0x8a44b5=('0'+_0x35c313[_0x2c46f3(0x156)]())[_0x2c46f3(0x14a)](-0x2),_0x1138a8=('0'+(_0x35c313['getMonth']()+0x1))[_0x2c46f3(0x14a)](-0x2),_0x456396=_0x35c313[_0x2c46f3(0x1b8)](),_0x148259=_0x456396+'-'+_0x1138a8+'-'+_0x8a44b5;if(_0x2ec62f[0x0]['language']==_0x2c46f3(0x169)){var _0x5a0c98=users[_0x2c46f3(0x176)];console[_0x2c46f3(0x205)](_0x5a0c98);}else{if(_0x2ec62f[0x0][_0x2c46f3(0x20f)]==_0x2c46f3(0x193))var _0x5a0c98=users['Hindi'];else{if(_0x2ec62f[0x0][_0x2c46f3(0x20f)]=='German')var _0x5a0c98=users['German'];else{if(_0x2ec62f[0x0][_0x2c46f3(0x20f)]==_0x2c46f3(0x1f6))var _0x5a0c98=users[_0x2c46f3(0x1f6)];else{if(_0x2ec62f[0x0][_0x2c46f3(0x20f)]==_0x2c46f3(0x215))var _0x5a0c98=users[_0x2c46f3(0x215)];else{if(_0x2ec62f[0x0]['language']==_0x2c46f3(0x1ec))var _0x5a0c98=users[_0x2c46f3(0x23c)];else{if(_0x2ec62f[0x0]['language']==_0x2c46f3(0x166))var _0x5a0c98=users[_0x2c46f3(0x166)];else{if(_0x2ec62f[0x0][_0x2c46f3(0x20f)]==_0x2c46f3(0x231))var _0x5a0c98=users['Arabic'];}}}}}}}_0x2c7560[_0x2c46f3(0x237)]('edit_purchases_finished',{'success':_0x2399af['flash']('success'),'errors':_0x2399af['flash'](_0x2c46f3(0x21d)),'role':_0x450abb,'profile':_0x25836f,'purchases':_0x408a9b,'suppliers':_0x5b2499,'warehouse':_0x545329,'product':_0x3b0619,'master_shop':_0x2ec62f,'language':_0x5a0c98,'ed_fullDate':_0x148259,'dataSelected':_0x1a8ece});}catch(_0x1b72ce){console[_0x2c46f3(0x205)](_0x1b72ce);}}),router[a0_0x363552(0x1a7)](a0_0x363552(0x1dd),auth,async(_0x2228a7,_0x100594)=>{var _0x4a39e6=a0_0x363552;try{const _0x150d69=_0x2228a7[_0x4a39e6(0x1e7)]['id'],_0x572ce9=await purchases_finished[_0x4a39e6(0x1fe)]({'_id':_0x2228a7[_0x4a39e6(0x1e7)]['id']}),_0x2fd879=await warehouse[_0x4a39e6(0x1fe)]({'name':_0x572ce9['warehouse_name'],'room':_0x572ce9['room']});_0x572ce9[_0x4a39e6(0x203)]['forEach'](_0x5f5702=>{var _0x249293=_0x4a39e6;const _0x139424=_0x2fd879[_0x249293(0x1c9)][_0x249293(0x212)](_0x52caef=>{var _0x41a123=_0x249293;_0x52caef[_0x41a123(0x17b)]==_0x5f5702[_0x41a123(0x17b)]&&_0x52caef[_0x41a123(0x1ce)]==_0x5f5702['bay']&&(_0x52caef['product_stock']=parseInt(_0x52caef[_0x41a123(0x16e)])-parseInt(_0x5f5702[_0x41a123(0x1be)]));});}),await _0x2fd879[_0x4a39e6(0x1bb)]();const {invoice:_0x425736,suppliers:_0x4e392b,date:_0x5e0058,warehouse_name:_0x582bfb,prod_name:_0x12ac48,prod_code:_0x1145c3,prod_qty:_0x3e9bdb,prod_unit:_0x376abf,prod_secondunit:_0x2dd16e,prod_level:_0x1a6bbd,prod_isle:_0x471dce,prod_pallet:_0x2c69c7,note:_0x13c759,expiry_date:_0x2ab69d,batch_code:_0x2b4d98,paid_amount:_0x223798,due_amount:_0x4c0e3d,Room_name:_0x25a8aa,primary_code:_0x19925b,secondary_code:_0x521faa,PO_number:_0x36330e,JO_number:_0x59bc0f}=_0x2228a7[_0x4a39e6(0x182)];if(typeof _0x12ac48==_0x4a39e6(0x201))var _0x390798=[_0x2228a7[_0x4a39e6(0x182)]['prod_name']],_0x19ee85=[_0x2228a7['body']['prod_code']],_0x1dc6aa=[_0x2228a7[_0x4a39e6(0x182)][_0x4a39e6(0x17c)]],_0x44aa13=[_0x2228a7[_0x4a39e6(0x182)][_0x4a39e6(0x222)]],_0x27e096=[_0x2228a7[_0x4a39e6(0x182)][_0x4a39e6(0x1b3)]],_0x33079f=[_0x2228a7[_0x4a39e6(0x182)]['prod_level']],_0x3fdf9b=[_0x2228a7['body'][_0x4a39e6(0x232)]],_0x43e20d=[_0x2228a7[_0x4a39e6(0x182)]['secondary_code']],_0x4d1f03=[_0x2228a7[_0x4a39e6(0x182)][_0x4a39e6(0x18d)]],_0x8aeea=[_0x2228a7[_0x4a39e6(0x182)][_0x4a39e6(0x1dc)]],_0x4fe268=[_0x2228a7[_0x4a39e6(0x182)][_0x4a39e6(0x1ed)]];else var _0x390798=[..._0x2228a7['body'][_0x4a39e6(0x171)]],_0x19ee85=[..._0x2228a7[_0x4a39e6(0x182)][_0x4a39e6(0x1a1)]],_0x1dc6aa=[..._0x2228a7[_0x4a39e6(0x182)]['prod_qty']],_0x44aa13=[..._0x2228a7[_0x4a39e6(0x182)][_0x4a39e6(0x222)]],_0x27e096=[..._0x2228a7[_0x4a39e6(0x182)]['prod_secondunit']],_0x33079f=[..._0x2228a7[_0x4a39e6(0x182)][_0x4a39e6(0x217)]],_0x3fdf9b=[..._0x2228a7[_0x4a39e6(0x182)][_0x4a39e6(0x232)]],_0x43e20d=[..._0x2228a7[_0x4a39e6(0x182)]['secondary_code']],_0x4d1f03=[..._0x2228a7[_0x4a39e6(0x182)][_0x4a39e6(0x18d)]],_0x8aeea=[..._0x2228a7[_0x4a39e6(0x182)][_0x4a39e6(0x1dc)]],_0x4fe268=[..._0x2228a7[_0x4a39e6(0x182)][_0x4a39e6(0x1ed)]];const _0x11823a=_0x390798['map'](_0x56ae0d=>{return _0x56ae0d={'product_name':_0x56ae0d};});_0x19ee85['forEach']((_0x58cdb0,_0x53fd88)=>{var _0x4427f8=_0x4a39e6;_0x11823a[_0x53fd88][_0x4427f8(0x149)]=_0x58cdb0;}),_0x1dc6aa[_0x4a39e6(0x1db)]((_0x33927c,_0x31b028)=>{_0x11823a[_0x31b028]['quantity']=_0x33927c;}),_0x44aa13[_0x4a39e6(0x1db)]((_0x40b521,_0x2cac38)=>{var _0x1613b3=_0x4a39e6;_0x11823a[_0x2cac38][_0x1613b3(0x23f)]=_0x40b521;}),_0x27e096[_0x4a39e6(0x1db)]((_0x34e0e3,_0x3f03cf)=>{var _0x4c3c30=_0x4a39e6;_0x11823a[_0x3f03cf][_0x4c3c30(0x200)]=_0x34e0e3;}),_0x33079f[_0x4a39e6(0x1db)]((_0x34b1b8,_0x5e6b12)=>{var _0x182e6f=_0x4a39e6;_0x11823a[_0x5e6b12][_0x182e6f(0x1ce)]=_0x34b1b8;}),_0x3fdf9b['forEach']((_0x4fe828,_0x2e14a1)=>{var _0x18e6ce=_0x4a39e6;_0x11823a[_0x2e14a1][_0x18e6ce(0x232)]=_0x4fe828;}),_0x43e20d[_0x4a39e6(0x1db)]((_0x500ebc,_0x2427f7)=>{var _0x497ccd=_0x4a39e6;_0x11823a[_0x2427f7][_0x497ccd(0x164)]=_0x500ebc;}),_0x4d1f03[_0x4a39e6(0x1db)]((_0x418239,_0x400f9b)=>{var _0x5c3f05=_0x4a39e6;_0x11823a[_0x400f9b][_0x5c3f05(0x199)]=_0x418239;}),_0x8aeea['forEach']((_0x184b3c,_0x567fe8)=>{var _0x2b089f=_0x4a39e6;_0x11823a[_0x567fe8][_0x2b089f(0x1dc)]=_0x184b3c;}),_0x4fe268['forEach']((_0xef79ee,_0x542905)=>{var _0x225836=_0x4a39e6;_0x11823a[_0x542905][_0x225836(0x1ed)]=_0xef79ee;});const _0x70f5de=_0x11823a[_0x4a39e6(0x1bd)](_0x413a51=>_0x413a51['quantity']!=='0'&&_0x413a51[_0x4a39e6(0x1be)]!=='');_0x572ce9['invoice']=_0x425736,_0x572ce9[_0x4a39e6(0x238)]=_0x4e392b,_0x572ce9[_0x4a39e6(0x218)]=_0x5e0058,_0x572ce9[_0x4a39e6(0x1d2)]=_0x582bfb,_0x572ce9['product']=_0x70f5de,_0x572ce9[_0x4a39e6(0x1fb)]=_0x13c759,_0x572ce9[_0x4a39e6(0x23d)]=_0x223798,_0x572ce9[_0x4a39e6(0x1ad)]=_0x4c0e3d,_0x572ce9[_0x4a39e6(0x234)]=_0x25a8aa,_0x572ce9['POnumber']=_0x36330e,_0x572ce9[_0x4a39e6(0x1a5)]=_0x59bc0f;const _0xccece3=await _0x572ce9['save'](),_0x5beaf1=await warehouse[_0x4a39e6(0x1fe)]({'name':_0x2228a7[_0x4a39e6(0x182)][_0x4a39e6(0x1d2)],'room':_0x2228a7[_0x4a39e6(0x182)][_0x4a39e6(0x183)]});_0x572ce9[_0x4a39e6(0x203)]['forEach'](_0x384dee=>{var _0x10dcb7=_0x4a39e6,_0x3e4162=0x0;const _0xd6700a=_0x5beaf1[_0x10dcb7(0x1c9)][_0x10dcb7(0x212)](_0x10e2e6=>{var _0x52d505=_0x10dcb7;_0x10e2e6[_0x52d505(0x17b)]==_0x384dee[_0x52d505(0x17b)]&&_0x10e2e6[_0x52d505(0x1ce)]==_0x384dee[_0x52d505(0x1ce)]&&(_0x10e2e6[_0x52d505(0x16e)]=parseInt(_0x10e2e6[_0x52d505(0x16e)])+parseInt(_0x384dee[_0x52d505(0x1be)]),_0x3e4162++);});_0x3e4162=='0'&&(_0x5beaf1[_0x10dcb7(0x1c9)]=_0x5beaf1[_0x10dcb7(0x1c9)][_0x10dcb7(0x187)]({'product_name':_0x384dee['product_name'],'product_stock':_0x384dee[_0x10dcb7(0x1be)],'primary_code':_0x384dee['primary_code'],'secondary_code':_0x384dee[_0x10dcb7(0x164)],'product_code':_0x384dee[_0x10dcb7(0x149)],'bay':_0x384dee[_0x10dcb7(0x1ce)],'maxProducts':_0x384dee[_0x10dcb7(0x199)],'unit':_0x384dee[_0x10dcb7(0x23f)],'secondary_unit':_0x384dee['secondary_unit'],'expiry_date':_0x384dee[_0x10dcb7(0x1ed)]}));}),await _0x5beaf1['save']();const _0x1153d1=await s_payment_data[_0x4a39e6(0x1fe)]({'invoice':_0x2228a7[_0x4a39e6(0x182)][_0x4a39e6(0x1ac)]});if(_0x1153d1===null){}else console[_0x4a39e6(0x205)](_0x4a39e6(0x238),_0x1153d1,_0x2228a7[_0x4a39e6(0x182)]['invoice']),_0x1153d1['suppliers']=_0x2228a7[_0x4a39e6(0x182)][_0x4a39e6(0x238)],await _0x1153d1[_0x4a39e6(0x1bb)]();_0x2228a7[_0x4a39e6(0x1e6)]('success',_0x4a39e6(0x150)),_0x100594[_0x4a39e6(0x18c)](_0x4a39e6(0x148));}catch(_0x3e8a7d){console['log'](_0x3e8a7d);}}),router[a0_0x363552(0x1a7)]('/give_payment/:id',auth,async(_0x3ba862,_0xd77ac9)=>{var _0x48f19a=a0_0x363552;try{const _0x2ef132=_0x3ba862[_0x48f19a(0x1e7)]['id'],{invoice:_0x20a2c0,suppliers:_0x5b719d,payable:_0x1c1326,due_amount:_0x2d05b6}=_0x3ba862[_0x48f19a(0x182)],_0xb710d0=await purchases[_0x48f19a(0x1f7)](_0x2ef132);var _0x273a63=_0x1c1326-_0x2d05b6;_0xb710d0[_0x48f19a(0x23d)]=parseFloat(_0xb710d0[_0x48f19a(0x23d)])+parseFloat(_0x2d05b6),_0xb710d0[_0x48f19a(0x1ad)]=_0x273a63;const _0x1cc372=await _0xb710d0[_0x48f19a(0x1bb)]();console[_0x48f19a(0x205)](_0x1cc372);const _0x2508f9=await s_payment_data[_0x48f19a(0x1fe)]({'invoice':_0x20a2c0});_0x2508f9['amount']=_0x273a63,await _0x2508f9[_0x48f19a(0x1bb)]();let _0x4b810e=new Date(),_0x35720f=('0'+_0x4b810e['getDate']())[_0x48f19a(0x14a)](-0x2),_0x4686d3=('0'+(_0x4b810e[_0x48f19a(0x1bf)]()+0x1))[_0x48f19a(0x14a)](-0x2),_0x45b2f2=_0x4b810e['getFullYear'](),_0xff450d=_0x45b2f2+'-'+_0x4686d3+'-'+_0x35720f;const _0x57acc5=new suppliers_payment({'invoice':_0x20a2c0,'date':_0x45b2f2+'-'+_0x4686d3+'-'+_0x35720f,'suppliers':_0x5b719d,'reason':_0x48f19a(0x1a8),'amount':_0x2d05b6}),_0x36f363=await _0x57acc5['save']();_0x3ba862[_0x48f19a(0x1e6)](_0x48f19a(0x1cf),_0x48f19a(0x157)),_0xd77ac9[_0x48f19a(0x18c)]('/all_purchases/view');}catch(_0x127277){console[_0x48f19a(0x205)](_0x127277);}}),router[a0_0x363552(0x1df)](a0_0x363552(0x1a2),auth,async(_0x6d1b8,_0x397b34)=>{var _0x6ae304=a0_0x363552;try{const {username:_0x491ece,email:_0x5e5226,role:_0x15ad6d}=_0x6d1b8[_0x6ae304(0x1e8)],_0x200448=_0x6d1b8[_0x6ae304(0x1e8)],_0x2cf6be=await profile[_0x6ae304(0x1fe)]({'email':_0x200448['email']}),_0x4c3179=await master_shop[_0x6ae304(0x1c2)]();console[_0x6ae304(0x205)](_0x6ae304(0x19c),_0x4c3179);const _0x249c35=_0x6d1b8['params']['id'],_0x974ad8=await purchases[_0x6ae304(0x1f7)](_0x249c35);console[_0x6ae304(0x205)](_0x974ad8);const _0x225cbe=await suppliers['findOne']({'name':_0x974ad8[_0x6ae304(0x238)]});console[_0x6ae304(0x205)](_0x225cbe);if(_0x4c3179[0x0][_0x6ae304(0x20f)]==_0x6ae304(0x169)){var _0x4d22b4=users[_0x6ae304(0x176)];console[_0x6ae304(0x205)](_0x4d22b4);}else{if(_0x4c3179[0x0][_0x6ae304(0x20f)]==_0x6ae304(0x193))var _0x4d22b4=users['Hindi'];else{if(_0x4c3179[0x0][_0x6ae304(0x20f)]==_0x6ae304(0x1eb))var _0x4d22b4=users[_0x6ae304(0x1eb)];else{if(_0x4c3179[0x0]['language']==_0x6ae304(0x1f6))var _0x4d22b4=users[_0x6ae304(0x1f6)];else{if(_0x4c3179[0x0][_0x6ae304(0x20f)]==_0x6ae304(0x215))var _0x4d22b4=users['French'];else{if(_0x4c3179[0x0][_0x6ae304(0x20f)]==_0x6ae304(0x1ec))var _0x4d22b4=users[_0x6ae304(0x23c)];else{if(_0x4c3179[0x0][_0x6ae304(0x20f)]==_0x6ae304(0x166))var _0x4d22b4=users[_0x6ae304(0x166)];else{if(_0x4c3179[0x0]['language']==_0x6ae304(0x231))var _0x4d22b4=users[_0x6ae304(0x1a6)];}}}}}}}_0x397b34[_0x6ae304(0x237)](_0x6ae304(0x1b0),{'success':_0x6d1b8['flash']('success'),'errors':_0x6d1b8[_0x6ae304(0x1e6)](_0x6ae304(0x21d)),'role':_0x200448,'profile':_0x2cf6be,'master_shop':_0x4c3179,'supplier':_0x225cbe,'purchase':_0x974ad8,'language':_0x4d22b4});}catch(_0x35a334){console[_0x6ae304(0x205)](_0x35a334);}}),router[a0_0x363552(0x1df)](a0_0x363552(0x16b),auth,async(_0x3ab9d2,_0x7e8d28)=>{var _0x595200=a0_0x363552;try{const {username:_0x34ffcb,email:_0x38cd28,role:_0x1dcd9e}=_0x3ab9d2[_0x595200(0x1e8)],_0x3d9e08=_0x3ab9d2[_0x595200(0x1e8)],_0x5afa7=await profile['findOne']({'email':_0x3d9e08['email']}),_0x32f83d=await master_shop[_0x595200(0x1c2)]();console[_0x595200(0x205)]('master',_0x32f83d);const _0x42a1c1=_0x3ab9d2[_0x595200(0x1e7)]['id'];console[_0x595200(0x205)](_0x42a1c1);const _0x3c0acf=await purchases_finished[_0x595200(0x1f7)](_0x42a1c1);console[_0x595200(0x205)](_0x595200(0x229),_0x3c0acf);const _0x12b84f=await product[_0x595200(0x1c2)]({}),_0x346dd8=await warehouse['aggregate']([{'$match':{'name':_0x3c0acf['warehouse_name'],'room':_0x3c0acf[_0x595200(0x234)]}},{'$unwind':_0x595200(0x219)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x595200(0x14b)},'product_stock':{'$first':_0x595200(0x17f)},'bay':{'$first':_0x595200(0x18a)},'bin':{'$first':_0x595200(0x1d0)},'type':{'$first':_0x595200(0x220)},'floorlevel':{'$first':_0x595200(0x1b4)},'primary_code':{'$first':_0x595200(0x202)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x595200(0x221)},'storage':{'$first':_0x595200(0x161)},'rack':{'$first':'$product_details.rack'}}}]);console[_0x595200(0x205)](_0x595200(0x21b),_0x346dd8);let _0x2f0fe2;if(_0x3d9e08[_0x595200(0x147)]=='staff'){const _0x27a487=await staff[_0x595200(0x1fe)]({'email':_0x3d9e08['email']});_0x2f0fe2=await warehouse['find']({'status':_0x595200(0x14d),'name':_0x27a487['warehouse'],'warehouse_category':_0x595200(0x1ea),'name':_0x595200(0x158)});}else _0x2f0fe2=await warehouse[_0x595200(0x178)]([{'$match':{'status':'Enabled','warehouse_category':_0x595200(0x1ea),'name':'Return\x20Goods'}},{'$group':{'_id':_0x595200(0x1bc),'name':{'$first':_0x595200(0x1bc)}}}]);if(_0x32f83d[0x0][_0x595200(0x20f)]==_0x595200(0x169)){var _0xd25dec=users['English'];console[_0x595200(0x205)](_0xd25dec);}else{if(_0x32f83d[0x0]['language']==_0x595200(0x193))var _0xd25dec=users['Hindi'];else{if(_0x32f83d[0x0][_0x595200(0x20f)]==_0x595200(0x1eb))var _0xd25dec=users[_0x595200(0x1eb)];else{if(_0x32f83d[0x0]['language']==_0x595200(0x1f6))var _0xd25dec=users['Spanish'];else{if(_0x32f83d[0x0]['language']==_0x595200(0x215))var _0xd25dec=users[_0x595200(0x215)];else{if(_0x32f83d[0x0][_0x595200(0x20f)]==_0x595200(0x1ec))var _0xd25dec=users[_0x595200(0x23c)];else{if(_0x32f83d[0x0][_0x595200(0x20f)]==_0x595200(0x166))var _0xd25dec=users['Chinese'];else{if(_0x32f83d[0x0][_0x595200(0x20f)]==_0x595200(0x231))var _0xd25dec=users['Arabic'];}}}}}}}_0x7e8d28[_0x595200(0x237)](_0x595200(0x1c3),{'success':_0x3ab9d2[_0x595200(0x1e6)]('success'),'errors':_0x3ab9d2[_0x595200(0x1e6)](_0x595200(0x21d)),'role':_0x3d9e08,'profile':_0x5afa7,'user':_0x3c0acf,'stock':_0x346dd8,'master_shop':_0x32f83d,'product':_0x12b84f,'language':_0xd25dec,'warehouse':_0x2f0fe2});}catch(_0xb6c1d0){console['log'](_0xb6c1d0);}}),router[a0_0x363552(0x1a7)]('/view/return_purchase/:id',auth,async(_0x1b87d9,_0x2aa49c)=>{var _0x27fdc6=a0_0x363552;try{const {invoice:_0x1fa787,date:_0x465bbd,warehouse_name:_0x36e10a,Room_name:_0x2c2a14,product_name:_0xdcbe9e,purchase_quantity:_0x2e381b,stocks:_0x19c016,return_qty:_0x1a58fa,note:_0x1ae39a,level:_0x122f00,isle:_0x49f4bc,pallet:_0x36a060,to_warehouse_name:_0x5297eb,to_Room_name:_0x5c0a81}=_0x1b87d9[_0x27fdc6(0x182)],_0x2d74ef=await purchases_finished['findOne']({'_id':_0x1b87d9['params']['id']}),_0x352db7=await warehouse[_0x27fdc6(0x1fe)]({'name':_0x36e10a,'room':_0x2c2a14,'warehouse_category':'Finished\x20Goods'});if(typeof _0xdcbe9e=='string')var _0x2d8b33=[_0x1b87d9[_0x27fdc6(0x182)][_0x27fdc6(0x17b)]],_0x59595e=[_0x1b87d9[_0x27fdc6(0x182)][_0x27fdc6(0x1e1)]],_0x3e2b71=[_0x1b87d9[_0x27fdc6(0x182)][_0x27fdc6(0x15f)]],_0x33fa62=[_0x1b87d9['body'][_0x27fdc6(0x233)]],_0x5f1b84=[_0x1b87d9['body']['level']],_0x59dba5=[_0x1b87d9['body'][_0x27fdc6(0x191)]],_0x2a6673=[_0x1b87d9[_0x27fdc6(0x182)][_0x27fdc6(0x1d9)]],_0x2f2339=[_0x1b87d9[_0x27fdc6(0x182)][_0x27fdc6(0x235)]];else var _0x2d8b33=[..._0x1b87d9[_0x27fdc6(0x182)][_0x27fdc6(0x17b)]],_0x59595e=[..._0x1b87d9[_0x27fdc6(0x182)][_0x27fdc6(0x1e1)]],_0x3e2b71=[..._0x1b87d9[_0x27fdc6(0x182)][_0x27fdc6(0x15f)]],_0x33fa62=[..._0x1b87d9['body']['return_qty']],_0x5f1b84=[..._0x1b87d9[_0x27fdc6(0x182)][_0x27fdc6(0x23b)]],_0x59dba5=[..._0x1b87d9[_0x27fdc6(0x182)][_0x27fdc6(0x191)]],_0x2a6673=[..._0x1b87d9[_0x27fdc6(0x182)]['primary_code_hide']],_0x2f2339=[..._0x1b87d9[_0x27fdc6(0x182)][_0x27fdc6(0x235)]];const _0x2079c3=_0x2d8b33[_0x27fdc6(0x212)](_0xd5b8a1=>{return _0xd5b8a1={'product_name':_0xd5b8a1};});_0x59595e[_0x27fdc6(0x1db)]((_0x1bbd22,_0x3f25b2)=>{_0x2079c3[_0x3f25b2]['purchase_quantity']=_0x1bbd22;}),_0x3e2b71[_0x27fdc6(0x1db)]((_0x45203d,_0x2a1fc1)=>{var _0x40e1f1=_0x27fdc6;_0x2079c3[_0x2a1fc1][_0x40e1f1(0x1e0)]=_0x45203d;}),_0x33fa62[_0x27fdc6(0x1db)]((_0x1653e8,_0x547dde)=>{var _0x4ee525=_0x27fdc6;_0x2079c3[_0x547dde][_0x4ee525(0x233)]=_0x1653e8;}),_0x5f1b84['forEach']((_0x41abc9,_0x5e558d)=>{var _0x37b433=_0x27fdc6;_0x2079c3[_0x5e558d][_0x37b433(0x1ce)]=_0x41abc9;}),_0x59dba5[_0x27fdc6(0x1db)]((_0x28147a,_0x326be5)=>{var _0x143582=_0x27fdc6;_0x2079c3[_0x326be5][_0x143582(0x149)]=_0x28147a;}),_0x2a6673[_0x27fdc6(0x1db)]((_0x2164ff,_0x13e0c9)=>{var _0x3c2e00=_0x27fdc6;_0x2079c3[_0x13e0c9][_0x3c2e00(0x232)]=_0x2164ff;}),_0x2f2339[_0x27fdc6(0x1db)]((_0x3d5e8c,_0x3c2805)=>{_0x2079c3[_0x3c2805]['secondary_code']=_0x3d5e8c;}),_0x2079c3['forEach'](_0x2bbabc=>{var _0x3c2e0a=_0x27fdc6;console[_0x3c2e0a(0x205)](_0x2bbabc);const _0x472174=_0x352db7[_0x3c2e0a(0x1c9)][_0x3c2e0a(0x212)](_0x5d97a1=>{var _0x160952=_0x3c2e0a;_0x5d97a1[_0x160952(0x17b)]==_0x2bbabc[_0x160952(0x17b)]&&_0x5d97a1[_0x160952(0x1ce)]==_0x2bbabc['bay']&&(console['log'](parseInt(_0x5d97a1[_0x160952(0x16e)])+_0x160952(0x14e)+parseInt(_0x2bbabc['return_qty'])),_0x5d97a1[_0x160952(0x16e)]=parseInt(_0x5d97a1[_0x160952(0x16e)])-parseInt(_0x2bbabc[_0x160952(0x233)]));});}),await _0x352db7['save']();var _0x29c2dd=0x0;_0x2079c3[_0x27fdc6(0x1db)](_0xbd09d2=>{var _0x7ee4f4=_0x27fdc6;(parseInt(_0xbd09d2['purchase_quantity'])<parseInt(_0xbd09d2[_0x7ee4f4(0x233)])||parseInt(_0xbd09d2['stock_quantity'])<parseInt(_0xbd09d2[_0x7ee4f4(0x233)]))&&_0x29c2dd++;});if(_0x29c2dd!=0x0)return _0x1b87d9[_0x27fdc6(0x1e6)](_0x27fdc6(0x21d),_0x27fdc6(0x173)),_0x2aa49c[_0x27fdc6(0x18c)]('back');const _0x4e3263=new purchases_return_finished({'invoice':_0x1fa787,'suppliers':_0x1b87d9[_0x27fdc6(0x182)][_0x27fdc6(0x238)],'date':_0x465bbd,'warehouse_name':_0x36e10a,'return_product':_0x2079c3,'note':_0x1ae39a,'room':_0x2c2a14,'to_warehouse_name':_0x5297eb,'to_room':_0x5c0a81}),_0x3a77aa=await _0x4e3263['save'](),_0x65eb70=await purchases_return_finished['findOne']({'invoice':_0x1fa787}),_0x10f486=await warehouse[_0x27fdc6(0x1fe)]({'name':_0x5297eb,'room':_0x5c0a81,'warehouse_category':_0x27fdc6(0x1ea)});_0x65eb70[_0x27fdc6(0x1f9)][_0x27fdc6(0x1db)](_0x336e44=>{var _0x130c14=_0x27fdc6,_0x1e6f38=0x0;const _0x562852=_0x10f486[_0x130c14(0x1c9)][_0x130c14(0x212)](_0x462138=>{var _0x324efa=_0x130c14;console[_0x324efa(0x205)](_0x462138['product_name']+'=='+_0x336e44[_0x324efa(0x17b)]+'&&'+_0x462138['bay']+'=='+_0x336e44[_0x324efa(0x1ce)]),_0x462138[_0x324efa(0x17b)]==_0x336e44[_0x324efa(0x17b)]&&_0x462138[_0x324efa(0x1ce)]==_0x336e44[_0x324efa(0x1ce)]&&(_0x462138[_0x324efa(0x16e)]=parseInt(_0x462138['product_stock'])-parseInt(_0x336e44[_0x324efa(0x233)]),_0x1e6f38++);});_0x1e6f38=='0'&&(_0x10f486['product_details']=_0x10f486['product_details'][_0x130c14(0x187)]({'product_name':_0x336e44[_0x130c14(0x17b)],'product_stock':_0x336e44[_0x130c14(0x233)],'primary_code':_0x336e44[_0x130c14(0x232)],'secondary_code':_0x336e44[_0x130c14(0x164)],'product_code':_0x336e44[_0x130c14(0x149)],'bay':_0x336e44[_0x130c14(0x1ce)],'maxProducts':0xf423f}));}),await _0x10f486[_0x27fdc6(0x1bb)]();const _0x51c4af=await purchases_finished['findOne']({'invoice':_0x1fa787});_0x51c4af[_0x27fdc6(0x19e)]='True';const _0x3bacdd=await _0x51c4af[_0x27fdc6(0x1bb)](),_0x5dfe45=new s_payment_data({'invoice':_0x1fa787,'suppliers':_0x1b87d9['body'][_0x27fdc6(0x238)],'reason':_0x27fdc6(0x1e2)});await _0x5dfe45[_0x27fdc6(0x1bb)]();const _0x432729=await master_shop[_0x27fdc6(0x1c2)](),_0x6a60e9=await email_settings['findOne'](),_0x598b8d=await suppliers[_0x27fdc6(0x1fe)]({'name':_0x1b87d9[_0x27fdc6(0x182)]['suppliers']});_0x432729[0x0]['currency_placement']==0x1?(right_currency=_0x432729[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x432729[0x0][_0x27fdc6(0x21e)]);var _0x53a975=_0x2d8b33,_0x2ac806=_0x33fa62,_0x259f06='',_0x3e95db;for(_0x3e95db in _0x53a975){_0x259f06+=_0x27fdc6(0x1c7)+_0x27fdc6(0x224)+_0x53a975[_0x3e95db]+_0x27fdc6(0x1fc)+_0x27fdc6(0x224)+_0x2ac806[_0x3e95db]+'</td>'+_0x27fdc6(0x190);}let _0x4ccccb=nodemailer[_0x27fdc6(0x1e3)]({'service':_0x27fdc6(0x1b1),'auth':{'user':_0x6a60e9['email'],'pass':_0x6a60e9[_0x27fdc6(0x144)]}}),_0xc8b664={'from':_0x6a60e9[_0x27fdc6(0x20c)],'to':_0x598b8d['email'],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+_0x27fdc6(0x15a)+_0x27fdc6(0x1da)+_0x432729[0x0][_0x27fdc6(0x179)],'cid':_0x27fdc6(0x22a)}],'html':'<!DOCTYPE\x20html>'+_0x27fdc6(0x172)+_0x27fdc6(0x186)+_0x27fdc6(0x227)+_0x27fdc6(0x22f)+_0x27fdc6(0x227)+_0x27fdc6(0x151)+_0x27fdc6(0x1d6)+_0x27fdc6(0x227)+_0x27fdc6(0x1c8)+_0x432729[0x0][_0x27fdc6(0x20e)]+'\x20</h2>'+_0x27fdc6(0x1d6)+_0x27fdc6(0x1d6)+'<hr\x20class=\x22my-3\x22>'+'<div>'+_0x27fdc6(0x1f1)+_0x27fdc6(0x153)+_0x1fa787+'\x20'+_0x27fdc6(0x1d4)+_0x27fdc6(0x142)+_0x465bbd+'\x20'+'</span>'+_0x27fdc6(0x211)+'</div>'+_0x27fdc6(0x209)+_0x27fdc6(0x1af)+_0x27fdc6(0x1c7)+_0x27fdc6(0x16f)+_0x27fdc6(0x1f5)+_0x27fdc6(0x1b7)+_0x27fdc6(0x20d)+_0x27fdc6(0x190)+_0x27fdc6(0x1cd)+_0x27fdc6(0x1c6)+'\x20'+_0x259f06+'\x20'+'</tbody>'+'</table>'+_0x27fdc6(0x227)+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x432729[0x0][_0x27fdc6(0x20e)]+'</h5>'+'</div>'+_0x27fdc6(0x1d6)+_0x27fdc6(0x1f0)};_0x4ccccb[_0x27fdc6(0x16c)](_0xc8b664,function(_0x5489a9,_0x5237ee){var _0x8236ad=_0x27fdc6;_0x5489a9?console[_0x8236ad(0x205)](_0x8236ad(0x184)):console[_0x8236ad(0x205)](_0x8236ad(0x177));}),_0x1b87d9[_0x27fdc6(0x1e6)](_0x27fdc6(0x1cf),'purchases\x20item\x20return\x20successfull'),_0x2aa49c[_0x27fdc6(0x18c)](_0x27fdc6(0x148));}catch(_0x1e1c0b){_0x2aa49c['status'](0xc8)['json']({'message':_0x1e1c0b[_0x27fdc6(0x1aa)]});}}),router['get'](a0_0x363552(0x152),auth,async(_0x367bb9,_0x335c42)=>{var _0x52f35f=a0_0x363552;try{const {username:_0x181b66,email:_0x4310cd,role:_0xaf9e7e}=_0x367bb9['user'],_0x5b7d96=_0x367bb9['user'],_0x8be5f0=await profile[_0x52f35f(0x1fe)]({'email':_0x5b7d96[_0x52f35f(0x20c)]}),_0x37fe65=await master_shop[_0x52f35f(0x1c2)](),_0xd8d6a1=_0x367bb9[_0x52f35f(0x1e7)]['id'],_0x56ce22=await purchases_finished[_0x52f35f(0x1f7)](_0xd8d6a1);if(_0x37fe65[0x0][_0x52f35f(0x20f)]==_0x52f35f(0x169))var _0xf7316d=users[_0x52f35f(0x176)];else{if(_0x37fe65[0x0][_0x52f35f(0x20f)]=='Hindi')var _0xf7316d=users[_0x52f35f(0x193)];else{if(_0x37fe65[0x0][_0x52f35f(0x20f)]==_0x52f35f(0x1eb))var _0xf7316d=users[_0x52f35f(0x1eb)];else{if(_0x37fe65[0x0][_0x52f35f(0x20f)]==_0x52f35f(0x1f6))var _0xf7316d=users[_0x52f35f(0x1f6)];else{if(_0x37fe65[0x0]['language']==_0x52f35f(0x215))var _0xf7316d=users[_0x52f35f(0x215)];else{if(_0x37fe65[0x0][_0x52f35f(0x20f)]==_0x52f35f(0x1ec))var _0xf7316d=users[_0x52f35f(0x23c)];else{if(_0x37fe65[0x0][_0x52f35f(0x20f)]=='Chinese')var _0xf7316d=users[_0x52f35f(0x166)];else{if(_0x37fe65[0x0][_0x52f35f(0x20f)]==_0x52f35f(0x231))var _0xf7316d=users['Arabic'];}}}}}}}_0x335c42[_0x52f35f(0x237)](_0x52f35f(0x14f),{'success':_0x367bb9['flash'](_0x52f35f(0x1cf)),'errors':_0x367bb9[_0x52f35f(0x1e6)](_0x52f35f(0x21d)),'role':_0x5b7d96,'profile':_0x8be5f0,'alldata':_0x56ce22,'master_shop':_0x37fe65,'language':_0xf7316d});}catch(_0x5230fd){console[_0x52f35f(0x205)](_0x5230fd);}}),router[a0_0x363552(0x1a7)](a0_0x363552(0x16d),async(_0x372eb8,_0x2c2c73)=>{var _0x292d1f=a0_0x363552;const {product_code:_0x23eb39}=_0x372eb8[_0x292d1f(0x182)];var _0x47387f;const _0x25918b=await product[_0x292d1f(0x178)]([{'$match':{'primary_code':_0x23eb39}},{'$group':{'_id':_0x292d1f(0x1e4),'name':{'$first':_0x292d1f(0x1bc)},'category':{'$first':_0x292d1f(0x1c1)},'brand':{'$first':_0x292d1f(0x19a)},'unit':{'$first':_0x292d1f(0x23e)},'alertquantity':{'$first':_0x292d1f(0x14c)},'product_code':{'$first':_0x292d1f(0x15b)},'primary_code':{'$first':_0x292d1f(0x1d5)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x292d1f(0x1c5)},'maxProdPerUnit':{'$first':_0x292d1f(0x1cb)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x292d1f(0x159)},'maxProducts':{'$first':_0x292d1f(0x225)},'CBM':{'$first':{'$toDouble':_0x292d1f(0x22d)}}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'CBM':0x1}}]),_0x362ef8=await product['aggregate']([{'$match':{'secondary_code':_0x23eb39}},{'$group':{'_id':'$_id','name':{'$first':_0x292d1f(0x1bc)},'category':{'$first':'$category'},'brand':{'$first':'$brand'},'unit':{'$first':'$unit'},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x292d1f(0x15b)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x292d1f(0x1e5)},'maxStocks':{'$first':_0x292d1f(0x1c5)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x292d1f(0x159)},'CBM':{'$first':{'$toDouble':_0x292d1f(0x22d)}}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1,'CBM':0x1}}]);if(_0x25918b['length']>0x0)_0x47387f=_0x25918b;else _0x362ef8[_0x292d1f(0x17d)]>0x0&&(_0x47387f=_0x362ef8);_0x2c2c73[_0x292d1f(0x1a4)](_0x47387f);}),router['post'](a0_0x363552(0x170),async(_0x3fbd13,_0x3dd239)=>{var _0x4e225e=a0_0x363552;const {productCode:_0x14b7f1,bay:_0x4cb4c6,warehouses:_0x2b391f,room:_0x153014}=_0x3fbd13[_0x4e225e(0x182)];console[_0x4e225e(0x205)](_0x3fbd13[_0x4e225e(0x182)]);try{const _0x2eae27=await warehouse[_0x4e225e(0x178)]([{'$match':{'name':_0x2b391f,'room':_0x153014}},{'$unwind':'$product_details'},{'$match':{'product_details.pallet':parseInt(_0x4cb4c6)}},{'$group':{'_id':'$product_details.product_name','name':{'$first':_0x4e225e(0x14b)},'product_stock':{'$sum':_0x4e225e(0x17f)},'pallet':{'$first':'$product_details.pallet'},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);console[_0x4e225e(0x205)]('data',_0x2eae27),_0x3dd239[_0x4e225e(0x1a0)](0xc8)[_0x4e225e(0x1a4)](_0x2eae27);}catch(_0x215821){_0x3dd239[_0x4e225e(0x1a0)](0x194)[_0x4e225e(0x1a4)]({'message':_0x215821['message']});}}),module['exports']=router;