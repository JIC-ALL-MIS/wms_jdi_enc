var a0_0x569643=a0_0xd264;(function(_0x7a685d,_0x2e139e){var _0x1ebc93=a0_0xd264,_0x425ff4=_0x7a685d();while(!![]){try{var _0x539134=parseInt(_0x1ebc93(0x217))/0x1+-parseInt(_0x1ebc93(0x22e))/0x2*(-parseInt(_0x1ebc93(0x1b8))/0x3)+-parseInt(_0x1ebc93(0x21a))/0x4+-parseInt(_0x1ebc93(0x27b))/0x5+parseInt(_0x1ebc93(0x1e2))/0x6+parseInt(_0x1ebc93(0x271))/0x7*(-parseInt(_0x1ebc93(0x26b))/0x8)+-parseInt(_0x1ebc93(0x2af))/0x9*(-parseInt(_0x1ebc93(0x25f))/0xa);if(_0x539134===_0x2e139e)break;else _0x425ff4['push'](_0x425ff4['shift']());}catch(_0x2c0bc5){_0x425ff4['push'](_0x425ff4['shift']());}}}(a0_0x1d81,0xbae10));function a0_0xd264(_0x14cb30,_0x518ffc){var _0x1d815f=a0_0x1d81();return a0_0xd264=function(_0xd264e5,_0x10946a){_0xd264e5=_0xd264e5-0x1af;var _0x46c908=_0x1d815f[_0xd264e5];return _0x46c908;},a0_0xd264(_0x14cb30,_0x518ffc);}function a0_0x1d81(){var _0x2e3c9f=['rak','$product.bay','$_id','$primary_code','exports','email','toString','amount','$batch_code','prod_isle','prod_code','</head><body>','Sales\x20Update\x20successfully','length','purchases\x20item\x20return\x20successfull','all_purchases','get','Shelves','Rack\x20B','max_product_unit','error','<table\x20style=\x22width:\x20100%\x20!important;\x22>','<tr>','$name','map','bin','log','product_stock','expiry_date','secondary_code_hide','getMonth','/all_purchases/view','Enabled','/barcode_scanner','then','\x20<>\x20','secondary_unit','delivery_date','params','room','all_purchases_barcode','$unit','Arabic\x20(ae)','prod_secondunit','redirect','push','</tbody>','Portuguese\x20(BR)','9ZBHsMN','Rack\x20E','../public/language/languages.json','note','/view','edit_purchases_view','user','invoice','add\x20post','$product_details.pallet','getFullYear','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','production_date','logo','<hr\x20class=\x22my-3\x22>','find','Rack\x20D','/view/add_purchases','slice','currency_placement','$product.bin','/invoice/:id','Floor','</td>','master','242397OtYeZl','$note','$expiry_date','site_title','$paid_amount','Purchase\x20Return','$product','purchase_invoice','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','</h5>','purchase_quantity','English\x20(US)','$product_code','prod_qty','JO_number','</div>','Chinese','post','return_purchase','$finalize','$product_details.expiry_date','language','$secondary_unit','Level','stocks','currency','$return_data','$product_details','errors','delivery_code','string','gmail','English','Portuguese','stock_quantity','product_list','$maxProdPerUnit','$product.floorlevel','staff','storage','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$category','2590452EcSjBT','$product.quantity','quantity','nodemailer','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','$product_details.product_name','Purchase\x20Return\x20Mail','$room','Raw\x20Materials','</body></html>','</span>','../middleware/auth','Spanish','Receiving\x20Area','$date','German','findById','<strong>\x20Regards\x20</strong>','COLD\x20STORAGE','level','Rack\x20F','render','$product_details.product_stock','$brand','$suppliers','return_data','suppliers','return_qty','/preview/:id','$product.room_name','An\x20error\x20occurred.','body','\x20<\x20wew\x20>\x20','role','$product_details.bin','INC-','$product_details.maxProducts','all','Enclosed','\x20</h2>','table\x20page','Rack\x20A','image','alertQTY','status','</tr>','Email\x20sent\x20successfully','$product_details.secondary_code','payment\x20successfull','French','prod_primunit','room_name','edit_purchases','527746UQjaAs','product_code_hide','filter','1238584BAtYbu','$suppliers_docs','$product_details.rack','<h5\x20style=\x22text-align:\x20left;\x22>','finalize','suppliers_docs','foreach\x20newproduct','product','POnumber','flash','Error\x20Occurs','$warehouse_name','<div>','primary_code','user_id','save','<html><head><title></title>','Purchase\x20data\x20added\x20successfully','/upload/','prod_unit','34zCfBsW','rack','Ambient','<!DOCTYPE\x20html>','name','floorlevel','prod_cat','/view/add_purchases/:id','$product_details._id','batch_code','<span\x20style=\x22float:\x20right;\x22>','Paid\x20For\x20Purchase','message','$product_details.type','Hindi','bay','Return\x20Goods','$product_details.bay','prod_pallet','Arabic','<tbody\x20style=\x22text-align:\x20center;\x22>','$product.type','product_details','$product_details.level','\x20Order\x20Number\x20:\x20','isle','success','Room_name','product_name','findOne','$product_details.product_code','RoomAssign','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','product_cat','return_product','product_code','/../public','maxperunit','due_amount','warehouse','primary_code_hide','aggregate','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','DRY\x20STORAGE','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.floorlevel','types','secondary_code','createTransport','7329710CjcrMy','date','maxStocks','prod_level','Router','concat','/CheckingWarehouse','$invoice','path','pallet','warehouse_name','<h5>','574064vrjFNA','Rack\x20C','MaxStocks_data','$product_details.isle','paid_amount','$alertquantity','77xsETGE','$due_amount','Logo.png','/view/:id','type','\x20Order\x20Date\x20:\x20','json','$maxStocks','standard_unit','/view/return_purchase/:id','6008010ErLeuW','add_purchases','forEach','prod_name'];a0_0x1d81=function(){return _0x2e3c9f;};return a0_0x1d81();}const express=require('express'),app=express(),router=express[a0_0x569643(0x263)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings}=require('../models/all_models'),auth=require(a0_0x569643(0x1ed)),nodemailer=require(a0_0x569643(0x1e5));var ejs=require('ejs');const path=require(a0_0x569643(0x267)),users=require(a0_0x569643(0x2b1));router[a0_0x569643(0x28f)](a0_0x569643(0x2b3),auth,async(_0x36cd7e,_0x3cb440)=>{var _0x345708=a0_0x569643;try{const {username:_0x22719b,email:_0x8f894a,role:_0x34940a}=_0x36cd7e[_0x345708(0x2b5)],_0x3b88ba=_0x36cd7e[_0x345708(0x2b5)],_0x17f7a0=await profile[_0x345708(0x24b)]({'email':_0x3b88ba[_0x345708(0x284)]}),_0x17f038=await staff[_0x345708(0x24b)]({'email':_0x3b88ba[_0x345708(0x284)]});if(_0x3b88ba[_0x345708(0x203)]==_0x345708(0x1de)){const _0x512c91=await staff['findOne']({'email':_0x3b88ba['email']});}const _0x49eeb4=await master_shop[_0x345708(0x2be)]();let _0x1ab309;if(_0x3b88ba['role']=='staff'){const _0x368513=await staff['findOne']({'email':_0x3b88ba[_0x345708(0x284)]});_0x1ab309=await purchases[_0x345708(0x257)]([{'$match':{'warehouse_name':_0x368513[_0x345708(0x255)]}},{'$lookup':{'from':'suppliers','localField':_0x345708(0x1fc),'foreignField':'name','as':_0x345708(0x21f)}},{'$unwind':_0x345708(0x21b)},{'$unwind':'$product'},{'$group':{'_id':_0x345708(0x281),'invoice':{'$first':_0x345708(0x266)},'suppliers':{'$first':_0x345708(0x1fa)},'date':{'$first':_0x345708(0x1f0)},'warehouse_name':{'$first':_0x345708(0x225)},'room':{'$first':_0x345708(0x1e9)},'product':{'$push':_0x345708(0x1be)},'note':{'$first':_0x345708(0x1b9)},'paid_amount':{'$first':_0x345708(0x1bc)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x345708(0x287)},'expiry_date':{'$first':_0x345708(0x1ba)},'suppliers_docs':{'$first':_0x345708(0x21b)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x345708(0x280)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x345708(0x1dd)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x1ab309=await purchases[_0x345708(0x257)]([{'$lookup':{'from':'suppliers','localField':'suppliers','foreignField':_0x345708(0x232),'as':_0x345708(0x21f)}},{'$unwind':'$suppliers_docs'},{'$unwind':_0x345708(0x1be)},{'$group':{'_id':_0x345708(0x281),'invoice':{'$first':_0x345708(0x266)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x345708(0x1f0)},'warehouse_name':{'$first':_0x345708(0x225)},'room':{'$addToSet':_0x345708(0x1ff)},'product':{'$push':_0x345708(0x1be)},'note':{'$first':_0x345708(0x1b9)},'paid_amount':{'$first':_0x345708(0x1bc)},'due_amount':{'$first':_0x345708(0x272)},'return_data':{'$first':_0x345708(0x1d2)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x345708(0x1ba)},'suppliers_docs':{'$first':_0x345708(0x21b)},'total_product_quantity':{'$sum':_0x345708(0x1e3)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x345708(0x1b3)},'type':{'$addToSet':_0x345708(0x243)},'floorlevel':{'$addToSet':_0x345708(0x1dd)},'finalize':{'$first':_0x345708(0x1cb)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x49eeb4[0x0][_0x345708(0x1cd)]=='English\x20(US)'){var _0x13b205=users[_0x345708(0x1d8)];console[_0x345708(0x299)](_0x13b205);}else{if(_0x49eeb4[0x0][_0x345708(0x1cd)]==_0x345708(0x23c))var _0x13b205=users[_0x345708(0x23c)];else{if(_0x49eeb4[0x0][_0x345708(0x1cd)]==_0x345708(0x1f1))var _0x13b205=users['German'];else{if(_0x49eeb4[0x0]['language']=='Spanish')var _0x13b205=users[_0x345708(0x1ee)];else{if(_0x49eeb4[0x0]['language']==_0x345708(0x213))var _0x13b205=users[_0x345708(0x213)];else{if(_0x49eeb4[0x0]['language']=='Portuguese\x20(BR)')var _0x13b205=users[_0x345708(0x1d9)];else{if(_0x49eeb4[0x0][_0x345708(0x1cd)]==_0x345708(0x1c8))var _0x13b205=users[_0x345708(0x1c8)];else{if(_0x49eeb4[0x0][_0x345708(0x1cd)]==_0x345708(0x2a9))var _0x13b205=users[_0x345708(0x241)];}}}}}}}_0x3cb440[_0x345708(0x1f7)](_0x345708(0x28e),{'success':_0x36cd7e[_0x345708(0x223)](_0x345708(0x248)),'errors':_0x36cd7e[_0x345708(0x223)]('errors'),'purchases':_0x1ab309,'role':_0x3b88ba,'profile':_0x17f7a0,'master_shop':_0x49eeb4,'language':_0x13b205});}catch(_0x6bcc7e){console[_0x345708(0x299)](_0x345708(0x20a),_0x6bcc7e),_0x3cb440['status'](0xc8)[_0x345708(0x277)]({'message':_0x6bcc7e['message']});}});function BayBinSelected(_0x4c5d5e,_0xa60067){var _0x2620a7=a0_0x569643,_0x5711ba=[],_0x320ac0=[],_0xdfb34f=[],_0x238d4c=[],_0xf8af5a=[],_0x32ac73=[];let _0x52c8c9=[];if(_0x4c5d5e==_0x2620a7(0x259))switch(_0xa60067){case'Rack\x20A':_0x5711ba=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x320ac0=[0x1,0x2],_0x238d4c=[0x1,0x2,0x3,0x4,0x5],_0xdfb34f=['Level',_0x2620a7(0x1b5)],_0xf8af5a=['D'],_0x32ac73=['A'];break;case _0x2620a7(0x291):_0x5711ba=[0x6,0x5,0x4,0x3,0x2,0x1],_0x320ac0=[0x1,0x2],_0x238d4c=[0x1,0x2,0x3,0x4,0x5],_0xdfb34f=['Level',_0x2620a7(0x1b5)],_0xf8af5a=['D'],_0x32ac73=['B'];break;case _0x2620a7(0x290):_0x5711ba=[0x0],_0x320ac0=[0x0],_0x238d4c=[0x1,0x2,0x3,0x4,0x5],_0xdfb34f=['Floor'],_0xf8af5a=['D'],_0x32ac73=['S'];break;case _0x2620a7(0x1ef):_0x5711ba=[0x0],_0x320ac0=[0x0],_0x238d4c=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0xdfb34f=['Floor'],_0xf8af5a=['D'],_0x32ac73=['R'];break;}else{if(_0x4c5d5e==_0x2620a7(0x1f4))switch(_0xa60067){case _0x2620a7(0x20b):_0x5711ba=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x320ac0=['B','F'],_0x238d4c=[0x1,0x2,0x3,0x4,0x5],_0xdfb34f=[_0x2620a7(0x1cf),_0x2620a7(0x1b5)],_0xf8af5a=['C'],_0x32ac73=['A'];break;case _0x2620a7(0x291):_0x5711ba=[0x5,0x4,0x3,0x2,0x1],_0x320ac0=['F','B','S'],_0x238d4c=[0x1,0x2,0x3,0x4,0x5],_0xdfb34f=[_0x2620a7(0x1cf),_0x2620a7(0x1b5)],_0xf8af5a=['C'],_0x32ac73=['B'];break;case _0x2620a7(0x26c):_0x5711ba=[0x1,0x2,0x3,0x4,0x5],_0x320ac0=['B','F','S'],_0x238d4c=[0x5,0x4,0x3,0x2,0x1],_0xdfb34f=[_0x2620a7(0x1cf),_0x2620a7(0x1b5)],_0xf8af5a=['C'],_0x32ac73=['C'];break;case _0x2620a7(0x1af):_0x5711ba=[0x5,0x4,0x3,0x2,0x1],_0x320ac0=['F','B','S'],_0x238d4c=[0x1,0x2,0x3,0x4,0x5],_0xdfb34f=['Level',_0x2620a7(0x1b5)],_0xf8af5a=['C'],_0x32ac73=['D'];break;case _0x2620a7(0x2b0):_0x5711ba=[0x4,0x3,0x2,0x1],_0x320ac0=[0x1,0x2],_0x238d4c=[0x1,0x2,0x3,0x4,0x5],_0xdfb34f=[_0x2620a7(0x1cf),_0x2620a7(0x1b5)],_0xf8af5a=['C'],_0x32ac73=['E'];break;case _0x2620a7(0x1f6):_0x5711ba=[0x1,0x2,0x3],_0x320ac0=[0x1,0x2],_0x238d4c=[0x1,0x2,0x3,0x4,0x5],_0xdfb34f=[_0x2620a7(0x1cf)],_0xf8af5a=['C'],_0x32ac73=['F'];break;}}return{'levels':_0x5711ba,'Isle':_0x320ac0,'rack':_0x238d4c,'type':_0xdfb34f,'storage':_0xf8af5a,'rak':_0x32ac73};}router[a0_0x569643(0x28f)](a0_0x569643(0x1b0),auth,async(_0x4893de,_0x25d56a)=>{var _0x3737f1=a0_0x569643;try{const {username:_0x35e532,email:_0x37f0af,role:_0xe098af}=_0x4893de[_0x3737f1(0x2b5)],_0x12a7a9=_0x4893de[_0x3737f1(0x2b5)],_0x1d899f=await profile['findOne']({'email':_0x12a7a9[_0x3737f1(0x284)]}),_0x3344d8=await master_shop[_0x3737f1(0x2be)](),_0x2d54bb=await staff[_0x3737f1(0x24b)]({'email':_0x12a7a9[_0x3737f1(0x284)]}),_0xc4bf8f=await suppliers[_0x3737f1(0x2be)]({});let _0x266d59;if(_0x12a7a9[_0x3737f1(0x203)]==_0x3737f1(0x1de)){const _0x3df564=await staff[_0x3737f1(0x24b)]({'email':_0x12a7a9[_0x3737f1(0x284)]});_0x266d59=await warehouse['aggregate']([{'$match':{'status':_0x3737f1(0x29f),'name':_0x3df564[_0x3737f1(0x255)],'warehouse_category':'Raw\x20Materials','name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x3737f1(0x296),'name':{'$first':_0x3737f1(0x296)}}}]);}else _0x266d59=await warehouse[_0x3737f1(0x257)]([{'$match':{'status':'Enabled','warehouse_category':'Raw\x20Materials','name':{'$ne':_0x3737f1(0x23e)}}},{'$group':{'_id':_0x3737f1(0x296),'name':{'$first':_0x3737f1(0x296)}}}]);const _0x29bfc3=await product['find']({}),_0x349d7b=await warehouse['find']({'status':_0x3737f1(0x29f)}),_0x48dd98=await purchases['find']({}),_0x11d505=_0x48dd98['length']+0x1,_0x53e46b=_0x3737f1(0x205)+_0x11d505[_0x3737f1(0x285)]()['padStart'](0x5,'0');var _0x27b4b2=[_0x3737f1(0x230),_0x3737f1(0x208)];if(_0x3344d8[0x0][_0x3737f1(0x1cd)]==_0x3737f1(0x1c3)){var _0x19d130=users['English'];console[_0x3737f1(0x299)](_0x19d130);}else{if(_0x3344d8[0x0][_0x3737f1(0x1cd)]==_0x3737f1(0x23c))var _0x19d130=users[_0x3737f1(0x23c)];else{if(_0x3344d8[0x0][_0x3737f1(0x1cd)]=='German')var _0x19d130=users[_0x3737f1(0x1f1)];else{if(_0x3344d8[0x0][_0x3737f1(0x1cd)]==_0x3737f1(0x1ee))var _0x19d130=users[_0x3737f1(0x1ee)];else{if(_0x3344d8[0x0][_0x3737f1(0x1cd)]==_0x3737f1(0x213))var _0x19d130=users['French'];else{if(_0x3344d8[0x0][_0x3737f1(0x1cd)]=='Portuguese\x20(BR)')var _0x19d130=users[_0x3737f1(0x1d9)];else{if(_0x3344d8[0x0]['language']==_0x3737f1(0x1c8))var _0x19d130=users['Chinese'];else{if(_0x3344d8[0x0]['language']=='Arabic\x20(ae)')var _0x19d130=users[_0x3737f1(0x241)];}}}}}}}_0x25d56a[_0x3737f1(0x1f7)](_0x3737f1(0x27c),{'success':_0x4893de[_0x3737f1(0x223)]('success'),'errors':_0x4893de['flash'](_0x3737f1(0x1d4)),'role':_0x12a7a9,'profile':_0x1d899f,'suppliers':_0xc4bf8f,'warehouse':_0x266d59,'product':_0x29bfc3,'invoice':_0x53e46b,'master_shop':_0x3344d8,'language':_0x19d130,'find_data':_0x349d7b,'rooms_data':_0x27b4b2});}catch(_0x5f0b97){console['log'](_0x5f0b97);}}),router['get'](a0_0x569643(0x235),auth,async(_0x370ae6,_0x3abbbe)=>{var _0x5e9dd5=a0_0x569643;try{const _0x91ecc4=_0x370ae6[_0x5e9dd5(0x2a5)]['id'];console[_0x5e9dd5(0x299)](_0x91ecc4);const _0x9909e4=await master_shop[_0x5e9dd5(0x2be)]();console[_0x5e9dd5(0x299)](_0x5e9dd5(0x1b7),_0x9909e4);const _0x1db177=await product[_0x5e9dd5(0x24b)]({'name':_0x91ecc4});console[_0x5e9dd5(0x299)](_0x5e9dd5(0x221),_0x1db177),_0x3abbbe[_0x5e9dd5(0x20e)](0xc8)[_0x5e9dd5(0x277)]({'product_data':_0x1db177,'master':_0x9909e4});}catch(_0x8416){console[_0x5e9dd5(0x299)]('add_purchases\x20error',_0x8416);}}),router[a0_0x569643(0x1c9)](a0_0x569643(0x1b0),auth,async(_0x5ddf8e,_0x45cfa6)=>{var _0x43ce43=a0_0x569643;try{const {invoice:_0x34fe9b,date:_0x320c23,warehouse_name:_0x3f8bf7,prod_name:_0x234b72,prod_code:_0x26175c,prod_qty:_0x7aa356,prod_unit:_0x3405ea,prod_secondunit:_0x1dfd94,prod_level:_0x10eecd,prod_isle:_0x5d729a,prod_pallet:_0x487014,note:_0x1c11db,expiry_date:_0x4116cd,batch_code:_0x43acdd,payable:_0x104141,due_amount:_0x369628,Room_name:_0x2a9cde,primary_code:_0x2a3669,secondary_code:_0xc82299,MaxStocks_data:_0x4e5fab,PO_number:_0x5dbf35,SCRN:_0x491b59,JO_number:_0x5ea542}=_0x5ddf8e[_0x43ce43(0x201)];if(typeof _0x234b72=='string')var _0x34bf7b=[_0x5ddf8e[_0x43ce43(0x201)][_0x43ce43(0x27e)]],_0x3423ad=[_0x5ddf8e['body'][_0x43ce43(0x289)]],_0x49a17c=[_0x5ddf8e[_0x43ce43(0x201)]['prod_Qty']],_0x2923d0=[_0x5ddf8e[_0x43ce43(0x201)][_0x43ce43(0x214)]],_0x1b3a00=[_0x5ddf8e[_0x43ce43(0x201)]['prod_secondunit']],_0x43e9dc=[_0x5ddf8e[_0x43ce43(0x201)][_0x43ce43(0x262)]],_0x702266=[_0x5ddf8e[_0x43ce43(0x201)]['primary_code']],_0x20a1c1=[_0x5ddf8e['body'][_0x43ce43(0x25d)]],_0x2a58db=[_0x5ddf8e[_0x43ce43(0x201)]['MaxStocks_data']],_0x5e706d=[_0x5ddf8e[_0x43ce43(0x201)][_0x43ce43(0x237)]],_0xa391bc=[_0x5ddf8e[_0x43ce43(0x201)][_0x43ce43(0x29b)]],_0x238131=[_0x5ddf8e[_0x43ce43(0x201)][_0x43ce43(0x292)]],_0x2685a3=[_0x5ddf8e[_0x43ce43(0x201)]['alertQTY']],_0x635ff3=[_0x5ddf8e[_0x43ce43(0x201)][_0x43ce43(0x2bb)]],_0x35fcaf=[_0x5ddf8e['body']['prod_cat']],_0x340d6b=[_0x5ddf8e[_0x43ce43(0x201)][_0x43ce43(0x24d)]];else var _0x34bf7b=[..._0x5ddf8e[_0x43ce43(0x201)]['prod_name']],_0x3423ad=[..._0x5ddf8e['body'][_0x43ce43(0x289)]],_0x49a17c=[..._0x5ddf8e[_0x43ce43(0x201)]['prod_Qty']],_0x2923d0=[..._0x5ddf8e[_0x43ce43(0x201)][_0x43ce43(0x214)]],_0x1b3a00=[..._0x5ddf8e[_0x43ce43(0x201)][_0x43ce43(0x2aa)]],_0x43e9dc=[..._0x5ddf8e['body'][_0x43ce43(0x262)]],_0x702266=[..._0x5ddf8e[_0x43ce43(0x201)]['primary_code']],_0x20a1c1=[..._0x5ddf8e['body'][_0x43ce43(0x25d)]],_0x2a58db=[..._0x5ddf8e[_0x43ce43(0x201)][_0x43ce43(0x26d)]],_0x5e706d=[..._0x5ddf8e[_0x43ce43(0x201)][_0x43ce43(0x237)]],_0xa391bc=[..._0x5ddf8e[_0x43ce43(0x201)][_0x43ce43(0x29b)]],_0x238131=[..._0x5ddf8e[_0x43ce43(0x201)]['max_product_unit']],_0x2685a3=[..._0x5ddf8e[_0x43ce43(0x201)]['alertQTY']],_0x635ff3=[..._0x5ddf8e[_0x43ce43(0x201)][_0x43ce43(0x2bb)]],_0x35fcaf=[..._0x5ddf8e[_0x43ce43(0x201)][_0x43ce43(0x234)]],_0x340d6b=[..._0x5ddf8e[_0x43ce43(0x201)][_0x43ce43(0x24d)]];const _0x554837=_0x34bf7b['map'](_0x30f4e1=>{return _0x30f4e1={'product_name':_0x30f4e1};});_0x3423ad[_0x43ce43(0x27d)]((_0x560b08,_0x5beeaf)=>{var _0xc91574=_0x43ce43;_0x554837[_0x5beeaf][_0xc91574(0x251)]=_0x560b08;}),_0x49a17c[_0x43ce43(0x27d)]((_0x394327,_0x30664b)=>{var _0x323bbb=_0x43ce43;_0x554837[_0x30664b][_0x323bbb(0x1e4)]=_0x394327;}),_0x2923d0[_0x43ce43(0x27d)]((_0x5dfbc8,_0x4ff414)=>{var _0xcac227=_0x43ce43;_0x554837[_0x4ff414][_0xcac227(0x279)]=_0x5dfbc8;}),_0x1b3a00[_0x43ce43(0x27d)]((_0x742f5f,_0x4c89db)=>{var _0x4ca7cc=_0x43ce43;_0x554837[_0x4c89db][_0x4ca7cc(0x2a3)]=_0x742f5f;}),_0x43e9dc['forEach']((_0x2f9a93,_0x599681)=>{var _0x39d1a2=_0x43ce43;_0x340d6b[_0x39d1a2(0x27d)]((_0x4a8222,_0x3cd83f)=>{var _0x1f98a1=_0x39d1a2;if(_0x4a8222==_0x1f98a1(0x1ef)&&_0x599681==_0x3cd83f){console[_0x1f98a1(0x299)](_0x4a8222+_0x1f98a1(0x202)+_0x599681+_0x1f98a1(0x2a2)+_0x3cd83f+'\x20<>\x20'+_0x2f9a93);var _0x503610=_0x2f9a93[_0x1f98a1(0x1b1)](0x3);_0x554837[_0x599681][_0x1f98a1(0x1df)]=_0x2f9a93[0x0],_0x554837[_0x599681][_0x1f98a1(0x22f)]=_0x2f9a93[0x1],_0x554837[_0x599681][_0x1f98a1(0x23d)]=0x0,_0x554837[_0x599681][_0x1f98a1(0x298)]=0x0,_0x554837[_0x599681][_0x1f98a1(0x275)]=_0x1f98a1(0x1b5),_0x554837[_0x599681][_0x1f98a1(0x233)]=_0x503610;}else{if(_0x4a8222=='Shelves'&&_0x599681==_0x3cd83f){var _0x503610=_0x2f9a93[_0x1f98a1(0x1b1)](0x3);_0x554837[_0x599681][_0x1f98a1(0x1df)]=_0x2f9a93[0x0],_0x554837[_0x599681][_0x1f98a1(0x22f)]=_0x2f9a93[0x1],_0x554837[_0x599681]['bay']=0x0,_0x554837[_0x599681][_0x1f98a1(0x298)]=0x0,_0x554837[_0x599681][_0x1f98a1(0x275)]='Floor',_0x554837[_0x599681][_0x1f98a1(0x233)]=_0x2f9a93[0x5];}else{if(_0x599681==_0x3cd83f){var _0x2b95b1;if(_0x2f9a93[0x4]=='L')_0x2b95b1=_0x1f98a1(0x1cf);else _0x2f9a93[0x4]=='F'&&(_0x2b95b1=_0x1f98a1(0x1b5));_0x554837[_0x599681][_0x1f98a1(0x1df)]=_0x2f9a93[0x0],_0x554837[_0x599681][_0x1f98a1(0x22f)]=_0x2f9a93[0x1],_0x554837[_0x599681][_0x1f98a1(0x23d)]=_0x2f9a93[0x2],_0x554837[_0x599681][_0x1f98a1(0x298)]=_0x2f9a93[0x3],_0x554837[_0x599681][_0x1f98a1(0x275)]=_0x2b95b1,_0x554837[_0x599681][_0x1f98a1(0x233)]=_0x2f9a93[0x5];}}}});}),_0x702266[_0x43ce43(0x27d)]((_0x4fe99a,_0x5f52fd)=>{var _0xe3edae=_0x43ce43;_0x554837[_0x5f52fd][_0xe3edae(0x227)]=_0x4fe99a;}),_0x20a1c1['forEach']((_0x373223,_0x3b036c)=>{var _0x3ddfb4=_0x43ce43;_0x554837[_0x3b036c][_0x3ddfb4(0x25d)]=_0x373223;}),_0x2a58db['forEach']((_0x319296,_0x50368e)=>{_0x554837[_0x50368e]['maxStocks']=_0x319296;}),_0x5e706d['forEach']((_0x4c4298,_0x2aabb1)=>{_0x554837[_0x2aabb1]['batch_code']=_0x4c4298;}),_0xa391bc[_0x43ce43(0x27d)]((_0x10ac92,_0x2d1741)=>{var _0x1507fd=_0x43ce43;_0x554837[_0x2d1741][_0x1507fd(0x29b)]=_0x10ac92;}),_0x238131['forEach']((_0x16fa7c,_0x33dc29)=>{var _0x1aefa6=_0x43ce43;_0x554837[_0x33dc29][_0x1aefa6(0x253)]=_0x16fa7c;}),_0x2685a3[_0x43ce43(0x27d)]((_0x11683c,_0x54e9a7)=>{var _0x25acb7=_0x43ce43;_0x554837[_0x54e9a7][_0x25acb7(0x20d)]=_0x11683c;}),_0x635ff3[_0x43ce43(0x27d)]((_0xc5ce3,_0x4687d3)=>{var _0x28369a=_0x43ce43;_0x554837[_0x4687d3][_0x28369a(0x2bb)]=_0xc5ce3;}),_0x35fcaf[_0x43ce43(0x27d)]((_0x10a4ff,_0x1cdb42)=>{var _0xa98fab=_0x43ce43;_0x554837[_0x1cdb42][_0xa98fab(0x24f)]=_0x10a4ff;}),_0x340d6b[_0x43ce43(0x27d)]((_0x524c78,_0x598c09)=>{_0x554837[_0x598c09]['room_name']=_0x524c78;});const _0x58067e=_0x340d6b[_0x43ce43(0x297)](_0xff597d=>{return _0xff597d={'room_name':_0xff597d};}),_0x1e6d93=_0x554837[_0x43ce43(0x219)](_0x4dfb4e=>_0x4dfb4e[_0x43ce43(0x1e4)]!=='0'&&_0x4dfb4e[_0x43ce43(0x1e4)]!==''),_0xa73666=new purchases({'invoice':_0x34fe9b,'suppliers':_0x5ddf8e[_0x43ce43(0x201)][_0x43ce43(0x1fc)],'date':_0x320c23,'warehouse_name':_0x3f8bf7,'product':_0x1e6d93,'note':_0x1c11db,'due_amount':_0x369628,'POnumber':_0x5dbf35,'SCRN':_0x491b59,'JO_number':_0x5ea542,'roomList':_0x58067e}),_0x50cae3=await _0xa73666[_0x43ce43(0x229)](),_0x2e2083=await purchases['findOne']({'invoice':_0x34fe9b}),_0x10ea0c=_0x2e2083[_0x43ce43(0x221)]['map'](async _0xf0082=>{var _0x123c02=_0x43ce43,_0x553374=await warehouse[_0x123c02(0x24b)]({'name':_0x3f8bf7,'room':_0xf0082[_0x123c02(0x215)]}),_0x3fece5=0x0;return _0x553374[_0x123c02(0x244)][_0x123c02(0x27d)](_0x5a896d=>{var _0x1f0a50=_0x123c02;_0x5a896d[_0x1f0a50(0x24a)]==_0xf0082[_0x1f0a50(0x24a)]&&_0x5a896d[_0x1f0a50(0x233)]==_0xf0082['floorlevel']&&_0x5a896d['type']==_0xf0082[_0x1f0a50(0x275)]&&_0x5a896d[_0x1f0a50(0x298)]==_0xf0082['bin']&&_0x5a896d[_0x1f0a50(0x23d)]==_0xf0082[_0x1f0a50(0x23d)]&&_0x5a896d[_0x1f0a50(0x22f)]==_0xf0082[_0x1f0a50(0x22f)]&&_0x5a896d[_0x1f0a50(0x1df)]==_0xf0082[_0x1f0a50(0x1df)]&&_0x5a896d[_0x1f0a50(0x29b)]==_0xf0082['expiry_date']&&_0x5a896d[_0x1f0a50(0x237)]==_0xf0082[_0x1f0a50(0x237)]&&_0x5a896d[_0x1f0a50(0x2bb)]==_0xf0082['production_date']&&(_0x5a896d[_0x1f0a50(0x29a)]+=_0xf0082['quantity'],_0x3fece5++);}),_0x3fece5===0x0&&_0x553374[_0x123c02(0x244)][_0x123c02(0x2ac)]({'product_name':_0xf0082[_0x123c02(0x24a)],'product_stock':_0xf0082[_0x123c02(0x1e4)],'primary_code':_0xf0082[_0x123c02(0x227)],'secondary_code':_0xf0082['secondary_code'],'product_code':_0xf0082[_0x123c02(0x251)],'storage':_0xf0082[_0x123c02(0x1df)],'rack':_0xf0082[_0x123c02(0x22f)],'bay':_0xf0082['bay'],'bin':_0xf0082[_0x123c02(0x298)],'type':_0xf0082[_0x123c02(0x275)],'floorlevel':_0xf0082['floorlevel'],'maxProducts':_0xf0082[_0x123c02(0x261)],'unit':_0xf0082[_0x123c02(0x279)],'secondary_unit':_0xf0082['secondary_unit'],'expiry_date':_0xf0082[_0x123c02(0x29b)],'maxPerUnit':_0xf0082[_0x123c02(0x253)],'batch_code':_0xf0082['batch_code'],'alertQTY':_0xf0082[_0x123c02(0x20d)],'production_date':_0xf0082['production_date'],'product_cat':_0xf0082[_0x123c02(0x24f)]}),_0x553374;});Promise[_0x43ce43(0x207)](_0x10ea0c)[_0x43ce43(0x2a1)](async _0x432f3c=>{var _0x144643=_0x43ce43;try{for(const _0x2ba036 of _0x432f3c){await _0x2ba036[_0x144643(0x229)]();}_0x5ddf8e[_0x144643(0x223)](_0x144643(0x248),_0x144643(0x22b)),_0x45cfa6['redirect']('/all_purchases/view/');}catch(_0x203b15){console[_0x144643(0x293)](_0x203b15),_0x45cfa6[_0x144643(0x20e)](0x1f4)[_0x144643(0x277)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})['catch'](_0x27cd77=>{var _0x57224a=_0x43ce43;console['error'](_0x27cd77),_0x45cfa6[_0x57224a(0x20e)](0x1f4)[_0x57224a(0x277)]({'error':_0x57224a(0x200)});});}catch(_0x46deaa){console[_0x43ce43(0x299)](_0x46deaa);}}),router[a0_0x569643(0x28f)]('/preview/:id',auth,async(_0x7fc6da,_0x3ae19f)=>{var _0x191e1a=a0_0x569643;try{const {username:_0x26c6ad,email:_0x44ef2,role:_0x4f699e}=_0x7fc6da[_0x191e1a(0x2b5)],_0x40a56c=_0x7fc6da['user'],_0x171073=await profile[_0x191e1a(0x24b)]({'email':_0x40a56c[_0x191e1a(0x284)]}),_0x68e841=await master_shop[_0x191e1a(0x2be)](),_0x59ece5=_0x7fc6da['params']['id'],_0x4148c2=await purchases[_0x191e1a(0x1f2)](_0x59ece5),_0x1994c6=await warehouse[_0x191e1a(0x257)]([{'$match':{'name':_0x4148c2[_0x191e1a(0x269)],'room':_0x4148c2[_0x191e1a(0x2a6)]}},{'$unwind':_0x191e1a(0x1d3)},{'$group':{'_id':_0x191e1a(0x236),'name':{'$first':_0x191e1a(0x1e7)},'product_stock':{'$first':_0x191e1a(0x1f8)},'bay':{'$first':_0x191e1a(0x23f)},'bin':{'$first':_0x191e1a(0x204)},'type':{'$first':_0x191e1a(0x23b)},'floorlevel':{'$first':_0x191e1a(0x25b)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x191e1a(0x21c)},'expiry_date':{'$first':_0x191e1a(0x1cc)}}}]),_0x58bd6c=await customer['find']({});let _0x5c7b44;if(_0x40a56c[_0x191e1a(0x203)]==_0x191e1a(0x1de)){const _0x1e9e55=await staff[_0x191e1a(0x24b)]({'email':_0x40a56c[_0x191e1a(0x284)]});_0x5c7b44=await warehouse[_0x191e1a(0x257)]([{'$match':{'status':_0x191e1a(0x29f),'name':_0x1e9e55[_0x191e1a(0x255)]}},{'$group':{'_id':_0x191e1a(0x296),'name':{'$first':_0x191e1a(0x296)}}}]);}else _0x5c7b44=await warehouse[_0x191e1a(0x257)]([{'$match':{'status':_0x191e1a(0x29f)}},{'$group':{'_id':'$name','name':{'$first':_0x191e1a(0x296)}}}]);const _0x516f27=await product[_0x191e1a(0x2be)]({}),_0x20f90a=await suppliers['find']({}),_0x2f0f95=BayBinSelected(_0x4148c2[_0x191e1a(0x269)],_0x4148c2[_0x191e1a(0x2a6)]);if(_0x68e841[0x0][_0x191e1a(0x1cd)]==_0x191e1a(0x1c3)){var _0x714ed3=users['English'];console[_0x191e1a(0x299)](_0x714ed3);}else{if(_0x68e841[0x0]['language']==_0x191e1a(0x23c))var _0x714ed3=users['Hindi'];else{if(_0x68e841[0x0][_0x191e1a(0x1cd)]==_0x191e1a(0x1f1))var _0x714ed3=users[_0x191e1a(0x1f1)];else{if(_0x68e841[0x0][_0x191e1a(0x1cd)]==_0x191e1a(0x1ee))var _0x714ed3=users[_0x191e1a(0x1ee)];else{if(_0x68e841[0x0][_0x191e1a(0x1cd)]==_0x191e1a(0x213))var _0x714ed3=users[_0x191e1a(0x213)];else{if(_0x68e841[0x0]['language']==_0x191e1a(0x2ae))var _0x714ed3=users['Portuguese'];else{if(_0x68e841[0x0][_0x191e1a(0x1cd)]=='Chinese')var _0x714ed3=users[_0x191e1a(0x1c8)];else{if(_0x68e841[0x0][_0x191e1a(0x1cd)]==_0x191e1a(0x2a9))var _0x714ed3=users[_0x191e1a(0x241)];}}}}}}}_0x3ae19f[_0x191e1a(0x1f7)](_0x191e1a(0x2b4),{'success':_0x7fc6da['flash']('success'),'errors':_0x7fc6da[_0x191e1a(0x223)](_0x191e1a(0x1d4)),'role':_0x40a56c,'profile':_0x171073,'customer':_0x58bd6c,'warehouse':_0x5c7b44,'product':_0x1994c6,'user':_0x4148c2,'master_shop':_0x68e841,'unit':_0x516f27,'language':_0x714ed3,'suppliers':_0x20f90a,'dataSelected':_0x2f0f95});}catch(_0x404f74){console['log'](_0x404f74);}}),router[a0_0x569643(0x1c9)](a0_0x569643(0x1fe),auth,async(_0x20c281,_0x32c9e6)=>{var _0x218114=a0_0x569643;try{const _0x593ad2=_0x20c281['params']['id'],{invoice:_0x2b1748,warehouse_name:_0x2fa223,Room_name:_0x425b15}=_0x20c281['body'],_0x5c4e39=await warehouse['findOne']({'name':_0x2fa223,'room':_0x425b15}),_0x4e90e7=await purchases['findOne']({'invoice':_0x2b1748});_0x4e90e7[_0x218114(0x221)][_0x218114(0x27d)](_0x2630b2=>{var _0x537b66=_0x218114,_0x5c9044=0x0;const _0x130cf3=_0x5c4e39['product_details'][_0x537b66(0x297)](_0x5aa31d=>{var _0x204f3a=_0x537b66;_0x5aa31d[_0x204f3a(0x24a)]==_0x2630b2[_0x204f3a(0x24a)]&&_0x5aa31d[_0x204f3a(0x233)]==_0x2630b2[_0x204f3a(0x233)]&&_0x5aa31d[_0x204f3a(0x275)]==_0x2630b2[_0x204f3a(0x275)]&&_0x5aa31d[_0x204f3a(0x298)]==_0x2630b2[_0x204f3a(0x298)]&&_0x5aa31d[_0x204f3a(0x23d)]==_0x2630b2[_0x204f3a(0x23d)]&&_0x5aa31d['rack']==_0x2630b2[_0x204f3a(0x22f)]&&_0x5aa31d[_0x204f3a(0x1df)]==_0x2630b2[_0x204f3a(0x1df)]&&_0x5aa31d[_0x204f3a(0x29b)]==_0x2630b2[_0x204f3a(0x29b)]&&_0x5aa31d[_0x204f3a(0x237)]==_0x2630b2[_0x204f3a(0x237)]&&_0x5aa31d['production_date']==_0x2630b2[_0x204f3a(0x2bb)]&&_0x5aa31d['delivery_date']==_0x2630b2[_0x204f3a(0x2a4)]&&_0x5aa31d[_0x204f3a(0x1d5)]==_0x2630b2['delivery_code']&&(_0x5aa31d['product_stock']=parseInt(_0x5aa31d[_0x204f3a(0x29a)])+parseInt(_0x2630b2[_0x204f3a(0x1e4)]),_0x5c9044++);});_0x5c9044=='0'&&(_0x5c4e39[_0x537b66(0x244)]=_0x5c4e39[_0x537b66(0x244)][_0x537b66(0x264)]({'product_name':_0x2630b2['product_name'],'product_stock':_0x2630b2[_0x537b66(0x1e4)],'primary_code':_0x2630b2[_0x537b66(0x227)],'secondary_code':_0x2630b2['secondary_code'],'product_code':_0x2630b2['product_code'],'storage':_0x2630b2[_0x537b66(0x1df)],'rack':_0x2630b2['rack'],'bay':_0x2630b2[_0x537b66(0x23d)],'bin':_0x2630b2['bin'],'type':_0x2630b2['type'],'floorlevel':_0x2630b2['floorlevel'],'maxProducts':_0x2630b2[_0x537b66(0x261)],'unit':_0x2630b2[_0x537b66(0x279)],'secondary_unit':_0x2630b2[_0x537b66(0x2a3)],'expiry_date':_0x2630b2['expiry_date'],'maxPerUnit':_0x2630b2[_0x537b66(0x253)],'batch_code':_0x2630b2[_0x537b66(0x237)],'alertQTY':_0x2630b2[_0x537b66(0x20d)],'production_date':_0x2630b2[_0x537b66(0x2bb)],'delivery_date':_0x2630b2[_0x537b66(0x2a4)],'delivery_code':_0x2630b2[_0x537b66(0x1d5)]}));}),await _0x5c4e39[_0x218114(0x229)](),_0x4e90e7[_0x218114(0x21e)]='True';const _0x2f4f73=await _0x4e90e7[_0x218114(0x229)]();_0x20c281[_0x218114(0x223)](_0x218114(0x248),_0x218114(0x28b)),_0x32c9e6[_0x218114(0x2ab)](_0x218114(0x29e));}catch(_0x510fba){console[_0x218114(0x299)](_0x510fba);}}),router[a0_0x569643(0x28f)](a0_0x569643(0x274),auth,async(_0x2920a1,_0x413e8c)=>{var _0x390849=a0_0x569643;try{const {username:_0x477193,email:_0x28e5ee,role:_0xed1785}=_0x2920a1['user'],_0x3c8c7d=_0x2920a1[_0x390849(0x2b5)],_0x3e717e=await profile['findOne']({'email':_0x3c8c7d[_0x390849(0x284)]}),_0x613243=await master_shop[_0x390849(0x2be)](),_0x652736=_0x2920a1[_0x390849(0x2a5)]['id'],_0x3dc521=await purchases['findById'](_0x652736),_0x1b731f=await suppliers[_0x390849(0x2be)]({});let _0x4cb2df;if(_0x3c8c7d[_0x390849(0x203)]==_0x390849(0x1de)){const _0x1eecf9=await staff[_0x390849(0x24b)]({'email':_0x3c8c7d[_0x390849(0x284)]});_0x4cb2df=await warehouse[_0x390849(0x2be)]({'status':_0x390849(0x29f),'name':_0x1eecf9['warehouse'],'warehouse_category':_0x390849(0x1ea)});}else _0x4cb2df=await warehouse[_0x390849(0x257)]([{'$match':{'status':'Enabled','warehouse_category':_0x390849(0x1ea)}},{'$group':{'_id':_0x390849(0x296),'name':{'$first':'$name'}}}]);const _0x258f9e=await product[_0x390849(0x2be)]({}),_0x477941=BayBinSelected(_0x3dc521[_0x390849(0x269)],_0x3dc521[_0x390849(0x2a6)]);let _0x5de1df=new Date(_0x3dc521[_0x390849(0x29b)]),_0x554baa=('0'+_0x5de1df['getDate']())[_0x390849(0x1b1)](-0x2),_0x56565b=('0'+(_0x5de1df[_0x390849(0x29d)]()+0x1))[_0x390849(0x1b1)](-0x2),_0x499381=_0x5de1df[_0x390849(0x2b9)](),_0x18b4fa=_0x499381+'-'+_0x56565b+'-'+_0x554baa;if(_0x613243[0x0][_0x390849(0x1cd)]=='English\x20(US)'){var _0x350576=users['English'];console[_0x390849(0x299)](_0x350576);}else{if(_0x613243[0x0][_0x390849(0x1cd)]=='Hindi')var _0x350576=users['Hindi'];else{if(_0x613243[0x0][_0x390849(0x1cd)]=='German')var _0x350576=users[_0x390849(0x1f1)];else{if(_0x613243[0x0][_0x390849(0x1cd)]==_0x390849(0x1ee))var _0x350576=users[_0x390849(0x1ee)];else{if(_0x613243[0x0][_0x390849(0x1cd)]==_0x390849(0x213))var _0x350576=users[_0x390849(0x213)];else{if(_0x613243[0x0][_0x390849(0x1cd)]==_0x390849(0x2ae))var _0x350576=users[_0x390849(0x1d9)];else{if(_0x613243[0x0][_0x390849(0x1cd)]==_0x390849(0x1c8))var _0x350576=users[_0x390849(0x1c8)];else{if(_0x613243[0x0]['language']==_0x390849(0x2a9))var _0x350576=users['Arabic'];}}}}}}}_0x413e8c[_0x390849(0x1f7)](_0x390849(0x216),{'success':_0x2920a1[_0x390849(0x223)](_0x390849(0x248)),'errors':_0x2920a1[_0x390849(0x223)](_0x390849(0x1d4)),'role':_0x3c8c7d,'profile':_0x3e717e,'purchases':_0x3dc521,'suppliers':_0x1b731f,'warehouse':_0x4cb2df,'product':_0x258f9e,'master_shop':_0x613243,'language':_0x350576,'ed_fullDate':_0x18b4fa,'dataSelected':_0x477941});}catch(_0x340554){console[_0x390849(0x299)](_0x340554);}}),router[a0_0x569643(0x1c9)](a0_0x569643(0x274),auth,async(_0x46ba1f,_0x5e646d)=>{var _0x4af4a0=a0_0x569643;try{const _0x2ab866=_0x46ba1f['params']['id'],_0x1ec41a=await purchases['findOne']({'_id':_0x46ba1f['params']['id']}),_0xff0960=await warehouse[_0x4af4a0(0x24b)]({'name':_0x1ec41a[_0x4af4a0(0x269)],'room':_0x1ec41a[_0x4af4a0(0x2a6)]});_0x1ec41a['product']['forEach'](_0x56efc6=>{var _0x44bfe3=_0x4af4a0;const _0x1ee4f2=_0xff0960[_0x44bfe3(0x244)][_0x44bfe3(0x297)](_0x14aa4f=>{var _0x517563=_0x44bfe3;_0x14aa4f[_0x517563(0x24a)]==_0x56efc6[_0x517563(0x24a)]&&_0x14aa4f[_0x517563(0x233)]==_0x56efc6[_0x517563(0x233)]&&_0x14aa4f[_0x517563(0x275)]==_0x56efc6[_0x517563(0x275)]&&_0x14aa4f[_0x517563(0x298)]==_0x56efc6[_0x517563(0x298)]&&_0x14aa4f[_0x517563(0x23d)]==_0x56efc6[_0x517563(0x23d)]&&_0x14aa4f['rack']==_0x56efc6[_0x517563(0x22f)]&&_0x14aa4f['storage']==_0x56efc6[_0x517563(0x1df)]&&(_0x14aa4f[_0x517563(0x29a)]=parseInt(_0x14aa4f[_0x517563(0x29a)])-parseInt(_0x56efc6[_0x517563(0x1e4)]));});}),await _0xff0960[_0x4af4a0(0x229)]();const {invoice:_0x835d53,suppliers:_0x5a0490,date:_0x4d61d6,warehouse_name:_0x1f8cef,prod_name:_0x2edb2b,prod_code:_0x5d139a,prod_qty:_0x1f6cae,prod_unit:_0x4200c5,prod_secondunit:_0x355486,prod_level:_0x106a45,prod_isle:_0x5ba617,prod_pallet:_0x4059a5,note:_0x172f0d,expiry_date:_0x2ab99f,batch_code:_0x206e57,paid_amount:_0x572d62,due_amount:_0x32984a,Room_name:_0x456f8e,primary_code:_0x29f06a,secondary_code:_0x423554,PO_number:_0x4d225b,JO_number:_0x9d254d}=_0x46ba1f[_0x4af4a0(0x201)];if(typeof _0x2edb2b==_0x4af4a0(0x1d6))var _0x1fe184=[_0x46ba1f['body']['prod_name']],_0x1cbcd5=[_0x46ba1f[_0x4af4a0(0x201)][_0x4af4a0(0x289)]],_0x8d66ec=[_0x46ba1f['body']['prod_qty']],_0x1e5b5f=[_0x46ba1f[_0x4af4a0(0x201)][_0x4af4a0(0x22d)]],_0x12e724=[_0x46ba1f[_0x4af4a0(0x201)][_0x4af4a0(0x2aa)]],_0x700400=[_0x46ba1f[_0x4af4a0(0x201)][_0x4af4a0(0x262)]],_0x2f9af7=[_0x46ba1f[_0x4af4a0(0x201)][_0x4af4a0(0x288)]],_0xbf65bd=[_0x46ba1f[_0x4af4a0(0x201)]['prod_pallet']],_0x3929c2=[_0x46ba1f['body']['primary_code']],_0x3f3572=[_0x46ba1f['body'][_0x4af4a0(0x25d)]],_0x50114d=[_0x46ba1f[_0x4af4a0(0x201)]['MaxStocks_data']],_0x52de7d=[_0x46ba1f[_0x4af4a0(0x201)]['batch_code']],_0x416a0a=[_0x46ba1f[_0x4af4a0(0x201)][_0x4af4a0(0x29b)]],_0x38753a=[_0x46ba1f['body'][_0x4af4a0(0x1df)]],_0x4e658b=[_0x46ba1f[_0x4af4a0(0x201)][_0x4af4a0(0x27f)]],_0x3abb9a=[_0x46ba1f[_0x4af4a0(0x201)][_0x4af4a0(0x275)]];else var _0x1fe184=[..._0x46ba1f['body'][_0x4af4a0(0x27e)]],_0x1cbcd5=[..._0x46ba1f[_0x4af4a0(0x201)][_0x4af4a0(0x289)]],_0x8d66ec=[..._0x46ba1f[_0x4af4a0(0x201)][_0x4af4a0(0x1c5)]],_0x1e5b5f=[..._0x46ba1f[_0x4af4a0(0x201)][_0x4af4a0(0x22d)]],_0x12e724=[..._0x46ba1f[_0x4af4a0(0x201)][_0x4af4a0(0x2aa)]],_0x700400=[..._0x46ba1f[_0x4af4a0(0x201)][_0x4af4a0(0x262)]],_0x2f9af7=[..._0x46ba1f['body'][_0x4af4a0(0x288)]],_0xbf65bd=[..._0x46ba1f['body'][_0x4af4a0(0x240)]],_0x3929c2=[..._0x46ba1f[_0x4af4a0(0x201)]['primary_code']],_0x3f3572=[..._0x46ba1f[_0x4af4a0(0x201)][_0x4af4a0(0x25d)]],_0x50114d=[..._0x46ba1f[_0x4af4a0(0x201)][_0x4af4a0(0x26d)]],_0x52de7d=[..._0x46ba1f['body'][_0x4af4a0(0x237)]],_0x416a0a=[..._0x46ba1f[_0x4af4a0(0x201)]['expiry_date']],_0x38753a=[..._0x46ba1f[_0x4af4a0(0x201)][_0x4af4a0(0x1df)]],_0x4e658b=[..._0x46ba1f[_0x4af4a0(0x201)][_0x4af4a0(0x27f)]],_0x3abb9a=[..._0x46ba1f[_0x4af4a0(0x201)]['type']];const _0x1f1701=_0x1fe184[_0x4af4a0(0x297)](_0x6d2f6d=>{return _0x6d2f6d={'product_name':_0x6d2f6d};});_0x1cbcd5[_0x4af4a0(0x27d)]((_0x36c80b,_0x8337b7)=>{var _0x4e6d4d=_0x4af4a0;_0x1f1701[_0x8337b7][_0x4e6d4d(0x251)]=_0x36c80b;}),_0x8d66ec[_0x4af4a0(0x27d)]((_0x20190e,_0x42f768)=>{var _0xade6bc=_0x4af4a0;_0x1f1701[_0x42f768][_0xade6bc(0x1e4)]=_0x20190e;}),_0x1e5b5f[_0x4af4a0(0x27d)]((_0x5348bc,_0x42cc8a)=>{var _0x5134fb=_0x4af4a0;_0x1f1701[_0x42cc8a][_0x5134fb(0x279)]=_0x5348bc;}),_0x12e724[_0x4af4a0(0x27d)]((_0x4aa0a2,_0x4006b2)=>{_0x1f1701[_0x4006b2]['secondary_unit']=_0x4aa0a2;}),_0x700400[_0x4af4a0(0x27d)]((_0x3321e8,_0x4e078b)=>{var _0x1154e0=_0x4af4a0;_0x1f1701[_0x4e078b][_0x1154e0(0x23d)]=_0x3321e8;}),_0x2f9af7[_0x4af4a0(0x27d)]((_0x2db920,_0x270bee)=>{_0x1f1701[_0x270bee]['bin']=_0x2db920;}),_0xbf65bd[_0x4af4a0(0x27d)]((_0x2a5ebc,_0xbdc494)=>{var _0x16a9ca=_0x4af4a0;_0x1f1701[_0xbdc494][_0x16a9ca(0x233)]=_0x2a5ebc;}),_0x3929c2[_0x4af4a0(0x27d)]((_0xe9aab1,_0x42d37c)=>{_0x1f1701[_0x42d37c]['primary_code']=_0xe9aab1;}),_0x3f3572[_0x4af4a0(0x27d)]((_0x2e2268,_0x152eab)=>{_0x1f1701[_0x152eab]['secondary_code']=_0x2e2268;}),_0x50114d[_0x4af4a0(0x27d)]((_0x1817f5,_0x3f405b)=>{_0x1f1701[_0x3f405b]['maxStocks']=_0x1817f5;}),_0x52de7d[_0x4af4a0(0x27d)]((_0x2811f0,_0x3d8f13)=>{_0x1f1701[_0x3d8f13]['batch_code']=_0x2811f0;}),_0x416a0a[_0x4af4a0(0x27d)]((_0x5125ab,_0xc5fc5c)=>{var _0x1eb524=_0x4af4a0;_0x1f1701[_0xc5fc5c][_0x1eb524(0x29b)]=_0x5125ab;}),_0x3abb9a[_0x4af4a0(0x27d)]((_0x12b316,_0xe01c2)=>{_0x1f1701[_0xe01c2]['type']=_0x12b316;}),_0x38753a['forEach']((_0x288370,_0x42d2f2)=>{var _0x2dcbf3=_0x4af4a0;_0x1f1701[_0x42d2f2][_0x2dcbf3(0x1df)]=_0x288370;}),_0x4e658b[_0x4af4a0(0x27d)]((_0x423bff,_0x55e3a5)=>{var _0xeb66f9=_0x4af4a0;_0x1f1701[_0x55e3a5][_0xeb66f9(0x22f)]=_0x423bff;});const _0x1dc177=_0x1f1701['filter'](_0x23f447=>_0x23f447[_0x4af4a0(0x1e4)]!=='0'&&_0x23f447[_0x4af4a0(0x1e4)]!=='');_0x1ec41a[_0x4af4a0(0x2b6)]=_0x835d53,_0x1ec41a[_0x4af4a0(0x1fc)]=_0x5a0490,_0x1ec41a[_0x4af4a0(0x260)]=_0x4d61d6,_0x1ec41a['warehouse_name']=_0x1f8cef,_0x1ec41a[_0x4af4a0(0x221)]=_0x1dc177,_0x1ec41a[_0x4af4a0(0x2b2)]=_0x172f0d,_0x1ec41a[_0x4af4a0(0x26f)]=_0x572d62,_0x1ec41a[_0x4af4a0(0x254)]=_0x32984a,_0x1ec41a[_0x4af4a0(0x2a6)]=_0x456f8e,_0x1ec41a[_0x4af4a0(0x222)]=_0x4d225b,_0x1ec41a[_0x4af4a0(0x1c6)]=_0x9d254d;const _0x3c892f=await _0x1ec41a[_0x4af4a0(0x229)](),_0x400efa=await warehouse[_0x4af4a0(0x24b)]({'name':_0x46ba1f['body'][_0x4af4a0(0x269)],'room':_0x46ba1f[_0x4af4a0(0x201)][_0x4af4a0(0x249)]});_0x1ec41a[_0x4af4a0(0x221)][_0x4af4a0(0x27d)](_0xbeb4cf=>{var _0x28459d=_0x4af4a0,_0x5d97ed=0x0;const _0xf60101=_0x400efa[_0x28459d(0x244)][_0x28459d(0x297)](_0x3a9c48=>{var _0x5cb3ac=_0x28459d;_0x3a9c48[_0x5cb3ac(0x24a)]==_0xbeb4cf[_0x5cb3ac(0x24a)]&&_0x3a9c48[_0x5cb3ac(0x233)]==_0xbeb4cf['floorlevel']&&_0x3a9c48[_0x5cb3ac(0x275)]==_0xbeb4cf[_0x5cb3ac(0x275)]&&_0x3a9c48[_0x5cb3ac(0x298)]==_0xbeb4cf[_0x5cb3ac(0x298)]&&_0x3a9c48[_0x5cb3ac(0x23d)]==_0xbeb4cf['bay']&&_0x3a9c48[_0x5cb3ac(0x22f)]==_0xbeb4cf[_0x5cb3ac(0x22f)]&&_0x3a9c48[_0x5cb3ac(0x1df)]==_0xbeb4cf[_0x5cb3ac(0x1df)]&&(_0x3a9c48['product_stock']=parseInt(_0x3a9c48[_0x5cb3ac(0x29a)])+parseInt(_0xbeb4cf['quantity']),_0x5d97ed++);});_0x5d97ed=='0'&&(_0x400efa[_0x28459d(0x244)]=_0x400efa[_0x28459d(0x244)][_0x28459d(0x264)]({'product_name':_0xbeb4cf[_0x28459d(0x24a)],'product_stock':_0xbeb4cf[_0x28459d(0x1e4)],'primary_code':_0xbeb4cf[_0x28459d(0x227)],'secondary_code':_0xbeb4cf['secondary_code'],'product_code':_0xbeb4cf[_0x28459d(0x251)],'storage':_0xbeb4cf[_0x28459d(0x1df)],'rack':_0xbeb4cf[_0x28459d(0x22f)],'bay':_0xbeb4cf[_0x28459d(0x23d)],'bin':_0xbeb4cf[_0x28459d(0x298)],'type':_0xbeb4cf[_0x28459d(0x275)],'floorlevel':_0xbeb4cf['floorlevel'],'maxProducts':_0xbeb4cf['maxStocks'],'unit':_0xbeb4cf[_0x28459d(0x279)],'secondary_unit':_0xbeb4cf[_0x28459d(0x2a3)],'expiry_date':_0xbeb4cf[_0x28459d(0x29b)]}));}),await _0x400efa[_0x4af4a0(0x229)]();const _0x2e5925=await s_payment_data[_0x4af4a0(0x24b)]({'invoice':_0x46ba1f[_0x4af4a0(0x201)]['invoice']});if(_0x2e5925===null){}else console['log'](_0x4af4a0(0x1fc),_0x2e5925,_0x46ba1f[_0x4af4a0(0x201)][_0x4af4a0(0x2b6)]),_0x2e5925[_0x4af4a0(0x1fc)]=_0x46ba1f['body']['suppliers'],await _0x2e5925[_0x4af4a0(0x229)]();_0x46ba1f['flash'](_0x4af4a0(0x248),'purchase\x20data\x20update\x20successfully'),_0x5e646d[_0x4af4a0(0x2ab)](_0x4af4a0(0x29e));}catch(_0x592d6b){console[_0x4af4a0(0x299)](_0x592d6b);}}),router['post']('/give_payment/:id',auth,async(_0x3aae3a,_0x2d9f7b)=>{var _0x32808f=a0_0x569643;try{const _0x1d7567=_0x3aae3a[_0x32808f(0x2a5)]['id'],{invoice:_0xce007a,suppliers:_0x5bd438,payable:_0x241df8,due_amount:_0x1596b8}=_0x3aae3a[_0x32808f(0x201)],_0x1d1c69=await purchases[_0x32808f(0x1f2)](_0x1d7567);var _0x8fc43a=_0x241df8-_0x1596b8;_0x1d1c69['paid_amount']=parseFloat(_0x1d1c69[_0x32808f(0x26f)])+parseFloat(_0x1596b8),_0x1d1c69[_0x32808f(0x254)]=_0x8fc43a;const _0x553629=await _0x1d1c69[_0x32808f(0x229)]();console[_0x32808f(0x299)](_0x553629);const _0x2b6e6b=await s_payment_data[_0x32808f(0x24b)]({'invoice':_0xce007a});_0x2b6e6b[_0x32808f(0x286)]=_0x8fc43a,await _0x2b6e6b[_0x32808f(0x229)]();let _0xc66220=new Date(),_0x35e5d5=('0'+_0xc66220['getDate']())['slice'](-0x2),_0x31ff49=('0'+(_0xc66220[_0x32808f(0x29d)]()+0x1))['slice'](-0x2),_0x53e234=_0xc66220['getFullYear'](),_0x1a6fd4=_0x53e234+'-'+_0x31ff49+'-'+_0x35e5d5;const _0x9a5333=new suppliers_payment({'invoice':_0xce007a,'date':_0x53e234+'-'+_0x31ff49+'-'+_0x35e5d5,'suppliers':_0x5bd438,'reason':_0x32808f(0x239),'amount':_0x1596b8}),_0x4c11ab=await _0x9a5333['save']();_0x3aae3a[_0x32808f(0x223)](_0x32808f(0x248),_0x32808f(0x212)),_0x2d9f7b[_0x32808f(0x2ab)](_0x32808f(0x29e));}catch(_0x2dc0f5){console['log'](_0x2dc0f5);}}),router[a0_0x569643(0x28f)](a0_0x569643(0x1b4),auth,async(_0x35e8db,_0x7d8ffd)=>{var _0x2399ec=a0_0x569643;try{const {username:_0x57499d,email:_0x554bb1,role:_0x43b6c5}=_0x35e8db[_0x2399ec(0x2b5)],_0x42e9f3=_0x35e8db['user'],_0x3ade6f=await profile[_0x2399ec(0x24b)]({'email':_0x42e9f3[_0x2399ec(0x284)]}),_0x18aa82=await master_shop['find']();console[_0x2399ec(0x299)](_0x2399ec(0x1b7),_0x18aa82);const _0x4bc7a4=_0x35e8db[_0x2399ec(0x2a5)]['id'],_0x39ec4f=await purchases[_0x2399ec(0x1f2)](_0x4bc7a4);console['log'](_0x39ec4f);const _0x1266f3=await suppliers[_0x2399ec(0x24b)]({'name':_0x39ec4f[_0x2399ec(0x1fc)]});console['log'](_0x1266f3);if(_0x18aa82[0x0][_0x2399ec(0x1cd)]==_0x2399ec(0x1c3)){var _0x3c0f87=users[_0x2399ec(0x1d8)];console[_0x2399ec(0x299)](_0x3c0f87);}else{if(_0x18aa82[0x0][_0x2399ec(0x1cd)]=='Hindi')var _0x3c0f87=users[_0x2399ec(0x23c)];else{if(_0x18aa82[0x0][_0x2399ec(0x1cd)]==_0x2399ec(0x1f1))var _0x3c0f87=users[_0x2399ec(0x1f1)];else{if(_0x18aa82[0x0][_0x2399ec(0x1cd)]=='Spanish')var _0x3c0f87=users[_0x2399ec(0x1ee)];else{if(_0x18aa82[0x0][_0x2399ec(0x1cd)]==_0x2399ec(0x213))var _0x3c0f87=users[_0x2399ec(0x213)];else{if(_0x18aa82[0x0][_0x2399ec(0x1cd)]==_0x2399ec(0x2ae))var _0x3c0f87=users['Portuguese'];else{if(_0x18aa82[0x0][_0x2399ec(0x1cd)]=='Chinese')var _0x3c0f87=users[_0x2399ec(0x1c8)];else{if(_0x18aa82[0x0]['language']==_0x2399ec(0x2a9))var _0x3c0f87=users[_0x2399ec(0x241)];}}}}}}}_0x7d8ffd['render'](_0x2399ec(0x1bf),{'success':_0x35e8db[_0x2399ec(0x223)](_0x2399ec(0x248)),'errors':_0x35e8db[_0x2399ec(0x223)](_0x2399ec(0x1d4)),'role':_0x42e9f3,'profile':_0x3ade6f,'master_shop':_0x18aa82,'supplier':_0x1266f3,'purchase':_0x39ec4f,'language':_0x3c0f87});}catch(_0x26b205){console['log'](_0x26b205);}}),router[a0_0x569643(0x28f)](a0_0x569643(0x27a),auth,async(_0x298987,_0x426550)=>{var _0x3dd823=a0_0x569643;try{const {username:_0x139f2f,email:_0x85a335,role:_0x4cf1ae}=_0x298987[_0x3dd823(0x2b5)],_0x56b282=_0x298987['user'],_0x3b1e93=await profile['findOne']({'email':_0x56b282[_0x3dd823(0x284)]}),_0x342844=await master_shop[_0x3dd823(0x2be)]();console[_0x3dd823(0x299)](_0x3dd823(0x1b7),_0x342844);const _0x295732=_0x298987[_0x3dd823(0x2a5)]['id'];console[_0x3dd823(0x299)](_0x295732);const _0xe61c0e=await purchases[_0x3dd823(0x1f2)](_0x295732);console['log'](_0x3dd823(0x228),_0xe61c0e);const _0x108741=await product[_0x3dd823(0x2be)]({}),_0x1e8918=await warehouse[_0x3dd823(0x257)]([{'$match':{'name':_0xe61c0e[_0x3dd823(0x269)],'room':_0xe61c0e[_0x3dd823(0x2a6)],'warehouse_category':_0x3dd823(0x1ea)}},{'$unwind':_0x3dd823(0x1d3)},{'$group':{'_id':_0x3dd823(0x236),'name':{'$first':_0x3dd823(0x1e7)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x3dd823(0x23f)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x3dd823(0x23b)},'floorlevel':{'$first':_0x3dd823(0x25b)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x3dd823(0x211)},'product_code':{'$first':_0x3dd823(0x24c)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x3dd823(0x21c)}}}]);warehouse_data=await warehouse[_0x3dd823(0x257)]([{'$match':{'status':'Enabled','name':_0x3dd823(0x23e),'warehouse_category':_0x3dd823(0x1ea)}},{'$group':{'_id':_0x3dd823(0x296),'name':{'$first':_0x3dd823(0x296)}}},{'$sort':{'name':0x1}}]),console[_0x3dd823(0x299)]('stock_data',_0x1e8918);if(_0x342844[0x0]['language']=='English\x20(US)'){var _0x1715f0=users[_0x3dd823(0x1d8)];console[_0x3dd823(0x299)](_0x1715f0);}else{if(_0x342844[0x0][_0x3dd823(0x1cd)]==_0x3dd823(0x23c))var _0x1715f0=users['Hindi'];else{if(_0x342844[0x0][_0x3dd823(0x1cd)]==_0x3dd823(0x1f1))var _0x1715f0=users[_0x3dd823(0x1f1)];else{if(_0x342844[0x0][_0x3dd823(0x1cd)]==_0x3dd823(0x1ee))var _0x1715f0=users[_0x3dd823(0x1ee)];else{if(_0x342844[0x0][_0x3dd823(0x1cd)]==_0x3dd823(0x213))var _0x1715f0=users['French'];else{if(_0x342844[0x0]['language']==_0x3dd823(0x2ae))var _0x1715f0=users['Portuguese'];else{if(_0x342844[0x0][_0x3dd823(0x1cd)]==_0x3dd823(0x1c8))var _0x1715f0=users[_0x3dd823(0x1c8)];else{if(_0x342844[0x0][_0x3dd823(0x1cd)]==_0x3dd823(0x2a9))var _0x1715f0=users[_0x3dd823(0x241)];}}}}}}}_0x426550['render'](_0x3dd823(0x1ca),{'success':_0x298987['flash']('success'),'errors':_0x298987[_0x3dd823(0x223)](_0x3dd823(0x1d4)),'role':_0x56b282,'profile':_0x3b1e93,'user':_0xe61c0e,'stock':_0x1e8918,'master_shop':_0x342844,'product':_0x108741,'language':_0x1715f0,'warehouse':warehouse_data});}catch(_0xdb770d){console[_0x3dd823(0x299)](_0xdb770d);}}),router[a0_0x569643(0x1c9)](a0_0x569643(0x27a),auth,async(_0x35a6c9,_0x32aa97)=>{var _0x279d2e=a0_0x569643;try{const {invoice:_0xdcd9e3,date:_0x19f4b7,warehouse_name:_0x5e2036,Room_name:_0x3aab2e,product_name:_0x2b1b7e,purchase_quantity:_0xcf819d,stocks:_0x38edc4,return_qty:_0x2425fd,note:_0x22462c,level:_0x320206,isle:_0x2ee907,pallet:_0x47b65f,to_warehouse_name:_0x1c0c8f,to_Room_name:_0x20a4fd}=_0x35a6c9[_0x279d2e(0x201)],_0xdb3c08=await purchases[_0x279d2e(0x24b)]({'_id':_0x35a6c9[_0x279d2e(0x2a5)]['id']}),_0x250242=await warehouse[_0x279d2e(0x24b)]({'name':_0x5e2036,'room':_0x3aab2e});if(typeof _0x2b1b7e==_0x279d2e(0x1d6))var _0x174855=[_0x35a6c9[_0x279d2e(0x201)][_0x279d2e(0x24a)]],_0x3dc80b=[_0x35a6c9[_0x279d2e(0x201)][_0x279d2e(0x1c2)]],_0x179692=[_0x35a6c9[_0x279d2e(0x201)][_0x279d2e(0x1d0)]],_0x480021=[_0x35a6c9[_0x279d2e(0x201)][_0x279d2e(0x1fd)]],_0x37b8b7=[_0x35a6c9[_0x279d2e(0x201)][_0x279d2e(0x1f5)]],_0x51f631=[_0x35a6c9['body'][_0x279d2e(0x247)]],_0x59d97d=[_0x35a6c9[_0x279d2e(0x201)][_0x279d2e(0x268)]],_0x96a044=[_0x35a6c9['body']['types']],_0x3c1945=[_0x35a6c9[_0x279d2e(0x201)][_0x279d2e(0x218)]],_0x519dec=[_0x35a6c9[_0x279d2e(0x201)][_0x279d2e(0x256)]],_0x2c2649=[_0x35a6c9[_0x279d2e(0x201)][_0x279d2e(0x29c)]];else var _0x174855=[..._0x35a6c9[_0x279d2e(0x201)]['product_name']],_0x3dc80b=[..._0x35a6c9[_0x279d2e(0x201)][_0x279d2e(0x1c2)]],_0x179692=[..._0x35a6c9[_0x279d2e(0x201)]['stocks']],_0x480021=[..._0x35a6c9[_0x279d2e(0x201)]['return_qty']],_0x37b8b7=[..._0x35a6c9['body'][_0x279d2e(0x1f5)]],_0x51f631=[..._0x35a6c9[_0x279d2e(0x201)][_0x279d2e(0x247)]],_0x59d97d=[..._0x35a6c9['body'][_0x279d2e(0x268)]],_0x96a044=[..._0x35a6c9[_0x279d2e(0x201)][_0x279d2e(0x25c)]],_0x3c1945=[..._0x35a6c9[_0x279d2e(0x201)][_0x279d2e(0x218)]],_0x519dec=[..._0x35a6c9[_0x279d2e(0x201)]['primary_code_hide']],_0x2c2649=[..._0x35a6c9[_0x279d2e(0x201)][_0x279d2e(0x29c)]];const _0x4f0b34=_0x174855[_0x279d2e(0x297)](_0x4c4972=>{return _0x4c4972={'product_name':_0x4c4972};});_0x3dc80b[_0x279d2e(0x27d)]((_0x4608ef,_0x381056)=>{var _0x3e5012=_0x279d2e;_0x4f0b34[_0x381056][_0x3e5012(0x1c2)]=_0x4608ef;}),_0x179692['forEach']((_0x9986d9,_0x164288)=>{var _0x2694e6=_0x279d2e;_0x4f0b34[_0x164288][_0x2694e6(0x1da)]=_0x9986d9;}),_0x480021['forEach']((_0x4af7e6,_0x69f4a1)=>{var _0x336add=_0x279d2e;_0x4f0b34[_0x69f4a1][_0x336add(0x1fd)]=_0x4af7e6;}),_0x37b8b7[_0x279d2e(0x27d)]((_0x3a00fe,_0x4faf1d)=>{var _0xfdf21c=_0x279d2e;_0x4f0b34[_0x4faf1d][_0xfdf21c(0x23d)]=_0x3a00fe;}),_0x51f631[_0x279d2e(0x27d)]((_0x5e8393,_0xc228f1)=>{var _0x5de99f=_0x279d2e;_0x4f0b34[_0xc228f1][_0x5de99f(0x298)]=_0x5e8393;}),_0x59d97d['forEach']((_0x121239,_0x2bc0ad)=>{_0x4f0b34[_0x2bc0ad]['floorlevel']=_0x121239;}),_0x96a044[_0x279d2e(0x27d)]((_0x197824,_0x2ccabc)=>{var _0xb0f4e4=_0x279d2e;_0x4f0b34[_0x2ccabc][_0xb0f4e4(0x275)]=_0x197824;}),_0x3c1945[_0x279d2e(0x27d)]((_0x39fbf8,_0x5955d7)=>{_0x4f0b34[_0x5955d7]['product_code']=_0x39fbf8;}),_0x519dec[_0x279d2e(0x27d)]((_0x33cc0e,_0x169998)=>{_0x4f0b34[_0x169998]['primary_code']=_0x33cc0e;}),_0x2c2649[_0x279d2e(0x27d)]((_0x22fe48,_0x358d9f)=>{_0x4f0b34[_0x358d9f]['secondary_code']=_0x22fe48;}),_0xdb3c08[_0x279d2e(0x221)][_0x279d2e(0x27d)](_0x5b0f38=>{var _0x1788f2=_0x279d2e;const _0x1759dd=_0x250242[_0x1788f2(0x244)][_0x1788f2(0x297)](_0x37ccaa=>{var _0x3074b7=_0x1788f2;_0x37ccaa[_0x3074b7(0x24a)]==_0x5b0f38[_0x3074b7(0x24a)]&&_0x37ccaa[_0x3074b7(0x233)]==_0x5b0f38[_0x3074b7(0x233)]&&_0x37ccaa[_0x3074b7(0x275)]==_0x5b0f38[_0x3074b7(0x275)]&&_0x37ccaa[_0x3074b7(0x298)]==_0x5b0f38[_0x3074b7(0x298)]&&_0x37ccaa[_0x3074b7(0x23d)]==_0x5b0f38[_0x3074b7(0x23d)]&&_0x37ccaa[_0x3074b7(0x22f)]==_0x5b0f38[_0x3074b7(0x22f)]&&_0x37ccaa[_0x3074b7(0x1df)]==_0x5b0f38[_0x3074b7(0x1df)]&&(console[_0x3074b7(0x299)](parseInt(_0x37ccaa['product_stock'])+_0x3074b7(0x2a2)+parseInt(_0x5b0f38['quantity'])),_0x37ccaa[_0x3074b7(0x29a)]=parseInt(_0x37ccaa['product_stock'])+parseInt(_0x5b0f38[_0x3074b7(0x1e4)]));});}),await _0x250242[_0x279d2e(0x229)]();const _0x1e8244=_0x4f0b34[_0x279d2e(0x219)](_0x121499=>_0x121499[_0x279d2e(0x1fd)]!=='0'&&_0x121499[_0x279d2e(0x1fd)]!=='');var _0x9aa850=0x0;_0x1e8244['forEach'](_0x4409f=>{var _0x27086b=_0x279d2e;console['log'](_0x27086b(0x220),_0x4409f),(parseInt(_0x4409f['purchase_quantity'])<parseInt(_0x4409f['return_qty'])||parseInt(_0x4409f[_0x27086b(0x1da)])<parseInt(_0x4409f[_0x27086b(0x1fd)]))&&_0x9aa850++;});if(_0x9aa850!=0x0)return _0x35a6c9[_0x279d2e(0x223)](_0x279d2e(0x1d4),_0x279d2e(0x1e6)),_0x32aa97['redirect']('back');const _0x34463d=new purchases_return({'invoice':_0xdcd9e3,'suppliers':_0x35a6c9[_0x279d2e(0x201)]['suppliers'],'date':_0x19f4b7,'warehouse_name':_0x5e2036,'return_product':_0x1e8244,'note':_0x22462c,'room':_0x3aab2e,'to_warehouse_name':_0x1c0c8f,'to_room':_0x20a4fd}),_0x5222a5=await _0x34463d[_0x279d2e(0x229)]();console[_0x279d2e(0x299)](_0x34463d);const _0x2c665d=await purchases_return[_0x279d2e(0x24b)]({'invoice':_0xdcd9e3}),_0x596925=await warehouse[_0x279d2e(0x24b)]({'name':_0x1c0c8f,'room':_0x20a4fd});_0x2c665d[_0x279d2e(0x250)][_0x279d2e(0x27d)](_0x3e1d5f=>{var _0x4c5da0=_0x279d2e,_0x3632b7=0x0;const _0x6ba110=_0x596925[_0x4c5da0(0x244)][_0x4c5da0(0x297)](_0xa6af1b=>{var _0x3e4ad8=_0x4c5da0;_0xa6af1b[_0x3e4ad8(0x24a)]==_0x3e1d5f[_0x3e4ad8(0x24a)]&&_0xa6af1b[_0x3e4ad8(0x233)]==_0x3e1d5f[_0x3e4ad8(0x233)]&&_0xa6af1b['type']==_0x3e1d5f[_0x3e4ad8(0x275)]&&_0xa6af1b['bin']==_0x3e1d5f['bin']&&_0xa6af1b[_0x3e4ad8(0x23d)]==_0x3e1d5f[_0x3e4ad8(0x23d)]&&(_0xa6af1b[_0x3e4ad8(0x29a)]=parseInt(_0xa6af1b[_0x3e4ad8(0x29a)])-parseInt(_0x3e1d5f['return_qty']),_0x3632b7++);});_0x3632b7=='0'&&(_0x596925[_0x4c5da0(0x244)]=_0x596925[_0x4c5da0(0x244)][_0x4c5da0(0x264)]({'product_name':_0x3e1d5f[_0x4c5da0(0x24a)],'product_stock':_0x3e1d5f[_0x4c5da0(0x1fd)],'primary_code':_0x3e1d5f['primary_code'],'secondary_code':_0x3e1d5f[_0x4c5da0(0x25d)],'product_code':_0x3e1d5f[_0x4c5da0(0x251)],'storage':_0x3e1d5f[_0x4c5da0(0x1df)],'rack':_0x3e1d5f[_0x4c5da0(0x22f)],'bay':_0x3e1d5f[_0x4c5da0(0x23d)],'bin':_0x3e1d5f[_0x4c5da0(0x298)],'type':_0x3e1d5f[_0x4c5da0(0x275)],'floorlevel':_0x3e1d5f['floorlevel'],'maxProducts':_0x3e1d5f['maxStocks'],'unit':_0x3e1d5f[_0x4c5da0(0x279)],'secondary_unit':_0x3e1d5f[_0x4c5da0(0x2a3)],'expiry_date':_0x3e1d5f[_0x4c5da0(0x29b)]}));}),await _0x596925[_0x279d2e(0x229)]();const _0x7430ab=await purchases['findOne']({'invoice':_0xdcd9e3});_0x7430ab[_0x279d2e(0x1fb)]='True';const _0x1ccc00=await _0x7430ab[_0x279d2e(0x229)](),_0x2622b2=new s_payment_data({'invoice':_0xdcd9e3,'suppliers':_0x35a6c9['body']['suppliers'],'reason':_0x279d2e(0x1bd)});await _0x2622b2['save']();const _0x2b1454=await master_shop[_0x279d2e(0x2be)]();console['log'](_0x279d2e(0x2b7),_0x2b1454[0x0][_0x279d2e(0x20c)]);const _0x3b6c84=await email_settings[_0x279d2e(0x24b)](),_0x102e12=await suppliers[_0x279d2e(0x24b)]({'name':_0x35a6c9[_0x279d2e(0x201)]['suppliers']});console[_0x279d2e(0x299)]('suppliers_data',_0x102e12);_0x2b1454[0x0][_0x279d2e(0x1b2)]==0x1?(right_currency=_0x2b1454[0x0][_0x279d2e(0x1d1)],left_currency=''):(right_currency='',left_currency=_0x2b1454[0x0][_0x279d2e(0x1d1)]);var _0x4b0981=_0x174855,_0x59614d=_0x480021,_0x4b7fd5='',_0xd4d92b;for(_0xd4d92b in _0x4b0981){_0x4b7fd5+=_0x279d2e(0x295)+_0x279d2e(0x258)+_0x4b0981[_0xd4d92b]+_0x279d2e(0x1b6)+_0x279d2e(0x258)+_0x59614d[_0xd4d92b]+_0x279d2e(0x1b6)+_0x279d2e(0x20f);}console[_0x279d2e(0x299)](_0x279d2e(0x1db),_0x4b7fd5);let _0x29373b=nodemailer[_0x279d2e(0x25e)]({'service':_0x279d2e(0x1d7),'auth':{'user':_0x3b6c84['email'],'pass':_0x3b6c84['password']}}),_0x1df20c={'from':_0x3b6c84['email'],'to':_0x102e12['email'],'subject':_0x279d2e(0x1e8),'attachments':[{'filename':_0x279d2e(0x273),'path':__dirname+_0x279d2e(0x252)+_0x279d2e(0x22c)+_0x2b1454[0x0][_0x279d2e(0x20c)],'cid':_0x279d2e(0x2bc)}],'html':_0x279d2e(0x231)+_0x279d2e(0x22a)+_0x279d2e(0x28a)+_0x279d2e(0x226)+_0x279d2e(0x24e)+'<div>'+_0x279d2e(0x1c0)+'</div>'+_0x279d2e(0x226)+'<h2>\x20'+_0x2b1454[0x0][_0x279d2e(0x1bb)]+_0x279d2e(0x209)+_0x279d2e(0x1c7)+_0x279d2e(0x1c7)+_0x279d2e(0x2bd)+'<div>'+_0x279d2e(0x21d)+_0x279d2e(0x246)+_0xdcd9e3+'\x20'+_0x279d2e(0x238)+_0x279d2e(0x276)+_0x19f4b7+'\x20'+_0x279d2e(0x1ec)+_0x279d2e(0x1c1)+_0x279d2e(0x1c7)+_0x279d2e(0x294)+_0x279d2e(0x25a)+'<tr>'+_0x279d2e(0x1e0)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>'+_0x279d2e(0x2ba)+_0x279d2e(0x20f)+'</thead>'+_0x279d2e(0x242)+'\x20'+_0x4b7fd5+'\x20'+_0x279d2e(0x2ad)+'</table>'+'<div>'+_0x279d2e(0x1f3)+_0x279d2e(0x26a)+_0x2b1454[0x0][_0x279d2e(0x1bb)]+'</h5>'+_0x279d2e(0x1c7)+_0x279d2e(0x1c7)+_0x279d2e(0x1eb)};_0x29373b['sendMail'](_0x1df20c,function(_0xe393fa,_0x161787){var _0x4ccff9=_0x279d2e;_0xe393fa?(console[_0x4ccff9(0x299)](_0xe393fa),console[_0x4ccff9(0x299)](_0x4ccff9(0x224))):console[_0x4ccff9(0x299)](_0x4ccff9(0x210));}),_0x35a6c9[_0x279d2e(0x223)](_0x279d2e(0x248),_0x279d2e(0x28d)),_0x32aa97[_0x279d2e(0x2ab)]('/all_purchases/view');}catch(_0xebf23f){console[_0x279d2e(0x299)](_0xebf23f),_0x32aa97[_0x279d2e(0x20e)](0xc8)[_0x279d2e(0x277)]({'message':_0xebf23f['message']});}}),router[a0_0x569643(0x28f)]('/barcode/:id',auth,async(_0x45e33c,_0x46b77f)=>{var _0x298c36=a0_0x569643;try{const {username:_0x1f13dd,email:_0x44a2c7,role:_0x2df865}=_0x45e33c[_0x298c36(0x2b5)],_0x5ec6b1=_0x45e33c[_0x298c36(0x2b5)],_0x51e801=await profile['findOne']({'email':_0x5ec6b1['email']}),_0xe0aa6c=await master_shop[_0x298c36(0x2be)](),_0x5059d1=_0x45e33c['params']['id'],_0x3f6cda=await purchases['findById'](_0x5059d1);if(_0xe0aa6c[0x0][_0x298c36(0x1cd)]=='English\x20(US)')var _0x90b41c=users[_0x298c36(0x1d8)];else{if(_0xe0aa6c[0x0][_0x298c36(0x1cd)]=='Hindi')var _0x90b41c=users['Hindi'];else{if(_0xe0aa6c[0x0][_0x298c36(0x1cd)]==_0x298c36(0x1f1))var _0x90b41c=users[_0x298c36(0x1f1)];else{if(_0xe0aa6c[0x0]['language']=='Spanish')var _0x90b41c=users[_0x298c36(0x1ee)];else{if(_0xe0aa6c[0x0][_0x298c36(0x1cd)]==_0x298c36(0x213))var _0x90b41c=users['French'];else{if(_0xe0aa6c[0x0][_0x298c36(0x1cd)]==_0x298c36(0x2ae))var _0x90b41c=users[_0x298c36(0x1d9)];else{if(_0xe0aa6c[0x0]['language']==_0x298c36(0x1c8))var _0x90b41c=users[_0x298c36(0x1c8)];else{if(_0xe0aa6c[0x0][_0x298c36(0x1cd)]=='Arabic\x20(ae)')var _0x90b41c=users['Arabic'];}}}}}}}_0x46b77f[_0x298c36(0x1f7)](_0x298c36(0x2a7),{'success':_0x45e33c[_0x298c36(0x223)]('success'),'errors':_0x45e33c[_0x298c36(0x223)](_0x298c36(0x1d4)),'role':_0x5ec6b1,'profile':_0x51e801,'alldata':_0x3f6cda,'master_shop':_0xe0aa6c,'language':_0x90b41c}),console[_0x298c36(0x299)](alldata);}catch(_0x2ef20e){console[_0x298c36(0x299)](_0x2ef20e);}}),router[a0_0x569643(0x1c9)](a0_0x569643(0x2a0),async(_0x13c005,_0x2870b8)=>{var _0x296752=a0_0x569643;const {product_code:_0x70b33a}=_0x13c005[_0x296752(0x201)];var _0x1aab41;const _0x3112b0=await product[_0x296752(0x257)]([{'$match':{'primary_code':_0x70b33a,'product_category':_0x296752(0x1ea)}},{'$group':{'_id':_0x296752(0x281),'name':{'$first':_0x296752(0x296)},'category':{'$first':_0x296752(0x1e1)},'brand':{'$first':_0x296752(0x1f9)},'unit':{'$first':_0x296752(0x2a8)},'alertquantity':{'$first':_0x296752(0x270)},'product_code':{'$first':_0x296752(0x1c4)},'primary_code':{'$first':_0x296752(0x282)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x296752(0x1dc)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x296752(0x1ce)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x4f6a17=await product['aggregate']([{'$match':{'secondary_code':_0x70b33a,'product_category':'Raw\x20Materials'}},{'$group':{'_id':_0x296752(0x281),'name':{'$first':_0x296752(0x296)},'category':{'$first':_0x296752(0x1e1)},'brand':{'$first':'$brand'},'unit':{'$first':_0x296752(0x2a8)},'alertquantity':{'$first':_0x296752(0x270)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x296752(0x282)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x296752(0x278)},'maxProdPerUnit':{'$first':_0x296752(0x1dc)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x296752(0x1ce)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x3112b0[_0x296752(0x28c)]>0x0)_0x1aab41=_0x3112b0;else _0x4f6a17[_0x296752(0x28c)]>0x0&&(_0x1aab41=_0x4f6a17);_0x2870b8['json'](_0x1aab41);}),router[a0_0x569643(0x1c9)](a0_0x569643(0x265),async(_0x39fe5f,_0x121c22)=>{var _0x5d41f9=a0_0x569643;const {primaryCode:_0x4c9ca8,secondaryCode:_0x4782f1,productCode:_0x5559b2,bay:_0xfa450,bin:_0x260145,types:_0x589f4f,pallet:_0x4fe943,warehouses:_0x1fb5f4,room:_0x2c77c9}=_0x39fe5f['body'];console['log'](_0x39fe5f[_0x5d41f9(0x201)]);try{const _0x26a73c=await warehouse[_0x5d41f9(0x257)]([{'$match':{'name':_0x1fb5f4,'room':_0x2c77c9}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':_0xfa450,'product_details.bin':_0x260145,'product_details.type':_0x589f4f}},{'$group':{'_id':_0x5d41f9(0x236),'name':{'$first':_0x5d41f9(0x1e7)},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':_0x5d41f9(0x245)},'isle':{'$first':_0x5d41f9(0x26e)},'pallet':{'$first':_0x5d41f9(0x2b8)},'maxProducts':{'$first':_0x5d41f9(0x206)}}}]);_0x121c22[_0x5d41f9(0x20e)](0xc8)['json'](_0x26a73c);}catch(_0x7145f1){_0x121c22[_0x5d41f9(0x20e)](0x194)[_0x5d41f9(0x277)]({'message':_0x7145f1[_0x5d41f9(0x23a)]});}}),module[a0_0x569643(0x283)]=router;