var a0_0x3d8737=a0_0x36cc;(function(_0x3adc9c,_0x431d70){var _0x7497c0=a0_0x36cc,_0x25646f=_0x3adc9c();while(!![]){try{var _0x50aab3=parseInt(_0x7497c0(0x11f))/0x1+-parseInt(_0x7497c0(0x17d))/0x2+-parseInt(_0x7497c0(0x160))/0x3*(parseInt(_0x7497c0(0xb8))/0x4)+parseInt(_0x7497c0(0x170))/0x5+parseInt(_0x7497c0(0xa3))/0x6*(parseInt(_0x7497c0(0x13c))/0x7)+parseInt(_0x7497c0(0x157))/0x8*(-parseInt(_0x7497c0(0xd1))/0x9)+-parseInt(_0x7497c0(0x91))/0xa*(parseInt(_0x7497c0(0x10c))/0xb);if(_0x50aab3===_0x431d70)break;else _0x25646f['push'](_0x25646f['shift']());}catch(_0x17a52a){_0x25646f['push'](_0x25646f['shift']());}}}(a0_0x4782,0xc2fa0));const express=require('express'),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings}=require(a0_0x3d8737(0xff)),auth=require('../middleware/auth'),nodemailer=require(a0_0x3d8737(0x17b));var ejs=require(a0_0x3d8737(0x139));const path=require(a0_0x3d8737(0x8e)),users=require(a0_0x3d8737(0xf2));router[a0_0x3d8737(0x166)](a0_0x3d8737(0x174),auth,async(_0x557e42,_0x32a9b3)=>{var _0x5b5a49=a0_0x3d8737;try{const {username:_0x45e897,email:_0x53709d,role:_0x2500bb}=_0x557e42['user'],_0x2156d4=_0x557e42[_0x5b5a49(0xcb)],_0x28fc28=await profile['findOne']({'email':_0x2156d4[_0x5b5a49(0x130)]}),_0x271250=await staff[_0x5b5a49(0x105)]({'email':_0x2156d4[_0x5b5a49(0x130)]});if(_0x2156d4[_0x5b5a49(0xf8)]=='staff'){const _0xd0f446=await staff[_0x5b5a49(0x105)]({'email':_0x2156d4[_0x5b5a49(0x130)]});}const _0x4f58d9=await master_shop[_0x5b5a49(0x171)]();let _0x3593a2;if(_0x2156d4[_0x5b5a49(0xf8)]==_0x5b5a49(0xf5)){const _0x4d7481=await staff[_0x5b5a49(0x105)]({'email':_0x2156d4[_0x5b5a49(0x130)]});_0x3593a2=await purchases[_0x5b5a49(0x141)]([{'$match':{'warehouse_name':_0x4d7481['warehouse']}},{'$lookup':{'from':_0x5b5a49(0x11d),'localField':_0x5b5a49(0x11d),'foreignField':'name','as':'suppliers_docs'}},{'$unwind':_0x5b5a49(0x11e)},{'$unwind':'$product'},{'$group':{'_id':_0x5b5a49(0x118),'invoice':{'$first':_0x5b5a49(0x182)},'suppliers':{'$first':_0x5b5a49(0xd7)},'date':{'$first':_0x5b5a49(0x181)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':_0x5b5a49(0x162)},'product':{'$push':_0x5b5a49(0x115)},'note':{'$first':_0x5b5a49(0x146)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x5b5a49(0xad)},'return_data':{'$first':_0x5b5a49(0xd9)},'batch_code':{'$first':_0x5b5a49(0x142)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x5b5a49(0x11e)},'total_product_quantity':{'$sum':_0x5b5a49(0x12f)},'level':{'$addToSet':_0x5b5a49(0x98)},'isle':{'$addToSet':_0x5b5a49(0x9d)},'type':{'$addToSet':_0x5b5a49(0x10d)},'floorlevel':{'$addToSet':_0x5b5a49(0x178)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x3593a2=await purchases['aggregate']([{'$lookup':{'from':_0x5b5a49(0x11d),'localField':_0x5b5a49(0x11d),'foreignField':_0x5b5a49(0xcf),'as':_0x5b5a49(0x180)}},{'$unwind':_0x5b5a49(0x11e)},{'$unwind':'$product'},{'$group':{'_id':_0x5b5a49(0x118),'invoice':{'$first':_0x5b5a49(0x182)},'suppliers':{'$first':_0x5b5a49(0xd7)},'date':{'$first':_0x5b5a49(0x181)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x5b5a49(0x137)},'product':{'$push':'$product'},'note':{'$first':_0x5b5a49(0x146)},'paid_amount':{'$first':_0x5b5a49(0x16b)},'due_amount':{'$first':_0x5b5a49(0xad)},'return_data':{'$first':_0x5b5a49(0xd9)},'batch_code':{'$first':_0x5b5a49(0x142)},'expiry_date':{'$first':_0x5b5a49(0x169)},'suppliers_docs':{'$first':_0x5b5a49(0x11e)},'total_product_quantity':{'$sum':_0x5b5a49(0x12f)},'level':{'$addToSet':_0x5b5a49(0x98)},'isle':{'$addToSet':_0x5b5a49(0x9d)},'type':{'$addToSet':_0x5b5a49(0x10d)},'floorlevel':{'$addToSet':_0x5b5a49(0x178)},'finalize':{'$first':_0x5b5a49(0xb4)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x4f58d9[0x0][_0x5b5a49(0x11b)]==_0x5b5a49(0xc5)){var _0x25f881=users[_0x5b5a49(0xe1)];console[_0x5b5a49(0xe9)](_0x25f881);}else{if(_0x4f58d9[0x0]['language']==_0x5b5a49(0xcd))var _0x25f881=users[_0x5b5a49(0xcd)];else{if(_0x4f58d9[0x0][_0x5b5a49(0x11b)]==_0x5b5a49(0x120))var _0x25f881=users[_0x5b5a49(0x120)];else{if(_0x4f58d9[0x0][_0x5b5a49(0x11b)]==_0x5b5a49(0x159))var _0x25f881=users['Spanish'];else{if(_0x4f58d9[0x0][_0x5b5a49(0x11b)]=='French')var _0x25f881=users[_0x5b5a49(0x111)];else{if(_0x4f58d9[0x0]['language']==_0x5b5a49(0x18b))var _0x25f881=users[_0x5b5a49(0x125)];else{if(_0x4f58d9[0x0][_0x5b5a49(0x11b)]==_0x5b5a49(0x176))var _0x25f881=users[_0x5b5a49(0x176)];else{if(_0x4f58d9[0x0][_0x5b5a49(0x11b)]==_0x5b5a49(0xac))var _0x25f881=users['Arabic'];}}}}}}}_0x32a9b3['render']('all_purchases',{'success':_0x557e42[_0x5b5a49(0x11c)](_0x5b5a49(0xdb)),'errors':_0x557e42['flash']('errors'),'purchases':_0x3593a2,'role':_0x2156d4,'profile':_0x28fc28,'master_shop':_0x4f58d9,'language':_0x25f881});}catch(_0x33c520){console[_0x5b5a49(0xe9)](_0x5b5a49(0xee),_0x33c520),_0x32a9b3[_0x5b5a49(0xf6)](0xc8)[_0x5b5a49(0x17a)]({'message':_0x33c520[_0x5b5a49(0xc7)]});}});function a0_0x36cc(_0x452e36,_0x2bfad7){var _0x478288=a0_0x4782();return a0_0x36cc=function(_0x36cc4b,_0x3b950f){_0x36cc4b=_0x36cc4b-0x8c;var _0x3487bc=_0x478288[_0x36cc4b];return _0x3487bc;},a0_0x36cc(_0x452e36,_0x2bfad7);}function BayBinSelected(_0x15d79b,_0x167713){var _0x3d71db=a0_0x3d8737,_0xbd3353=[],_0x58c1ee=[],_0xf46fd5=[],_0x51090c=[],_0x3be5c2=[],_0x4b4115=[];let _0x238a68=[];if(_0x15d79b=='DRY\x20STORAGE')switch(_0x167713){case _0x3d71db(0x8d):_0xbd3353=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x58c1ee=[0x1,0x2],_0x51090c=[0x1,0x2,0x3,0x4,0x5],_0xf46fd5=['Level',_0x3d71db(0xc6)],_0x3be5c2=['D'],_0x4b4115=['A'];break;case _0x3d71db(0x117):_0xbd3353=[0x6,0x5,0x4,0x3,0x2,0x1],_0x58c1ee=[0x1,0x2],_0x51090c=[0x1,0x2,0x3,0x4,0x5],_0xf46fd5=[_0x3d71db(0xe6),'Floor'],_0x3be5c2=['D'],_0x4b4115=['B'];break;case'Shelves':_0xbd3353=[0x0],_0x58c1ee=[0x0],_0x51090c=[0x1,0x2,0x3,0x4,0x5],_0xf46fd5=[_0x3d71db(0xc6)],_0x3be5c2=['D'],_0x4b4115=['S'];break;case _0x3d71db(0x15d):_0xbd3353=[0x0],_0x58c1ee=[0x0],_0x51090c=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0xf46fd5=[_0x3d71db(0xc6)],_0x3be5c2=['D'],_0x4b4115=['R'];break;}else{if(_0x15d79b==_0x3d71db(0x15b))switch(_0x167713){case _0x3d71db(0x8d):_0xbd3353=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x58c1ee=['B','F'],_0x51090c=[0x1,0x2,0x3,0x4,0x5],_0xf46fd5=['Level','Floor'],_0x3be5c2=['C'],_0x4b4115=['A'];break;case _0x3d71db(0x117):_0xbd3353=[0x5,0x4,0x3,0x2,0x1],_0x58c1ee=['F','B','S'],_0x51090c=[0x1,0x2,0x3,0x4,0x5],_0xf46fd5=[_0x3d71db(0xe6),_0x3d71db(0xc6)],_0x3be5c2=['C'],_0x4b4115=['B'];break;case _0x3d71db(0xa0):_0xbd3353=[0x1,0x2,0x3,0x4,0x5],_0x58c1ee=['B','F','S'],_0x51090c=[0x5,0x4,0x3,0x2,0x1],_0xf46fd5=[_0x3d71db(0xe6),'Floor'],_0x3be5c2=['C'],_0x4b4115=['C'];break;case _0x3d71db(0x14d):_0xbd3353=[0x5,0x4,0x3,0x2,0x1],_0x58c1ee=['F','B','S'],_0x51090c=[0x1,0x2,0x3,0x4,0x5],_0xf46fd5=[_0x3d71db(0xe6),_0x3d71db(0xc6)],_0x3be5c2=['C'],_0x4b4115=['D'];break;case _0x3d71db(0x102):_0xbd3353=[0x4,0x3,0x2,0x1],_0x58c1ee=[0x1,0x2],_0x51090c=[0x1,0x2,0x3,0x4,0x5],_0xf46fd5=[_0x3d71db(0xe6),_0x3d71db(0xc6)],_0x3be5c2=['C'],_0x4b4115=['E'];break;case'Rack\x20F':_0xbd3353=[0x1,0x2,0x3],_0x58c1ee=[0x1,0x2],_0x51090c=[0x1,0x2,0x3,0x4,0x5],_0xf46fd5=[_0x3d71db(0xe6)],_0x3be5c2=['C'],_0x4b4115=['F'];break;}}return{'levels':_0xbd3353,'Isle':_0x58c1ee,'rack':_0x51090c,'type':_0xf46fd5,'storage':_0x3be5c2,'rak':_0x4b4115};}function a0_0x4782(){var _0x1f9cf2=['INC-','payment\x20successfull','primary_code','French','room_name','$product_details._id','prod_secondunit','$product','product_code_hide','Rack\x20B','$_id','errors','product_list','language','flash','suppliers','$suppliers_docs','1554394EetWCo','German','password','rack','/view/return_purchase/:id','product_name','Portuguese','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','$secondary_code','purchase\x20data\x20update\x20successfully','prod_isle','Purchase\x20data\x20added\x20successfully','Error\x20Occurs','Ambient','<!DOCTYPE\x20html>','$product_details.type','$product.quantity','email','level','/CheckingWarehouse','getMonth','findById','$product_code','stocks','$product.room_name','type','ejs','length','$product_details','7McWDqc','save','$product_details.secondary_code','all','<h5\x20style=\x22text-align:\x20left;\x22>','aggregate','$batch_code','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','sendMail','standard_unit','$note','forEach','prod_level','secondary_unit','$product_details.storage','<html><head><title></title>','getFullYear','Rack\x20D','expiry_date','\x20</h2>','render','<div>','</div>','isle','/../public','RoomAssign','JO_number','4504088cwhExa','/barcode/:id','Spanish','\x20<>\x20','COLD\x20STORAGE','True','Receiving\x20Area','concat','/all_purchases/view','307959HjdgXt','note','$room','floorlevel','prod_cat','$brand','get','slice','/upload/','$expiry_date','types','$paid_amount','foreach\x20newproduct','suppliers_data','prod_unit','image','5782450OFwHLC','find','add_purchases\x20error','rak','/view','delivery_date','Chinese','room','$product.floorlevel','return_purchase','json','nodemailer','logo','300524xQIVZI','alertQTY','gmail','suppliers_docs','$date','$invoice','</head><body>','$product_details.isle','bin','An\x20error\x20occurred\x20while\x20saving\x20data.','$name','body','/view/add_purchases/:id','paid_amount','Portuguese\x20(BR)','product_stock','Rack\x20A','path','$product_details.floorlevel','Paid\x20For\x20Purchase','16910NeNkzU','product','prod_primunit','product_details','$maxProdPerUnit','invoice','prod_Qty','$product.bay','error','prod_code','/barcode_scanner','toString','$product.bin','$product_details.product_stock','Enabled','Rack\x20C','$category','purchase_quantity','8178450RemSkL','\x20Order\x20Date\x20:\x20','master','params','/view/add_purchases','batch_code','getDate','/preview/:id','\x20<\x20wew\x20>\x20','Arabic\x20(ae)','$due_amount','Purchase\x20Return\x20Mail','back','$product_details.level','amount','maxperunit','Purchase\x20Return','$finalize','Enclosed','/view/:id','Arabic','12lYgKKT','exports','$product_details.rack','map','Shelves','currency_placement','</body></html>','warehouse_name','<h2>\x20','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','prod_pallet','<strong>\x20Regards\x20</strong>','English\x20(US)','Floor','message','$maxStocks','catch','production_date','user','\x20Order\x20Number\x20:\x20','Hindi','pallet','name','post','9xuCJwm','max_product_unit','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','secondary_code','padStart','An\x20error\x20occurred.','$suppliers','stock_quantity','$return_data','product_code','success','purchase_invoice','maxStocks','Return\x20Goods','all_purchases_barcode','filter','English','MaxStocks_data','string','currency','Room_name','Level','/all_purchases/view/','bay','log','</td>','quantity','</tr>','$alertquantity','table\x20page','<h5>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','<tr>','../public/language/languages.json','Raw\x20Materials','return_product','staff','status','/invoice/:id','role','prod_name','due_amount','return_qty','prod_qty','date','$product_details.product_name','../models/all_models','redirect','Logo.png','Rack\x20E','$primary_code','</thead>','findOne','add\x20post','<span\x20style=\x22float:\x20right;\x22>','storage','delivery_code','$product_details.bin','warehouse','14663KfousC','$product.type'];a0_0x4782=function(){return _0x1f9cf2;};return a0_0x4782();}router[a0_0x3d8737(0x166)](a0_0x3d8737(0xa7),auth,async(_0x2440e5,_0x533027)=>{var _0x318e2b=a0_0x3d8737;try{const {username:_0x2228e2,email:_0x463edf,role:_0x2c9603}=_0x2440e5[_0x318e2b(0xcb)],_0x45c8a1=_0x2440e5[_0x318e2b(0xcb)],_0x2d5a6f=await profile['findOne']({'email':_0x45c8a1[_0x318e2b(0x130)]}),_0x1ea96c=await master_shop['find'](),_0x38a6c9=await staff[_0x318e2b(0x105)]({'email':_0x45c8a1[_0x318e2b(0x130)]}),_0x44876d=await suppliers['find']({});let _0x4d604f;if(_0x45c8a1[_0x318e2b(0xf8)]==_0x318e2b(0xf5)){const _0x42ff27=await staff[_0x318e2b(0x105)]({'email':_0x45c8a1[_0x318e2b(0x130)]});_0x4d604f=await warehouse[_0x318e2b(0x141)]([{'$match':{'status':_0x318e2b(0x9f),'name':_0x42ff27[_0x318e2b(0x10b)],'warehouse_category':_0x318e2b(0xf3),'name':{'$ne':_0x318e2b(0xde)}}},{'$group':{'_id':_0x318e2b(0x187),'name':{'$first':_0x318e2b(0x187)}}}]);}else _0x4d604f=await warehouse['aggregate']([{'$match':{'status':_0x318e2b(0x9f),'warehouse_category':_0x318e2b(0xf3),'name':{'$ne':_0x318e2b(0xde)}}},{'$group':{'_id':'$name','name':{'$first':_0x318e2b(0x187)}}}]);const _0x570023=await product[_0x318e2b(0x171)]({}),_0x49be53=await warehouse[_0x318e2b(0x171)]({'status':_0x318e2b(0x9f)}),_0xa87fc0=await purchases['find']({}),_0x4507dc=_0xa87fc0['length']+0x1,_0x4a31a6=_0x318e2b(0x10e)+_0x4507dc[_0x318e2b(0x9c)]()[_0x318e2b(0xd5)](0x5,'0');var _0x32c8c3=[_0x318e2b(0x12c),_0x318e2b(0xb5)];if(_0x1ea96c[0x0][_0x318e2b(0x11b)]==_0x318e2b(0xc5)){var _0x933377=users['English'];console[_0x318e2b(0xe9)](_0x933377);}else{if(_0x1ea96c[0x0][_0x318e2b(0x11b)]=='Hindi')var _0x933377=users['Hindi'];else{if(_0x1ea96c[0x0][_0x318e2b(0x11b)]==_0x318e2b(0x120))var _0x933377=users[_0x318e2b(0x120)];else{if(_0x1ea96c[0x0][_0x318e2b(0x11b)]==_0x318e2b(0x159))var _0x933377=users[_0x318e2b(0x159)];else{if(_0x1ea96c[0x0][_0x318e2b(0x11b)]==_0x318e2b(0x111))var _0x933377=users[_0x318e2b(0x111)];else{if(_0x1ea96c[0x0]['language']==_0x318e2b(0x18b))var _0x933377=users[_0x318e2b(0x125)];else{if(_0x1ea96c[0x0][_0x318e2b(0x11b)]==_0x318e2b(0x176))var _0x933377=users[_0x318e2b(0x176)];else{if(_0x1ea96c[0x0][_0x318e2b(0x11b)]==_0x318e2b(0xac))var _0x933377=users[_0x318e2b(0xb7)];}}}}}}}_0x533027[_0x318e2b(0x150)]('add_purchases',{'success':_0x2440e5[_0x318e2b(0x11c)]('success'),'errors':_0x2440e5['flash']('errors'),'role':_0x45c8a1,'profile':_0x2d5a6f,'suppliers':_0x44876d,'warehouse':_0x4d604f,'product':_0x570023,'invoice':_0x4a31a6,'master_shop':_0x1ea96c,'language':_0x933377,'find_data':_0x49be53,'rooms_data':_0x32c8c3});}catch(_0x25d9e0){console[_0x318e2b(0xe9)](_0x25d9e0);}}),router['get'](a0_0x3d8737(0x189),auth,async(_0x81082d,_0x65a47d)=>{var _0x88dd56=a0_0x3d8737;try{const _0x2aa060=_0x81082d[_0x88dd56(0xa6)]['id'];console[_0x88dd56(0xe9)](_0x2aa060);const _0x5ade1f=await master_shop[_0x88dd56(0x171)]();console[_0x88dd56(0xe9)]('master',_0x5ade1f);const _0x885912=await product[_0x88dd56(0x105)]({'name':_0x2aa060});console['log']('product',_0x885912),_0x65a47d[_0x88dd56(0xf6)](0xc8)['json']({'product_data':_0x885912,'master':_0x5ade1f});}catch(_0x3a9026){console['log'](_0x88dd56(0x172),_0x3a9026);}}),router[a0_0x3d8737(0xd0)]('/view/add_purchases',auth,async(_0x27cb3a,_0x40a8d0)=>{var _0xc753c2=a0_0x3d8737;try{const {invoice:_0xda70f0,date:_0x78f94e,warehouse_name:_0xa99519,prod_name:_0x4bceec,prod_code:_0x4303aa,prod_qty:_0x3cd7a7,prod_unit:_0x4a3518,prod_secondunit:_0x248ae6,prod_level:_0x350e27,prod_isle:_0x22f2ef,prod_pallet:_0x2134fa,note:_0x1a53d6,expiry_date:_0x4e3539,batch_code:_0x51ce0e,payable:_0x3e5675,due_amount:_0x2d6603,Room_name:_0x51c722,primary_code:_0x459255,secondary_code:_0x36e515,MaxStocks_data:_0x27eb9e,PO_number:_0x2a751f,SCRN:_0x504680,JO_number:_0x9cb96c}=_0x27cb3a['body'];if(typeof _0x4bceec==_0xc753c2(0xe3))var _0x2412b4=[_0x27cb3a['body'][_0xc753c2(0xf9)]],_0x2bf2c8=[_0x27cb3a[_0xc753c2(0x188)][_0xc753c2(0x9a)]],_0x37bcc6=[_0x27cb3a[_0xc753c2(0x188)]['prod_Qty']],_0xb39550=[_0x27cb3a[_0xc753c2(0x188)][_0xc753c2(0x93)]],_0x3717f5=[_0x27cb3a['body']['prod_secondunit']],_0x40c6fa=[_0x27cb3a[_0xc753c2(0x188)][_0xc753c2(0x148)]],_0x13c9de=[_0x27cb3a[_0xc753c2(0x188)][_0xc753c2(0x110)]],_0x544bda=[_0x27cb3a[_0xc753c2(0x188)][_0xc753c2(0xd4)]],_0x327007=[_0x27cb3a['body'][_0xc753c2(0xe2)]],_0x4d425d=[_0x27cb3a[_0xc753c2(0x188)][_0xc753c2(0xa8)]],_0x16d44e=[_0x27cb3a[_0xc753c2(0x188)]['expiry_date']],_0x4138c6=[_0x27cb3a['body'][_0xc753c2(0xd2)]],_0x38773d=[_0x27cb3a[_0xc753c2(0x188)]['alertQTY']],_0x6b3af1=[_0x27cb3a[_0xc753c2(0x188)][_0xc753c2(0xca)]],_0xb823f=[_0x27cb3a[_0xc753c2(0x188)][_0xc753c2(0x164)]],_0x1fed3b=[_0x27cb3a['body'][_0xc753c2(0x155)]];else var _0x2412b4=[..._0x27cb3a[_0xc753c2(0x188)][_0xc753c2(0xf9)]],_0x2bf2c8=[..._0x27cb3a[_0xc753c2(0x188)][_0xc753c2(0x9a)]],_0x37bcc6=[..._0x27cb3a[_0xc753c2(0x188)][_0xc753c2(0x97)]],_0xb39550=[..._0x27cb3a[_0xc753c2(0x188)]['prod_primunit']],_0x3717f5=[..._0x27cb3a['body']['prod_secondunit']],_0x40c6fa=[..._0x27cb3a[_0xc753c2(0x188)][_0xc753c2(0x148)]],_0x13c9de=[..._0x27cb3a['body'][_0xc753c2(0x110)]],_0x544bda=[..._0x27cb3a[_0xc753c2(0x188)][_0xc753c2(0xd4)]],_0x327007=[..._0x27cb3a['body'][_0xc753c2(0xe2)]],_0x4d425d=[..._0x27cb3a[_0xc753c2(0x188)]['batch_code']],_0x16d44e=[..._0x27cb3a['body'][_0xc753c2(0x14e)]],_0x4138c6=[..._0x27cb3a[_0xc753c2(0x188)][_0xc753c2(0xd2)]],_0x38773d=[..._0x27cb3a[_0xc753c2(0x188)][_0xc753c2(0x17e)]],_0x6b3af1=[..._0x27cb3a[_0xc753c2(0x188)]['production_date']],_0xb823f=[..._0x27cb3a[_0xc753c2(0x188)][_0xc753c2(0x164)]],_0x1fed3b=[..._0x27cb3a[_0xc753c2(0x188)][_0xc753c2(0x155)]];const _0x2c8547=_0x2412b4['map'](_0x181363=>{return _0x181363={'product_name':_0x181363};});_0x2bf2c8[_0xc753c2(0x147)]((_0x203622,_0x1bdd4d)=>{var _0x4de41f=_0xc753c2;_0x2c8547[_0x1bdd4d][_0x4de41f(0xda)]=_0x203622;}),_0x37bcc6['forEach']((_0x1454bf,_0x5b26cc)=>{_0x2c8547[_0x5b26cc]['quantity']=_0x1454bf;}),_0xb39550[_0xc753c2(0x147)]((_0x3f517e,_0x173b24)=>{var _0x4981c7=_0xc753c2;_0x2c8547[_0x173b24][_0x4981c7(0x145)]=_0x3f517e;}),_0x3717f5[_0xc753c2(0x147)]((_0x1522c5,_0x24f270)=>{_0x2c8547[_0x24f270]['secondary_unit']=_0x1522c5;}),_0x40c6fa['forEach']((_0xef182a,_0x57778d)=>{var _0x3cbdd1=_0xc753c2;_0x1fed3b[_0x3cbdd1(0x147)]((_0x1cfc61,_0x2b0517)=>{var _0xf33645=_0x3cbdd1;if(_0x1cfc61==_0xf33645(0x15d)&&_0x57778d==_0x2b0517){console[_0xf33645(0xe9)](_0x1cfc61+_0xf33645(0xab)+_0x57778d+_0xf33645(0x15a)+_0x2b0517+_0xf33645(0x15a)+_0xef182a);var _0x5430f9=_0xef182a['slice'](0x3);_0x2c8547[_0x57778d][_0xf33645(0x108)]=_0xef182a[0x0],_0x2c8547[_0x57778d]['rack']=_0xef182a[0x1],_0x2c8547[_0x57778d]['bay']=0x0,_0x2c8547[_0x57778d][_0xf33645(0x185)]=0x0,_0x2c8547[_0x57778d]['type']=_0xf33645(0xc6),_0x2c8547[_0x57778d][_0xf33645(0x163)]=_0x5430f9;}else{if(_0x1cfc61==_0xf33645(0xbc)&&_0x57778d==_0x2b0517){var _0x5430f9=_0xef182a['slice'](0x3);_0x2c8547[_0x57778d]['storage']=_0xef182a[0x0],_0x2c8547[_0x57778d]['rack']=_0xef182a[0x1],_0x2c8547[_0x57778d][_0xf33645(0xe8)]=0x0,_0x2c8547[_0x57778d][_0xf33645(0x185)]=0x0,_0x2c8547[_0x57778d][_0xf33645(0x138)]=_0xf33645(0xc6),_0x2c8547[_0x57778d][_0xf33645(0x163)]=_0xef182a[0x5];}else{if(_0x57778d==_0x2b0517){var _0x4493a1;if(_0xef182a[0x4]=='L')_0x4493a1=_0xf33645(0xe6);else _0xef182a[0x4]=='F'&&(_0x4493a1='Floor');_0x2c8547[_0x57778d][_0xf33645(0x108)]=_0xef182a[0x0],_0x2c8547[_0x57778d]['rack']=_0xef182a[0x1],_0x2c8547[_0x57778d]['bay']=_0xef182a[0x2],_0x2c8547[_0x57778d][_0xf33645(0x185)]=_0xef182a[0x3],_0x2c8547[_0x57778d]['type']=_0x4493a1,_0x2c8547[_0x57778d][_0xf33645(0x163)]=_0xef182a[0x5];}}}});}),_0x13c9de[_0xc753c2(0x147)]((_0x5489f4,_0xd35b04)=>{_0x2c8547[_0xd35b04]['primary_code']=_0x5489f4;}),_0x544bda[_0xc753c2(0x147)]((_0x54c0a6,_0x3ff6e5)=>{var _0x473a09=_0xc753c2;_0x2c8547[_0x3ff6e5][_0x473a09(0xd4)]=_0x54c0a6;}),_0x327007[_0xc753c2(0x147)]((_0x38b6ed,_0x51e2e0)=>{var _0x2379cd=_0xc753c2;_0x2c8547[_0x51e2e0][_0x2379cd(0xdd)]=_0x38b6ed;}),_0x4d425d['forEach']((_0x3ef9ab,_0x1ffb9d)=>{_0x2c8547[_0x1ffb9d]['batch_code']=_0x3ef9ab;}),_0x16d44e[_0xc753c2(0x147)]((_0x18be85,_0x27b005)=>{var _0x435f33=_0xc753c2;_0x2c8547[_0x27b005][_0x435f33(0x14e)]=_0x18be85;}),_0x4138c6['forEach']((_0x32dd0e,_0x83a817)=>{var _0xbe4462=_0xc753c2;_0x2c8547[_0x83a817][_0xbe4462(0xb2)]=_0x32dd0e;}),_0x38773d[_0xc753c2(0x147)]((_0x428470,_0xff2277)=>{_0x2c8547[_0xff2277]['alertQTY']=_0x428470;}),_0x6b3af1[_0xc753c2(0x147)]((_0x569557,_0x38c2bb)=>{var _0x4c05ed=_0xc753c2;_0x2c8547[_0x38c2bb][_0x4c05ed(0xca)]=_0x569557;}),_0xb823f[_0xc753c2(0x147)]((_0x1ab7ff,_0x54b43e)=>{_0x2c8547[_0x54b43e]['product_cat']=_0x1ab7ff;}),_0x1fed3b[_0xc753c2(0x147)]((_0x44532a,_0x32a107)=>{var _0x3a4a2c=_0xc753c2;_0x2c8547[_0x32a107][_0x3a4a2c(0x112)]=_0x44532a;});const _0x1e8c51=_0x1fed3b[_0xc753c2(0xbb)](_0x29fc5b=>{return _0x29fc5b={'room_name':_0x29fc5b};}),_0x159c65=_0x2c8547[_0xc753c2(0xe0)](_0x5ec67e=>_0x5ec67e[_0xc753c2(0xeb)]!=='0'&&_0x5ec67e['quantity']!==''),_0x4d8f76=new purchases({'invoice':_0xda70f0,'suppliers':_0x27cb3a[_0xc753c2(0x188)][_0xc753c2(0x11d)],'date':_0x78f94e,'warehouse_name':_0xa99519,'product':_0x159c65,'note':_0x1a53d6,'due_amount':_0x2d6603,'POnumber':_0x2a751f,'SCRN':_0x504680,'JO_number':_0x9cb96c,'roomList':_0x1e8c51}),_0x1a6b7a=await _0x4d8f76['save'](),_0x4d9b63=await purchases[_0xc753c2(0x105)]({'invoice':_0xda70f0}),_0x286fd4=_0x4d9b63['product'][_0xc753c2(0xbb)](async _0x4ec725=>{var _0xdbcd86=_0xc753c2,_0x192061=await warehouse[_0xdbcd86(0x105)]({'name':_0xa99519,'room':_0x4ec725[_0xdbcd86(0x112)]}),_0x478534=0x0;return _0x192061[_0xdbcd86(0x94)]['forEach'](_0x14f73f=>{var _0x5a7f0f=_0xdbcd86;_0x14f73f[_0x5a7f0f(0x124)]==_0x4ec725[_0x5a7f0f(0x124)]&&_0x14f73f[_0x5a7f0f(0x163)]==_0x4ec725[_0x5a7f0f(0x163)]&&_0x14f73f[_0x5a7f0f(0x138)]==_0x4ec725['type']&&_0x14f73f[_0x5a7f0f(0x185)]==_0x4ec725['bin']&&_0x14f73f[_0x5a7f0f(0xe8)]==_0x4ec725['bay']&&_0x14f73f['rack']==_0x4ec725[_0x5a7f0f(0x122)]&&_0x14f73f[_0x5a7f0f(0x108)]==_0x4ec725[_0x5a7f0f(0x108)]&&_0x14f73f[_0x5a7f0f(0x14e)]==_0x4ec725[_0x5a7f0f(0x14e)]&&_0x14f73f[_0x5a7f0f(0xa8)]==_0x4ec725[_0x5a7f0f(0xa8)]&&_0x14f73f[_0x5a7f0f(0xca)]==_0x4ec725[_0x5a7f0f(0xca)]&&(_0x14f73f[_0x5a7f0f(0x8c)]+=_0x4ec725[_0x5a7f0f(0xeb)],_0x478534++);}),_0x478534===0x0&&_0x192061[_0xdbcd86(0x94)]['push']({'product_name':_0x4ec725[_0xdbcd86(0x124)],'product_stock':_0x4ec725[_0xdbcd86(0xeb)],'primary_code':_0x4ec725[_0xdbcd86(0x110)],'secondary_code':_0x4ec725['secondary_code'],'product_code':_0x4ec725[_0xdbcd86(0xda)],'storage':_0x4ec725[_0xdbcd86(0x108)],'rack':_0x4ec725[_0xdbcd86(0x122)],'bay':_0x4ec725[_0xdbcd86(0xe8)],'bin':_0x4ec725['bin'],'type':_0x4ec725[_0xdbcd86(0x138)],'floorlevel':_0x4ec725[_0xdbcd86(0x163)],'maxProducts':_0x4ec725[_0xdbcd86(0xdd)],'unit':_0x4ec725['standard_unit'],'secondary_unit':_0x4ec725[_0xdbcd86(0x149)],'expiry_date':_0x4ec725[_0xdbcd86(0x14e)],'maxPerUnit':_0x4ec725[_0xdbcd86(0xb2)],'batch_code':_0x4ec725[_0xdbcd86(0xa8)],'alertQTY':_0x4ec725[_0xdbcd86(0x17e)],'production_date':_0x4ec725[_0xdbcd86(0xca)],'product_cat':_0x4ec725['product_cat']}),_0x192061;});Promise[_0xc753c2(0x13f)](_0x286fd4)['then'](async _0x2866a2=>{var _0x5bb55b=_0xc753c2;try{for(const _0x4660ff of _0x2866a2){await _0x4660ff[_0x5bb55b(0x13d)]();}_0x27cb3a[_0x5bb55b(0x11c)](_0x5bb55b(0xdb),_0x5bb55b(0x12a)),_0x40a8d0[_0x5bb55b(0x100)](_0x5bb55b(0xe7));}catch(_0x379b24){console[_0x5bb55b(0x99)](_0x379b24),_0x40a8d0[_0x5bb55b(0xf6)](0x1f4)[_0x5bb55b(0x17a)]({'error':_0x5bb55b(0x186)});}})[_0xc753c2(0xc9)](_0x5457d4=>{var _0x27939a=_0xc753c2;console['error'](_0x5457d4),_0x40a8d0[_0x27939a(0xf6)](0x1f4)['json']({'error':_0x27939a(0xd6)});});}catch(_0x580913){console['log'](_0x580913);}}),router[a0_0x3d8737(0x166)](a0_0x3d8737(0xaa),auth,async(_0x36257f,_0x4b43d4)=>{var _0x43b300=a0_0x3d8737;try{const {username:_0x53837d,email:_0x531442,role:_0x47079f}=_0x36257f[_0x43b300(0xcb)],_0x155e8f=_0x36257f['user'],_0x4c0eb7=await profile[_0x43b300(0x105)]({'email':_0x155e8f['email']}),_0x5ca5f3=await master_shop['find'](),_0x420d12=_0x36257f[_0x43b300(0xa6)]['id'],_0x3b77e3=await purchases[_0x43b300(0x134)](_0x420d12),_0x43842b=await warehouse[_0x43b300(0x141)]([{'$match':{'name':_0x3b77e3[_0x43b300(0xbf)],'room':_0x3b77e3[_0x43b300(0x177)]}},{'$unwind':_0x43b300(0x13b)},{'$group':{'_id':_0x43b300(0x113),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x43b300(0x10a)},'type':{'$first':_0x43b300(0x12e)},'floorlevel':{'$first':_0x43b300(0x8f)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x43b300(0x13e)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x43b300(0x14a)},'rack':{'$first':_0x43b300(0xba)},'expiry_date':{'$first':'$product_details.expiry_date'}}}]),_0x361861=await customer[_0x43b300(0x171)]({});let _0x3f62f4;if(_0x155e8f[_0x43b300(0xf8)]==_0x43b300(0xf5)){const _0x82de8f=await staff[_0x43b300(0x105)]({'email':_0x155e8f[_0x43b300(0x130)]});_0x3f62f4=await warehouse[_0x43b300(0x141)]([{'$match':{'status':_0x43b300(0x9f),'name':_0x82de8f['warehouse']}},{'$group':{'_id':_0x43b300(0x187),'name':{'$first':_0x43b300(0x187)}}}]);}else _0x3f62f4=await warehouse['aggregate']([{'$match':{'status':_0x43b300(0x9f)}},{'$group':{'_id':_0x43b300(0x187),'name':{'$first':_0x43b300(0x187)}}}]);const _0x252d7d=await product[_0x43b300(0x171)]({}),_0x24264a=await suppliers[_0x43b300(0x171)]({}),_0x98188a=BayBinSelected(_0x3b77e3['warehouse_name'],_0x3b77e3[_0x43b300(0x177)]);if(_0x5ca5f3[0x0][_0x43b300(0x11b)]==_0x43b300(0xc5)){var _0x5251a3=users[_0x43b300(0xe1)];console['log'](_0x5251a3);}else{if(_0x5ca5f3[0x0][_0x43b300(0x11b)]=='Hindi')var _0x5251a3=users['Hindi'];else{if(_0x5ca5f3[0x0][_0x43b300(0x11b)]==_0x43b300(0x120))var _0x5251a3=users[_0x43b300(0x120)];else{if(_0x5ca5f3[0x0][_0x43b300(0x11b)]==_0x43b300(0x159))var _0x5251a3=users[_0x43b300(0x159)];else{if(_0x5ca5f3[0x0][_0x43b300(0x11b)]==_0x43b300(0x111))var _0x5251a3=users[_0x43b300(0x111)];else{if(_0x5ca5f3[0x0][_0x43b300(0x11b)]=='Portuguese\x20(BR)')var _0x5251a3=users[_0x43b300(0x125)];else{if(_0x5ca5f3[0x0]['language']==_0x43b300(0x176))var _0x5251a3=users[_0x43b300(0x176)];else{if(_0x5ca5f3[0x0][_0x43b300(0x11b)]==_0x43b300(0xac))var _0x5251a3=users[_0x43b300(0xb7)];}}}}}}}_0x4b43d4[_0x43b300(0x150)]('edit_purchases_view',{'success':_0x36257f[_0x43b300(0x11c)]('success'),'errors':_0x36257f[_0x43b300(0x11c)](_0x43b300(0x119)),'role':_0x155e8f,'profile':_0x4c0eb7,'customer':_0x361861,'warehouse':_0x3f62f4,'product':_0x43842b,'user':_0x3b77e3,'master_shop':_0x5ca5f3,'unit':_0x252d7d,'language':_0x5251a3,'suppliers':_0x24264a,'dataSelected':_0x98188a});}catch(_0x17cb1c){console[_0x43b300(0xe9)](_0x17cb1c);}}),router[a0_0x3d8737(0xd0)]('/preview/:id',auth,async(_0x556446,_0x2de9ea)=>{var _0xb5fb95=a0_0x3d8737;try{const _0xec677b=_0x556446[_0xb5fb95(0xa6)]['id'],{invoice:_0x47e05f,warehouse_name:_0x3e2502,Room_name:_0x3024ab}=_0x556446[_0xb5fb95(0x188)],_0x1ece2f=await warehouse['findOne']({'name':_0x3e2502,'room':_0x3024ab}),_0x4995d4=await purchases['findOne']({'invoice':_0x47e05f});_0x4995d4[_0xb5fb95(0x92)][_0xb5fb95(0x147)](_0x4cae92=>{var _0x444354=_0xb5fb95,_0x312025=0x0;const _0x81f9b=_0x1ece2f[_0x444354(0x94)][_0x444354(0xbb)](_0x37a397=>{var _0x1d4938=_0x444354;_0x37a397['product_name']==_0x4cae92['product_name']&&_0x37a397[_0x1d4938(0x163)]==_0x4cae92[_0x1d4938(0x163)]&&_0x37a397[_0x1d4938(0x138)]==_0x4cae92[_0x1d4938(0x138)]&&_0x37a397[_0x1d4938(0x185)]==_0x4cae92[_0x1d4938(0x185)]&&_0x37a397[_0x1d4938(0xe8)]==_0x4cae92[_0x1d4938(0xe8)]&&_0x37a397[_0x1d4938(0x122)]==_0x4cae92[_0x1d4938(0x122)]&&_0x37a397[_0x1d4938(0x108)]==_0x4cae92['storage']&&_0x37a397[_0x1d4938(0x14e)]==_0x4cae92['expiry_date']&&_0x37a397[_0x1d4938(0xa8)]==_0x4cae92[_0x1d4938(0xa8)]&&_0x37a397['production_date']==_0x4cae92['production_date']&&_0x37a397[_0x1d4938(0x175)]==_0x4cae92[_0x1d4938(0x175)]&&_0x37a397[_0x1d4938(0x109)]==_0x4cae92[_0x1d4938(0x109)]&&(_0x37a397[_0x1d4938(0x8c)]=parseInt(_0x37a397['product_stock'])+parseInt(_0x4cae92[_0x1d4938(0xeb)]),_0x312025++);});_0x312025=='0'&&(_0x1ece2f[_0x444354(0x94)]=_0x1ece2f[_0x444354(0x94)]['concat']({'product_name':_0x4cae92[_0x444354(0x124)],'product_stock':_0x4cae92[_0x444354(0xeb)],'primary_code':_0x4cae92[_0x444354(0x110)],'secondary_code':_0x4cae92[_0x444354(0xd4)],'product_code':_0x4cae92[_0x444354(0xda)],'storage':_0x4cae92[_0x444354(0x108)],'rack':_0x4cae92[_0x444354(0x122)],'bay':_0x4cae92[_0x444354(0xe8)],'bin':_0x4cae92[_0x444354(0x185)],'type':_0x4cae92[_0x444354(0x138)],'floorlevel':_0x4cae92[_0x444354(0x163)],'maxProducts':_0x4cae92['maxStocks'],'unit':_0x4cae92[_0x444354(0x145)],'secondary_unit':_0x4cae92[_0x444354(0x149)],'expiry_date':_0x4cae92[_0x444354(0x14e)],'maxPerUnit':_0x4cae92[_0x444354(0xb2)],'batch_code':_0x4cae92[_0x444354(0xa8)],'alertQTY':_0x4cae92[_0x444354(0x17e)],'production_date':_0x4cae92[_0x444354(0xca)],'delivery_date':_0x4cae92[_0x444354(0x175)],'delivery_code':_0x4cae92[_0x444354(0x109)]}));}),await _0x1ece2f['save'](),_0x4995d4['finalize']=_0xb5fb95(0x15c);const _0x499ee7=await _0x4995d4['save']();_0x556446['flash']('success','Sales\x20Update\x20successfully'),_0x2de9ea[_0xb5fb95(0x100)](_0xb5fb95(0x15f));}catch(_0xf4f3a8){console[_0xb5fb95(0xe9)](_0xf4f3a8);}}),router[a0_0x3d8737(0x166)](a0_0x3d8737(0xb6),auth,async(_0x3ba250,_0x4b521f)=>{var _0x556fa0=a0_0x3d8737;try{const {username:_0x1f1a50,email:_0x27648b,role:_0x3bc3e9}=_0x3ba250[_0x556fa0(0xcb)],_0x5b42d5=_0x3ba250[_0x556fa0(0xcb)],_0x867d88=await profile[_0x556fa0(0x105)]({'email':_0x5b42d5['email']}),_0x37385f=await master_shop['find'](),_0x57ed04=_0x3ba250[_0x556fa0(0xa6)]['id'],_0x138476=await purchases[_0x556fa0(0x134)](_0x57ed04),_0x512c44=await suppliers[_0x556fa0(0x171)]({});let _0x2aca1c;if(_0x5b42d5[_0x556fa0(0xf8)]==_0x556fa0(0xf5)){const _0x7efbc1=await staff[_0x556fa0(0x105)]({'email':_0x5b42d5[_0x556fa0(0x130)]});_0x2aca1c=await warehouse[_0x556fa0(0x171)]({'status':'Enabled','name':_0x7efbc1['warehouse'],'warehouse_category':_0x556fa0(0xf3)});}else _0x2aca1c=await warehouse[_0x556fa0(0x141)]([{'$match':{'status':_0x556fa0(0x9f),'warehouse_category':_0x556fa0(0xf3)}},{'$group':{'_id':_0x556fa0(0x187),'name':{'$first':_0x556fa0(0x187)}}}]);const _0x4392eb=await product[_0x556fa0(0x171)]({}),_0x5a0488=BayBinSelected(_0x138476[_0x556fa0(0xbf)],_0x138476[_0x556fa0(0x177)]);let _0x18b246=new Date(_0x138476[_0x556fa0(0x14e)]),_0x3f19e1=('0'+_0x18b246['getDate']())[_0x556fa0(0x167)](-0x2),_0x19a082=('0'+(_0x18b246['getMonth']()+0x1))[_0x556fa0(0x167)](-0x2),_0x106493=_0x18b246[_0x556fa0(0x14c)](),_0x3df36e=_0x106493+'-'+_0x19a082+'-'+_0x3f19e1;if(_0x37385f[0x0]['language']==_0x556fa0(0xc5)){var _0xc37208=users[_0x556fa0(0xe1)];console[_0x556fa0(0xe9)](_0xc37208);}else{if(_0x37385f[0x0][_0x556fa0(0x11b)]==_0x556fa0(0xcd))var _0xc37208=users[_0x556fa0(0xcd)];else{if(_0x37385f[0x0][_0x556fa0(0x11b)]==_0x556fa0(0x120))var _0xc37208=users['German'];else{if(_0x37385f[0x0]['language']==_0x556fa0(0x159))var _0xc37208=users['Spanish'];else{if(_0x37385f[0x0][_0x556fa0(0x11b)]==_0x556fa0(0x111))var _0xc37208=users[_0x556fa0(0x111)];else{if(_0x37385f[0x0]['language']=='Portuguese\x20(BR)')var _0xc37208=users[_0x556fa0(0x125)];else{if(_0x37385f[0x0][_0x556fa0(0x11b)]==_0x556fa0(0x176))var _0xc37208=users[_0x556fa0(0x176)];else{if(_0x37385f[0x0]['language']==_0x556fa0(0xac))var _0xc37208=users[_0x556fa0(0xb7)];}}}}}}}_0x4b521f[_0x556fa0(0x150)]('edit_purchases',{'success':_0x3ba250[_0x556fa0(0x11c)](_0x556fa0(0xdb)),'errors':_0x3ba250['flash'](_0x556fa0(0x119)),'role':_0x5b42d5,'profile':_0x867d88,'purchases':_0x138476,'suppliers':_0x512c44,'warehouse':_0x2aca1c,'product':_0x4392eb,'master_shop':_0x37385f,'language':_0xc37208,'ed_fullDate':_0x3df36e,'dataSelected':_0x5a0488});}catch(_0x5c51e9){console['log'](_0x5c51e9);}}),router[a0_0x3d8737(0xd0)](a0_0x3d8737(0xb6),auth,async(_0x11f56b,_0x49cd23)=>{var _0x34a63d=a0_0x3d8737;try{const _0x141583=_0x11f56b[_0x34a63d(0xa6)]['id'],_0x3ac549=await purchases[_0x34a63d(0x105)]({'_id':_0x11f56b[_0x34a63d(0xa6)]['id']}),_0x470cee=await warehouse[_0x34a63d(0x105)]({'name':_0x3ac549[_0x34a63d(0xbf)],'room':_0x3ac549[_0x34a63d(0x177)]});_0x3ac549['product'][_0x34a63d(0x147)](_0x5a81e0=>{var _0x23ec74=_0x34a63d;const _0xc97232=_0x470cee[_0x23ec74(0x94)][_0x23ec74(0xbb)](_0x3600d8=>{var _0x336092=_0x23ec74;_0x3600d8[_0x336092(0x124)]==_0x5a81e0['product_name']&&_0x3600d8[_0x336092(0x163)]==_0x5a81e0[_0x336092(0x163)]&&_0x3600d8[_0x336092(0x138)]==_0x5a81e0[_0x336092(0x138)]&&_0x3600d8[_0x336092(0x185)]==_0x5a81e0['bin']&&_0x3600d8[_0x336092(0xe8)]==_0x5a81e0[_0x336092(0xe8)]&&_0x3600d8['rack']==_0x5a81e0[_0x336092(0x122)]&&_0x3600d8[_0x336092(0x108)]==_0x5a81e0['storage']&&(_0x3600d8['product_stock']=parseInt(_0x3600d8[_0x336092(0x8c)])-parseInt(_0x5a81e0[_0x336092(0xeb)]));});}),await _0x470cee[_0x34a63d(0x13d)]();const {invoice:_0x13316f,suppliers:_0xf9cad3,date:_0x43c26d,warehouse_name:_0x343fa0,prod_name:_0x28ab6b,prod_code:_0x53febc,prod_qty:_0x5c1503,prod_unit:_0x84a27b,prod_secondunit:_0x45820c,prod_level:_0x1930d9,prod_isle:_0x4a4664,prod_pallet:_0x42ad2d,note:_0x1cab5f,expiry_date:_0x4fb58c,batch_code:_0x4eb9f7,paid_amount:_0x149fd5,due_amount:_0x1f9b0f,Room_name:_0x452e73,primary_code:_0xcaef32,secondary_code:_0x570b40,PO_number:_0x428b8c,JO_number:_0x4306f1}=_0x11f56b[_0x34a63d(0x188)];if(typeof _0x28ab6b==_0x34a63d(0xe3))var _0x4b6c19=[_0x11f56b['body']['prod_name']],_0x296133=[_0x11f56b[_0x34a63d(0x188)][_0x34a63d(0x9a)]],_0x12d60a=[_0x11f56b[_0x34a63d(0x188)][_0x34a63d(0xfc)]],_0x6cb892=[_0x11f56b['body'][_0x34a63d(0x16e)]],_0x350c8a=[_0x11f56b[_0x34a63d(0x188)][_0x34a63d(0x114)]],_0x242183=[_0x11f56b['body']['prod_level']],_0x173979=[_0x11f56b[_0x34a63d(0x188)][_0x34a63d(0x129)]],_0x265760=[_0x11f56b[_0x34a63d(0x188)]['prod_pallet']],_0x188449=[_0x11f56b[_0x34a63d(0x188)][_0x34a63d(0x110)]],_0x13dcf8=[_0x11f56b[_0x34a63d(0x188)]['secondary_code']],_0x52aa20=[_0x11f56b[_0x34a63d(0x188)][_0x34a63d(0xe2)]],_0x2ff196=[_0x11f56b[_0x34a63d(0x188)][_0x34a63d(0xa8)]],_0x217912=[_0x11f56b['body'][_0x34a63d(0x14e)]],_0x23915a=[_0x11f56b[_0x34a63d(0x188)][_0x34a63d(0x108)]],_0x5b1276=[_0x11f56b[_0x34a63d(0x188)]['rak']],_0x5e3f19=[_0x11f56b[_0x34a63d(0x188)][_0x34a63d(0x138)]];else var _0x4b6c19=[..._0x11f56b[_0x34a63d(0x188)]['prod_name']],_0x296133=[..._0x11f56b['body'][_0x34a63d(0x9a)]],_0x12d60a=[..._0x11f56b[_0x34a63d(0x188)][_0x34a63d(0xfc)]],_0x6cb892=[..._0x11f56b[_0x34a63d(0x188)][_0x34a63d(0x16e)]],_0x350c8a=[..._0x11f56b[_0x34a63d(0x188)][_0x34a63d(0x114)]],_0x242183=[..._0x11f56b[_0x34a63d(0x188)][_0x34a63d(0x148)]],_0x173979=[..._0x11f56b['body'][_0x34a63d(0x129)]],_0x265760=[..._0x11f56b[_0x34a63d(0x188)][_0x34a63d(0xc3)]],_0x188449=[..._0x11f56b[_0x34a63d(0x188)]['primary_code']],_0x13dcf8=[..._0x11f56b[_0x34a63d(0x188)]['secondary_code']],_0x52aa20=[..._0x11f56b['body'][_0x34a63d(0xe2)]],_0x2ff196=[..._0x11f56b[_0x34a63d(0x188)][_0x34a63d(0xa8)]],_0x217912=[..._0x11f56b[_0x34a63d(0x188)]['expiry_date']],_0x23915a=[..._0x11f56b[_0x34a63d(0x188)]['storage']],_0x5b1276=[..._0x11f56b[_0x34a63d(0x188)][_0x34a63d(0x173)]],_0x5e3f19=[..._0x11f56b[_0x34a63d(0x188)][_0x34a63d(0x138)]];const _0x37aba2=_0x4b6c19[_0x34a63d(0xbb)](_0x5a8a50=>{return _0x5a8a50={'product_name':_0x5a8a50};});_0x296133[_0x34a63d(0x147)]((_0x429114,_0x4e1d88)=>{_0x37aba2[_0x4e1d88]['product_code']=_0x429114;}),_0x12d60a[_0x34a63d(0x147)]((_0x1dcd10,_0x33d71d)=>{var _0x256ee6=_0x34a63d;_0x37aba2[_0x33d71d][_0x256ee6(0xeb)]=_0x1dcd10;}),_0x6cb892['forEach']((_0x501310,_0x293a1b)=>{var _0xf5747a=_0x34a63d;_0x37aba2[_0x293a1b][_0xf5747a(0x145)]=_0x501310;}),_0x350c8a[_0x34a63d(0x147)]((_0x276eb3,_0x3766b6)=>{var _0x4d5d42=_0x34a63d;_0x37aba2[_0x3766b6][_0x4d5d42(0x149)]=_0x276eb3;}),_0x242183[_0x34a63d(0x147)]((_0xba5575,_0x254cb3)=>{var _0x425038=_0x34a63d;_0x37aba2[_0x254cb3][_0x425038(0xe8)]=_0xba5575;}),_0x173979[_0x34a63d(0x147)]((_0x296800,_0x598f37)=>{var _0x3bcabf=_0x34a63d;_0x37aba2[_0x598f37][_0x3bcabf(0x185)]=_0x296800;}),_0x265760['forEach']((_0x50d990,_0x27e29b)=>{var _0x4a4c48=_0x34a63d;_0x37aba2[_0x27e29b][_0x4a4c48(0x163)]=_0x50d990;}),_0x188449[_0x34a63d(0x147)]((_0x443c60,_0x189ba7)=>{var _0x4f1645=_0x34a63d;_0x37aba2[_0x189ba7][_0x4f1645(0x110)]=_0x443c60;}),_0x13dcf8[_0x34a63d(0x147)]((_0x2478d3,_0x4c6396)=>{var _0x3915bb=_0x34a63d;_0x37aba2[_0x4c6396][_0x3915bb(0xd4)]=_0x2478d3;}),_0x52aa20['forEach']((_0x23b517,_0xa19479)=>{_0x37aba2[_0xa19479]['maxStocks']=_0x23b517;}),_0x2ff196[_0x34a63d(0x147)]((_0x32577f,_0xa9b0d8)=>{var _0x362c15=_0x34a63d;_0x37aba2[_0xa9b0d8][_0x362c15(0xa8)]=_0x32577f;}),_0x217912[_0x34a63d(0x147)]((_0x7b184c,_0x489eba)=>{var _0x289720=_0x34a63d;_0x37aba2[_0x489eba][_0x289720(0x14e)]=_0x7b184c;}),_0x5e3f19[_0x34a63d(0x147)]((_0x5824a3,_0x112a48)=>{var _0x1d89a8=_0x34a63d;_0x37aba2[_0x112a48][_0x1d89a8(0x138)]=_0x5824a3;}),_0x23915a[_0x34a63d(0x147)]((_0x17b024,_0x51f7c7)=>{_0x37aba2[_0x51f7c7]['storage']=_0x17b024;}),_0x5b1276[_0x34a63d(0x147)]((_0xf41d43,_0x3246b8)=>{var _0x43cbf7=_0x34a63d;_0x37aba2[_0x3246b8][_0x43cbf7(0x122)]=_0xf41d43;});const _0x440a66=_0x37aba2[_0x34a63d(0xe0)](_0xa69fd7=>_0xa69fd7[_0x34a63d(0xeb)]!=='0'&&_0xa69fd7[_0x34a63d(0xeb)]!=='');_0x3ac549[_0x34a63d(0x96)]=_0x13316f,_0x3ac549[_0x34a63d(0x11d)]=_0xf9cad3,_0x3ac549[_0x34a63d(0xfd)]=_0x43c26d,_0x3ac549[_0x34a63d(0xbf)]=_0x343fa0,_0x3ac549[_0x34a63d(0x92)]=_0x440a66,_0x3ac549[_0x34a63d(0x161)]=_0x1cab5f,_0x3ac549[_0x34a63d(0x18a)]=_0x149fd5,_0x3ac549[_0x34a63d(0xfa)]=_0x1f9b0f,_0x3ac549[_0x34a63d(0x177)]=_0x452e73,_0x3ac549['POnumber']=_0x428b8c,_0x3ac549[_0x34a63d(0x156)]=_0x4306f1;const _0x424597=await _0x3ac549[_0x34a63d(0x13d)](),_0x1e287c=await warehouse[_0x34a63d(0x105)]({'name':_0x11f56b['body'][_0x34a63d(0xbf)],'room':_0x11f56b[_0x34a63d(0x188)][_0x34a63d(0xe5)]});_0x3ac549[_0x34a63d(0x92)][_0x34a63d(0x147)](_0x37f4b1=>{var _0x2715ee=_0x34a63d,_0x588833=0x0;const _0x711a91=_0x1e287c[_0x2715ee(0x94)]['map'](_0x32449d=>{var _0xa52109=_0x2715ee;_0x32449d[_0xa52109(0x124)]==_0x37f4b1['product_name']&&_0x32449d['floorlevel']==_0x37f4b1['floorlevel']&&_0x32449d[_0xa52109(0x138)]==_0x37f4b1[_0xa52109(0x138)]&&_0x32449d[_0xa52109(0x185)]==_0x37f4b1[_0xa52109(0x185)]&&_0x32449d[_0xa52109(0xe8)]==_0x37f4b1[_0xa52109(0xe8)]&&_0x32449d[_0xa52109(0x122)]==_0x37f4b1[_0xa52109(0x122)]&&_0x32449d[_0xa52109(0x108)]==_0x37f4b1[_0xa52109(0x108)]&&(_0x32449d[_0xa52109(0x8c)]=parseInt(_0x32449d[_0xa52109(0x8c)])+parseInt(_0x37f4b1[_0xa52109(0xeb)]),_0x588833++);});_0x588833=='0'&&(_0x1e287c[_0x2715ee(0x94)]=_0x1e287c[_0x2715ee(0x94)][_0x2715ee(0x15e)]({'product_name':_0x37f4b1[_0x2715ee(0x124)],'product_stock':_0x37f4b1['quantity'],'primary_code':_0x37f4b1[_0x2715ee(0x110)],'secondary_code':_0x37f4b1[_0x2715ee(0xd4)],'product_code':_0x37f4b1[_0x2715ee(0xda)],'storage':_0x37f4b1['storage'],'rack':_0x37f4b1[_0x2715ee(0x122)],'bay':_0x37f4b1[_0x2715ee(0xe8)],'bin':_0x37f4b1[_0x2715ee(0x185)],'type':_0x37f4b1[_0x2715ee(0x138)],'floorlevel':_0x37f4b1[_0x2715ee(0x163)],'maxProducts':_0x37f4b1['maxStocks'],'unit':_0x37f4b1['standard_unit'],'secondary_unit':_0x37f4b1[_0x2715ee(0x149)],'expiry_date':_0x37f4b1[_0x2715ee(0x14e)]}));}),await _0x1e287c[_0x34a63d(0x13d)]();const _0x409dad=await s_payment_data['findOne']({'invoice':_0x11f56b['body'][_0x34a63d(0x96)]});if(_0x409dad===null){}else console[_0x34a63d(0xe9)](_0x34a63d(0x11d),_0x409dad,_0x11f56b['body'][_0x34a63d(0x96)]),_0x409dad[_0x34a63d(0x11d)]=_0x11f56b[_0x34a63d(0x188)][_0x34a63d(0x11d)],await _0x409dad[_0x34a63d(0x13d)]();_0x11f56b[_0x34a63d(0x11c)]('success',_0x34a63d(0x128)),_0x49cd23[_0x34a63d(0x100)](_0x34a63d(0x15f));}catch(_0x2d6041){console['log'](_0x2d6041);}}),router[a0_0x3d8737(0xd0)]('/give_payment/:id',auth,async(_0x42676f,_0x3620ae)=>{var _0x35184e=a0_0x3d8737;try{const _0x542b34=_0x42676f[_0x35184e(0xa6)]['id'],{invoice:_0x5d508a,suppliers:_0x54f486,payable:_0x291d7c,due_amount:_0x48bc97}=_0x42676f[_0x35184e(0x188)],_0x3e3ab8=await purchases['findById'](_0x542b34);var _0x2b870b=_0x291d7c-_0x48bc97;_0x3e3ab8[_0x35184e(0x18a)]=parseFloat(_0x3e3ab8[_0x35184e(0x18a)])+parseFloat(_0x48bc97),_0x3e3ab8['due_amount']=_0x2b870b;const _0x390b70=await _0x3e3ab8[_0x35184e(0x13d)]();console[_0x35184e(0xe9)](_0x390b70);const _0x35685c=await s_payment_data[_0x35184e(0x105)]({'invoice':_0x5d508a});_0x35685c[_0x35184e(0xb1)]=_0x2b870b,await _0x35685c[_0x35184e(0x13d)]();let _0x49691b=new Date(),_0xb2e9bb=('0'+_0x49691b[_0x35184e(0xa9)]())['slice'](-0x2),_0x35b70e=('0'+(_0x49691b[_0x35184e(0x133)]()+0x1))[_0x35184e(0x167)](-0x2),_0x11d49b=_0x49691b[_0x35184e(0x14c)](),_0x17b6fe=_0x11d49b+'-'+_0x35b70e+'-'+_0xb2e9bb;const _0x273a61=new suppliers_payment({'invoice':_0x5d508a,'date':_0x11d49b+'-'+_0x35b70e+'-'+_0xb2e9bb,'suppliers':_0x54f486,'reason':_0x35184e(0x90),'amount':_0x48bc97}),_0xefb355=await _0x273a61[_0x35184e(0x13d)]();_0x42676f[_0x35184e(0x11c)](_0x35184e(0xdb),_0x35184e(0x10f)),_0x3620ae[_0x35184e(0x100)](_0x35184e(0x15f));}catch(_0x1e2b66){console[_0x35184e(0xe9)](_0x1e2b66);}}),router[a0_0x3d8737(0x166)](a0_0x3d8737(0xf7),auth,async(_0x319f0b,_0x440e43)=>{var _0x7538c1=a0_0x3d8737;try{const {username:_0x5663ca,email:_0x25ae94,role:_0x310a41}=_0x319f0b[_0x7538c1(0xcb)],_0x2300f5=_0x319f0b[_0x7538c1(0xcb)],_0x5c0c4e=await profile[_0x7538c1(0x105)]({'email':_0x2300f5[_0x7538c1(0x130)]}),_0x348d93=await master_shop[_0x7538c1(0x171)]();console[_0x7538c1(0xe9)](_0x7538c1(0xa5),_0x348d93);const _0x4c1d59=_0x319f0b[_0x7538c1(0xa6)]['id'],_0x26f7cd=await purchases['findById'](_0x4c1d59);console[_0x7538c1(0xe9)](_0x26f7cd);const _0xe94967=await suppliers[_0x7538c1(0x105)]({'name':_0x26f7cd[_0x7538c1(0x11d)]});console[_0x7538c1(0xe9)](_0xe94967);if(_0x348d93[0x0]['language']=='English\x20(US)'){var _0x525e70=users[_0x7538c1(0xe1)];console[_0x7538c1(0xe9)](_0x525e70);}else{if(_0x348d93[0x0]['language']==_0x7538c1(0xcd))var _0x525e70=users[_0x7538c1(0xcd)];else{if(_0x348d93[0x0]['language']=='German')var _0x525e70=users['German'];else{if(_0x348d93[0x0][_0x7538c1(0x11b)]==_0x7538c1(0x159))var _0x525e70=users[_0x7538c1(0x159)];else{if(_0x348d93[0x0]['language']==_0x7538c1(0x111))var _0x525e70=users[_0x7538c1(0x111)];else{if(_0x348d93[0x0][_0x7538c1(0x11b)]==_0x7538c1(0x18b))var _0x525e70=users['Portuguese'];else{if(_0x348d93[0x0][_0x7538c1(0x11b)]=='Chinese')var _0x525e70=users[_0x7538c1(0x176)];else{if(_0x348d93[0x0]['language']==_0x7538c1(0xac))var _0x525e70=users[_0x7538c1(0xb7)];}}}}}}}_0x440e43[_0x7538c1(0x150)](_0x7538c1(0xdc),{'success':_0x319f0b[_0x7538c1(0x11c)](_0x7538c1(0xdb)),'errors':_0x319f0b['flash'](_0x7538c1(0x119)),'role':_0x2300f5,'profile':_0x5c0c4e,'master_shop':_0x348d93,'supplier':_0xe94967,'purchase':_0x26f7cd,'language':_0x525e70});}catch(_0x4f2314){console[_0x7538c1(0xe9)](_0x4f2314);}}),router[a0_0x3d8737(0x166)]('/view/return_purchase/:id',auth,async(_0x4e8e70,_0x102dd0)=>{var _0x34cd68=a0_0x3d8737;try{const {username:_0x134553,email:_0x90c598,role:_0x6e5b4a}=_0x4e8e70[_0x34cd68(0xcb)],_0x198a2b=_0x4e8e70[_0x34cd68(0xcb)],_0x5ce510=await profile[_0x34cd68(0x105)]({'email':_0x198a2b['email']}),_0x30873c=await master_shop[_0x34cd68(0x171)]();console[_0x34cd68(0xe9)](_0x34cd68(0xa5),_0x30873c);const _0x256086=_0x4e8e70[_0x34cd68(0xa6)]['id'];console['log'](_0x256086);const _0x2a4f78=await purchases[_0x34cd68(0x134)](_0x256086);console['log']('user_id',_0x2a4f78);const _0x28209e=await product[_0x34cd68(0x171)]({}),_0x14a2bb=await warehouse[_0x34cd68(0x141)]([{'$match':{'name':_0x2a4f78['warehouse_name'],'room':_0x2a4f78[_0x34cd68(0x177)],'warehouse_category':_0x34cd68(0xf3)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x34cd68(0x113),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x34cd68(0x9e)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x34cd68(0x10a)},'type':{'$first':_0x34cd68(0x12e)},'floorlevel':{'$first':_0x34cd68(0x8f)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x34cd68(0x13e)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x34cd68(0x14a)},'rack':{'$first':_0x34cd68(0xba)}}}]);warehouse_data=await warehouse[_0x34cd68(0x141)]([{'$match':{'status':'Enabled','name':'Return\x20Goods','warehouse_category':_0x34cd68(0xf3)}},{'$group':{'_id':_0x34cd68(0x187),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]),console[_0x34cd68(0xe9)]('stock_data',_0x14a2bb);if(_0x30873c[0x0][_0x34cd68(0x11b)]==_0x34cd68(0xc5)){var _0x2c0699=users['English'];console[_0x34cd68(0xe9)](_0x2c0699);}else{if(_0x30873c[0x0][_0x34cd68(0x11b)]==_0x34cd68(0xcd))var _0x2c0699=users[_0x34cd68(0xcd)];else{if(_0x30873c[0x0]['language']=='German')var _0x2c0699=users[_0x34cd68(0x120)];else{if(_0x30873c[0x0][_0x34cd68(0x11b)]==_0x34cd68(0x159))var _0x2c0699=users[_0x34cd68(0x159)];else{if(_0x30873c[0x0][_0x34cd68(0x11b)]==_0x34cd68(0x111))var _0x2c0699=users[_0x34cd68(0x111)];else{if(_0x30873c[0x0][_0x34cd68(0x11b)]==_0x34cd68(0x18b))var _0x2c0699=users[_0x34cd68(0x125)];else{if(_0x30873c[0x0][_0x34cd68(0x11b)]=='Chinese')var _0x2c0699=users[_0x34cd68(0x176)];else{if(_0x30873c[0x0][_0x34cd68(0x11b)]=='Arabic\x20(ae)')var _0x2c0699=users['Arabic'];}}}}}}}_0x102dd0['render'](_0x34cd68(0x179),{'success':_0x4e8e70['flash'](_0x34cd68(0xdb)),'errors':_0x4e8e70[_0x34cd68(0x11c)](_0x34cd68(0x119)),'role':_0x198a2b,'profile':_0x5ce510,'user':_0x2a4f78,'stock':_0x14a2bb,'master_shop':_0x30873c,'product':_0x28209e,'language':_0x2c0699,'warehouse':warehouse_data});}catch(_0x18f267){console[_0x34cd68(0xe9)](_0x18f267);}}),router[a0_0x3d8737(0xd0)](a0_0x3d8737(0x123),auth,async(_0x440218,_0xdde89d)=>{var _0x4fe089=a0_0x3d8737;try{const {invoice:_0x494436,date:_0x4873ec,warehouse_name:_0x453adf,Room_name:_0x2bdfc3,product_name:_0x2a976d,purchase_quantity:_0xabd4dc,stocks:_0x1ce3d6,return_qty:_0x4af86a,note:_0xa2a13c,level:_0x62b0bb,isle:_0x5366db,pallet:_0xb92a34,to_warehouse_name:_0x348f76,to_Room_name:_0x4a825e}=_0x440218[_0x4fe089(0x188)],_0x42557b=await purchases[_0x4fe089(0x105)]({'_id':_0x440218[_0x4fe089(0xa6)]['id']}),_0x464a94=await warehouse['findOne']({'name':_0x453adf,'room':_0x2bdfc3});if(typeof _0x2a976d=='string')var _0x107b12=[_0x440218['body'][_0x4fe089(0x124)]],_0x4da332=[_0x440218[_0x4fe089(0x188)][_0x4fe089(0xa2)]],_0x1f5c5f=[_0x440218[_0x4fe089(0x188)][_0x4fe089(0x136)]],_0x5afe87=[_0x440218[_0x4fe089(0x188)][_0x4fe089(0xfb)]],_0xedd7e=[_0x440218[_0x4fe089(0x188)][_0x4fe089(0x131)]],_0xef60b7=[_0x440218['body'][_0x4fe089(0x153)]],_0x56114a=[_0x440218[_0x4fe089(0x188)][_0x4fe089(0xce)]],_0x9198cb=[_0x440218[_0x4fe089(0x188)][_0x4fe089(0x16a)]],_0x1d7084=[_0x440218[_0x4fe089(0x188)][_0x4fe089(0x116)]],_0xb90d46=[_0x440218['body']['primary_code_hide']],_0x4206d3=[_0x440218[_0x4fe089(0x188)]['secondary_code_hide']];else var _0x107b12=[..._0x440218[_0x4fe089(0x188)][_0x4fe089(0x124)]],_0x4da332=[..._0x440218[_0x4fe089(0x188)][_0x4fe089(0xa2)]],_0x1f5c5f=[..._0x440218[_0x4fe089(0x188)]['stocks']],_0x5afe87=[..._0x440218[_0x4fe089(0x188)][_0x4fe089(0xfb)]],_0xedd7e=[..._0x440218['body'][_0x4fe089(0x131)]],_0xef60b7=[..._0x440218[_0x4fe089(0x188)][_0x4fe089(0x153)]],_0x56114a=[..._0x440218['body'][_0x4fe089(0xce)]],_0x9198cb=[..._0x440218[_0x4fe089(0x188)]['types']],_0x1d7084=[..._0x440218[_0x4fe089(0x188)][_0x4fe089(0x116)]],_0xb90d46=[..._0x440218[_0x4fe089(0x188)]['primary_code_hide']],_0x4206d3=[..._0x440218[_0x4fe089(0x188)]['secondary_code_hide']];const _0x58d19d=_0x107b12[_0x4fe089(0xbb)](_0x2d0b85=>{return _0x2d0b85={'product_name':_0x2d0b85};});_0x4da332[_0x4fe089(0x147)]((_0x562468,_0x8fa6f4)=>{var _0x413985=_0x4fe089;_0x58d19d[_0x8fa6f4][_0x413985(0xa2)]=_0x562468;}),_0x1f5c5f[_0x4fe089(0x147)]((_0x40891b,_0x52de4c)=>{var _0x3eb334=_0x4fe089;_0x58d19d[_0x52de4c][_0x3eb334(0xd8)]=_0x40891b;}),_0x5afe87[_0x4fe089(0x147)]((_0x389e79,_0x2e9669)=>{var _0xfa2832=_0x4fe089;_0x58d19d[_0x2e9669][_0xfa2832(0xfb)]=_0x389e79;}),_0xedd7e[_0x4fe089(0x147)]((_0x43cb7f,_0xfdc432)=>{var _0x53c706=_0x4fe089;_0x58d19d[_0xfdc432][_0x53c706(0xe8)]=_0x43cb7f;}),_0xef60b7[_0x4fe089(0x147)]((_0x2dade9,_0x347708)=>{var _0x194fad=_0x4fe089;_0x58d19d[_0x347708][_0x194fad(0x185)]=_0x2dade9;}),_0x56114a[_0x4fe089(0x147)]((_0x18a156,_0x36e13a)=>{var _0x2f9d43=_0x4fe089;_0x58d19d[_0x36e13a][_0x2f9d43(0x163)]=_0x18a156;}),_0x9198cb[_0x4fe089(0x147)]((_0x756d38,_0x163ece)=>{var _0x4d6f72=_0x4fe089;_0x58d19d[_0x163ece][_0x4d6f72(0x138)]=_0x756d38;}),_0x1d7084[_0x4fe089(0x147)]((_0x81a7d7,_0xd064ae)=>{_0x58d19d[_0xd064ae]['product_code']=_0x81a7d7;}),_0xb90d46[_0x4fe089(0x147)]((_0x4b1d7d,_0x476c77)=>{var _0x3e097d=_0x4fe089;_0x58d19d[_0x476c77][_0x3e097d(0x110)]=_0x4b1d7d;}),_0x4206d3[_0x4fe089(0x147)]((_0x39e55b,_0x296591)=>{var _0x3cf503=_0x4fe089;_0x58d19d[_0x296591][_0x3cf503(0xd4)]=_0x39e55b;}),_0x42557b[_0x4fe089(0x92)][_0x4fe089(0x147)](_0x4d4ec4=>{var _0x57a86e=_0x4fe089;const _0xdd045d=_0x464a94[_0x57a86e(0x94)]['map'](_0x352efc=>{var _0x3cf01a=_0x57a86e;_0x352efc[_0x3cf01a(0x124)]==_0x4d4ec4['product_name']&&_0x352efc[_0x3cf01a(0x163)]==_0x4d4ec4[_0x3cf01a(0x163)]&&_0x352efc['type']==_0x4d4ec4[_0x3cf01a(0x138)]&&_0x352efc[_0x3cf01a(0x185)]==_0x4d4ec4[_0x3cf01a(0x185)]&&_0x352efc[_0x3cf01a(0xe8)]==_0x4d4ec4[_0x3cf01a(0xe8)]&&_0x352efc[_0x3cf01a(0x122)]==_0x4d4ec4[_0x3cf01a(0x122)]&&_0x352efc['storage']==_0x4d4ec4[_0x3cf01a(0x108)]&&(console[_0x3cf01a(0xe9)](parseInt(_0x352efc[_0x3cf01a(0x8c)])+_0x3cf01a(0x15a)+parseInt(_0x4d4ec4[_0x3cf01a(0xeb)])),_0x352efc['product_stock']=parseInt(_0x352efc[_0x3cf01a(0x8c)])+parseInt(_0x4d4ec4[_0x3cf01a(0xeb)]));});}),await _0x464a94[_0x4fe089(0x13d)]();const _0x220d25=_0x58d19d['filter'](_0x4ae4bf=>_0x4ae4bf[_0x4fe089(0xfb)]!=='0'&&_0x4ae4bf['return_qty']!=='');var _0x3f898a=0x0;_0x220d25[_0x4fe089(0x147)](_0x201a1a=>{var _0x247631=_0x4fe089;console[_0x247631(0xe9)](_0x247631(0x16c),_0x201a1a),(parseInt(_0x201a1a[_0x247631(0xa2)])<parseInt(_0x201a1a[_0x247631(0xfb)])||parseInt(_0x201a1a['stock_quantity'])<parseInt(_0x201a1a[_0x247631(0xfb)]))&&_0x3f898a++;});if(_0x3f898a!=0x0)return _0x440218[_0x4fe089(0x11c)](_0x4fe089(0x119),_0x4fe089(0xc1)),_0xdde89d[_0x4fe089(0x100)](_0x4fe089(0xaf));const _0x2051d0=new purchases_return({'invoice':_0x494436,'suppliers':_0x440218[_0x4fe089(0x188)][_0x4fe089(0x11d)],'date':_0x4873ec,'warehouse_name':_0x453adf,'return_product':_0x220d25,'note':_0xa2a13c,'room':_0x2bdfc3,'to_warehouse_name':_0x348f76,'to_room':_0x4a825e}),_0x32eca9=await _0x2051d0[_0x4fe089(0x13d)]();console[_0x4fe089(0xe9)](_0x2051d0);const _0x416404=await purchases_return['findOne']({'invoice':_0x494436}),_0x31015c=await warehouse[_0x4fe089(0x105)]({'name':_0x348f76,'room':_0x4a825e});_0x416404[_0x4fe089(0xf4)][_0x4fe089(0x147)](_0x12b76b=>{var _0x3d5006=_0x4fe089,_0x26cb15=0x0;const _0x3ca01b=_0x31015c[_0x3d5006(0x94)][_0x3d5006(0xbb)](_0x1fc749=>{var _0x4fa457=_0x3d5006;_0x1fc749['product_name']==_0x12b76b['product_name']&&_0x1fc749[_0x4fa457(0x163)]==_0x12b76b[_0x4fa457(0x163)]&&_0x1fc749[_0x4fa457(0x138)]==_0x12b76b[_0x4fa457(0x138)]&&_0x1fc749[_0x4fa457(0x185)]==_0x12b76b[_0x4fa457(0x185)]&&_0x1fc749[_0x4fa457(0xe8)]==_0x12b76b['bay']&&(_0x1fc749[_0x4fa457(0x8c)]=parseInt(_0x1fc749[_0x4fa457(0x8c)])-parseInt(_0x12b76b['return_qty']),_0x26cb15++);});_0x26cb15=='0'&&(_0x31015c[_0x3d5006(0x94)]=_0x31015c[_0x3d5006(0x94)][_0x3d5006(0x15e)]({'product_name':_0x12b76b[_0x3d5006(0x124)],'product_stock':_0x12b76b['return_qty'],'primary_code':_0x12b76b[_0x3d5006(0x110)],'secondary_code':_0x12b76b[_0x3d5006(0xd4)],'product_code':_0x12b76b[_0x3d5006(0xda)],'storage':_0x12b76b['storage'],'rack':_0x12b76b[_0x3d5006(0x122)],'bay':_0x12b76b[_0x3d5006(0xe8)],'bin':_0x12b76b['bin'],'type':_0x12b76b['type'],'floorlevel':_0x12b76b[_0x3d5006(0x163)],'maxProducts':_0x12b76b[_0x3d5006(0xdd)],'unit':_0x12b76b[_0x3d5006(0x145)],'secondary_unit':_0x12b76b[_0x3d5006(0x149)],'expiry_date':_0x12b76b['expiry_date']}));}),await _0x31015c['save']();const _0x26bdef=await purchases[_0x4fe089(0x105)]({'invoice':_0x494436});_0x26bdef['return_data']=_0x4fe089(0x15c);const _0x24411d=await _0x26bdef[_0x4fe089(0x13d)](),_0x507944=new s_payment_data({'invoice':_0x494436,'suppliers':_0x440218[_0x4fe089(0x188)]['suppliers'],'reason':_0x4fe089(0xb3)});await _0x507944['save']();const _0x32fbda=await master_shop['find']();console[_0x4fe089(0xe9)](_0x4fe089(0x106),_0x32fbda[0x0][_0x4fe089(0x16f)]);const _0x19b27b=await email_settings[_0x4fe089(0x105)](),_0x46d85d=await suppliers[_0x4fe089(0x105)]({'name':_0x440218[_0x4fe089(0x188)][_0x4fe089(0x11d)]});console[_0x4fe089(0xe9)](_0x4fe089(0x16d),_0x46d85d);_0x32fbda[0x0][_0x4fe089(0xbd)]==0x1?(right_currency=_0x32fbda[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x32fbda[0x0][_0x4fe089(0xe4)]);var _0x1e9e56=_0x107b12,_0x17e2f2=_0x5afe87,_0x31ca92='',_0x54741b;for(_0x54741b in _0x1e9e56){_0x31ca92+=_0x4fe089(0xf1)+_0x4fe089(0xd3)+_0x1e9e56[_0x54741b]+_0x4fe089(0xea)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x17e2f2[_0x54741b]+_0x4fe089(0xea)+_0x4fe089(0xec);}console[_0x4fe089(0xe9)](_0x4fe089(0x11a),_0x31ca92);let _0x516f00=nodemailer['createTransport']({'service':_0x4fe089(0x17f),'auth':{'user':_0x19b27b['email'],'pass':_0x19b27b[_0x4fe089(0x121)]}}),_0x6ffec7={'from':_0x19b27b['email'],'to':_0x46d85d[_0x4fe089(0x130)],'subject':_0x4fe089(0xae),'attachments':[{'filename':_0x4fe089(0x101),'path':__dirname+_0x4fe089(0x154)+_0x4fe089(0x168)+_0x32fbda[0x0][_0x4fe089(0x16f)],'cid':_0x4fe089(0x17c)}],'html':_0x4fe089(0x12d)+_0x4fe089(0x14b)+_0x4fe089(0x183)+_0x4fe089(0x151)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+_0x4fe089(0x143)+_0x4fe089(0x152)+_0x4fe089(0x151)+_0x4fe089(0xc0)+_0x32fbda[0x0]['site_title']+_0x4fe089(0x14f)+_0x4fe089(0x152)+'</div>'+'<hr\x20class=\x22my-3\x22>'+_0x4fe089(0x151)+_0x4fe089(0x140)+_0x4fe089(0xcc)+_0x494436+'\x20'+_0x4fe089(0x107)+_0x4fe089(0xa4)+_0x4873ec+'\x20'+'</span>'+'</h5>'+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x4fe089(0xf1)+_0x4fe089(0xf0)+_0x4fe089(0xc2)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>'+_0x4fe089(0x126)+_0x4fe089(0xec)+_0x4fe089(0x104)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x31ca92+'\x20'+'</tbody>'+'</table>'+_0x4fe089(0x151)+_0x4fe089(0xc4)+_0x4fe089(0xef)+_0x32fbda[0x0]['site_title']+'</h5>'+'</div>'+'</div>'+_0x4fe089(0xbe)};_0x516f00[_0x4fe089(0x144)](_0x6ffec7,function(_0x4850d1,_0x3b25b7){var _0x55d817=_0x4fe089;_0x4850d1?(console[_0x55d817(0xe9)](_0x4850d1),console[_0x55d817(0xe9)](_0x55d817(0x12b))):console['log']('Email\x20sent\x20successfully');}),_0x440218[_0x4fe089(0x11c)](_0x4fe089(0xdb),'purchases\x20item\x20return\x20successfull'),_0xdde89d[_0x4fe089(0x100)]('/all_purchases/view');}catch(_0x3d14a9){console[_0x4fe089(0xe9)](_0x3d14a9),_0xdde89d[_0x4fe089(0xf6)](0xc8)[_0x4fe089(0x17a)]({'message':_0x3d14a9[_0x4fe089(0xc7)]});}}),router[a0_0x3d8737(0x166)](a0_0x3d8737(0x158),auth,async(_0x1c76b4,_0x33b933)=>{var _0x48b11a=a0_0x3d8737;try{const {username:_0x133aff,email:_0x5ea362,role:_0x116006}=_0x1c76b4['user'],_0x23f713=_0x1c76b4[_0x48b11a(0xcb)],_0x27fcca=await profile[_0x48b11a(0x105)]({'email':_0x23f713[_0x48b11a(0x130)]}),_0x105a84=await master_shop[_0x48b11a(0x171)](),_0x5b8e26=_0x1c76b4[_0x48b11a(0xa6)]['id'],_0x48992b=await purchases['findById'](_0x5b8e26);if(_0x105a84[0x0]['language']==_0x48b11a(0xc5))var _0x54ee23=users[_0x48b11a(0xe1)];else{if(_0x105a84[0x0]['language']==_0x48b11a(0xcd))var _0x54ee23=users[_0x48b11a(0xcd)];else{if(_0x105a84[0x0][_0x48b11a(0x11b)]==_0x48b11a(0x120))var _0x54ee23=users['German'];else{if(_0x105a84[0x0]['language']=='Spanish')var _0x54ee23=users[_0x48b11a(0x159)];else{if(_0x105a84[0x0][_0x48b11a(0x11b)]==_0x48b11a(0x111))var _0x54ee23=users[_0x48b11a(0x111)];else{if(_0x105a84[0x0][_0x48b11a(0x11b)]==_0x48b11a(0x18b))var _0x54ee23=users[_0x48b11a(0x125)];else{if(_0x105a84[0x0][_0x48b11a(0x11b)]==_0x48b11a(0x176))var _0x54ee23=users[_0x48b11a(0x176)];else{if(_0x105a84[0x0][_0x48b11a(0x11b)]==_0x48b11a(0xac))var _0x54ee23=users[_0x48b11a(0xb7)];}}}}}}}_0x33b933[_0x48b11a(0x150)](_0x48b11a(0xdf),{'success':_0x1c76b4[_0x48b11a(0x11c)](_0x48b11a(0xdb)),'errors':_0x1c76b4['flash'](_0x48b11a(0x119)),'role':_0x23f713,'profile':_0x27fcca,'alldata':_0x48992b,'master_shop':_0x105a84,'language':_0x54ee23}),console[_0x48b11a(0xe9)](alldata);}catch(_0x2ee8b6){console['log'](_0x2ee8b6);}}),router['post'](a0_0x3d8737(0x9b),async(_0x33327b,_0x4a04d6)=>{var _0x3b9cbf=a0_0x3d8737;const {product_code:_0x4b2c06}=_0x33327b[_0x3b9cbf(0x188)];var _0x29d13f;const _0x18a9b2=await product[_0x3b9cbf(0x141)]([{'$match':{'primary_code':_0x4b2c06,'product_category':_0x3b9cbf(0xf3)}},{'$group':{'_id':_0x3b9cbf(0x118),'name':{'$first':_0x3b9cbf(0x187)},'category':{'$first':_0x3b9cbf(0xa1)},'brand':{'$first':_0x3b9cbf(0x165)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x3b9cbf(0xed)},'product_code':{'$first':_0x3b9cbf(0x135)},'primary_code':{'$first':_0x3b9cbf(0x103)},'secondary_code':{'$first':_0x3b9cbf(0x127)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x3b9cbf(0x95)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x17927d=await product['aggregate']([{'$match':{'secondary_code':_0x4b2c06,'product_category':_0x3b9cbf(0xf3)}},{'$group':{'_id':_0x3b9cbf(0x118),'name':{'$first':'$name'},'category':{'$first':_0x3b9cbf(0xa1)},'brand':{'$first':_0x3b9cbf(0x165)},'unit':{'$first':'$unit'},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x3b9cbf(0x135)},'primary_code':{'$first':_0x3b9cbf(0x103)},'secondary_code':{'$first':_0x3b9cbf(0x127)},'maxStocks':{'$first':_0x3b9cbf(0xc8)},'maxProdPerUnit':{'$first':_0x3b9cbf(0x95)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x18a9b2[_0x3b9cbf(0x13a)]>0x0)_0x29d13f=_0x18a9b2;else _0x17927d[_0x3b9cbf(0x13a)]>0x0&&(_0x29d13f=_0x17927d);_0x4a04d6[_0x3b9cbf(0x17a)](_0x29d13f);}),router[a0_0x3d8737(0xd0)](a0_0x3d8737(0x132),async(_0x17ff3a,_0x5c7c83)=>{var _0x992583=a0_0x3d8737;const {primaryCode:_0x5a9373,secondaryCode:_0x51cb04,productCode:_0x532018,bay:_0x15fb61,bin:_0x3ecad3,types:_0x470e8f,pallet:_0x192ba8,warehouses:_0x5b4419,room:_0x28804d}=_0x17ff3a['body'];console[_0x992583(0xe9)](_0x17ff3a[_0x992583(0x188)]);try{const _0x8a4487=await warehouse[_0x992583(0x141)]([{'$match':{'name':_0x5b4419,'room':_0x28804d}},{'$unwind':_0x992583(0x13b)},{'$match':{'product_details.bay':_0x15fb61,'product_details.bin':_0x3ecad3,'product_details.type':_0x470e8f}},{'$group':{'_id':_0x992583(0x113),'name':{'$first':_0x992583(0xfe)},'product_stock':{'$first':_0x992583(0x9e)},'level':{'$first':_0x992583(0xb0)},'isle':{'$first':_0x992583(0x184)},'pallet':{'$first':'$product_details.pallet'},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x5c7c83['status'](0xc8)['json'](_0x8a4487);}catch(_0x527811){_0x5c7c83['status'](0x194)[_0x992583(0x17a)]({'message':_0x527811['message']});}}),module[a0_0x3d8737(0xb9)]=router;