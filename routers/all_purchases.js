var a0_0x5f14e8=a0_0x12ee;(function(_0x468b22,_0x7c3bd8){var _0x2a9d28=a0_0x12ee,_0x3c5533=_0x468b22();while(!![]){try{var _0x4f3f6a=-parseInt(_0x2a9d28(0x1a8))/0x1*(parseInt(_0x2a9d28(0x199))/0x2)+parseInt(_0x2a9d28(0x138))/0x3+parseInt(_0x2a9d28(0xe7))/0x4*(-parseInt(_0x2a9d28(0x17e))/0x5)+parseInt(_0x2a9d28(0x1cf))/0x6*(parseInt(_0x2a9d28(0x1e2))/0x7)+-parseInt(_0x2a9d28(0x185))/0x8*(parseInt(_0x2a9d28(0x1b9))/0x9)+-parseInt(_0x2a9d28(0x150))/0xa+parseInt(_0x2a9d28(0xf7))/0xb*(parseInt(_0x2a9d28(0x117))/0xc);if(_0x4f3f6a===_0x7c3bd8)break;else _0x3c5533['push'](_0x3c5533['shift']());}catch(_0x4605d6){_0x3c5533['push'](_0x3c5533['shift']());}}}(a0_0x30b5,0xbec8d));const express=require(a0_0x5f14e8(0x144)),app=express(),router=express[a0_0x5f14e8(0xe3)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings}=require('../models/all_models'),auth=require(a0_0x5f14e8(0xfe)),nodemailer=require(a0_0x5f14e8(0x155));function a0_0x12ee(_0x43969c,_0x18353e){var _0x30b561=a0_0x30b5();return a0_0x12ee=function(_0x12eed2,_0x399392){_0x12eed2=_0x12eed2-0xd8;var _0x23dad2=_0x30b561[_0x12eed2];return _0x23dad2;},a0_0x12ee(_0x43969c,_0x18353e);}var ejs=require('ejs');const path=require(a0_0x5f14e8(0xf1)),users=require(a0_0x5f14e8(0x181));router['get'](a0_0x5f14e8(0x1de),auth,async(_0x2594a9,_0x57da26)=>{var _0x372121=a0_0x5f14e8;try{const {username:_0x33cf61,email:_0x3c1e52,role:_0x521883}=_0x2594a9[_0x372121(0x1b7)],_0xe538=_0x2594a9[_0x372121(0x1b7)],_0x355147=await profile[_0x372121(0x1cd)]({'email':_0xe538['email']}),_0x42f51c=await staff['findOne']({'email':_0xe538[_0x372121(0x12a)]});if(_0xe538[_0x372121(0x128)]==_0x372121(0x14c)){const _0x388e8c=await staff[_0x372121(0x1cd)]({'email':_0xe538[_0x372121(0x12a)]});}const _0x67f70b=await master_shop['find']();let _0x1e9a10;if(_0xe538['role']==_0x372121(0x14c)){const _0x4364b5=await staff[_0x372121(0x1cd)]({'email':_0xe538[_0x372121(0x12a)]});_0x1e9a10=await purchases[_0x372121(0xe8)]([{'$match':{'warehouse_name':_0x4364b5[_0x372121(0x130)]}},{'$lookup':{'from':'suppliers','localField':'suppliers','foreignField':_0x372121(0x115),'as':'suppliers_docs'}},{'$unwind':_0x372121(0x11a)},{'$unwind':_0x372121(0x12f)},{'$group':{'_id':_0x372121(0x158),'invoice':{'$first':_0x372121(0x167)},'suppliers':{'$first':_0x372121(0x126)},'date':{'$first':_0x372121(0x12d)},'warehouse_name':{'$first':_0x372121(0x137)},'room':{'$first':'$room'},'product':{'$push':'$product'},'note':{'$first':_0x372121(0x179)},'paid_amount':{'$first':_0x372121(0x1d5)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x372121(0xed)},'expiry_date':{'$first':_0x372121(0x1ab)},'suppliers_docs':{'$first':_0x372121(0x11a)},'total_product_quantity':{'$sum':_0x372121(0x111)},'level':{'$addToSet':_0x372121(0x149)},'isle':{'$addToSet':_0x372121(0x19e)},'type':{'$addToSet':_0x372121(0x11f)},'floorlevel':{'$addToSet':_0x372121(0x1d1)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x1e9a10=await purchases[_0x372121(0xe8)]([{'$lookup':{'from':'suppliers','localField':'suppliers','foreignField':_0x372121(0x115),'as':_0x372121(0x12e)}},{'$unwind':'$suppliers_docs'},{'$unwind':_0x372121(0x12f)},{'$group':{'_id':'$_id','invoice':{'$first':_0x372121(0x167)},'suppliers':{'$first':'$suppliers'},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x372121(0x137)},'room':{'$addToSet':_0x372121(0x174)},'product':{'$push':_0x372121(0x12f)},'note':{'$first':_0x372121(0x179)},'paid_amount':{'$first':_0x372121(0x1d5)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x372121(0xf2)},'batch_code':{'$first':_0x372121(0xed)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x372121(0x11a)},'total_product_quantity':{'$sum':_0x372121(0x111)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x372121(0x19e)},'type':{'$addToSet':_0x372121(0x11f)},'floorlevel':{'$addToSet':_0x372121(0x1d1)},'finalize':{'$first':_0x372121(0x13b)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x67f70b[0x0][_0x372121(0x112)]=='English\x20(US)'){var _0x49af97=users[_0x372121(0x121)];console['log'](_0x49af97);}else{if(_0x67f70b[0x0][_0x372121(0x112)]==_0x372121(0x190))var _0x49af97=users[_0x372121(0x190)];else{if(_0x67f70b[0x0][_0x372121(0x112)]==_0x372121(0x10c))var _0x49af97=users[_0x372121(0x10c)];else{if(_0x67f70b[0x0][_0x372121(0x112)]==_0x372121(0xdb))var _0x49af97=users[_0x372121(0xdb)];else{if(_0x67f70b[0x0][_0x372121(0x112)]==_0x372121(0x148))var _0x49af97=users[_0x372121(0x148)];else{if(_0x67f70b[0x0][_0x372121(0x112)]==_0x372121(0x102))var _0x49af97=users['Portuguese'];else{if(_0x67f70b[0x0][_0x372121(0x112)]==_0x372121(0xe4))var _0x49af97=users[_0x372121(0xe4)];else{if(_0x67f70b[0x0][_0x372121(0x112)]==_0x372121(0x1ce))var _0x49af97=users[_0x372121(0x12b)];}}}}}}}_0x57da26[_0x372121(0x188)](_0x372121(0x13d),{'success':_0x2594a9[_0x372121(0xdc)]('success'),'errors':_0x2594a9[_0x372121(0xdc)](_0x372121(0x176)),'purchases':_0x1e9a10,'role':_0xe538,'profile':_0x355147,'master_shop':_0x67f70b,'language':_0x49af97});}catch(_0x3ccc7a){console[_0x372121(0x1d6)]('table\x20page',_0x3ccc7a),_0x57da26[_0x372121(0xd9)](0xc8)[_0x372121(0x104)]({'message':_0x3ccc7a[_0x372121(0x114)]});}});function BayBinSelected(_0x48114f,_0x586cc8){var _0x26005a=a0_0x5f14e8,_0x3bdba5=[],_0x1ba204=[],_0x508db3=[],_0x527487=[],_0x35f0e7=[],_0x5f3005=[];let _0x461987=[];if(_0x48114f==_0x26005a(0x1ca))switch(_0x586cc8){case _0x26005a(0x1c9):_0x3bdba5=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x1ba204=[0x1,0x2],_0x527487=[0x1,0x2,0x3,0x4,0x5],_0x508db3=[_0x26005a(0x1e0),'Floor'],_0x35f0e7=['D'],_0x5f3005=['A'];break;case _0x26005a(0x118):_0x3bdba5=[0x6,0x5,0x4,0x3,0x2,0x1],_0x1ba204=[0x1,0x2],_0x527487=[0x1,0x2,0x3,0x4,0x5],_0x508db3=[_0x26005a(0x1e0),_0x26005a(0x136)],_0x35f0e7=['D'],_0x5f3005=['B'];break;case _0x26005a(0x165):_0x3bdba5=[0x0],_0x1ba204=[0x0],_0x527487=[0x1,0x2,0x3,0x4,0x5],_0x508db3=[_0x26005a(0x136)],_0x35f0e7=['D'],_0x5f3005=['S'];break;case _0x26005a(0x10f):_0x3bdba5=[0x0],_0x1ba204=[0x0],_0x527487=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x508db3=[_0x26005a(0x136)],_0x35f0e7=['D'],_0x5f3005=['R'];break;}else{if(_0x48114f==_0x26005a(0x116))switch(_0x586cc8){case _0x26005a(0x1c9):_0x3bdba5=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x1ba204=['B','F'],_0x527487=[0x1,0x2,0x3,0x4,0x5],_0x508db3=['Level','Floor'],_0x35f0e7=['C'],_0x5f3005=['A'];break;case'Rack\x20B':_0x3bdba5=[0x5,0x4,0x3,0x2,0x1],_0x1ba204=['F','B','S'],_0x527487=[0x1,0x2,0x3,0x4,0x5],_0x508db3=['Level',_0x26005a(0x136)],_0x35f0e7=['C'],_0x5f3005=['B'];break;case _0x26005a(0x13a):_0x3bdba5=[0x1,0x2,0x3,0x4,0x5],_0x1ba204=['B','F','S'],_0x527487=[0x5,0x4,0x3,0x2,0x1],_0x508db3=[_0x26005a(0x1e0),'Floor'],_0x35f0e7=['C'],_0x5f3005=['C'];break;case _0x26005a(0x10a):_0x3bdba5=[0x5,0x4,0x3,0x2,0x1],_0x1ba204=['F','B','S'],_0x527487=[0x1,0x2,0x3,0x4,0x5],_0x508db3=[_0x26005a(0x1e0),_0x26005a(0x136)],_0x35f0e7=['C'],_0x5f3005=['D'];break;case _0x26005a(0x146):_0x3bdba5=[0x4,0x3,0x2,0x1],_0x1ba204=[0x1,0x2],_0x527487=[0x1,0x2,0x3,0x4,0x5],_0x508db3=[_0x26005a(0x1e0),'Floor'],_0x35f0e7=['C'],_0x5f3005=['E'];break;case _0x26005a(0xe0):_0x3bdba5=[0x1,0x2,0x3],_0x1ba204=[0x1,0x2],_0x527487=[0x1,0x2,0x3,0x4,0x5],_0x508db3=[_0x26005a(0x1e0)],_0x35f0e7=['C'],_0x5f3005=['F'];break;}}return{'levels':_0x3bdba5,'Isle':_0x1ba204,'rack':_0x527487,'type':_0x508db3,'storage':_0x35f0e7,'rak':_0x5f3005};}router[a0_0x5f14e8(0x1b4)](a0_0x5f14e8(0xd8),auth,async(_0x53456e,_0x42e92f)=>{var _0x3e15e0=a0_0x5f14e8;try{const {username:_0x3e60d3,email:_0x40709b,role:_0x382698}=_0x53456e[_0x3e15e0(0x1b7)],_0x3a0850=_0x53456e['user'],_0x18427b=await profile['findOne']({'email':_0x3a0850['email']}),_0x30764a=await master_shop[_0x3e15e0(0x1db)](),_0x58d729=await staff[_0x3e15e0(0x1cd)]({'email':_0x3a0850[_0x3e15e0(0x12a)]}),_0x2b57e3=await suppliers[_0x3e15e0(0x1db)]({});let _0x26bff0;if(_0x3a0850[_0x3e15e0(0x128)]==_0x3e15e0(0x14c)){const _0x20597e=await staff['findOne']({'email':_0x3a0850[_0x3e15e0(0x12a)]});_0x26bff0=await warehouse[_0x3e15e0(0xe8)]([{'$match':{'status':_0x3e15e0(0x11b),'name':_0x20597e[_0x3e15e0(0x130)],'warehouse_category':_0x3e15e0(0x1c2),'name':{'$ne':_0x3e15e0(0x1a4)}}},{'$group':{'_id':_0x3e15e0(0x16f),'name':{'$first':_0x3e15e0(0x16f)}}}]);}else _0x26bff0=await warehouse[_0x3e15e0(0xe8)]([{'$match':{'status':_0x3e15e0(0x11b),'warehouse_category':_0x3e15e0(0x1c2),'name':{'$ne':_0x3e15e0(0x1a4)}}},{'$group':{'_id':_0x3e15e0(0x16f),'name':{'$first':_0x3e15e0(0x16f)}}}]);const _0x2853e7=await product['find']({}),_0x3448ec=await warehouse['find']({'status':_0x3e15e0(0x11b)}),_0x4d6dc2=await purchases['find']({}),_0x5d82c9=_0x4d6dc2[_0x3e15e0(0x197)]+0x1,_0x3582b8='INC-'+_0x5d82c9[_0x3e15e0(0x1ac)]()['padStart'](0x5,'0');var _0x42a22e=['Ambient',_0x3e15e0(0x15b)];if(_0x30764a[0x0][_0x3e15e0(0x112)]==_0x3e15e0(0x1a9)){var _0x528fa4=users[_0x3e15e0(0x121)];console[_0x3e15e0(0x1d6)](_0x528fa4);}else{if(_0x30764a[0x0][_0x3e15e0(0x112)]==_0x3e15e0(0x190))var _0x528fa4=users[_0x3e15e0(0x190)];else{if(_0x30764a[0x0][_0x3e15e0(0x112)]=='German')var _0x528fa4=users['German'];else{if(_0x30764a[0x0][_0x3e15e0(0x112)]==_0x3e15e0(0xdb))var _0x528fa4=users[_0x3e15e0(0xdb)];else{if(_0x30764a[0x0][_0x3e15e0(0x112)]==_0x3e15e0(0x148))var _0x528fa4=users[_0x3e15e0(0x148)];else{if(_0x30764a[0x0][_0x3e15e0(0x112)]==_0x3e15e0(0x102))var _0x528fa4=users[_0x3e15e0(0xe1)];else{if(_0x30764a[0x0][_0x3e15e0(0x112)]==_0x3e15e0(0xe4))var _0x528fa4=users['Chinese'];else{if(_0x30764a[0x0][_0x3e15e0(0x112)]=='Arabic\x20(ae)')var _0x528fa4=users[_0x3e15e0(0x12b)];}}}}}}}_0x42e92f[_0x3e15e0(0x188)]('add_purchases',{'success':_0x53456e[_0x3e15e0(0xdc)](_0x3e15e0(0x17a)),'errors':_0x53456e['flash']('errors'),'role':_0x3a0850,'profile':_0x18427b,'suppliers':_0x2b57e3,'warehouse':_0x26bff0,'product':_0x2853e7,'invoice':_0x3582b8,'master_shop':_0x30764a,'language':_0x528fa4,'find_data':_0x3448ec,'rooms_data':_0x42a22e});}catch(_0x4d342a){console[_0x3e15e0(0x1d6)](_0x4d342a);}}),router[a0_0x5f14e8(0x1b4)](a0_0x5f14e8(0xf5),auth,async(_0x234abf,_0x2732ba)=>{var _0xf5a2e0=a0_0x5f14e8;try{const _0x356795=_0x234abf['params']['id'];console[_0xf5a2e0(0x1d6)](_0x356795);const _0x47f9df=await master_shop[_0xf5a2e0(0x1db)]();console[_0xf5a2e0(0x1d6)](_0xf5a2e0(0x19a),_0x47f9df);const _0x5d56d6=await product[_0xf5a2e0(0x1cd)]({'name':_0x356795});console[_0xf5a2e0(0x1d6)](_0xf5a2e0(0x163),_0x5d56d6),_0x2732ba[_0xf5a2e0(0xd9)](0xc8)[_0xf5a2e0(0x104)]({'product_data':_0x5d56d6,'master':_0x47f9df});}catch(_0x4af480){console[_0xf5a2e0(0x1d6)]('add_purchases\x20error',_0x4af480);}}),router[a0_0x5f14e8(0x1d3)](a0_0x5f14e8(0xd8),auth,async(_0x5f15cc,_0x47a443)=>{var _0x1c399c=a0_0x5f14e8;try{const {invoice:_0x3b58d1,date:_0x3cace1,warehouse_name:_0x20cf81,prod_name:_0x2066c4,prod_code:_0x545af7,prod_qty:_0x1603b5,prod_unit:_0x1414a2,prod_secondunit:_0x220b17,prod_level:_0x10f6f5,prod_isle:_0x5011a3,prod_pallet:_0x4993f0,note:_0x116a3a,expiry_date:_0x360f32,batch_code:_0x312723,payable:_0xe460c6,due_amount:_0x307938,Room_name:_0x56993f,primary_code:_0x27514f,secondary_code:_0x81a076,MaxStocks_data:_0x345ab6,PO_number:_0x4dd367,SCRN:_0x288d5d,JO_number:_0x38362e}=_0x5f15cc[_0x1c399c(0x18e)];if(typeof _0x2066c4==_0x1c399c(0x1b2))var _0x21d381=[_0x5f15cc[_0x1c399c(0x18e)][_0x1c399c(0x18f)]],_0x194741=[_0x5f15cc['body']['prod_code']],_0x1f10bb=[_0x5f15cc[_0x1c399c(0x18e)][_0x1c399c(0x189)]],_0x1b6526=[_0x5f15cc[_0x1c399c(0x18e)][_0x1c399c(0xe5)]],_0x4377d0=[_0x5f15cc[_0x1c399c(0x18e)][_0x1c399c(0x11e)]],_0x2665c3=[_0x5f15cc[_0x1c399c(0x18e)][_0x1c399c(0xef)]],_0x2a0d36=[_0x5f15cc[_0x1c399c(0x18e)][_0x1c399c(0x1b6)]],_0x2f0541=[_0x5f15cc['body'][_0x1c399c(0x193)]],_0x27ff92=[_0x5f15cc[_0x1c399c(0x18e)][_0x1c399c(0x133)]],_0x53a982=[_0x5f15cc['body']['batch_code']],_0x772c4e=[_0x5f15cc['body']['expiry_date']],_0x2fea04=[_0x5f15cc[_0x1c399c(0x18e)][_0x1c399c(0xf0)]],_0x24cdb5=[_0x5f15cc[_0x1c399c(0x18e)]['alertQTY']],_0x4c7dcd=[_0x5f15cc[_0x1c399c(0x18e)][_0x1c399c(0x110)]],_0x95df8f=[_0x5f15cc[_0x1c399c(0x18e)][_0x1c399c(0x192)]],_0x14ad93=[_0x5f15cc[_0x1c399c(0x18e)][_0x1c399c(0xec)]];else var _0x21d381=[..._0x5f15cc[_0x1c399c(0x18e)][_0x1c399c(0x18f)]],_0x194741=[..._0x5f15cc[_0x1c399c(0x18e)]['prod_code']],_0x1f10bb=[..._0x5f15cc[_0x1c399c(0x18e)][_0x1c399c(0x189)]],_0x1b6526=[..._0x5f15cc[_0x1c399c(0x18e)][_0x1c399c(0xe5)]],_0x4377d0=[..._0x5f15cc['body'][_0x1c399c(0x11e)]],_0x2665c3=[..._0x5f15cc[_0x1c399c(0x18e)]['prod_level']],_0x2a0d36=[..._0x5f15cc[_0x1c399c(0x18e)][_0x1c399c(0x1b6)]],_0x2f0541=[..._0x5f15cc[_0x1c399c(0x18e)][_0x1c399c(0x193)]],_0x27ff92=[..._0x5f15cc[_0x1c399c(0x18e)]['MaxStocks_data']],_0x53a982=[..._0x5f15cc[_0x1c399c(0x18e)][_0x1c399c(0x1b5)]],_0x772c4e=[..._0x5f15cc['body'][_0x1c399c(0x14b)]],_0x2fea04=[..._0x5f15cc[_0x1c399c(0x18e)][_0x1c399c(0xf0)]],_0x24cdb5=[..._0x5f15cc[_0x1c399c(0x18e)][_0x1c399c(0x13e)]],_0x4c7dcd=[..._0x5f15cc[_0x1c399c(0x18e)][_0x1c399c(0x110)]],_0x95df8f=[..._0x5f15cc['body'][_0x1c399c(0x192)]],_0x14ad93=[..._0x5f15cc[_0x1c399c(0x18e)][_0x1c399c(0xec)]];const _0x1f96e0=_0x21d381[_0x1c399c(0x134)](_0x355ab3=>{return _0x355ab3={'product_name':_0x355ab3};});_0x194741[_0x1c399c(0xeb)]((_0x583ce3,_0xc4815e)=>{var _0x180107=_0x1c399c;_0x1f96e0[_0xc4815e][_0x180107(0x1a0)]=_0x583ce3;}),_0x1f10bb[_0x1c399c(0xeb)]((_0x4151e7,_0x21d2e8)=>{var _0x20b1cf=_0x1c399c;_0x1f96e0[_0x21d2e8][_0x20b1cf(0x143)]=_0x4151e7;}),_0x1b6526[_0x1c399c(0xeb)]((_0x4fe915,_0x1252d9)=>{_0x1f96e0[_0x1252d9]['standard_unit']=_0x4fe915;}),_0x4377d0[_0x1c399c(0xeb)]((_0x2ba361,_0x4ce246)=>{var _0x4b70f1=_0x1c399c;_0x1f96e0[_0x4ce246][_0x4b70f1(0x142)]=_0x2ba361;}),_0x2665c3[_0x1c399c(0xeb)]((_0x422160,_0xa066fb)=>{var _0x71eecc=_0x1c399c;_0x14ad93[_0x71eecc(0xeb)]((_0x41f7c0,_0x42c22c)=>{var _0x15be1d=_0x71eecc;if(_0x41f7c0==_0x15be1d(0x10f)&&_0xa066fb==_0x42c22c){console[_0x15be1d(0x1d6)](_0x41f7c0+_0x15be1d(0x183)+_0xa066fb+_0x15be1d(0x1e3)+_0x42c22c+_0x15be1d(0x1e3)+_0x422160);var _0x264bf1=_0x422160[_0x15be1d(0x1a3)](0x3);_0x1f96e0[_0xa066fb][_0x15be1d(0x1e7)]=_0x422160[0x0],_0x1f96e0[_0xa066fb][_0x15be1d(0x14f)]=_0x422160[0x1],_0x1f96e0[_0xa066fb][_0x15be1d(0x1df)]=0x0,_0x1f96e0[_0xa066fb][_0x15be1d(0x1ad)]=0x0,_0x1f96e0[_0xa066fb][_0x15be1d(0x187)]=_0x15be1d(0x136),_0x1f96e0[_0xa066fb][_0x15be1d(0x1c8)]=_0x264bf1;}else{if(_0x41f7c0==_0x15be1d(0x165)&&_0xa066fb==_0x42c22c){var _0x264bf1=_0x422160[_0x15be1d(0x1a3)](0x3);_0x1f96e0[_0xa066fb][_0x15be1d(0x1e7)]=_0x422160[0x0],_0x1f96e0[_0xa066fb][_0x15be1d(0x14f)]=_0x422160[0x1],_0x1f96e0[_0xa066fb][_0x15be1d(0x1df)]=0x0,_0x1f96e0[_0xa066fb][_0x15be1d(0x1ad)]=0x0,_0x1f96e0[_0xa066fb][_0x15be1d(0x187)]=_0x15be1d(0x136),_0x1f96e0[_0xa066fb]['floorlevel']=_0x422160[0x5];}else{if(_0xa066fb==_0x42c22c){var _0x229ce3;if(_0x422160[0x4]=='L')_0x229ce3=_0x15be1d(0x1e0);else _0x422160[0x4]=='F'&&(_0x229ce3=_0x15be1d(0x136));_0x1f96e0[_0xa066fb][_0x15be1d(0x1e7)]=_0x422160[0x0],_0x1f96e0[_0xa066fb][_0x15be1d(0x14f)]=_0x422160[0x1],_0x1f96e0[_0xa066fb][_0x15be1d(0x1df)]=_0x422160[0x2],_0x1f96e0[_0xa066fb][_0x15be1d(0x1ad)]=_0x422160[0x3],_0x1f96e0[_0xa066fb]['type']=_0x229ce3,_0x1f96e0[_0xa066fb][_0x15be1d(0x1c8)]=_0x422160[0x5];}}}});}),_0x2a0d36[_0x1c399c(0xeb)]((_0x288fb9,_0x1c8992)=>{var _0x2a70ee=_0x1c399c;_0x1f96e0[_0x1c8992][_0x2a70ee(0x1b6)]=_0x288fb9;}),_0x2f0541['forEach']((_0x3b908e,_0x10de98)=>{var _0x8b6c96=_0x1c399c;_0x1f96e0[_0x10de98][_0x8b6c96(0x193)]=_0x3b908e;}),_0x27ff92[_0x1c399c(0xeb)]((_0x28fd60,_0x3c9119)=>{var _0x58ebd6=_0x1c399c;_0x1f96e0[_0x3c9119][_0x58ebd6(0x1d0)]=_0x28fd60;}),_0x53a982[_0x1c399c(0xeb)]((_0x238a2a,_0x1a841f)=>{_0x1f96e0[_0x1a841f]['batch_code']=_0x238a2a;}),_0x772c4e[_0x1c399c(0xeb)]((_0x1bee8f,_0x2af986)=>{var _0x4513b6=_0x1c399c;_0x1f96e0[_0x2af986][_0x4513b6(0x14b)]=_0x1bee8f;}),_0x2fea04[_0x1c399c(0xeb)]((_0x5a4b4e,_0x5530ff)=>{var _0xd06dda=_0x1c399c;_0x1f96e0[_0x5530ff][_0xd06dda(0x1d2)]=_0x5a4b4e;}),_0x24cdb5['forEach']((_0x8e982e,_0x34b3dd)=>{var _0x461a6a=_0x1c399c;_0x1f96e0[_0x34b3dd][_0x461a6a(0x13e)]=_0x8e982e;}),_0x4c7dcd['forEach']((_0x44175e,_0x213708)=>{var _0x375e80=_0x1c399c;_0x1f96e0[_0x213708][_0x375e80(0x110)]=_0x44175e;}),_0x95df8f[_0x1c399c(0xeb)]((_0xee1056,_0x62f480)=>{_0x1f96e0[_0x62f480]['product_cat']=_0xee1056;}),_0x14ad93[_0x1c399c(0xeb)]((_0x33b214,_0xfec36b)=>{var _0x1c547b=_0x1c399c;_0x1f96e0[_0xfec36b][_0x1c547b(0x1c1)]=_0x33b214;});const _0x500363=_0x14ad93[_0x1c399c(0x134)](_0x258ac9=>{return _0x258ac9={'room_name':_0x258ac9};}),_0x23f379=_0x1f96e0[_0x1c399c(0x1b3)](_0x2eddb6=>_0x2eddb6[_0x1c399c(0x143)]!=='0'&&_0x2eddb6[_0x1c399c(0x143)]!==''),_0x16a91c=new purchases({'invoice':_0x3b58d1,'suppliers':_0x5f15cc[_0x1c399c(0x18e)][_0x1c399c(0xf4)],'date':_0x3cace1,'warehouse_name':_0x20cf81,'product':_0x23f379,'note':_0x116a3a,'due_amount':_0x307938,'POnumber':_0x4dd367,'SCRN':_0x288d5d,'JO_number':_0x38362e,'roomList':_0x500363}),_0x2b44b9=await _0x16a91c[_0x1c399c(0x1cb)](),_0x2c1eb0=await purchases[_0x1c399c(0x1cd)]({'invoice':_0x3b58d1}),_0x2e3636=_0x2c1eb0[_0x1c399c(0x163)]['map'](async _0x4e0fe2=>{var _0x4b396a=_0x1c399c,_0x26d108=await warehouse[_0x4b396a(0x1cd)]({'name':_0x20cf81,'room':_0x4e0fe2['room_name']}),_0x30f16d=0x0;return _0x26d108[_0x4b396a(0x1dd)][_0x4b396a(0xeb)](_0x55ba6a=>{var _0x174f27=_0x4b396a;_0x55ba6a['product_name']==_0x4e0fe2[_0x174f27(0x11d)]&&_0x55ba6a['floorlevel']==_0x4e0fe2[_0x174f27(0x1c8)]&&_0x55ba6a[_0x174f27(0x187)]==_0x4e0fe2[_0x174f27(0x187)]&&_0x55ba6a[_0x174f27(0x1ad)]==_0x4e0fe2[_0x174f27(0x1ad)]&&_0x55ba6a[_0x174f27(0x1df)]==_0x4e0fe2[_0x174f27(0x1df)]&&_0x55ba6a['rack']==_0x4e0fe2[_0x174f27(0x14f)]&&_0x55ba6a['storage']==_0x4e0fe2[_0x174f27(0x1e7)]&&_0x55ba6a['expiry_date']==_0x4e0fe2[_0x174f27(0x14b)]&&_0x55ba6a[_0x174f27(0x1b5)]==_0x4e0fe2[_0x174f27(0x1b5)]&&_0x55ba6a[_0x174f27(0x110)]==_0x4e0fe2['production_date']&&(_0x55ba6a['product_stock']+=_0x4e0fe2[_0x174f27(0x143)],_0x30f16d++);}),_0x30f16d===0x0&&_0x26d108[_0x4b396a(0x1dd)][_0x4b396a(0x107)]({'product_name':_0x4e0fe2[_0x4b396a(0x11d)],'product_stock':_0x4e0fe2[_0x4b396a(0x143)],'primary_code':_0x4e0fe2[_0x4b396a(0x1b6)],'secondary_code':_0x4e0fe2[_0x4b396a(0x193)],'product_code':_0x4e0fe2[_0x4b396a(0x1a0)],'storage':_0x4e0fe2[_0x4b396a(0x1e7)],'rack':_0x4e0fe2[_0x4b396a(0x14f)],'bay':_0x4e0fe2['bay'],'bin':_0x4e0fe2[_0x4b396a(0x1ad)],'type':_0x4e0fe2[_0x4b396a(0x187)],'floorlevel':_0x4e0fe2['floorlevel'],'maxProducts':_0x4e0fe2[_0x4b396a(0x1d0)],'unit':_0x4e0fe2[_0x4b396a(0x141)],'secondary_unit':_0x4e0fe2[_0x4b396a(0x142)],'expiry_date':_0x4e0fe2[_0x4b396a(0x14b)],'maxPerUnit':_0x4e0fe2['maxperunit'],'batch_code':_0x4e0fe2['batch_code'],'alertQTY':_0x4e0fe2[_0x4b396a(0x13e)],'production_date':_0x4e0fe2[_0x4b396a(0x110)],'product_cat':_0x4e0fe2[_0x4b396a(0x113)]}),_0x26d108;});Promise[_0x1c399c(0x19b)](_0x2e3636)[_0x1c399c(0x15e)](async _0xedff14=>{var _0x5a1767=_0x1c399c;try{for(const _0x5a33a3 of _0xedff14){await _0x5a33a3[_0x5a1767(0x1cb)]();}_0x5f15cc[_0x5a1767(0xdc)]('success',_0x5a1767(0x1e9)),_0x47a443[_0x5a1767(0xfc)](_0x5a1767(0x154));}catch(_0xc1047){console[_0x5a1767(0x100)](_0xc1047),_0x47a443[_0x5a1767(0xd9)](0x1f4)[_0x5a1767(0x104)]({'error':_0x5a1767(0x125)});}})[_0x1c399c(0x166)](_0x401fe9=>{var _0x1c097d=_0x1c399c;console[_0x1c097d(0x100)](_0x401fe9),_0x47a443[_0x1c097d(0xd9)](0x1f4)[_0x1c097d(0x104)]({'error':'An\x20error\x20occurred.'});});}catch(_0x46efd4){console[_0x1c399c(0x1d6)](_0x46efd4);}}),router[a0_0x5f14e8(0x1b4)](a0_0x5f14e8(0x103),auth,async(_0x454f04,_0x23a081)=>{var _0x421a94=a0_0x5f14e8;try{const {username:_0x5451f2,email:_0x1a76c8,role:_0x5eddfa}=_0x454f04[_0x421a94(0x1b7)],_0x457e25=_0x454f04[_0x421a94(0x1b7)],_0x353b55=await profile[_0x421a94(0x1cd)]({'email':_0x457e25[_0x421a94(0x12a)]}),_0x3326a0=await master_shop[_0x421a94(0x1db)](),_0x4a1b0c=_0x454f04[_0x421a94(0x16d)]['id'],_0x472388=await purchases['findById'](_0x4a1b0c),_0x27bced=await warehouse[_0x421a94(0xe8)]([{'$match':{'name':_0x472388[_0x421a94(0x198)],'room':_0x472388[_0x421a94(0x1e4)]}},{'$unwind':_0x421a94(0xf6)},{'$group':{'_id':_0x421a94(0x15a),'name':{'$first':_0x421a94(0x182)},'product_stock':{'$first':_0x421a94(0x1ba)},'bay':{'$first':_0x421a94(0x1b1)},'bin':{'$first':_0x421a94(0x169)},'type':{'$first':_0x421a94(0x1c4)},'floorlevel':{'$first':_0x421a94(0xea)},'primary_code':{'$first':_0x421a94(0x1d8)},'secondary_code':{'$first':_0x421a94(0x1bf)},'product_code':{'$first':_0x421a94(0x160)},'storage':{'$first':_0x421a94(0x1a1)},'rack':{'$first':_0x421a94(0x170)},'expiry_date':{'$first':'$product_details.expiry_date'}}}]),_0x3d7d0a=await customer[_0x421a94(0x1db)]({});let _0xf57965;if(_0x457e25[_0x421a94(0x128)]=='staff'){const _0x5d7ea5=await staff[_0x421a94(0x1cd)]({'email':_0x457e25[_0x421a94(0x12a)]});_0xf57965=await warehouse[_0x421a94(0xe8)]([{'$match':{'status':_0x421a94(0x11b),'name':_0x5d7ea5['warehouse']}},{'$group':{'_id':_0x421a94(0x16f),'name':{'$first':'$name'}}}]);}else _0xf57965=await warehouse[_0x421a94(0xe8)]([{'$match':{'status':_0x421a94(0x11b)}},{'$group':{'_id':_0x421a94(0x16f),'name':{'$first':_0x421a94(0x16f)}}}]);const _0x2c9bfc=await product[_0x421a94(0x1db)]({}),_0x3cf8eb=await suppliers[_0x421a94(0x1db)]({}),_0x547a63=BayBinSelected(_0x472388[_0x421a94(0x198)],_0x472388[_0x421a94(0x1e4)]);if(_0x3326a0[0x0]['language']==_0x421a94(0x1a9)){var _0x50fea9=users[_0x421a94(0x121)];console[_0x421a94(0x1d6)](_0x50fea9);}else{if(_0x3326a0[0x0]['language']==_0x421a94(0x190))var _0x50fea9=users[_0x421a94(0x190)];else{if(_0x3326a0[0x0][_0x421a94(0x112)]==_0x421a94(0x10c))var _0x50fea9=users[_0x421a94(0x10c)];else{if(_0x3326a0[0x0][_0x421a94(0x112)]==_0x421a94(0xdb))var _0x50fea9=users[_0x421a94(0xdb)];else{if(_0x3326a0[0x0]['language']=='French')var _0x50fea9=users['French'];else{if(_0x3326a0[0x0][_0x421a94(0x112)]==_0x421a94(0x102))var _0x50fea9=users[_0x421a94(0xe1)];else{if(_0x3326a0[0x0][_0x421a94(0x112)]==_0x421a94(0xe4))var _0x50fea9=users['Chinese'];else{if(_0x3326a0[0x0]['language']==_0x421a94(0x1ce))var _0x50fea9=users[_0x421a94(0x12b)];}}}}}}}_0x23a081[_0x421a94(0x188)](_0x421a94(0x151),{'success':_0x454f04[_0x421a94(0xdc)](_0x421a94(0x17a)),'errors':_0x454f04[_0x421a94(0xdc)](_0x421a94(0x176)),'role':_0x457e25,'profile':_0x353b55,'customer':_0x3d7d0a,'warehouse':_0xf57965,'product':_0x27bced,'user':_0x472388,'master_shop':_0x3326a0,'unit':_0x2c9bfc,'language':_0x50fea9,'suppliers':_0x3cf8eb,'dataSelected':_0x547a63});}catch(_0x168c89){console[_0x421a94(0x1d6)](_0x168c89);}}),router[a0_0x5f14e8(0x1d3)](a0_0x5f14e8(0x103),auth,async(_0x3fffe8,_0x5ea36f)=>{var _0xaa4ef9=a0_0x5f14e8;try{const _0x52a1ba=_0x3fffe8[_0xaa4ef9(0x16d)]['id'],{invoice:_0x4d17b7,warehouse_name:_0x157979,Room_name:_0xd042a7}=_0x3fffe8[_0xaa4ef9(0x18e)],_0x180a68=await warehouse[_0xaa4ef9(0x1cd)]({'name':_0x157979,'room':_0xd042a7}),_0x3fae77=await purchases[_0xaa4ef9(0x1cd)]({'invoice':_0x4d17b7});_0x3fae77[_0xaa4ef9(0x163)][_0xaa4ef9(0xeb)](_0x3c533d=>{var _0x450219=_0xaa4ef9,_0x526b85=0x0;const _0x338ccd=_0x180a68[_0x450219(0x1dd)][_0x450219(0x134)](_0x17839e=>{var _0x4a5569=_0x450219;_0x17839e[_0x4a5569(0x11d)]==_0x3c533d[_0x4a5569(0x11d)]&&_0x17839e['floorlevel']==_0x3c533d['floorlevel']&&_0x17839e['type']==_0x3c533d[_0x4a5569(0x187)]&&_0x17839e[_0x4a5569(0x1ad)]==_0x3c533d[_0x4a5569(0x1ad)]&&_0x17839e['bay']==_0x3c533d[_0x4a5569(0x1df)]&&_0x17839e['rack']==_0x3c533d['rack']&&_0x17839e['storage']==_0x3c533d[_0x4a5569(0x1e7)]&&_0x17839e[_0x4a5569(0x14b)]==_0x3c533d['expiry_date']&&_0x17839e['batch_code']==_0x3c533d[_0x4a5569(0x1b5)]&&_0x17839e[_0x4a5569(0x110)]==_0x3c533d['production_date']&&_0x17839e[_0x4a5569(0x164)]==_0x3c533d[_0x4a5569(0x164)]&&_0x17839e['delivery_code']==_0x3c533d['delivery_code']&&(_0x17839e['product_stock']=parseInt(_0x17839e[_0x4a5569(0x123)])+parseInt(_0x3c533d[_0x4a5569(0x143)]),_0x526b85++);});_0x526b85=='0'&&(_0x180a68[_0x450219(0x1dd)]=_0x180a68[_0x450219(0x1dd)][_0x450219(0x132)]({'product_name':_0x3c533d[_0x450219(0x11d)],'product_stock':_0x3c533d[_0x450219(0x143)],'primary_code':_0x3c533d[_0x450219(0x1b6)],'secondary_code':_0x3c533d['secondary_code'],'product_code':_0x3c533d[_0x450219(0x1a0)],'storage':_0x3c533d[_0x450219(0x1e7)],'rack':_0x3c533d[_0x450219(0x14f)],'bay':_0x3c533d[_0x450219(0x1df)],'bin':_0x3c533d[_0x450219(0x1ad)],'type':_0x3c533d[_0x450219(0x187)],'floorlevel':_0x3c533d[_0x450219(0x1c8)],'maxProducts':_0x3c533d[_0x450219(0x1d0)],'unit':_0x3c533d['standard_unit'],'secondary_unit':_0x3c533d[_0x450219(0x142)],'expiry_date':_0x3c533d[_0x450219(0x14b)],'maxPerUnit':_0x3c533d[_0x450219(0x1d2)],'batch_code':_0x3c533d[_0x450219(0x1b5)],'alertQTY':_0x3c533d['alertQTY'],'production_date':_0x3c533d['production_date'],'delivery_date':_0x3c533d[_0x450219(0x164)],'delivery_code':_0x3c533d[_0x450219(0x127)]}));}),await _0x180a68[_0xaa4ef9(0x1cb)](),_0x3fae77[_0xaa4ef9(0x106)]=_0xaa4ef9(0x1a5);const _0xa8593a=await _0x3fae77[_0xaa4ef9(0x1cb)]();_0x3fffe8[_0xaa4ef9(0xdc)]('success','Sales\x20Update\x20successfully'),_0x5ea36f[_0xaa4ef9(0xfc)](_0xaa4ef9(0x162));}catch(_0x3ddb70){console[_0xaa4ef9(0x1d6)](_0x3ddb70);}}),router[a0_0x5f14e8(0x1b4)](a0_0x5f14e8(0x1b8),auth,async(_0x2ca818,_0x243257)=>{var _0x1b8592=a0_0x5f14e8;try{const {username:_0x3c8814,email:_0x5263db,role:_0x1aa74d}=_0x2ca818[_0x1b8592(0x1b7)],_0x5ea762=_0x2ca818[_0x1b8592(0x1b7)],_0xbb613=await profile[_0x1b8592(0x1cd)]({'email':_0x5ea762[_0x1b8592(0x12a)]}),_0x152a4e=await master_shop['find'](),_0x309205=_0x2ca818[_0x1b8592(0x16d)]['id'],_0x4e6d61=await purchases[_0x1b8592(0x15d)](_0x309205),_0x4c7d9e=await suppliers[_0x1b8592(0x1db)]({});let _0x5cee1b;if(_0x5ea762['role']=='staff'){const _0x2850c3=await staff['findOne']({'email':_0x5ea762[_0x1b8592(0x12a)]});_0x5cee1b=await warehouse[_0x1b8592(0x1db)]({'status':_0x1b8592(0x11b),'name':_0x2850c3[_0x1b8592(0x130)],'warehouse_category':_0x1b8592(0x1c2)});}else _0x5cee1b=await warehouse[_0x1b8592(0xe8)]([{'$match':{'status':_0x1b8592(0x11b),'warehouse_category':_0x1b8592(0x1c2)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x209f3d=await product[_0x1b8592(0x1db)]({}),_0x10f787=BayBinSelected(_0x4e6d61[_0x1b8592(0x198)],_0x4e6d61['room']);let _0x921cef=new Date(_0x4e6d61[_0x1b8592(0x14b)]),_0x381642=('0'+_0x921cef[_0x1b8592(0xf8)]())[_0x1b8592(0x1a3)](-0x2),_0x524461=('0'+(_0x921cef[_0x1b8592(0x17f)]()+0x1))[_0x1b8592(0x1a3)](-0x2),_0x4d62da=_0x921cef[_0x1b8592(0x1a2)](),_0x221399=_0x4d62da+'-'+_0x524461+'-'+_0x381642;if(_0x152a4e[0x0][_0x1b8592(0x112)]==_0x1b8592(0x1a9)){var _0x32f75a=users[_0x1b8592(0x121)];console[_0x1b8592(0x1d6)](_0x32f75a);}else{if(_0x152a4e[0x0][_0x1b8592(0x112)]==_0x1b8592(0x190))var _0x32f75a=users[_0x1b8592(0x190)];else{if(_0x152a4e[0x0][_0x1b8592(0x112)]==_0x1b8592(0x10c))var _0x32f75a=users[_0x1b8592(0x10c)];else{if(_0x152a4e[0x0][_0x1b8592(0x112)]==_0x1b8592(0xdb))var _0x32f75a=users['Spanish'];else{if(_0x152a4e[0x0][_0x1b8592(0x112)]==_0x1b8592(0x148))var _0x32f75a=users['French'];else{if(_0x152a4e[0x0][_0x1b8592(0x112)]==_0x1b8592(0x102))var _0x32f75a=users[_0x1b8592(0xe1)];else{if(_0x152a4e[0x0][_0x1b8592(0x112)]=='Chinese')var _0x32f75a=users[_0x1b8592(0xe4)];else{if(_0x152a4e[0x0][_0x1b8592(0x112)]==_0x1b8592(0x1ce))var _0x32f75a=users[_0x1b8592(0x12b)];}}}}}}}_0x243257[_0x1b8592(0x188)](_0x1b8592(0xdd),{'success':_0x2ca818['flash'](_0x1b8592(0x17a)),'errors':_0x2ca818[_0x1b8592(0xdc)](_0x1b8592(0x176)),'role':_0x5ea762,'profile':_0xbb613,'purchases':_0x4e6d61,'suppliers':_0x4c7d9e,'warehouse':_0x5cee1b,'product':_0x209f3d,'master_shop':_0x152a4e,'language':_0x32f75a,'ed_fullDate':_0x221399,'dataSelected':_0x10f787});}catch(_0x5727ea){console[_0x1b8592(0x1d6)](_0x5727ea);}}),router[a0_0x5f14e8(0x1d3)](a0_0x5f14e8(0x1b8),auth,async(_0x109911,_0x5350bc)=>{var _0x3c9cc7=a0_0x5f14e8;try{const _0x42daac=_0x109911[_0x3c9cc7(0x16d)]['id'],_0xbff226=await purchases['findOne']({'_id':_0x109911['params']['id']}),_0x1c7ef8=await warehouse[_0x3c9cc7(0x1cd)]({'name':_0xbff226[_0x3c9cc7(0x198)],'room':_0xbff226[_0x3c9cc7(0x1e4)]});_0xbff226[_0x3c9cc7(0x163)][_0x3c9cc7(0xeb)](_0x157ec4=>{var _0x3ac152=_0x3c9cc7;const _0x179cb5=_0x1c7ef8[_0x3ac152(0x1dd)]['map'](_0x414120=>{var _0xe14b08=_0x3ac152;_0x414120['product_name']==_0x157ec4[_0xe14b08(0x11d)]&&_0x414120[_0xe14b08(0x1c8)]==_0x157ec4[_0xe14b08(0x1c8)]&&_0x414120[_0xe14b08(0x187)]==_0x157ec4[_0xe14b08(0x187)]&&_0x414120['bin']==_0x157ec4['bin']&&_0x414120[_0xe14b08(0x1df)]==_0x157ec4[_0xe14b08(0x1df)]&&_0x414120[_0xe14b08(0x14f)]==_0x157ec4[_0xe14b08(0x14f)]&&_0x414120[_0xe14b08(0x1e7)]==_0x157ec4['storage']&&(_0x414120['product_stock']=parseInt(_0x414120[_0xe14b08(0x123)])-parseInt(_0x157ec4['quantity']));});}),await _0x1c7ef8['save']();const {invoice:_0x3bb2c3,suppliers:_0x256fc6,date:_0x5e583f,warehouse_name:_0x2e0e3f,prod_name:_0x5382c9,prod_code:_0x5e688d,prod_qty:_0x235899,prod_unit:_0x2f19b5,prod_secondunit:_0x2cd54d,prod_level:_0x83ebab,prod_isle:_0x1c210f,prod_pallet:_0x207780,note:_0x3d9d35,expiry_date:_0x514c60,batch_code:_0x4f1c74,paid_amount:_0x537f18,due_amount:_0x5c4a7d,Room_name:_0xec21e1,primary_code:_0x9e68e1,secondary_code:_0x2f7ba4,PO_number:_0x25c89a,JO_number:_0x567364}=_0x109911[_0x3c9cc7(0x18e)];if(typeof _0x5382c9=='string')var _0x5522ae=[_0x109911['body'][_0x3c9cc7(0x18f)]],_0x394270=[_0x109911[_0x3c9cc7(0x18e)][_0x3c9cc7(0x140)]],_0x5930aa=[_0x109911['body']['prod_qty']],_0x46d6db=[_0x109911[_0x3c9cc7(0x18e)][_0x3c9cc7(0x184)]],_0x1bd5a7=[_0x109911[_0x3c9cc7(0x18e)][_0x3c9cc7(0x11e)]],_0x5908d7=[_0x109911[_0x3c9cc7(0x18e)][_0x3c9cc7(0xef)]],_0x4a41b2=[_0x109911[_0x3c9cc7(0x18e)][_0x3c9cc7(0xf3)]],_0x1c0f5b=[_0x109911[_0x3c9cc7(0x18e)][_0x3c9cc7(0x108)]],_0x335ef4=[_0x109911[_0x3c9cc7(0x18e)][_0x3c9cc7(0x1b6)]],_0x346e45=[_0x109911[_0x3c9cc7(0x18e)][_0x3c9cc7(0x193)]],_0x2a4c14=[_0x109911['body'][_0x3c9cc7(0x133)]],_0x538532=[_0x109911[_0x3c9cc7(0x18e)]['batch_code']],_0x1a1119=[_0x109911[_0x3c9cc7(0x18e)][_0x3c9cc7(0x14b)]],_0x571a22=[_0x109911[_0x3c9cc7(0x18e)]['storage']],_0x558595=[_0x109911[_0x3c9cc7(0x18e)][_0x3c9cc7(0x1d7)]],_0x10f791=[_0x109911[_0x3c9cc7(0x18e)][_0x3c9cc7(0x187)]];else var _0x5522ae=[..._0x109911['body']['prod_name']],_0x394270=[..._0x109911[_0x3c9cc7(0x18e)][_0x3c9cc7(0x140)]],_0x5930aa=[..._0x109911[_0x3c9cc7(0x18e)][_0x3c9cc7(0x19d)]],_0x46d6db=[..._0x109911[_0x3c9cc7(0x18e)][_0x3c9cc7(0x184)]],_0x1bd5a7=[..._0x109911[_0x3c9cc7(0x18e)]['prod_secondunit']],_0x5908d7=[..._0x109911[_0x3c9cc7(0x18e)][_0x3c9cc7(0xef)]],_0x4a41b2=[..._0x109911[_0x3c9cc7(0x18e)]['prod_isle']],_0x1c0f5b=[..._0x109911[_0x3c9cc7(0x18e)][_0x3c9cc7(0x108)]],_0x335ef4=[..._0x109911['body'][_0x3c9cc7(0x1b6)]],_0x346e45=[..._0x109911[_0x3c9cc7(0x18e)]['secondary_code']],_0x2a4c14=[..._0x109911[_0x3c9cc7(0x18e)][_0x3c9cc7(0x133)]],_0x538532=[..._0x109911[_0x3c9cc7(0x18e)]['batch_code']],_0x1a1119=[..._0x109911[_0x3c9cc7(0x18e)][_0x3c9cc7(0x14b)]],_0x571a22=[..._0x109911[_0x3c9cc7(0x18e)][_0x3c9cc7(0x1e7)]],_0x558595=[..._0x109911['body']['rak']],_0x10f791=[..._0x109911['body'][_0x3c9cc7(0x187)]];const _0x529db2=_0x5522ae[_0x3c9cc7(0x134)](_0x290fc2=>{return _0x290fc2={'product_name':_0x290fc2};});_0x394270[_0x3c9cc7(0xeb)]((_0x5cf3af,_0x5d0d9f)=>{_0x529db2[_0x5d0d9f]['product_code']=_0x5cf3af;}),_0x5930aa[_0x3c9cc7(0xeb)]((_0xb3b7a6,_0x59c9f2)=>{var _0x58a091=_0x3c9cc7;_0x529db2[_0x59c9f2][_0x58a091(0x143)]=_0xb3b7a6;}),_0x46d6db[_0x3c9cc7(0xeb)]((_0x4423ff,_0x49468b)=>{var _0x3ac88f=_0x3c9cc7;_0x529db2[_0x49468b][_0x3ac88f(0x141)]=_0x4423ff;}),_0x1bd5a7['forEach']((_0x37d461,_0x2ec3cd)=>{var _0x125912=_0x3c9cc7;_0x529db2[_0x2ec3cd][_0x125912(0x142)]=_0x37d461;}),_0x5908d7[_0x3c9cc7(0xeb)]((_0x33f32c,_0x3892c0)=>{var _0x52a723=_0x3c9cc7;_0x529db2[_0x3892c0][_0x52a723(0x1df)]=_0x33f32c;}),_0x4a41b2[_0x3c9cc7(0xeb)]((_0x87474d,_0xc7fdfe)=>{var _0x38fef8=_0x3c9cc7;_0x529db2[_0xc7fdfe][_0x38fef8(0x1ad)]=_0x87474d;}),_0x1c0f5b[_0x3c9cc7(0xeb)]((_0xc3bef7,_0x4c1f5e)=>{var _0x512726=_0x3c9cc7;_0x529db2[_0x4c1f5e][_0x512726(0x1c8)]=_0xc3bef7;}),_0x335ef4[_0x3c9cc7(0xeb)]((_0x496e1d,_0x6fc82c)=>{_0x529db2[_0x6fc82c]['primary_code']=_0x496e1d;}),_0x346e45['forEach']((_0x56b428,_0x2d30ea)=>{var _0x462eb7=_0x3c9cc7;_0x529db2[_0x2d30ea][_0x462eb7(0x193)]=_0x56b428;}),_0x2a4c14[_0x3c9cc7(0xeb)]((_0x43306e,_0x478645)=>{var _0x53a130=_0x3c9cc7;_0x529db2[_0x478645][_0x53a130(0x1d0)]=_0x43306e;}),_0x538532[_0x3c9cc7(0xeb)]((_0x41c1a9,_0x51bdfd)=>{var _0x1eed3a=_0x3c9cc7;_0x529db2[_0x51bdfd][_0x1eed3a(0x1b5)]=_0x41c1a9;}),_0x1a1119['forEach']((_0x9e576f,_0x8f14b9)=>{var _0x5ee51c=_0x3c9cc7;_0x529db2[_0x8f14b9][_0x5ee51c(0x14b)]=_0x9e576f;}),_0x10f791[_0x3c9cc7(0xeb)]((_0x2341f6,_0x2f4ad8)=>{var _0x2286c0=_0x3c9cc7;_0x529db2[_0x2f4ad8][_0x2286c0(0x187)]=_0x2341f6;}),_0x571a22[_0x3c9cc7(0xeb)]((_0x1e7fdb,_0xc58f1f)=>{var _0x2bc994=_0x3c9cc7;_0x529db2[_0xc58f1f][_0x2bc994(0x1e7)]=_0x1e7fdb;}),_0x558595[_0x3c9cc7(0xeb)]((_0x21b514,_0x12a112)=>{var _0x263aab=_0x3c9cc7;_0x529db2[_0x12a112][_0x263aab(0x14f)]=_0x21b514;});const _0x3688c4=_0x529db2[_0x3c9cc7(0x1b3)](_0x365608=>_0x365608[_0x3c9cc7(0x143)]!=='0'&&_0x365608['quantity']!=='');_0xbff226['invoice']=_0x3bb2c3,_0xbff226[_0x3c9cc7(0xf4)]=_0x256fc6,_0xbff226[_0x3c9cc7(0x10e)]=_0x5e583f,_0xbff226['warehouse_name']=_0x2e0e3f,_0xbff226[_0x3c9cc7(0x163)]=_0x3688c4,_0xbff226[_0x3c9cc7(0xde)]=_0x3d9d35,_0xbff226[_0x3c9cc7(0x14e)]=_0x537f18,_0xbff226[_0x3c9cc7(0x1c3)]=_0x5c4a7d,_0xbff226[_0x3c9cc7(0x1e4)]=_0xec21e1,_0xbff226[_0x3c9cc7(0xfa)]=_0x25c89a,_0xbff226[_0x3c9cc7(0xf9)]=_0x567364;const _0x15e129=await _0xbff226[_0x3c9cc7(0x1cb)](),_0x5d9db3=await warehouse['findOne']({'name':_0x109911[_0x3c9cc7(0x18e)][_0x3c9cc7(0x198)],'room':_0x109911[_0x3c9cc7(0x18e)][_0x3c9cc7(0x180)]});_0xbff226[_0x3c9cc7(0x163)][_0x3c9cc7(0xeb)](_0x150e58=>{var _0x1f4575=_0x3c9cc7,_0x3e8f13=0x0;const _0x5b1461=_0x5d9db3[_0x1f4575(0x1dd)]['map'](_0x484a96=>{var _0x1dc8b9=_0x1f4575;_0x484a96[_0x1dc8b9(0x11d)]==_0x150e58[_0x1dc8b9(0x11d)]&&_0x484a96[_0x1dc8b9(0x1c8)]==_0x150e58[_0x1dc8b9(0x1c8)]&&_0x484a96[_0x1dc8b9(0x187)]==_0x150e58[_0x1dc8b9(0x187)]&&_0x484a96[_0x1dc8b9(0x1ad)]==_0x150e58[_0x1dc8b9(0x1ad)]&&_0x484a96[_0x1dc8b9(0x1df)]==_0x150e58['bay']&&_0x484a96['rack']==_0x150e58['rack']&&_0x484a96[_0x1dc8b9(0x1e7)]==_0x150e58[_0x1dc8b9(0x1e7)]&&(_0x484a96[_0x1dc8b9(0x123)]=parseInt(_0x484a96['product_stock'])+parseInt(_0x150e58[_0x1dc8b9(0x143)]),_0x3e8f13++);});_0x3e8f13=='0'&&(_0x5d9db3[_0x1f4575(0x1dd)]=_0x5d9db3[_0x1f4575(0x1dd)]['concat']({'product_name':_0x150e58[_0x1f4575(0x11d)],'product_stock':_0x150e58[_0x1f4575(0x143)],'primary_code':_0x150e58[_0x1f4575(0x1b6)],'secondary_code':_0x150e58[_0x1f4575(0x193)],'product_code':_0x150e58[_0x1f4575(0x1a0)],'storage':_0x150e58[_0x1f4575(0x1e7)],'rack':_0x150e58[_0x1f4575(0x14f)],'bay':_0x150e58[_0x1f4575(0x1df)],'bin':_0x150e58[_0x1f4575(0x1ad)],'type':_0x150e58[_0x1f4575(0x187)],'floorlevel':_0x150e58[_0x1f4575(0x1c8)],'maxProducts':_0x150e58[_0x1f4575(0x1d0)],'unit':_0x150e58[_0x1f4575(0x141)],'secondary_unit':_0x150e58[_0x1f4575(0x142)],'expiry_date':_0x150e58[_0x1f4575(0x14b)]}));}),await _0x5d9db3[_0x3c9cc7(0x1cb)]();const _0x2f2de6=await s_payment_data[_0x3c9cc7(0x1cd)]({'invoice':_0x109911[_0x3c9cc7(0x18e)][_0x3c9cc7(0x191)]});if(_0x2f2de6===null){}else console['log'](_0x3c9cc7(0xf4),_0x2f2de6,_0x109911[_0x3c9cc7(0x18e)][_0x3c9cc7(0x191)]),_0x2f2de6[_0x3c9cc7(0xf4)]=_0x109911['body'][_0x3c9cc7(0xf4)],await _0x2f2de6[_0x3c9cc7(0x1cb)]();_0x109911[_0x3c9cc7(0xdc)](_0x3c9cc7(0x17a),'purchase\x20data\x20update\x20successfully'),_0x5350bc[_0x3c9cc7(0xfc)](_0x3c9cc7(0x162));}catch(_0x86e92a){console[_0x3c9cc7(0x1d6)](_0x86e92a);}}),router[a0_0x5f14e8(0x1d3)](a0_0x5f14e8(0x1bd),auth,async(_0x3b080a,_0xeaa23c)=>{var _0xb7272e=a0_0x5f14e8;try{const _0x1e61ef=_0x3b080a[_0xb7272e(0x16d)]['id'],{invoice:_0x5e23f1,suppliers:_0x37b5e3,payable:_0x546592,due_amount:_0x70eb07}=_0x3b080a[_0xb7272e(0x18e)],_0x1ebea3=await purchases['findById'](_0x1e61ef);var _0x2594e3=_0x546592-_0x70eb07;_0x1ebea3[_0xb7272e(0x14e)]=parseFloat(_0x1ebea3[_0xb7272e(0x14e)])+parseFloat(_0x70eb07),_0x1ebea3[_0xb7272e(0x1c3)]=_0x2594e3;const _0x24f15b=await _0x1ebea3['save']();console[_0xb7272e(0x1d6)](_0x24f15b);const _0x495d15=await s_payment_data[_0xb7272e(0x1cd)]({'invoice':_0x5e23f1});_0x495d15[_0xb7272e(0x10b)]=_0x2594e3,await _0x495d15[_0xb7272e(0x1cb)]();let _0x28d296=new Date(),_0x39b08d=('0'+_0x28d296[_0xb7272e(0xf8)]())[_0xb7272e(0x1a3)](-0x2),_0x33deab=('0'+(_0x28d296[_0xb7272e(0x17f)]()+0x1))['slice'](-0x2),_0xbbbf7=_0x28d296[_0xb7272e(0x1a2)](),_0x5dd7e8=_0xbbbf7+'-'+_0x33deab+'-'+_0x39b08d;const _0x4e890f=new suppliers_payment({'invoice':_0x5e23f1,'date':_0xbbbf7+'-'+_0x33deab+'-'+_0x39b08d,'suppliers':_0x37b5e3,'reason':'Paid\x20For\x20Purchase','amount':_0x70eb07}),_0x4c881c=await _0x4e890f[_0xb7272e(0x1cb)]();_0x3b080a[_0xb7272e(0xdc)]('success',_0xb7272e(0x124)),_0xeaa23c['redirect'](_0xb7272e(0x162));}catch(_0x1b61dc){console[_0xb7272e(0x1d6)](_0x1b61dc);}}),router[a0_0x5f14e8(0x1b4)](a0_0x5f14e8(0x1cc),auth,async(_0x255d84,_0x41da56)=>{var _0x3b2759=a0_0x5f14e8;try{const {username:_0x3d12bb,email:_0x33c163,role:_0x24d94c}=_0x255d84[_0x3b2759(0x1b7)],_0x52e138=_0x255d84[_0x3b2759(0x1b7)],_0x44a45b=await profile[_0x3b2759(0x1cd)]({'email':_0x52e138[_0x3b2759(0x12a)]}),_0x551eb6=await master_shop[_0x3b2759(0x1db)]();console[_0x3b2759(0x1d6)](_0x3b2759(0x19a),_0x551eb6);const _0x4a21fe=_0x255d84['params']['id'],_0x49ee29=await purchases[_0x3b2759(0x15d)](_0x4a21fe);console[_0x3b2759(0x1d6)](_0x49ee29);const _0x4a9acb=await suppliers[_0x3b2759(0x1cd)]({'name':_0x49ee29[_0x3b2759(0xf4)]});console[_0x3b2759(0x1d6)](_0x4a9acb);if(_0x551eb6[0x0][_0x3b2759(0x112)]==_0x3b2759(0x1a9)){var _0x5de3c6=users[_0x3b2759(0x121)];console['log'](_0x5de3c6);}else{if(_0x551eb6[0x0][_0x3b2759(0x112)]==_0x3b2759(0x190))var _0x5de3c6=users['Hindi'];else{if(_0x551eb6[0x0][_0x3b2759(0x112)]==_0x3b2759(0x10c))var _0x5de3c6=users['German'];else{if(_0x551eb6[0x0][_0x3b2759(0x112)]==_0x3b2759(0xdb))var _0x5de3c6=users[_0x3b2759(0xdb)];else{if(_0x551eb6[0x0][_0x3b2759(0x112)]==_0x3b2759(0x148))var _0x5de3c6=users[_0x3b2759(0x148)];else{if(_0x551eb6[0x0][_0x3b2759(0x112)]==_0x3b2759(0x102))var _0x5de3c6=users['Portuguese'];else{if(_0x551eb6[0x0][_0x3b2759(0x112)]=='Chinese')var _0x5de3c6=users[_0x3b2759(0xe4)];else{if(_0x551eb6[0x0][_0x3b2759(0x112)]==_0x3b2759(0x1ce))var _0x5de3c6=users[_0x3b2759(0x12b)];}}}}}}}_0x41da56['render']('purchase_invoice',{'success':_0x255d84['flash'](_0x3b2759(0x17a)),'errors':_0x255d84[_0x3b2759(0xdc)](_0x3b2759(0x176)),'role':_0x52e138,'profile':_0x44a45b,'master_shop':_0x551eb6,'supplier':_0x4a9acb,'purchase':_0x49ee29,'language':_0x5de3c6});}catch(_0x3d8d11){console[_0x3b2759(0x1d6)](_0x3d8d11);}}),router['get']('/view/return_purchase/:id',auth,async(_0x3d675b,_0x38eff2)=>{var _0x46fd66=a0_0x5f14e8;try{const {username:_0x341fa4,email:_0x3ec20e,role:_0x3a0da4}=_0x3d675b['user'],_0x20e8ba=_0x3d675b[_0x46fd66(0x1b7)],_0x253ac7=await profile[_0x46fd66(0x1cd)]({'email':_0x20e8ba[_0x46fd66(0x12a)]}),_0x458499=await master_shop['find']();console[_0x46fd66(0x1d6)](_0x46fd66(0x19a),_0x458499);const _0x4ed9c4=_0x3d675b[_0x46fd66(0x16d)]['id'];console[_0x46fd66(0x1d6)](_0x4ed9c4);const _0x504d06=await purchases[_0x46fd66(0x15d)](_0x4ed9c4);console[_0x46fd66(0x1d6)](_0x46fd66(0x1da),_0x504d06);const _0xe05c8d=await product[_0x46fd66(0x1db)]({}),_0x4cd3b8=await warehouse[_0x46fd66(0xe8)]([{'$match':{'name':_0x504d06[_0x46fd66(0x198)],'room':_0x504d06['room'],'warehouse_category':'Raw\x20Materials'}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':_0x46fd66(0x182)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x46fd66(0x1b1)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x46fd66(0x1c4)},'floorlevel':{'$first':_0x46fd66(0xea)},'primary_code':{'$first':_0x46fd66(0x1d8)},'secondary_code':{'$first':_0x46fd66(0x1bf)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x46fd66(0x1a1)},'rack':{'$first':_0x46fd66(0x170)}}}]);warehouse_data=await warehouse[_0x46fd66(0xe8)]([{'$match':{'status':_0x46fd66(0x11b),'name':'Return\x20Goods','warehouse_category':_0x46fd66(0x1c2)}},{'$group':{'_id':_0x46fd66(0x16f),'name':{'$first':_0x46fd66(0x16f)}}},{'$sort':{'name':0x1}}]),console[_0x46fd66(0x1d6)](_0x46fd66(0x135),_0x4cd3b8);if(_0x458499[0x0][_0x46fd66(0x112)]==_0x46fd66(0x1a9)){var _0x1263c5=users[_0x46fd66(0x121)];console[_0x46fd66(0x1d6)](_0x1263c5);}else{if(_0x458499[0x0][_0x46fd66(0x112)]=='Hindi')var _0x1263c5=users[_0x46fd66(0x190)];else{if(_0x458499[0x0][_0x46fd66(0x112)]==_0x46fd66(0x10c))var _0x1263c5=users[_0x46fd66(0x10c)];else{if(_0x458499[0x0][_0x46fd66(0x112)]==_0x46fd66(0xdb))var _0x1263c5=users[_0x46fd66(0xdb)];else{if(_0x458499[0x0][_0x46fd66(0x112)]==_0x46fd66(0x148))var _0x1263c5=users[_0x46fd66(0x148)];else{if(_0x458499[0x0][_0x46fd66(0x112)]==_0x46fd66(0x102))var _0x1263c5=users['Portuguese'];else{if(_0x458499[0x0]['language']=='Chinese')var _0x1263c5=users[_0x46fd66(0xe4)];else{if(_0x458499[0x0][_0x46fd66(0x112)]=='Arabic\x20(ae)')var _0x1263c5=users[_0x46fd66(0x12b)];}}}}}}}_0x38eff2[_0x46fd66(0x188)](_0x46fd66(0x11c),{'success':_0x3d675b[_0x46fd66(0xdc)](_0x46fd66(0x17a)),'errors':_0x3d675b['flash']('errors'),'role':_0x20e8ba,'profile':_0x253ac7,'user':_0x504d06,'stock':_0x4cd3b8,'master_shop':_0x458499,'product':_0xe05c8d,'language':_0x1263c5,'warehouse':warehouse_data});}catch(_0x1237a7){console['log'](_0x1237a7);}}),router['post'](a0_0x5f14e8(0x13f),auth,async(_0x2241af,_0xa50df1)=>{var _0x17cc0b=a0_0x5f14e8;try{const {invoice:_0xf487ad,date:_0x41ab1e,warehouse_name:_0x26eac1,Room_name:_0x4e5211,product_name:_0x5c9e6b,purchase_quantity:_0x5c92fc,stocks:_0x7e3291,return_qty:_0x39780b,note:_0xa6a209,level:_0x47f579,isle:_0x25507a,pallet:_0xedf08f,to_warehouse_name:_0x238380,to_Room_name:_0x342cde}=_0x2241af[_0x17cc0b(0x18e)],_0x3945bb=await purchases[_0x17cc0b(0x1cd)]({'_id':_0x2241af[_0x17cc0b(0x16d)]['id']}),_0x3cbe10=await warehouse['findOne']({'name':_0x26eac1,'room':_0x4e5211});if(typeof _0x5c9e6b==_0x17cc0b(0x1b2))var _0x334583=[_0x2241af['body'][_0x17cc0b(0x11d)]],_0x2e6729=[_0x2241af[_0x17cc0b(0x18e)]['purchase_quantity']],_0x737b22=[_0x2241af[_0x17cc0b(0x18e)][_0x17cc0b(0x194)]],_0xd761b2=[_0x2241af[_0x17cc0b(0x18e)][_0x17cc0b(0xdf)]],_0x39bea2=[_0x2241af['body'][_0x17cc0b(0x178)]],_0x14cc61=[_0x2241af[_0x17cc0b(0x18e)][_0x17cc0b(0x13c)]],_0x3d1f7a=[_0x2241af['body'][_0x17cc0b(0x173)]],_0x2d6fbf=[_0x2241af['body']['types']],_0x3df3fe=[_0x2241af[_0x17cc0b(0x18e)][_0x17cc0b(0x168)]],_0x4a4573=[_0x2241af[_0x17cc0b(0x18e)][_0x17cc0b(0x1d9)]],_0x8a7d40=[_0x2241af[_0x17cc0b(0x18e)][_0x17cc0b(0xda)]];else var _0x334583=[..._0x2241af['body'][_0x17cc0b(0x11d)]],_0x2e6729=[..._0x2241af['body'][_0x17cc0b(0x1c6)]],_0x737b22=[..._0x2241af[_0x17cc0b(0x18e)][_0x17cc0b(0x194)]],_0xd761b2=[..._0x2241af[_0x17cc0b(0x18e)][_0x17cc0b(0xdf)]],_0x39bea2=[..._0x2241af[_0x17cc0b(0x18e)]['level']],_0x14cc61=[..._0x2241af[_0x17cc0b(0x18e)][_0x17cc0b(0x13c)]],_0x3d1f7a=[..._0x2241af['body'][_0x17cc0b(0x173)]],_0x2d6fbf=[..._0x2241af['body']['types']],_0x3df3fe=[..._0x2241af[_0x17cc0b(0x18e)][_0x17cc0b(0x168)]],_0x4a4573=[..._0x2241af[_0x17cc0b(0x18e)][_0x17cc0b(0x1d9)]],_0x8a7d40=[..._0x2241af['body'][_0x17cc0b(0xda)]];const _0x276ee5=_0x334583[_0x17cc0b(0x134)](_0x30b18a=>{return _0x30b18a={'product_name':_0x30b18a};});_0x2e6729[_0x17cc0b(0xeb)]((_0x389094,_0x1313d7)=>{var _0x22cdfc=_0x17cc0b;_0x276ee5[_0x1313d7][_0x22cdfc(0x1c6)]=_0x389094;}),_0x737b22[_0x17cc0b(0xeb)]((_0x2d365a,_0x1f94ae)=>{_0x276ee5[_0x1f94ae]['stock_quantity']=_0x2d365a;}),_0xd761b2[_0x17cc0b(0xeb)]((_0x1e8fdb,_0x3c2fe4)=>{var _0x2f5559=_0x17cc0b;_0x276ee5[_0x3c2fe4][_0x2f5559(0xdf)]=_0x1e8fdb;}),_0x39bea2[_0x17cc0b(0xeb)]((_0x576107,_0x3a9be5)=>{var _0x25338e=_0x17cc0b;_0x276ee5[_0x3a9be5][_0x25338e(0x1df)]=_0x576107;}),_0x14cc61[_0x17cc0b(0xeb)]((_0x6adae8,_0x16e39b)=>{_0x276ee5[_0x16e39b]['bin']=_0x6adae8;}),_0x3d1f7a[_0x17cc0b(0xeb)]((_0x476786,_0x38c986)=>{var _0x12e872=_0x17cc0b;_0x276ee5[_0x38c986][_0x12e872(0x1c8)]=_0x476786;}),_0x2d6fbf[_0x17cc0b(0xeb)]((_0x568191,_0xa8e387)=>{var _0x4d4fe0=_0x17cc0b;_0x276ee5[_0xa8e387][_0x4d4fe0(0x187)]=_0x568191;}),_0x3df3fe['forEach']((_0x3c62c5,_0xa34d22)=>{var _0x59cdf6=_0x17cc0b;_0x276ee5[_0xa34d22][_0x59cdf6(0x1a0)]=_0x3c62c5;}),_0x4a4573[_0x17cc0b(0xeb)]((_0x3b590e,_0x32eb21)=>{var _0x1f6953=_0x17cc0b;_0x276ee5[_0x32eb21][_0x1f6953(0x1b6)]=_0x3b590e;}),_0x8a7d40[_0x17cc0b(0xeb)]((_0x3c04c8,_0x21c0aa)=>{_0x276ee5[_0x21c0aa]['secondary_code']=_0x3c04c8;}),_0x3945bb['product']['forEach'](_0x43f316=>{var _0xcbf380=_0x17cc0b;const _0xf9e81c=_0x3cbe10[_0xcbf380(0x1dd)]['map'](_0x37eb74=>{var _0x2040d1=_0xcbf380;_0x37eb74[_0x2040d1(0x11d)]==_0x43f316[_0x2040d1(0x11d)]&&_0x37eb74[_0x2040d1(0x1c8)]==_0x43f316[_0x2040d1(0x1c8)]&&_0x37eb74['type']==_0x43f316[_0x2040d1(0x187)]&&_0x37eb74['bin']==_0x43f316['bin']&&_0x37eb74[_0x2040d1(0x1df)]==_0x43f316[_0x2040d1(0x1df)]&&_0x37eb74[_0x2040d1(0x14f)]==_0x43f316[_0x2040d1(0x14f)]&&_0x37eb74[_0x2040d1(0x1e7)]==_0x43f316[_0x2040d1(0x1e7)]&&(console['log'](parseInt(_0x37eb74[_0x2040d1(0x123)])+_0x2040d1(0x1e3)+parseInt(_0x43f316[_0x2040d1(0x143)])),_0x37eb74[_0x2040d1(0x123)]=parseInt(_0x37eb74[_0x2040d1(0x123)])+parseInt(_0x43f316[_0x2040d1(0x143)]));});}),await _0x3cbe10[_0x17cc0b(0x1cb)]();const _0x2541f4=_0x276ee5[_0x17cc0b(0x1b3)](_0x4f9754=>_0x4f9754[_0x17cc0b(0xdf)]!=='0'&&_0x4f9754[_0x17cc0b(0xdf)]!=='');var _0x3bbb52=0x0;_0x2541f4[_0x17cc0b(0xeb)](_0x5d2f10=>{var _0x3b8aaf=_0x17cc0b;console[_0x3b8aaf(0x1d6)]('foreach\x20newproduct',_0x5d2f10),(parseInt(_0x5d2f10[_0x3b8aaf(0x1c6)])<parseInt(_0x5d2f10[_0x3b8aaf(0xdf)])||parseInt(_0x5d2f10[_0x3b8aaf(0x1e8)])<parseInt(_0x5d2f10[_0x3b8aaf(0xdf)]))&&_0x3bbb52++;});if(_0x3bbb52!=0x0)return _0x2241af[_0x17cc0b(0xdc)]('errors',_0x17cc0b(0x1c7)),_0xa50df1[_0x17cc0b(0xfc)](_0x17cc0b(0x129));const _0x20a831=new purchases_return({'invoice':_0xf487ad,'suppliers':_0x2241af[_0x17cc0b(0x18e)]['suppliers'],'date':_0x41ab1e,'warehouse_name':_0x26eac1,'return_product':_0x2541f4,'note':_0xa6a209,'room':_0x4e5211,'to_warehouse_name':_0x238380,'to_room':_0x342cde}),_0x4ed410=await _0x20a831[_0x17cc0b(0x1cb)]();console[_0x17cc0b(0x1d6)](_0x20a831);const _0x4a1ac0=await purchases_return[_0x17cc0b(0x1cd)]({'invoice':_0xf487ad}),_0x23f0aa=await warehouse['findOne']({'name':_0x238380,'room':_0x342cde});_0x4a1ac0[_0x17cc0b(0xee)][_0x17cc0b(0xeb)](_0x346079=>{var _0x278073=_0x17cc0b,_0x143d9f=0x0;const _0x4ed226=_0x23f0aa[_0x278073(0x1dd)]['map'](_0x4f8e04=>{var _0x617f1a=_0x278073;_0x4f8e04[_0x617f1a(0x11d)]==_0x346079['product_name']&&_0x4f8e04[_0x617f1a(0x1c8)]==_0x346079[_0x617f1a(0x1c8)]&&_0x4f8e04[_0x617f1a(0x187)]==_0x346079[_0x617f1a(0x187)]&&_0x4f8e04['bin']==_0x346079['bin']&&_0x4f8e04[_0x617f1a(0x1df)]==_0x346079[_0x617f1a(0x1df)]&&(_0x4f8e04['product_stock']=parseInt(_0x4f8e04[_0x617f1a(0x123)])-parseInt(_0x346079[_0x617f1a(0xdf)]),_0x143d9f++);});_0x143d9f=='0'&&(_0x23f0aa[_0x278073(0x1dd)]=_0x23f0aa[_0x278073(0x1dd)]['concat']({'product_name':_0x346079[_0x278073(0x11d)],'product_stock':_0x346079['return_qty'],'primary_code':_0x346079['primary_code'],'secondary_code':_0x346079[_0x278073(0x193)],'product_code':_0x346079['product_code'],'storage':_0x346079['storage'],'rack':_0x346079[_0x278073(0x14f)],'bay':_0x346079[_0x278073(0x1df)],'bin':_0x346079[_0x278073(0x1ad)],'type':_0x346079[_0x278073(0x187)],'floorlevel':_0x346079[_0x278073(0x1c8)],'maxProducts':_0x346079['maxStocks'],'unit':_0x346079[_0x278073(0x141)],'secondary_unit':_0x346079[_0x278073(0x142)],'expiry_date':_0x346079['expiry_date']}));}),await _0x23f0aa[_0x17cc0b(0x1cb)]();const _0x2c9b85=await purchases[_0x17cc0b(0x1cd)]({'invoice':_0xf487ad});_0x2c9b85[_0x17cc0b(0x145)]=_0x17cc0b(0x1a5);const _0x568e84=await _0x2c9b85[_0x17cc0b(0x1cb)](),_0x5392bf=new s_payment_data({'invoice':_0xf487ad,'suppliers':_0x2241af['body'][_0x17cc0b(0xf4)],'reason':'Purchase\x20Return'});await _0x5392bf[_0x17cc0b(0x1cb)]();const _0x8cb2cc=await master_shop[_0x17cc0b(0x1db)]();console[_0x17cc0b(0x1d6)]('add\x20post',_0x8cb2cc[0x0][_0x17cc0b(0x1be)]);const _0x44aa40=await email_settings['findOne'](),_0xa3b26f=await suppliers[_0x17cc0b(0x1cd)]({'name':_0x2241af['body'][_0x17cc0b(0xf4)]});console['log']('suppliers_data',_0xa3b26f);_0x8cb2cc[0x0][_0x17cc0b(0x177)]==0x1?(right_currency=_0x8cb2cc[0x0][_0x17cc0b(0x16b)],left_currency=''):(right_currency='',left_currency=_0x8cb2cc[0x0][_0x17cc0b(0x16b)]);var _0x1ce7d2=_0x334583,_0x16acf6=_0xd761b2,_0x5b8897='',_0x5cd274;for(_0x5cd274 in _0x1ce7d2){_0x5b8897+=_0x17cc0b(0x18c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1ce7d2[_0x5cd274]+_0x17cc0b(0x1af)+_0x17cc0b(0x16a)+_0x16acf6[_0x5cd274]+_0x17cc0b(0x1af)+_0x17cc0b(0x161);}console[_0x17cc0b(0x1d6)](_0x17cc0b(0x109),_0x5b8897);let _0x181f37=nodemailer[_0x17cc0b(0x19c)]({'service':_0x17cc0b(0x14a),'auth':{'user':_0x44aa40['email'],'pass':_0x44aa40[_0x17cc0b(0x1d4)]}}),_0x5e0735={'from':_0x44aa40[_0x17cc0b(0x12a)],'to':_0xa3b26f[_0x17cc0b(0x12a)],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':_0x17cc0b(0x1ae),'path':__dirname+_0x17cc0b(0x16c)+_0x17cc0b(0x17c)+_0x8cb2cc[0x0][_0x17cc0b(0x1be)],'cid':_0x17cc0b(0x1bc)}],'html':_0x17cc0b(0x15c)+_0x17cc0b(0x18d)+_0x17cc0b(0x18a)+_0x17cc0b(0x186)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x17cc0b(0x186)+_0x17cc0b(0x171)+_0x17cc0b(0x1e5)+'<div>'+_0x17cc0b(0x16e)+_0x8cb2cc[0x0][_0x17cc0b(0x101)]+_0x17cc0b(0x147)+_0x17cc0b(0x1e5)+_0x17cc0b(0x1e5)+_0x17cc0b(0x122)+_0x17cc0b(0x186)+_0x17cc0b(0x17d)+_0x17cc0b(0x1aa)+_0xf487ad+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0x41ab1e+'\x20'+_0x17cc0b(0x14d)+_0x17cc0b(0x1e6)+_0x17cc0b(0x1e5)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x17cc0b(0x12c)+_0x17cc0b(0x18c)+_0x17cc0b(0x15f)+_0x17cc0b(0xe6)+_0x17cc0b(0x1e1)+_0x17cc0b(0xe9)+_0x17cc0b(0x161)+_0x17cc0b(0x120)+_0x17cc0b(0x18b)+'\x20'+_0x5b8897+'\x20'+_0x17cc0b(0x159)+_0x17cc0b(0x152)+_0x17cc0b(0x186)+_0x17cc0b(0x1a7)+_0x17cc0b(0xe2)+_0x8cb2cc[0x0][_0x17cc0b(0x101)]+_0x17cc0b(0x1e6)+_0x17cc0b(0x1e5)+'</div>'+_0x17cc0b(0x156)};_0x181f37[_0x17cc0b(0x1c5)](_0x5e0735,function(_0x59a9cf,_0x56d909){var _0xccc85d=_0x17cc0b;_0x59a9cf?(console[_0xccc85d(0x1d6)](_0x59a9cf),console[_0xccc85d(0x1d6)](_0xccc85d(0x172))):console['log'](_0xccc85d(0x1b0));}),_0x2241af[_0x17cc0b(0xdc)](_0x17cc0b(0x17a),_0x17cc0b(0xfd)),_0xa50df1[_0x17cc0b(0xfc)](_0x17cc0b(0x162));}catch(_0x4a82fc){console['log'](_0x4a82fc),_0xa50df1[_0x17cc0b(0xd9)](0xc8)[_0x17cc0b(0x104)]({'message':_0x4a82fc[_0x17cc0b(0x114)]});}}),router[a0_0x5f14e8(0x1b4)](a0_0x5f14e8(0x157),auth,async(_0x222b8f,_0x94d761)=>{var _0x54b340=a0_0x5f14e8;try{const {username:_0x5d607e,email:_0x22aa5e,role:_0x5818f1}=_0x222b8f[_0x54b340(0x1b7)],_0x1f3235=_0x222b8f['user'],_0x2b19f5=await profile['findOne']({'email':_0x1f3235[_0x54b340(0x12a)]}),_0x4c3924=await master_shop[_0x54b340(0x1db)](),_0xa79c0=_0x222b8f[_0x54b340(0x16d)]['id'],_0x36e45f=await purchases['findById'](_0xa79c0);if(_0x4c3924[0x0][_0x54b340(0x112)]==_0x54b340(0x1a9))var _0x136b93=users[_0x54b340(0x121)];else{if(_0x4c3924[0x0]['language']=='Hindi')var _0x136b93=users[_0x54b340(0x190)];else{if(_0x4c3924[0x0][_0x54b340(0x112)]==_0x54b340(0x10c))var _0x136b93=users[_0x54b340(0x10c)];else{if(_0x4c3924[0x0][_0x54b340(0x112)]==_0x54b340(0xdb))var _0x136b93=users['Spanish'];else{if(_0x4c3924[0x0][_0x54b340(0x112)]==_0x54b340(0x148))var _0x136b93=users['French'];else{if(_0x4c3924[0x0][_0x54b340(0x112)]=='Portuguese\x20(BR)')var _0x136b93=users['Portuguese'];else{if(_0x4c3924[0x0][_0x54b340(0x112)]==_0x54b340(0xe4))var _0x136b93=users[_0x54b340(0xe4)];else{if(_0x4c3924[0x0][_0x54b340(0x112)]==_0x54b340(0x1ce))var _0x136b93=users[_0x54b340(0x12b)];}}}}}}}_0x94d761[_0x54b340(0x188)](_0x54b340(0xfb),{'success':_0x222b8f[_0x54b340(0xdc)](_0x54b340(0x17a)),'errors':_0x222b8f[_0x54b340(0xdc)](_0x54b340(0x176)),'role':_0x1f3235,'profile':_0x2b19f5,'alldata':_0x36e45f,'master_shop':_0x4c3924,'language':_0x136b93}),console[_0x54b340(0x1d6)](alldata);}catch(_0x413d85){console[_0x54b340(0x1d6)](_0x413d85);}}),router[a0_0x5f14e8(0x1d3)](a0_0x5f14e8(0x1dc),async(_0x29b2a0,_0x4e9723)=>{var _0x45f1ed=a0_0x5f14e8;const {product_code:_0x433137}=_0x29b2a0['body'];var _0x3b0a46;const _0x4455bd=await product['aggregate']([{'$match':{'primary_code':_0x433137,'product_category':_0x45f1ed(0x1c2)}},{'$group':{'_id':'$_id','name':{'$first':_0x45f1ed(0x16f)},'category':{'$first':_0x45f1ed(0x1c0)},'brand':{'$first':'$brand'},'unit':{'$first':_0x45f1ed(0x196)},'alertquantity':{'$first':_0x45f1ed(0x139)},'product_code':{'$first':_0x45f1ed(0x195)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x45f1ed(0x175)},'maxStocks':{'$first':_0x45f1ed(0x1a6)},'maxProdPerUnit':{'$first':_0x45f1ed(0x119)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x45f1ed(0x19f)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x2fe97c=await product[_0x45f1ed(0xe8)]([{'$match':{'secondary_code':_0x433137,'product_category':_0x45f1ed(0x1c2)}},{'$group':{'_id':'$_id','name':{'$first':_0x45f1ed(0x16f)},'category':{'$first':'$category'},'brand':{'$first':_0x45f1ed(0x153)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x45f1ed(0x139)},'product_code':{'$first':_0x45f1ed(0x195)},'primary_code':{'$first':_0x45f1ed(0x10d)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x45f1ed(0x1a6)},'maxProdPerUnit':{'$first':_0x45f1ed(0x119)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x45f1ed(0x19f)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x4455bd['length']>0x0)_0x3b0a46=_0x4455bd;else _0x2fe97c['length']>0x0&&(_0x3b0a46=_0x2fe97c);_0x4e9723[_0x45f1ed(0x104)](_0x3b0a46);}),router['post'](a0_0x5f14e8(0x17b),async(_0x666c28,_0x5caa0a)=>{var _0x3494a2=a0_0x5f14e8;const {primaryCode:_0x33f9e9,secondaryCode:_0x534f1a,productCode:_0x11bc72,bay:_0x1a2fcd,bin:_0xc27445,types:_0x48bbec,pallet:_0x6a2bf4,warehouses:_0x3524cc,room:_0x23aa1a}=_0x666c28[_0x3494a2(0x18e)];console[_0x3494a2(0x1d6)](_0x666c28['body']);try{const _0x359049=await warehouse[_0x3494a2(0xe8)]([{'$match':{'name':_0x3524cc,'room':_0x23aa1a}},{'$unwind':_0x3494a2(0xf6)},{'$match':{'product_details.bay':_0x1a2fcd,'product_details.bin':_0xc27445,'product_details.type':_0x48bbec}},{'$group':{'_id':_0x3494a2(0x15a),'name':{'$first':_0x3494a2(0x182)},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x3494a2(0xff)},'pallet':{'$first':_0x3494a2(0x131)},'maxProducts':{'$first':_0x3494a2(0x105)}}}]);_0x5caa0a[_0x3494a2(0xd9)](0xc8)[_0x3494a2(0x104)](_0x359049);}catch(_0x33e7ac){_0x5caa0a[_0x3494a2(0xd9)](0x194)[_0x3494a2(0x104)]({'message':_0x33e7ac[_0x3494a2(0x114)]});}}),module[a0_0x5f14e8(0x1bb)]=router;function a0_0x30b5(){var _0x1f9b7a=['5588472hebYWu','<div>','type','render','prod_Qty','</head><body>','<tbody\x20style=\x22text-align:\x20center;\x22>','<tr>','<html><head><title></title>','body','prod_name','Hindi','invoice','prod_cat','secondary_code','stocks','$product_code','$unit','length','warehouse_name','2UZhqLi','master','all','createTransport','prod_qty','$product.bin','$secondary_unit','product_code','$product_details.storage','getFullYear','slice','Return\x20Goods','True','$maxStocks','<strong>\x20Regards\x20</strong>','451615sPlVWI','English\x20(US)','\x20Order\x20Number\x20:\x20','$expiry_date','toString','bin','Logo.png','</td>','Email\x20sent\x20successfully','$product_details.bay','string','filter','get','batch_code','primary_code','user','/view/:id','9hucJKs','$product_details.product_stock','exports','logo','/give_payment/:id','image','$product_details.secondary_code','$category','room_name','Raw\x20Materials','due_amount','$product_details.type','sendMail','purchase_quantity','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','floorlevel','Rack\x20A','DRY\x20STORAGE','save','/invoice/:id','findOne','Arabic\x20(ae)','18PUVyGQ','maxStocks','$product.floorlevel','maxperunit','post','password','$paid_amount','log','rak','$product_details.primary_code','primary_code_hide','user_id','find','/barcode_scanner','product_details','/view','bay','Level','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','2085993iVocyP','\x20<>\x20','room','</div>','</h5>','storage','stock_quantity','Purchase\x20data\x20added\x20successfully','/view/add_purchases','status','secondary_code_hide','Spanish','flash','edit_purchases','note','return_qty','Rack\x20F','Portuguese','<h5>','Router','Chinese','prod_primunit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','3964MPnRWE','aggregate','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','$product_details.floorlevel','forEach','RoomAssign','$batch_code','return_product','prod_level','max_product_unit','path','$return_data','prod_isle','suppliers','/view/add_purchases/:id','$product_details','1023AXWksW','getDate','JO_number','POnumber','all_purchases_barcode','redirect','purchases\x20item\x20return\x20successfull','../middleware/auth','$product_details.isle','error','site_title','Portuguese\x20(BR)','/preview/:id','json','$product_details.maxProducts','finalize','push','prod_pallet','product_list','Rack\x20D','amount','German','$primary_code','date','Receiving\x20Area','production_date','$product.quantity','language','product_cat','message','name','COLD\x20STORAGE','207660HXmXNQ','Rack\x20B','$maxProdPerUnit','$suppliers_docs','Enabled','return_purchase','product_name','prod_secondunit','$product.type','</thead>','English','<hr\x20class=\x22my-3\x22>','product_stock','payment\x20successfull','An\x20error\x20occurred\x20while\x20saving\x20data.','$suppliers','delivery_code','role','back','email','Arabic','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$date','suppliers_docs','$product','warehouse','$product_details.pallet','concat','MaxStocks_data','map','stock_data','Floor','$warehouse_name','2672823CCzzdU','$alertquantity','Rack\x20C','$finalize','isle','all_purchases','alertQTY','/view/return_purchase/:id','prod_code','standard_unit','secondary_unit','quantity','express','return_data','Rack\x20E','\x20</h2>','French','$product.bay','gmail','expiry_date','staff','</span>','paid_amount','rack','11485290hgFmda','edit_purchases_view','</table>','$brand','/all_purchases/view/','nodemailer','</body></html>','/barcode/:id','$_id','</tbody>','$product_details._id','Enclosed','<!DOCTYPE\x20html>','findById','then','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$product_details.product_code','</tr>','/all_purchases/view','product','delivery_date','Shelves','catch','$invoice','product_code_hide','$product_details.bin','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','currency','/../public','params','<h2>\x20','$name','$product_details.rack','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','Error\x20Occurs','pallet','$product.room_name','$secondary_code','errors','currency_placement','level','$note','success','/CheckingWarehouse','/upload/','<h5\x20style=\x22text-align:\x20left;\x22>','1585bUYhVL','getMonth','Room_name','../public/language/languages.json','$product_details.product_name','\x20<\x20wew\x20>\x20','prod_unit'];a0_0x30b5=function(){return _0x1f9b7a;};return a0_0x30b5();}