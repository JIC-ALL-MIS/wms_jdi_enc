const a0_0x4d2ab0=a0_0xd4f9;(function(_0x5c3a48,_0x54e75e){const _0x4f24a6=a0_0xd4f9,_0x4a4aa3=_0x5c3a48();while(!![]){try{const _0x1cb034=parseInt(_0x4f24a6(0x213))/0x1*(parseInt(_0x4f24a6(0x21d))/0x2)+parseInt(_0x4f24a6(0x244))/0x3+-parseInt(_0x4f24a6(0x251))/0x4*(-parseInt(_0x4f24a6(0x207))/0x5)+-parseInt(_0x4f24a6(0x22c))/0x6+parseInt(_0x4f24a6(0x1f1))/0x7*(parseInt(_0x4f24a6(0x23e))/0x8)+-parseInt(_0x4f24a6(0x20f))/0x9+-parseInt(_0x4f24a6(0x1f4))/0xa;if(_0x1cb034===_0x54e75e)break;else _0x4a4aa3['push'](_0x4a4aa3['shift']());}catch(_0xccb7e7){_0x4a4aa3['push'](_0x4a4aa3['shift']());}}}(a0_0x203f,0xb9300));const express=require('express'),app=express(),router=express[a0_0x4d2ab0(0x21f)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require(a0_0x4d2ab0(0x1f3)),auth=require('../middleware/auth'),users=require(a0_0x4d2ab0(0x204)),excelJS=require(a0_0x4d2ab0(0x24e)),xlsx=require(a0_0x4d2ab0(0x1fc)),multer=require(a0_0x4d2ab0(0x226));router['get'](a0_0x4d2ab0(0x23c),auth,async(_0x427bbf,_0x5788a2)=>{const _0x211014=a0_0x4d2ab0;try{const {username:_0x51ee6c,email:_0x31907f,role:_0x28ff46}=_0x427bbf[_0x211014(0x253)],_0x1139e0=_0x427bbf['user'],_0x4834c2=await profile['findOne']({'email':_0x1139e0[_0x211014(0x245)]}),_0x417282=await master_shop[_0x211014(0x22e)]();console[_0x211014(0x238)](_0x211014(0x230),_0x417282);const _0x29ec1e=await customer[_0x211014(0x22e)](),_0x106bfb=await customer['aggregate']([{'$lookup':{'from':_0x211014(0x241),'localField':'name','foreignField':_0x211014(0x22d),'as':_0x211014(0x200)}}]);console[_0x211014(0x238)](_0x106bfb);const _0x5d3fdc=_0x106bfb[_0x211014(0x209)](_0x499c8a=>{const _0x5b4662=_0x211014;console[_0x5b4662(0x238)](_0x5b4662(0x24a),_0x499c8a);var _0x4f57ca=0x0,_0x5b04dd=0x0;return _0x499c8a['customer_docs'][_0x5b4662(0x211)](_0x262771=>{const _0x508a65=_0x5b4662;console[_0x508a65(0x238)](_0x508a65(0x249),_0x262771),_0x262771[_0x508a65(0x201)]==_0x508a65(0x234)?_0x4f57ca+=_0x262771['amount']:_0x5b04dd+=_0x262771['amount'];}),_0x499c8a[_0x5b4662(0x206)]=parseFloat(_0x4f57ca)+0x0,_0x499c8a[_0x5b4662(0x21c)]=parseFloat(_0x5b04dd)+0x0,_0x499c8a;});console['log'](_0x211014(0x221),_0x5d3fdc);if(_0x417282[0x0][_0x211014(0x231)]==_0x211014(0x1f7)){var _0x54e994=users[_0x211014(0x247)];console['log'](_0x54e994);}else{if(_0x417282[0x0]['language']==_0x211014(0x22a))var _0x54e994=users[_0x211014(0x22a)];else{if(_0x417282[0x0][_0x211014(0x231)]==_0x211014(0x240))var _0x54e994=users[_0x211014(0x240)];else{if(_0x417282[0x0][_0x211014(0x231)]==_0x211014(0x23b))var _0x54e994=users[_0x211014(0x23b)];else{if(_0x417282[0x0][_0x211014(0x231)]==_0x211014(0x1ee))var _0x54e994=users[_0x211014(0x1ee)];else{if(_0x417282[0x0][_0x211014(0x231)]==_0x211014(0x223))var _0x54e994=users[_0x211014(0x243)];else{if(_0x417282[0x0]['language']==_0x211014(0x222))var _0x54e994=users[_0x211014(0x222)];else{if(_0x417282[0x0][_0x211014(0x231)]==_0x211014(0x210))var _0x54e994=users[_0x211014(0x218)];}}}}}}}_0x5788a2[_0x211014(0x23f)](_0x211014(0x22d),{'success':_0x427bbf[_0x211014(0x1fb)](_0x211014(0x24d)),'errors':_0x427bbf[_0x211014(0x1fb)](_0x211014(0x229)),'user':_0x29ec1e,'role':_0x1139e0,'profile':_0x4834c2,'payment':_0x5d3fdc,'master_shop':_0x417282,'language':_0x54e994});}catch(_0x2aadac){console[_0x211014(0x238)](_0x2aadac);}}),router[a0_0x4d2ab0(0x1fa)]('/view',auth,async(_0x3f6bf6,_0xadaab5)=>{const _0x22e878=a0_0x4d2ab0;try{const {name:_0x46259c,address:_0x2ac8a5,mobile:_0xb91d35,email:_0x2ec18b,receivable:_0xf24b00,payable:_0x386e3c}=_0x3f6bf6['body'],_0x467eea=new customer({'name':_0x46259c,'address':_0x2ac8a5,'mobile':_0xb91d35,'email':_0x2ec18b,'receivable':_0xf24b00,'payable':_0x386e3c}),_0x51f6aa=await _0x467eea[_0x22e878(0x21a)]();_0x3f6bf6['flash']('success','customer\x20add\x20successfully'),_0xadaab5['redirect'](_0x22e878(0x23a));}catch(_0x4c735e){console[_0x22e878(0x238)](_0x4c735e);}}),router[a0_0x4d2ab0(0x1f6)](a0_0x4d2ab0(0x227),auth,async(_0x3eab9c,_0xffa9ce)=>{const _0x2349c0=a0_0x4d2ab0;try{const {username:_0x4da514,email:_0x239342,role:_0x1731aa}=_0x3eab9c[_0x2349c0(0x253)],_0x2936bc=_0x3eab9c[_0x2349c0(0x253)],_0x4ab445=await profile['findOne']({'email':_0x2936bc[_0x2349c0(0x245)]}),_0x5b680a=await master_shop['find']();console['log']('master',_0x5b680a);const _0x1f3e6b=_0x3eab9c[_0x2349c0(0x235)]['id'],_0x151de1=await customer[_0x2349c0(0x23d)](_0x1f3e6b);if(_0x5b680a[0x0][_0x2349c0(0x231)]==_0x2349c0(0x1f7)){var _0x4d0949=users[_0x2349c0(0x247)];console[_0x2349c0(0x238)](_0x4d0949);}else{if(_0x5b680a[0x0][_0x2349c0(0x231)]==_0x2349c0(0x22a))var _0x4d0949=users[_0x2349c0(0x22a)];else{if(_0x5b680a[0x0][_0x2349c0(0x231)]=='German')var _0x4d0949=users['German'];else{if(_0x5b680a[0x0][_0x2349c0(0x231)]==_0x2349c0(0x23b))var _0x4d0949=users['Spanish'];else{if(_0x5b680a[0x0]['language']==_0x2349c0(0x1ee))var _0x4d0949=users[_0x2349c0(0x1ee)];else{if(_0x5b680a[0x0][_0x2349c0(0x231)]==_0x2349c0(0x223))var _0x4d0949=users[_0x2349c0(0x243)];else{if(_0x5b680a[0x0]['language']==_0x2349c0(0x222))var _0x4d0949=users['Chinese'];else{if(_0x5b680a[0x0][_0x2349c0(0x231)]=='Arabic\x20(ae)')var _0x4d0949=users[_0x2349c0(0x218)];}}}}}}}_0xffa9ce[_0x2349c0(0x23f)]('customer',{'success':_0x3eab9c[_0x2349c0(0x1fb)](_0x2349c0(0x24d)),'errors':_0x3eab9c['flash'](_0x2349c0(0x229)),'role':_0x2936bc,'profile':_0x4ab445,'user':_0x151de1,'master_shop':_0x5b680a,'language':_0x4d0949});}catch(_0x137afd){console[_0x2349c0(0x238)](_0x137afd);}}),router[a0_0x4d2ab0(0x1fa)](a0_0x4d2ab0(0x227),auth,async(_0x32eb24,_0x5b172e)=>{const _0x4d5308=a0_0x4d2ab0;try{const _0x491972=_0x32eb24[_0x4d5308(0x235)]['id'],_0x42f691=await customer[_0x4d5308(0x23d)](_0x491972),{name:_0x9b95fc,address:_0x37e140,mobile:_0x51ebdb,email:_0x1c4def,receivable:_0x58d411,payable:_0x182aa9}=_0x32eb24['body'];_0x42f691[_0x4d5308(0x205)]=_0x9b95fc,_0x42f691['address']=_0x37e140,_0x42f691[_0x4d5308(0x236)]=_0x51ebdb,_0x42f691[_0x4d5308(0x245)]=_0x1c4def,_0x42f691[_0x4d5308(0x214)]=_0x58d411,_0x42f691['payable']=_0x182aa9;const _0x398b87=await _0x42f691['save']();_0x32eb24[_0x4d5308(0x1fb)]('success',_0x4d5308(0x20d)),_0x5b172e[_0x4d5308(0x20a)](_0x4d5308(0x23a));}catch(_0x551c11){console[_0x4d5308(0x238)](_0x551c11);}}),router[a0_0x4d2ab0(0x1f6)]('/view/payment/:id',auth,async(_0x5c76d4,_0x18419e)=>{const _0x3ed9df=a0_0x4d2ab0;try{const {username:_0x19c369,email:_0x4e850c,role:_0x43b338}=_0x5c76d4[_0x3ed9df(0x253)],_0x469dd5=_0x5c76d4[_0x3ed9df(0x253)],_0x234d80=await profile[_0x3ed9df(0x20c)]({'email':_0x469dd5[_0x3ed9df(0x245)]}),_0x2907ee=await master_shop['find']();console[_0x3ed9df(0x238)](_0x3ed9df(0x230),_0x2907ee),console[_0x3ed9df(0x238)](_0x5c76d4[_0x3ed9df(0x235)]['id']);const _0x5dde5f=await customer[_0x3ed9df(0x20c)]({'_id':_0x5c76d4[_0x3ed9df(0x235)]['id']});console[_0x3ed9df(0x238)](_0x3ed9df(0x203),_0x5dde5f);const _0x2a7f2a=await c_payment_data['find']({'customer':_0x5dde5f[_0x3ed9df(0x205)]});console[_0x3ed9df(0x238)](_0x2a7f2a);const _0x2e1ba7=await c_payment_data[_0x3ed9df(0x250)]([{'$match':{'customer':_0x5dde5f[_0x3ed9df(0x205)]}},{'$match':{'reason':_0x3ed9df(0x234)}},{'$group':{'_id':'$reason','sum':{'$sum':_0x3ed9df(0x232)}}}]);console[_0x3ed9df(0x238)](_0x3ed9df(0x242),_0x2e1ba7);const _0x3abe3e=await c_payment_data['aggregate']([{'$match':{'customer':_0x5dde5f[_0x3ed9df(0x205)]}},{'$match':{'reason':_0x3ed9df(0x202)}},{'$group':{'_id':_0x3ed9df(0x1fe),'sum':{'$sum':'$amount'}}}]);console[_0x3ed9df(0x238)](_0x3ed9df(0x233),_0x3abe3e);if(_0x2907ee[0x0]['language']==_0x3ed9df(0x1f7)){var _0x556f25=users[_0x3ed9df(0x247)];console['log'](_0x556f25);}else{if(_0x2907ee[0x0][_0x3ed9df(0x231)]==_0x3ed9df(0x22a))var _0x556f25=users[_0x3ed9df(0x22a)];else{if(_0x2907ee[0x0][_0x3ed9df(0x231)]==_0x3ed9df(0x240))var _0x556f25=users['German'];else{if(_0x2907ee[0x0][_0x3ed9df(0x231)]=='Spanish')var _0x556f25=users[_0x3ed9df(0x23b)];else{if(_0x2907ee[0x0]['language']==_0x3ed9df(0x1ee))var _0x556f25=users[_0x3ed9df(0x1ee)];else{if(_0x2907ee[0x0][_0x3ed9df(0x231)]==_0x3ed9df(0x223))var _0x556f25=users[_0x3ed9df(0x243)];else{if(_0x2907ee[0x0][_0x3ed9df(0x231)]==_0x3ed9df(0x222))var _0x556f25=users[_0x3ed9df(0x222)];else{if(_0x2907ee[0x0]['language']==_0x3ed9df(0x210))var _0x556f25=users['Arabic'];}}}}}}}_0x18419e['render'](_0x3ed9df(0x24c),{'success':_0x5c76d4['flash'](_0x3ed9df(0x24d)),'errors':_0x5c76d4['flash'](_0x3ed9df(0x229)),'role':_0x469dd5,'profile':_0x234d80,'payment':_0x2a7f2a,'payable':_0x2e1ba7,'receivable':_0x3abe3e,'master_shop':_0x2907ee,'language':_0x556f25});}catch(_0x490d19){console[_0x3ed9df(0x238)](_0x490d19);}}),router[a0_0x4d2ab0(0x1f6)](a0_0x4d2ab0(0x1f8),auth,async(_0x4a2671,_0x3600f1)=>{const _0x23e9ee=a0_0x4d2ab0;try{const _0x3ccdbe=new excelJS['Workbook'](),_0x50b829=_0x3ccdbe[_0x23e9ee(0x1ed)]('Customers');return _0x50b829['columns']=[{'header':'ID','key':_0x23e9ee(0x1f2),'width':0xa},{'header':_0x23e9ee(0x1f9),'key':'PBrands','width':0xa},{'header':_0x23e9ee(0x219),'key':_0x23e9ee(0x20e),'width':0xa},{'header':'SalesmanName','key':_0x23e9ee(0x1ff),'width':0xa},{'header':_0x23e9ee(0x246),'key':_0x23e9ee(0x246),'width':0xa},{'header':_0x23e9ee(0x236),'key':'mobile','width':0xa},{'header':_0x23e9ee(0x245),'key':_0x23e9ee(0x245),'width':0xa}],_0x3600f1[_0x23e9ee(0x21e)](_0x23e9ee(0x225),'application/vnd.openxmlformats-officedocument.spreadsheatml.sheet'),_0x3600f1['setHeader'](_0x23e9ee(0x1fd),_0x23e9ee(0x228)),_0x3ccdbe[_0x23e9ee(0x1fc)][_0x23e9ee(0x20b)](_0x3600f1)[_0x23e9ee(0x21b)](()=>{const _0x14caf8=_0x23e9ee;_0x3600f1[_0x14caf8(0x24f)](0xc8);});}catch(_0x15cf0c){_0x3600f1[_0x23e9ee(0x24f)](0x190)[_0x23e9ee(0x212)]({'errors':_0x15cf0c['message']});}});function a0_0xd4f9(_0x3b084b,_0x1d2b5f){const _0x203f04=a0_0x203f();return a0_0xd4f9=function(_0xd4f9d2,_0x513e43){_0xd4f9d2=_0xd4f9d2-0x1ed;let _0x388d17=_0x203f04[_0xd4f9d2];return _0x388d17;},a0_0xd4f9(_0x3b084b,_0x1d2b5f);}const storage1=multer[a0_0x4d2ab0(0x215)]({'destination':(_0x253d82,_0x11cbcf,_0x2bffd2)=>{const _0x30a296=a0_0x4d2ab0;_0x2bffd2(null,_0x30a296(0x237));},'filename':(_0xc0f314,_0x32ddc2,_0x3cd4a0)=>{const _0x4f19b6=a0_0x4d2ab0;_0x3cd4a0(null,Date[_0x4f19b6(0x252)]()+_0x32ddc2[_0x4f19b6(0x224)]);}}),uploadMigrate=multer({'storage':storage1});function a0_0x203f(){const _0xe3afdf=['Chinese','Portuguese\x20(BR)','originalname','Content-Type','multer','/view/:id','attachment;\x20filename=customer_Migration_File.xlsx','errors','Hindi','customer_product_fule','1495302VboOmG','customer','find','/customer_import_migrate_file','master','language','$amount','receivable_sum','Sale','params','mobile','public/Migration','log','\x20Failed','/customer/view','Spanish','/view','findById','10288zyoaCp','render','German','c_payments','payable_sum','Portuguese','736614NWziHO','email','address','English','public/Migration/','element','data','utils','customer_payment','success','exceljs','status','aggregate','8UKsmtH','now','user','addWorksheet','French','file','readFile','3955iPedDH','PName','../models/all_models','4869880Nturzn','Sheets','get','English\x20(US)','/products_export_migrate_file','Name','post','flash','xlsx','Content-Disposition','$reason','SalesmanName','customer_docs','reason','Sale\x20Return','customer_data','../public/language/languages.json','name','sale','1554870JMhVNf','message','map','redirect','write','findOne','customer\x20update\x20successfully','PUnits','6312852KYPgwy','Arabic\x20(ae)','forEach','send','4895SOmBpb','receivable','diskStorage','json','sheet_to_json','Arabic','SalesmanCode','save','then','sale_return','246FMHRsF','setHeader','Router','\x20added\x20successfully','payment_data'];a0_0x203f=function(){return _0xe3afdf;};return a0_0x203f();}router['post'](a0_0x4d2ab0(0x22f),auth,uploadMigrate['single'](a0_0x4d2ab0(0x22b)),async(_0x18672a,_0x296e51)=>{const _0x7ab92c=a0_0x4d2ab0,_0x2b27f7=_0x18672a[_0x7ab92c(0x1ef)]['filename'],_0x3a5a77=await xlsx[_0x7ab92c(0x1f0)](_0x7ab92c(0x248)+_0x2b27f7);let _0x1067ae=_0x3a5a77['SheetNames'],_0x5bd29c=xlsx[_0x7ab92c(0x24b)][_0x7ab92c(0x217)](_0x3a5a77[_0x7ab92c(0x1f5)][_0x1067ae[0x0]]);for(const _0x4bac72 of _0x5bd29c){const _0x50795c=_0x4bac72['ID'],_0x340639=_0x4bac72[_0x7ab92c(0x1f9)],_0xd4d2d6=_0x4bac72['SalesmanCode'],_0x160271=_0x4bac72[_0x7ab92c(0x1ff)],_0x43b67d=_0x4bac72[_0x7ab92c(0x246)],_0x30ea7e=_0x4bac72['mobile'],_0x2d1785=_0x4bac72['email'];try{let _0x137aaa=await customer[_0x7ab92c(0x20c)]({'name':_0x340639});if(!_0x137aaa){const _0x2c06a9=new customer({'name':_0x340639,'ID':_0x50795c,'SalesmanCode':_0xd4d2d6,'SalesmanName':_0x160271,'address':_0x43b67d,'mobile':_0x30ea7e,'email':_0x2d1785});_0x137aaa=await _0x2c06a9[_0x7ab92c(0x21a)](),_0x18672a[_0x7ab92c(0x1fb)](_0x7ab92c(0x24d),_0x340639+_0x7ab92c(0x220));}else _0x18672a[_0x7ab92c(0x1fb)]('error',_0x340639+_0x7ab92c(0x239));}catch(_0x479993){_0x296e51['status'](0x1f4)[_0x7ab92c(0x216)]({'proderror':_0x479993[_0x7ab92c(0x208)],'aproduct':ProductName});}}_0x296e51[_0x7ab92c(0x20a)](_0x7ab92c(0x23a));}),module['exports']=router;