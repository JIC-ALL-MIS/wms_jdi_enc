const a0_0x20667e=a0_0x4ae6;(function(_0x4df8c2,_0x3ab080){const _0x4250d4=a0_0x4ae6,_0x2d2fd5=_0x4df8c2();while(!![]){try{const _0x28e658=parseInt(_0x4250d4(0x155))/0x1+parseInt(_0x4250d4(0x19e))/0x2*(-parseInt(_0x4250d4(0x17f))/0x3)+parseInt(_0x4250d4(0x166))/0x4+parseInt(_0x4250d4(0x176))/0x5+parseInt(_0x4250d4(0x150))/0x6*(parseInt(_0x4250d4(0x193))/0x7)+parseInt(_0x4250d4(0x152))/0x8+-parseInt(_0x4250d4(0x159))/0x9*(parseInt(_0x4250d4(0x192))/0xa);if(_0x28e658===_0x3ab080)break;else _0x2d2fd5['push'](_0x2d2fd5['shift']());}catch(_0x549fe8){_0x2d2fd5['push'](_0x2d2fd5['shift']());}}}(a0_0x32c3,0xe3c89));const express=require('express'),app=express(),router=express[a0_0x20667e(0x17d)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require(a0_0x20667e(0x157)),auth=require(a0_0x20667e(0x145)),users=require(a0_0x20667e(0x19f)),excelJS=require(a0_0x20667e(0x198)),xlsx=require(a0_0x20667e(0x14f)),multer=require(a0_0x20667e(0x15c));function a0_0x32c3(){const _0x19f9ef=['Chinese','xlsx','6GnsFcH','/view/:id','1869120tTNCeL','address','SalesmanCode','1496918lXCNkc','error','../models/all_models','French','27gfMboW','findOne','$reason','multer','errors','customer\x20add\x20successfully','originalname','/products_export_migrate_file','customer','receivable_sum','send','Sale\x20Return','PName','5204000qCWhZs','/view/payment/:id','success','map','sheet_to_json','redirect','master','\x20added\x20successfully','SheetNames','body','Workbook','$amount','receivable','mobile','customer_payment','/customer/view','6818635ADHyPf','payable','Portuguese\x20(BR)','element','Spanish','PUnits','utils','Router','get','12agyxik','readFile','payment_data','name','German','diskStorage','payable_sum','save','customer_data','columns','find','Hindi','findById','\x20Failed','status','forEach','PBrands','Arabic\x20(ae)','now','8831470SCGKym','4861927MCBXok','Name','user','customer_docs','Portuguese','exceljs','Arabic','/view','params','exports','SalesmanName','753702JcWDIj','../public/language/languages.json','sale_return','public/Migration','email','Sale','Sheets','English\x20(US)','flash','language','reason','English','public/Migration/','amount','single','filename','/customer_import_migrate_file','../middleware/auth','setHeader','aggregate','message','data','log','post','Content-Type','render'];a0_0x32c3=function(){return _0x19f9ef;};return a0_0x32c3();}router[a0_0x20667e(0x17e)](a0_0x20667e(0x19a),auth,async(_0x2c28cb,_0x2f5f19)=>{const _0x1aa0cc=a0_0x20667e;try{const {username:_0x17f102,email:_0x4b620d,role:_0x12bfc5}=_0x2c28cb[_0x1aa0cc(0x195)],_0x515366=_0x2c28cb[_0x1aa0cc(0x195)],_0x85e82d=await profile[_0x1aa0cc(0x15a)]({'email':_0x515366[_0x1aa0cc(0x138)]}),_0xbd153d=await master_shop['find']();console[_0x1aa0cc(0x14a)](_0x1aa0cc(0x16c),_0xbd153d);const _0x595771=await customer[_0x1aa0cc(0x189)](),_0x59f5e5=await customer[_0x1aa0cc(0x147)]([{'$lookup':{'from':'c_payments','localField':'name','foreignField':_0x1aa0cc(0x161),'as':_0x1aa0cc(0x196)}}]);console[_0x1aa0cc(0x14a)](_0x59f5e5);const _0x550e1b=_0x59f5e5[_0x1aa0cc(0x169)](_0x473e2c=>{const _0x541a4f=_0x1aa0cc;console[_0x541a4f(0x14a)](_0x541a4f(0x149),_0x473e2c);var _0x3c8732=0x0,_0xbe6c97=0x0;return _0x473e2c[_0x541a4f(0x196)][_0x541a4f(0x18e)](_0x329246=>{const _0x3f4e5b=_0x541a4f;console[_0x3f4e5b(0x14a)](_0x3f4e5b(0x179),_0x329246),_0x329246[_0x3f4e5b(0x13e)]==_0x3f4e5b(0x139)?_0x3c8732+=_0x329246[_0x3f4e5b(0x141)]:_0xbe6c97+=_0x329246[_0x3f4e5b(0x141)];}),_0x473e2c['sale']=parseFloat(_0x3c8732)+0x0,_0x473e2c[_0x541a4f(0x1a0)]=parseFloat(_0xbe6c97)+0x0,_0x473e2c;});console[_0x1aa0cc(0x14a)](_0x1aa0cc(0x181),_0x550e1b);if(_0xbd153d[0x0]['language']==_0x1aa0cc(0x13b)){var _0x10374f=users['English'];console[_0x1aa0cc(0x14a)](_0x10374f);}else{if(_0xbd153d[0x0][_0x1aa0cc(0x13d)]=='Hindi')var _0x10374f=users[_0x1aa0cc(0x18a)];else{if(_0xbd153d[0x0][_0x1aa0cc(0x13d)]==_0x1aa0cc(0x183))var _0x10374f=users[_0x1aa0cc(0x183)];else{if(_0xbd153d[0x0][_0x1aa0cc(0x13d)]==_0x1aa0cc(0x17a))var _0x10374f=users[_0x1aa0cc(0x17a)];else{if(_0xbd153d[0x0][_0x1aa0cc(0x13d)]=='French')var _0x10374f=users[_0x1aa0cc(0x158)];else{if(_0xbd153d[0x0][_0x1aa0cc(0x13d)]==_0x1aa0cc(0x178))var _0x10374f=users['Portuguese'];else{if(_0xbd153d[0x0][_0x1aa0cc(0x13d)]==_0x1aa0cc(0x14e))var _0x10374f=users[_0x1aa0cc(0x14e)];else{if(_0xbd153d[0x0]['language']=='Arabic\x20(ae)')var _0x10374f=users['Arabic'];}}}}}}}_0x2f5f19[_0x1aa0cc(0x14d)]('customer',{'success':_0x2c28cb[_0x1aa0cc(0x13c)](_0x1aa0cc(0x168)),'errors':_0x2c28cb['flash'](_0x1aa0cc(0x15d)),'user':_0x595771,'role':_0x515366,'profile':_0x85e82d,'payment':_0x550e1b,'master_shop':_0xbd153d,'language':_0x10374f});}catch(_0x2b6f3b){console['log'](_0x2b6f3b);}}),router['post'](a0_0x20667e(0x19a),auth,async(_0x35cc2e,_0x44ebeb)=>{const _0x94d975=a0_0x20667e;try{const {name:_0x1e3f20,address:_0xd915ba,mobile:_0x3f03c2,email:_0x4ad758,receivable:_0x3297ee,payable:_0x174add}=_0x35cc2e[_0x94d975(0x16f)],_0x449c21=new customer({'name':_0x1e3f20,'address':_0xd915ba,'mobile':_0x3f03c2,'email':_0x4ad758,'receivable':_0x3297ee,'payable':_0x174add}),_0x54b4d8=await _0x449c21[_0x94d975(0x186)]();_0x35cc2e[_0x94d975(0x13c)](_0x94d975(0x168),_0x94d975(0x15e)),_0x44ebeb[_0x94d975(0x16b)]('/customer/view');}catch(_0x4cf61a){console[_0x94d975(0x14a)](_0x4cf61a);}}),router[a0_0x20667e(0x17e)](a0_0x20667e(0x151),auth,async(_0x690077,_0x408f1c)=>{const _0x2a6a93=a0_0x20667e;try{const {username:_0x4aaa61,email:_0x4a6018,role:_0x14d99f}=_0x690077['user'],_0x522da1=_0x690077[_0x2a6a93(0x195)],_0xb2d0b1=await profile[_0x2a6a93(0x15a)]({'email':_0x522da1[_0x2a6a93(0x138)]}),_0x35eed5=await master_shop[_0x2a6a93(0x189)]();console[_0x2a6a93(0x14a)](_0x2a6a93(0x16c),_0x35eed5);const _0x57cf05=_0x690077[_0x2a6a93(0x19b)]['id'],_0x1d3bd2=await customer[_0x2a6a93(0x18b)](_0x57cf05);if(_0x35eed5[0x0][_0x2a6a93(0x13d)]==_0x2a6a93(0x13b)){var _0x4f0cc7=users[_0x2a6a93(0x13f)];console[_0x2a6a93(0x14a)](_0x4f0cc7);}else{if(_0x35eed5[0x0][_0x2a6a93(0x13d)]==_0x2a6a93(0x18a))var _0x4f0cc7=users['Hindi'];else{if(_0x35eed5[0x0]['language']==_0x2a6a93(0x183))var _0x4f0cc7=users[_0x2a6a93(0x183)];else{if(_0x35eed5[0x0][_0x2a6a93(0x13d)]==_0x2a6a93(0x17a))var _0x4f0cc7=users[_0x2a6a93(0x17a)];else{if(_0x35eed5[0x0]['language']==_0x2a6a93(0x158))var _0x4f0cc7=users[_0x2a6a93(0x158)];else{if(_0x35eed5[0x0][_0x2a6a93(0x13d)]=='Portuguese\x20(BR)')var _0x4f0cc7=users[_0x2a6a93(0x197)];else{if(_0x35eed5[0x0][_0x2a6a93(0x13d)]==_0x2a6a93(0x14e))var _0x4f0cc7=users[_0x2a6a93(0x14e)];else{if(_0x35eed5[0x0][_0x2a6a93(0x13d)]==_0x2a6a93(0x190))var _0x4f0cc7=users['Arabic'];}}}}}}}_0x408f1c[_0x2a6a93(0x14d)](_0x2a6a93(0x161),{'success':_0x690077[_0x2a6a93(0x13c)](_0x2a6a93(0x168)),'errors':_0x690077[_0x2a6a93(0x13c)](_0x2a6a93(0x15d)),'role':_0x522da1,'profile':_0xb2d0b1,'user':_0x1d3bd2,'master_shop':_0x35eed5,'language':_0x4f0cc7});}catch(_0xdc81b){console[_0x2a6a93(0x14a)](_0xdc81b);}}),router[a0_0x20667e(0x14b)](a0_0x20667e(0x151),auth,async(_0x372ac4,_0x405fcf)=>{const _0xc62654=a0_0x20667e;try{const _0xc7db05=_0x372ac4[_0xc62654(0x19b)]['id'],_0x1d827c=await customer[_0xc62654(0x18b)](_0xc7db05),{name:_0x5bb955,address:_0x1f77c8,mobile:_0x44af5b,email:_0x10e69e,receivable:_0x568dd7,payable:_0xfe2581}=_0x372ac4[_0xc62654(0x16f)];_0x1d827c[_0xc62654(0x182)]=_0x5bb955,_0x1d827c[_0xc62654(0x153)]=_0x1f77c8,_0x1d827c[_0xc62654(0x173)]=_0x44af5b,_0x1d827c[_0xc62654(0x138)]=_0x10e69e,_0x1d827c[_0xc62654(0x172)]=_0x568dd7,_0x1d827c[_0xc62654(0x177)]=_0xfe2581;const _0x595e42=await _0x1d827c[_0xc62654(0x186)]();_0x372ac4[_0xc62654(0x13c)](_0xc62654(0x168),'customer\x20update\x20successfully'),_0x405fcf[_0xc62654(0x16b)](_0xc62654(0x175));}catch(_0x1db6f0){console[_0xc62654(0x14a)](_0x1db6f0);}}),router['get'](a0_0x20667e(0x167),auth,async(_0x36e507,_0x50c867)=>{const _0x5b052c=a0_0x20667e;try{const {username:_0x15516f,email:_0xe93b73,role:_0x563a96}=_0x36e507[_0x5b052c(0x195)],_0x55c0c7=_0x36e507[_0x5b052c(0x195)],_0x2299da=await profile['findOne']({'email':_0x55c0c7[_0x5b052c(0x138)]}),_0x142ba4=await master_shop[_0x5b052c(0x189)]();console[_0x5b052c(0x14a)](_0x5b052c(0x16c),_0x142ba4),console[_0x5b052c(0x14a)](_0x36e507[_0x5b052c(0x19b)]['id']);const _0xa896af=await customer[_0x5b052c(0x15a)]({'_id':_0x36e507[_0x5b052c(0x19b)]['id']});console[_0x5b052c(0x14a)](_0x5b052c(0x187),_0xa896af);const _0x43f3d6=await c_payment_data[_0x5b052c(0x189)]({'customer':_0xa896af[_0x5b052c(0x182)]});console[_0x5b052c(0x14a)](_0x43f3d6);const _0x1e5b24=await c_payment_data[_0x5b052c(0x147)]([{'$match':{'customer':_0xa896af[_0x5b052c(0x182)]}},{'$match':{'reason':_0x5b052c(0x139)}},{'$group':{'_id':_0x5b052c(0x15b),'sum':{'$sum':_0x5b052c(0x171)}}}]);console[_0x5b052c(0x14a)](_0x5b052c(0x185),_0x1e5b24);const _0xd28fc9=await c_payment_data['aggregate']([{'$match':{'customer':_0xa896af[_0x5b052c(0x182)]}},{'$match':{'reason':_0x5b052c(0x164)}},{'$group':{'_id':_0x5b052c(0x15b),'sum':{'$sum':'$amount'}}}]);console[_0x5b052c(0x14a)](_0x5b052c(0x162),_0xd28fc9);if(_0x142ba4[0x0]['language']=='English\x20(US)'){var _0x4b3820=users[_0x5b052c(0x13f)];console['log'](_0x4b3820);}else{if(_0x142ba4[0x0]['language']==_0x5b052c(0x18a))var _0x4b3820=users[_0x5b052c(0x18a)];else{if(_0x142ba4[0x0][_0x5b052c(0x13d)]==_0x5b052c(0x183))var _0x4b3820=users['German'];else{if(_0x142ba4[0x0][_0x5b052c(0x13d)]==_0x5b052c(0x17a))var _0x4b3820=users[_0x5b052c(0x17a)];else{if(_0x142ba4[0x0][_0x5b052c(0x13d)]==_0x5b052c(0x158))var _0x4b3820=users['French'];else{if(_0x142ba4[0x0]['language']==_0x5b052c(0x178))var _0x4b3820=users[_0x5b052c(0x197)];else{if(_0x142ba4[0x0][_0x5b052c(0x13d)]==_0x5b052c(0x14e))var _0x4b3820=users[_0x5b052c(0x14e)];else{if(_0x142ba4[0x0]['language']==_0x5b052c(0x190))var _0x4b3820=users[_0x5b052c(0x199)];}}}}}}}_0x50c867[_0x5b052c(0x14d)](_0x5b052c(0x174),{'success':_0x36e507[_0x5b052c(0x13c)](_0x5b052c(0x168)),'errors':_0x36e507['flash'](_0x5b052c(0x15d)),'role':_0x55c0c7,'profile':_0x2299da,'payment':_0x43f3d6,'payable':_0x1e5b24,'receivable':_0xd28fc9,'master_shop':_0x142ba4,'language':_0x4b3820});}catch(_0x494120){console[_0x5b052c(0x14a)](_0x494120);}}),router[a0_0x20667e(0x17e)](a0_0x20667e(0x160),auth,async(_0x4a757c,_0x3556d0)=>{const _0x1e6975=a0_0x20667e;try{const _0x157e0b=new excelJS[(_0x1e6975(0x170))](),_0x5bfa10=_0x157e0b['addWorksheet']('Customers');return _0x5bfa10[_0x1e6975(0x188)]=[{'header':'ID','key':_0x1e6975(0x165),'width':0xa},{'header':'Name','key':_0x1e6975(0x18f),'width':0xa},{'header':_0x1e6975(0x154),'key':_0x1e6975(0x17b),'width':0xa},{'header':_0x1e6975(0x19d),'key':_0x1e6975(0x19d),'width':0xa},{'header':'address','key':_0x1e6975(0x153),'width':0xa},{'header':_0x1e6975(0x173),'key':_0x1e6975(0x173),'width':0xa},{'header':_0x1e6975(0x138),'key':'email','width':0xa}],_0x3556d0[_0x1e6975(0x146)](_0x1e6975(0x14c),'application/vnd.openxmlformats-officedocument.spreadsheatml.sheet'),_0x3556d0[_0x1e6975(0x146)]('Content-Disposition','attachment;\x20filename=customer_Migration_File.xlsx'),_0x157e0b[_0x1e6975(0x14f)]['write'](_0x3556d0)['then'](()=>{const _0x2d22ac=_0x1e6975;_0x3556d0[_0x2d22ac(0x18d)](0xc8);});}catch(_0x2d7631){_0x3556d0['status'](0x190)[_0x1e6975(0x163)]({'errors':_0x2d7631[_0x1e6975(0x148)]});}});function a0_0x4ae6(_0x2b04c2,_0x1355aa){const _0x32c356=a0_0x32c3();return a0_0x4ae6=function(_0x4ae6e3,_0x3ee214){_0x4ae6e3=_0x4ae6e3-0x138;let _0x347617=_0x32c356[_0x4ae6e3];return _0x347617;},a0_0x4ae6(_0x2b04c2,_0x1355aa);}const storage1=multer[a0_0x20667e(0x184)]({'destination':(_0x1eca65,_0x116648,_0x2de6b1)=>{const _0x4ade28=a0_0x20667e;_0x2de6b1(null,_0x4ade28(0x1a1));},'filename':(_0x5590a6,_0x152294,_0x5039af)=>{const _0x27ef90=a0_0x20667e;_0x5039af(null,Date[_0x27ef90(0x191)]()+_0x152294[_0x27ef90(0x15f)]);}}),uploadMigrate=multer({'storage':storage1});router['post'](a0_0x20667e(0x144),auth,uploadMigrate[a0_0x20667e(0x142)]('customer_product_fule'),async(_0x459bce,_0xe5c2e5)=>{const _0x1d1071=a0_0x20667e,_0x407c28=_0x459bce['file'][_0x1d1071(0x143)],_0x1f34f9=await xlsx[_0x1d1071(0x180)](_0x1d1071(0x140)+_0x407c28);let _0x19a9b3=_0x1f34f9[_0x1d1071(0x16e)],_0x12fe79=xlsx[_0x1d1071(0x17c)][_0x1d1071(0x16a)](_0x1f34f9[_0x1d1071(0x13a)][_0x19a9b3[0x0]]);for(const _0x5d759b of _0x12fe79){const _0x59760a=_0x5d759b['ID'],_0x5350fb=_0x5d759b[_0x1d1071(0x194)],_0x540e20=_0x5d759b[_0x1d1071(0x154)],_0xf79a1d=_0x5d759b[_0x1d1071(0x19d)],_0x1e253f=_0x5d759b['address'],_0x1035bb=_0x5d759b[_0x1d1071(0x173)],_0x182a7d=_0x5d759b[_0x1d1071(0x138)];try{let _0x40df17=await customer[_0x1d1071(0x15a)]({'name':_0x5350fb});if(!_0x40df17){const _0x201f4d=new customer({'name':_0x5350fb,'ID':_0x59760a,'SalesmanCode':_0x540e20,'SalesmanName':_0xf79a1d,'address':_0x1e253f,'mobile':_0x1035bb,'email':_0x182a7d});_0x40df17=await _0x201f4d[_0x1d1071(0x186)](),_0x459bce[_0x1d1071(0x13c)](_0x1d1071(0x168),_0x5350fb+_0x1d1071(0x16d));}else _0x459bce[_0x1d1071(0x13c)](_0x1d1071(0x156),_0x5350fb+_0x1d1071(0x18c));}catch(_0x44cf9f){_0xe5c2e5['status'](0x1f4)['json']({'proderror':_0x44cf9f[_0x1d1071(0x148)],'aproduct':ProductName});}}_0xe5c2e5[_0x1d1071(0x16b)](_0x1d1071(0x175));}),module[a0_0x20667e(0x19c)]=router;