const a0_0x37ce8f=a0_0x1ee8;(function(_0x10f6ae,_0x1d9b89){const _0x15f73b=a0_0x1ee8,_0x19ce68=_0x10f6ae();while(!![]){try{const _0x2ad324=-parseInt(_0x15f73b(0x161))/0x1*(-parseInt(_0x15f73b(0x183))/0x2)+-parseInt(_0x15f73b(0x15a))/0x3*(parseInt(_0x15f73b(0x16a))/0x4)+-parseInt(_0x15f73b(0x17e))/0x5*(parseInt(_0x15f73b(0x150))/0x6)+parseInt(_0x15f73b(0x15f))/0x7+-parseInt(_0x15f73b(0x18a))/0x8+-parseInt(_0x15f73b(0x176))/0x9*(parseInt(_0x15f73b(0x17a))/0xa)+parseInt(_0x15f73b(0x189))/0xb;if(_0x2ad324===_0x1d9b89)break;else _0x19ce68['push'](_0x19ce68['shift']());}catch(_0xeb27b4){_0x19ce68['push'](_0x19ce68['shift']());}}}(a0_0x2603,0xe9408));const express=require('express'),app=express(),router=express[a0_0x37ce8f(0x162)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require(a0_0x37ce8f(0x1a6)),auth=require(a0_0x37ce8f(0x14b)),users=require('../public/language/languages.json'),excelJS=require('exceljs'),xlsx=require(a0_0x37ce8f(0x14e)),multer=require(a0_0x37ce8f(0x158));router[a0_0x37ce8f(0x15e)]('/view',auth,async(_0x36b61d,_0x36dc7c)=>{const _0x14e88f=a0_0x37ce8f;try{const {username:_0x1ecfbc,email:_0x4b72aa,role:_0x24b283}=_0x36b61d[_0x14e88f(0x195)],_0x184288=_0x36b61d[_0x14e88f(0x195)],_0x59c7d0=await profile['findOne']({'email':_0x184288['email']}),_0x4a9a8d=await master_shop[_0x14e88f(0x19e)]();console[_0x14e88f(0x194)](_0x14e88f(0x18f),_0x4a9a8d);const _0x359caa=await customer[_0x14e88f(0x19e)](),_0x2a0905=await customer[_0x14e88f(0x18b)]([{'$lookup':{'from':'c_payments','localField':_0x14e88f(0x16b),'foreignField':_0x14e88f(0x199),'as':_0x14e88f(0x1a2)}}]);console[_0x14e88f(0x194)](_0x2a0905);const _0x22efd5=_0x2a0905[_0x14e88f(0x174)](_0x39de9a=>{const _0x8e2cca=_0x14e88f;console[_0x8e2cca(0x194)](_0x8e2cca(0x19b),_0x39de9a);var _0x32f909=0x0,_0xdb4554=0x0;return _0x39de9a[_0x8e2cca(0x1a2)][_0x8e2cca(0x159)](_0x15212b=>{const _0x2be88b=_0x8e2cca;console[_0x2be88b(0x194)](_0x2be88b(0x18d),_0x15212b),_0x15212b[_0x2be88b(0x186)]=='Sale'?_0x32f909+=_0x15212b[_0x2be88b(0x14f)]:_0xdb4554+=_0x15212b[_0x2be88b(0x14f)];}),_0x39de9a['sale']=parseFloat(_0x32f909)+0x0,_0x39de9a[_0x8e2cca(0x18e)]=parseFloat(_0xdb4554)+0x0,_0x39de9a;});console[_0x14e88f(0x194)]('payment_data',_0x22efd5);if(_0x4a9a8d[0x0][_0x14e88f(0x148)]==_0x14e88f(0x160)){var _0x2452bf=users['English'];console[_0x14e88f(0x194)](_0x2452bf);}else{if(_0x4a9a8d[0x0][_0x14e88f(0x148)]==_0x14e88f(0x184))var _0x2452bf=users[_0x14e88f(0x184)];else{if(_0x4a9a8d[0x0]['language']==_0x14e88f(0x154))var _0x2452bf=users[_0x14e88f(0x154)];else{if(_0x4a9a8d[0x0][_0x14e88f(0x148)]==_0x14e88f(0x143))var _0x2452bf=users[_0x14e88f(0x143)];else{if(_0x4a9a8d[0x0][_0x14e88f(0x148)]==_0x14e88f(0x16c))var _0x2452bf=users[_0x14e88f(0x16c)];else{if(_0x4a9a8d[0x0][_0x14e88f(0x148)]=='Portuguese\x20(BR)')var _0x2452bf=users[_0x14e88f(0x19d)];else{if(_0x4a9a8d[0x0][_0x14e88f(0x148)]==_0x14e88f(0x172))var _0x2452bf=users[_0x14e88f(0x172)];else{if(_0x4a9a8d[0x0][_0x14e88f(0x148)]=='Arabic\x20(ae)')var _0x2452bf=users[_0x14e88f(0x14c)];}}}}}}}_0x36dc7c[_0x14e88f(0x165)](_0x14e88f(0x199),{'success':_0x36b61d[_0x14e88f(0x141)](_0x14e88f(0x1a7)),'errors':_0x36b61d[_0x14e88f(0x141)]('errors'),'user':_0x359caa,'role':_0x184288,'profile':_0x59c7d0,'payment':_0x22efd5,'master_shop':_0x4a9a8d,'language':_0x2452bf});}catch(_0x48cdb3){console[_0x14e88f(0x194)](_0x48cdb3);}}),router[a0_0x37ce8f(0x181)](a0_0x37ce8f(0x179),auth,async(_0xc49871,_0x3afc82)=>{const _0x52146f=a0_0x37ce8f;try{const {name:_0xef2b1d,address:_0x1820e0,mobile:_0x10553d,email:_0x2da63a,receivable:_0x4d06ff,payable:_0x10f62b}=_0xc49871[_0x52146f(0x19f)],_0x4d58bd=new customer({'name':_0xef2b1d,'address':_0x1820e0,'mobile':_0x10553d,'email':_0x2da63a,'receivable':_0x4d06ff,'payable':_0x10f62b}),_0x30fa37=await _0x4d58bd[_0x52146f(0x169)]();_0xc49871['flash']('success',_0x52146f(0x1a4)),_0x3afc82[_0x52146f(0x1a9)](_0x52146f(0x1a1));}catch(_0x283597){console[_0x52146f(0x194)](_0x283597);}}),router['get']('/view/:id',auth,async(_0x3b9c53,_0x3b516f)=>{const _0x4673fd=a0_0x37ce8f;try{const {username:_0x1ec676,email:_0x2524e9,role:_0x2dbce3}=_0x3b9c53['user'],_0x279890=_0x3b9c53[_0x4673fd(0x195)],_0x1a14a0=await profile[_0x4673fd(0x149)]({'email':_0x279890[_0x4673fd(0x173)]}),_0x4b8aa8=await master_shop[_0x4673fd(0x19e)]();console['log'](_0x4673fd(0x18f),_0x4b8aa8);const _0x42cea8=_0x3b9c53[_0x4673fd(0x170)]['id'],_0x33a72c=await customer[_0x4673fd(0x193)](_0x42cea8);if(_0x4b8aa8[0x0][_0x4673fd(0x148)]==_0x4673fd(0x160)){var _0x411367=users[_0x4673fd(0x153)];console[_0x4673fd(0x194)](_0x411367);}else{if(_0x4b8aa8[0x0][_0x4673fd(0x148)]=='Hindi')var _0x411367=users[_0x4673fd(0x184)];else{if(_0x4b8aa8[0x0][_0x4673fd(0x148)]==_0x4673fd(0x154))var _0x411367=users[_0x4673fd(0x154)];else{if(_0x4b8aa8[0x0][_0x4673fd(0x148)]==_0x4673fd(0x143))var _0x411367=users[_0x4673fd(0x143)];else{if(_0x4b8aa8[0x0]['language']==_0x4673fd(0x16c))var _0x411367=users['French'];else{if(_0x4b8aa8[0x0][_0x4673fd(0x148)]=='Portuguese\x20(BR)')var _0x411367=users['Portuguese'];else{if(_0x4b8aa8[0x0][_0x4673fd(0x148)]==_0x4673fd(0x172))var _0x411367=users[_0x4673fd(0x172)];else{if(_0x4b8aa8[0x0][_0x4673fd(0x148)]=='Arabic\x20(ae)')var _0x411367=users[_0x4673fd(0x14c)];}}}}}}}_0x3b516f[_0x4673fd(0x165)](_0x4673fd(0x199),{'success':_0x3b9c53['flash'](_0x4673fd(0x1a7)),'errors':_0x3b9c53[_0x4673fd(0x141)](_0x4673fd(0x14a)),'role':_0x279890,'profile':_0x1a14a0,'user':_0x33a72c,'master_shop':_0x4b8aa8,'language':_0x411367});}catch(_0x2e8884){console[_0x4673fd(0x194)](_0x2e8884);}}),router['post'](a0_0x37ce8f(0x191),auth,async(_0x19ba5a,_0x328903)=>{const _0xd74b35=a0_0x37ce8f;try{const _0x2eee30=_0x19ba5a[_0xd74b35(0x170)]['id'],_0x2ba511=await customer[_0xd74b35(0x193)](_0x2eee30),{name:_0x35c18b,address:_0x36fec2,mobile:_0x4d7973,email:_0x3f1b89,receivable:_0x3f67e7,payable:_0x1b4fb7}=_0x19ba5a[_0xd74b35(0x19f)];_0x2ba511[_0xd74b35(0x16b)]=_0x35c18b,_0x2ba511[_0xd74b35(0x192)]=_0x36fec2,_0x2ba511[_0xd74b35(0x168)]=_0x4d7973,_0x2ba511[_0xd74b35(0x173)]=_0x3f1b89,_0x2ba511[_0xd74b35(0x155)]=_0x3f67e7,_0x2ba511[_0xd74b35(0x1ab)]=_0x1b4fb7;const _0x2b8161=await _0x2ba511['save']();_0x19ba5a[_0xd74b35(0x141)](_0xd74b35(0x1a7),_0xd74b35(0x147)),_0x328903['redirect'](_0xd74b35(0x1a1));}catch(_0x2b8b4){console[_0xd74b35(0x194)](_0x2b8b4);}}),router[a0_0x37ce8f(0x15e)](a0_0x37ce8f(0x18c),auth,async(_0x5a27a6,_0x584365)=>{const _0x2b9067=a0_0x37ce8f;try{const {username:_0x2fc3ab,email:_0x26662d,role:_0x29fbff}=_0x5a27a6[_0x2b9067(0x195)],_0x1fd9b6=_0x5a27a6[_0x2b9067(0x195)],_0x149451=await profile[_0x2b9067(0x149)]({'email':_0x1fd9b6[_0x2b9067(0x173)]}),_0x10d087=await master_shop[_0x2b9067(0x19e)]();console[_0x2b9067(0x194)](_0x2b9067(0x18f),_0x10d087),console[_0x2b9067(0x194)](_0x5a27a6[_0x2b9067(0x170)]['id']);const _0x100e7c=await customer[_0x2b9067(0x149)]({'_id':_0x5a27a6[_0x2b9067(0x170)]['id']});console[_0x2b9067(0x194)](_0x2b9067(0x163),_0x100e7c);const _0xa2eebf=await c_payment_data['find']({'customer':_0x100e7c[_0x2b9067(0x16b)]});console[_0x2b9067(0x194)](_0xa2eebf);const _0x37d5c7=await c_payment_data['aggregate']([{'$match':{'customer':_0x100e7c['name']}},{'$match':{'reason':_0x2b9067(0x145)}},{'$group':{'_id':_0x2b9067(0x190),'sum':{'$sum':_0x2b9067(0x19c)}}}]);console[_0x2b9067(0x194)](_0x2b9067(0x19a),_0x37d5c7);const _0x359770=await c_payment_data[_0x2b9067(0x18b)]([{'$match':{'customer':_0x100e7c[_0x2b9067(0x16b)]}},{'$match':{'reason':_0x2b9067(0x196)}},{'$group':{'_id':_0x2b9067(0x190),'sum':{'$sum':_0x2b9067(0x19c)}}}]);console[_0x2b9067(0x194)](_0x2b9067(0x17f),_0x359770);if(_0x10d087[0x0][_0x2b9067(0x148)]==_0x2b9067(0x160)){var _0x4c0352=users['English'];console[_0x2b9067(0x194)](_0x4c0352);}else{if(_0x10d087[0x0]['language']==_0x2b9067(0x184))var _0x4c0352=users[_0x2b9067(0x184)];else{if(_0x10d087[0x0][_0x2b9067(0x148)]==_0x2b9067(0x154))var _0x4c0352=users[_0x2b9067(0x154)];else{if(_0x10d087[0x0]['language']==_0x2b9067(0x143))var _0x4c0352=users[_0x2b9067(0x143)];else{if(_0x10d087[0x0][_0x2b9067(0x148)]=='French')var _0x4c0352=users[_0x2b9067(0x16c)];else{if(_0x10d087[0x0][_0x2b9067(0x148)]==_0x2b9067(0x1a3))var _0x4c0352=users[_0x2b9067(0x19d)];else{if(_0x10d087[0x0][_0x2b9067(0x148)]==_0x2b9067(0x172))var _0x4c0352=users[_0x2b9067(0x172)];else{if(_0x10d087[0x0][_0x2b9067(0x148)]=='Arabic\x20(ae)')var _0x4c0352=users[_0x2b9067(0x14c)];}}}}}}}_0x584365[_0x2b9067(0x165)](_0x2b9067(0x1aa),{'success':_0x5a27a6[_0x2b9067(0x141)](_0x2b9067(0x1a7)),'errors':_0x5a27a6[_0x2b9067(0x141)](_0x2b9067(0x14a)),'role':_0x1fd9b6,'profile':_0x149451,'payment':_0xa2eebf,'payable':_0x37d5c7,'receivable':_0x359770,'master_shop':_0x10d087,'language':_0x4c0352});}catch(_0x97c44b){console['log'](_0x97c44b);}}),router[a0_0x37ce8f(0x15e)]('/products_export_migrate_file',auth,async(_0x4bd5a7,_0xb14481)=>{const _0x26dcd3=a0_0x37ce8f;try{const _0x480e9e=new excelJS['Workbook'](),_0x10ea68=_0x480e9e[_0x26dcd3(0x151)](_0x26dcd3(0x171));return _0x10ea68['columns']=[{'header':'ID','key':'PName','width':0xa},{'header':_0x26dcd3(0x166),'key':_0x26dcd3(0x146),'width':0xa},{'header':_0x26dcd3(0x17d),'key':_0x26dcd3(0x16e),'width':0xa},{'header':_0x26dcd3(0x182),'key':_0x26dcd3(0x182),'width':0xa},{'header':_0x26dcd3(0x192),'key':_0x26dcd3(0x192),'width':0xa},{'header':_0x26dcd3(0x168),'key':'mobile','width':0xa},{'header':'email','key':_0x26dcd3(0x173),'width':0xa}],_0xb14481[_0x26dcd3(0x185)](_0x26dcd3(0x15d),_0x26dcd3(0x17c)),_0xb14481['setHeader'](_0x26dcd3(0x177),_0x26dcd3(0x1ac)),_0x480e9e[_0x26dcd3(0x14e)]['write'](_0xb14481)[_0x26dcd3(0x164)](()=>{const _0x2293e9=_0x26dcd3;_0xb14481[_0x2293e9(0x142)](0xc8);});}catch(_0x2f929c){_0xb14481[_0x26dcd3(0x142)](0x190)[_0x26dcd3(0x17b)]({'errors':_0x2f929c[_0x26dcd3(0x16d)]});}});function a0_0x2603(){const _0x4783e2=['message','PUnits','file','params','Customers','Chinese','email','map','/customer_import_migrate_file','3114OrObap','Content-Disposition','Sheets','/view','32090YhAtQZ','send','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','SalesmanCode','3215yMhOde','receivable_sum','\x20added\x20successfully','post','SalesmanName','74cKJHYy','Hindi','setHeader','reason','single','diskStorage','9128570lUtbUr','163448xYJwQG','aggregate','/view/payment/:id','element','sale_return','master','$reason','/view/:id','address','findById','log','user','Sale\x20Return','customer_product_fule','filename','customer','payable_sum','data','$amount','Portuguese','find','body','utils','/customer/view','customer_docs','Portuguese\x20(BR)','customer\x20add\x20successfully','originalname','../models/all_models','success','readFile','redirect','customer_payment','payable','attachment;\x20filename=customer_Migration_File.xlsx','flash','status','Spanish','sheet_to_json','Sale','PBrands','customer\x20update\x20successfully','language','findOne','errors','../middleware/auth','Arabic','public/Migration/','xlsx','amount','3426CTdYNB','addWorksheet','now','English','German','receivable','error','\x20Failed','multer','forEach','639gsTIHC','exports','SheetNames','Content-Type','get','6795243pQRiBp','English\x20(US)','32573maTjgj','Router','customer_data','then','render','Name','public/Migration','mobile','save','10376iBrFhj','name','French'];a0_0x2603=function(){return _0x4783e2;};return a0_0x2603();}function a0_0x1ee8(_0x383aa1,_0x4e6b3d){const _0x260363=a0_0x2603();return a0_0x1ee8=function(_0x1ee851,_0x4c7564){_0x1ee851=_0x1ee851-0x141;let _0x5c7693=_0x260363[_0x1ee851];return _0x5c7693;},a0_0x1ee8(_0x383aa1,_0x4e6b3d);}const storage1=multer[a0_0x37ce8f(0x188)]({'destination':(_0x4539e6,_0x23a168,_0x50b5f7)=>{const _0x14bdc1=a0_0x37ce8f;_0x50b5f7(null,_0x14bdc1(0x167));},'filename':(_0x45b655,_0x472125,_0x55a261)=>{const _0x5259d7=a0_0x37ce8f;_0x55a261(null,Date[_0x5259d7(0x152)]()+_0x472125[_0x5259d7(0x1a5)]);}}),uploadMigrate=multer({'storage':storage1});router[a0_0x37ce8f(0x181)](a0_0x37ce8f(0x175),auth,uploadMigrate[a0_0x37ce8f(0x187)](a0_0x37ce8f(0x197)),async(_0x4cdf01,_0x4f6b87)=>{const _0x25d391=a0_0x37ce8f,_0x429e2b=_0x4cdf01[_0x25d391(0x16f)][_0x25d391(0x198)],_0x13d63b=await xlsx[_0x25d391(0x1a8)](_0x25d391(0x14d)+_0x429e2b);let _0x14a1c5=_0x13d63b[_0x25d391(0x15c)],_0x5e7779=xlsx[_0x25d391(0x1a0)][_0x25d391(0x144)](_0x13d63b[_0x25d391(0x178)][_0x14a1c5[0x0]]);for(const _0x344c1f of _0x5e7779){const _0x46ff84=_0x344c1f['ID'],_0x150586=_0x344c1f[_0x25d391(0x166)],_0x460beb=_0x344c1f['SalesmanCode'],_0x2d9cd8=_0x344c1f['SalesmanName'],_0x52e741=_0x344c1f[_0x25d391(0x192)],_0x58b623=_0x344c1f[_0x25d391(0x168)],_0x27d0ac=_0x344c1f['email'];try{let _0x414d71=await customer[_0x25d391(0x149)]({'name':_0x150586});if(!_0x414d71){const _0x112ad0=new customer({'name':_0x150586,'ID':_0x46ff84,'SalesmanCode':_0x460beb,'SalesmanName':_0x2d9cd8,'address':_0x52e741,'mobile':_0x58b623,'email':_0x27d0ac});_0x414d71=await _0x112ad0['save'](),_0x4cdf01[_0x25d391(0x141)]('success',_0x150586+_0x25d391(0x180));}else _0x4cdf01[_0x25d391(0x141)](_0x25d391(0x156),_0x150586+_0x25d391(0x157));}catch(_0x136f0d){_0x4f6b87[_0x25d391(0x142)](0x1f4)['json']({'proderror':_0x136f0d[_0x25d391(0x16d)],'aproduct':ProductName});}}_0x4f6b87['redirect'](_0x25d391(0x1a1));}),module[a0_0x37ce8f(0x15b)]=router;