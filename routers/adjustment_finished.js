var a0_0x53e67e=a0_0x547d;function a0_0x547d(_0x549768,_0x53695d){var _0x66a175=a0_0x66a1();return a0_0x547d=function(_0x547d9c,_0x3115ec){_0x547d9c=_0x547d9c-0x123;var _0x400284=_0x66a175[_0x547d9c];return _0x400284;},a0_0x547d(_0x549768,_0x53695d);}(function(_0x2ddc44,_0x4ce1a6){var _0x29dafa=a0_0x547d,_0x4c4577=_0x2ddc44();while(!![]){try{var _0x370a35=-parseInt(_0x29dafa(0x135))/0x1+-parseInt(_0x29dafa(0x165))/0x2*(-parseInt(_0x29dafa(0x139))/0x3)+-parseInt(_0x29dafa(0x17c))/0x4*(parseInt(_0x29dafa(0x1c6))/0x5)+-parseInt(_0x29dafa(0x143))/0x6*(-parseInt(_0x29dafa(0x18d))/0x7)+-parseInt(_0x29dafa(0x18f))/0x8*(parseInt(_0x29dafa(0x1d6))/0x9)+parseInt(_0x29dafa(0x17f))/0xa*(parseInt(_0x29dafa(0x148))/0xb)+parseInt(_0x29dafa(0x1d2))/0xc*(parseInt(_0x29dafa(0x1b5))/0xd);if(_0x370a35===_0x4ce1a6)break;else _0x4c4577['push'](_0x4c4577['shift']());}catch(_0x59e82c){_0x4c4577['push'](_0x4c4577['shift']());}}}(a0_0x66a1,0x23521));const express=require('express'),app=express(),router=express['Router'](),auth=require('../middleware/auth'),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_finished,email_settings,supervisor_settings}=require(a0_0x53e67e(0x16a)),users=require('../public/language/languages.json'),nodemailer=require(a0_0x53e67e(0x1b7));router['get'](a0_0x53e67e(0x1ef),auth,async(_0x3b2a81,_0x23b603)=>{var _0x11e5b3=a0_0x53e67e;try{const {username:_0x3154cc,email:_0x457169,role:_0x3acdfb}=_0x3b2a81['user'],_0x5495f4=_0x3b2a81[_0x11e5b3(0x1c0)],_0xd04351=await profile[_0x11e5b3(0x1b8)]({'email':_0x5495f4[_0x11e5b3(0x1f4)]}),_0x15e3ec=await master_shop[_0x11e5b3(0x1a1)]();let _0x51e989;if(_0x5495f4[_0x11e5b3(0x132)]==_0x11e5b3(0x1be)){const _0x43cd63=await staff[_0x11e5b3(0x1b8)]({'email':_0x5495f4[_0x11e5b3(0x1f4)]});_0x51e989=await warehouse[_0x11e5b3(0x1a1)]({'status':_0x11e5b3(0x14b),'name':_0x43cd63[_0x11e5b3(0x189)]});}else _0x51e989=await warehouse[_0x11e5b3(0x1a1)]({'status':'Enabled'});const _0x74043d=await product[_0x11e5b3(0x1a1)]();let _0x3188a4;if(_0x5495f4[_0x11e5b3(0x132)]==_0x11e5b3(0x1be)){const _0x4d2180=await staff[_0x11e5b3(0x1b8)]({'email':_0x5495f4[_0x11e5b3(0x1f4)]});_0x3188a4=await adjustment_finished['find']({'warehouse_name':_0x4d2180[_0x11e5b3(0x189)]});}else _0x3188a4=await adjustment_finished[_0x11e5b3(0x169)]([{'$unwind':_0x11e5b3(0x177)},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'date':{'$first':_0x11e5b3(0x1ce)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x11e5b3(0x198)},'finalize':{'$first':_0x11e5b3(0x181)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x15e3ec[0x0][_0x11e5b3(0x18a)]==_0x11e5b3(0x136)){var _0x4fd390=users[_0x11e5b3(0x1f0)];console[_0x11e5b3(0x1bf)](_0x4fd390);}else{if(_0x15e3ec[0x0][_0x11e5b3(0x18a)]=='Hindi')var _0x4fd390=users[_0x11e5b3(0x13c)];else{if(_0x15e3ec[0x0]['language']==_0x11e5b3(0x167))var _0x4fd390=users[_0x11e5b3(0x167)];else{if(_0x15e3ec[0x0][_0x11e5b3(0x18a)]=='Spanish')var _0x4fd390=users[_0x11e5b3(0x17d)];else{if(_0x15e3ec[0x0][_0x11e5b3(0x18a)]=='French')var _0x4fd390=users['French'];else{if(_0x15e3ec[0x0][_0x11e5b3(0x18a)]==_0x11e5b3(0x1f2))var _0x4fd390=users[_0x11e5b3(0x195)];else{if(_0x15e3ec[0x0][_0x11e5b3(0x18a)]==_0x11e5b3(0x12e))var _0x4fd390=users[_0x11e5b3(0x12e)];else{if(_0x15e3ec[0x0][_0x11e5b3(0x18a)]==_0x11e5b3(0x14e))var _0x4fd390=users[_0x11e5b3(0x19c)];}}}}}}}_0x23b603[_0x11e5b3(0x1e7)](_0x11e5b3(0x13b),{'success':_0x3b2a81[_0x11e5b3(0x16f)]('success'),'errors':_0x3b2a81[_0x11e5b3(0x16f)](_0x11e5b3(0x125)),'role':_0x5495f4,'profile':_0xd04351,'warehouse':_0x51e989,'product':_0x74043d,'adjustment':_0x3188a4,'master_shop':_0x15e3ec,'language':_0x4fd390});}catch(_0x5ad439){console[_0x11e5b3(0x1bf)](_0x5ad439);}});async function getRandom8DigitNumber(){var _0xa3303f=a0_0x53e67e;const _0x39e145=0x989680,_0x2a325c=0x5f5e0ff,_0x1d94be=Math[_0xa3303f(0x1ad)](Math[_0xa3303f(0x12b)]()*(_0x2a325c-_0x39e145+0x1))+_0x39e145;var _0x256103;const _0x5613e0=await adjustment_finished[_0xa3303f(0x1b8)]({'invoice':_0xa3303f(0x186)+_0x1d94be});return _0x5613e0&&_0x5613e0[_0xa3303f(0x1b0)]>0x0?_0x256103=_0xa3303f(0x186)+_0x1d94be:_0x256103='ADJ-'+_0x1d94be,_0x256103;}function a0_0x66a1(){var _0x3f1537=['Secondary_units','$product_details.rack','date','$room','random','filter','add','Chinese','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Level\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room\x20</th>','There\x27s\x20a\x20error\x20in\x20this\x20transaction','role','$product_details.bay','$product.product_name','44699bJvOhA','English\x20(US)','prod_name','isle','6rCOKXb','findById','adjustment_finished','Hindi','prod_code','new_adjust_qty','<h2>\x20','Sale\x20Product\x20Mail','slice','_id','90wYhfir','Enclosed','params','secondary_code','pallet','5357gdIVbI','host','room_names','Enabled','Logo.png','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Arabic\x20(ae)','$product_details.CBM','primary_code','unit','CBM','Ambient','</h5>','exports','/barcode_scanner','$product_details.product_name','minus','adjustment\x20data\x20update\x20successfully','room','$product_details.product_stock','adjustment\x20add\x20successfull','Primary_Units','product_name','prod_cat','An\x20error\x20occurred.','master','purchases_data','string','product_code','38320ERMSTV','$product_details.primary_code','German','$product_details.batch_code','aggregate','../models/all_models','adjust_qty','status','$product_details.storage','port','flash','$name','expiry_date','add_adjustment_finished','An\x20error\x20occurred\x20while\x20saving\x20data.','</tbody>','all','<hr\x20class=\x22my-3\x22>','$product','save','</body></html>','$product_details.maxPerUnit','$product_details.level','119792UiKaxH','Spanish','warehouse_name','1770smYmGV','padStart','$finalize','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','Return\x20Rooms','json','maxPerUnit','ADJ-','Email\x20sent\x20successfully','French','warehouse','language','note','$product_details.unit','123053IfYyOP','Error\x20Occurs','324744KAepSu','</thead>','$product_details.secondary_code','$product_details.type','$product_details.secondary_unit','bay','Portuguese','</head><body>','$product_details.maxProducts','$product.room_names','product_stock','createTransport','<table\x20style=\x22width:\x20100%\x20!important;\x22>','Arabic','$product_details.production_date','</span>','edit_adjustment_finished_view','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20of\x20measure\x20</th>','find','<tr>','<h5>','/view/:id','types','batch_code','$product_details.expiry_date','RMSEmail','redirect','<tbody\x20style=\x22text-align:\x20center;\x22>','JO_number','product_details','floor','production_date','forEach','length','getMonth','level','$product_details.pallet','<!DOCTYPE\x20html>','1417VTfPAL','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','nodemailer','findOne','logo','$product_details._id','success','body','/upload/','staff','log','user','map','push','/adjustment_finished/view','\x20</h2>','type','15UTqLbG','get','Return\x20Goods','$product_details.floorlevel','post','product','product_date','</td>','$date','/CheckingWarehouse','/../public','secondary_unit','19284LKVsPE','prod_invoice','$product_details.product_code','message','63AbVKsR','$product_details.bin','/preview/:id','New_Qty_Converted_adj','getFullYear','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product_details','</tr>','error','/view/add_adjustment','finalize','sendMail','$product_details.invoice','New_Qty_Converted','<div>','invoice','edit_adjustment_finished','render','True','\x20Order\x20Date\x20:\x20','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','foreach\x20newproduct','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','catch','/view','English','stock','Portuguese\x20(BR)','then','email','<span\x20style=\x22float:\x20right;\x22>','</div>','errors','Rooms'];a0_0x66a1=function(){return _0x3f1537;};return a0_0x66a1();}router[a0_0x53e67e(0x1c7)](a0_0x53e67e(0x1df),auth,async(_0x155f33,_0x42752a)=>{var _0x20aab4=a0_0x53e67e;try{const {username:_0x22ad77,email:_0x2e6347,role:_0xa5d9d7}=_0x155f33[_0x20aab4(0x1c0)],_0x25eb04=_0x155f33[_0x20aab4(0x1c0)],_0x1f2e82=await profile[_0x20aab4(0x1b8)]({'email':_0x25eb04[_0x20aab4(0x1f4)]}),_0x2ef966=await master_shop[_0x20aab4(0x1a1)]();let _0x26d04f;if(_0x25eb04[_0x20aab4(0x132)]==_0x20aab4(0x1be)){const _0x1520b5=await staff[_0x20aab4(0x1b8)]({'email':_0x25eb04[_0x20aab4(0x1f4)]});_0x26d04f=await warehouse[_0x20aab4(0x169)]([{'$match':{'status':_0x20aab4(0x14b),'name':_0x1520b5['warehouse'],'name':{'$ne':_0x20aab4(0x1c8)}}},{'$group':{'_id':_0x20aab4(0x170),'name':{'$first':_0x20aab4(0x170)}}}]);}else _0x26d04f=await warehouse[_0x20aab4(0x169)]([{'$match':{'status':_0x20aab4(0x14b),'name':{'$ne':_0x20aab4(0x1c8)}}},{'$group':{'_id':_0x20aab4(0x170),'name':{'$first':'$name'}}}]);const _0x3f71cf=await product['find']({}),_0x3c8eb6=await adjustment_finished['find']({}),_0x4983f0=_0x3c8eb6[_0x20aab4(0x1b0)]+0x1,_0x1098ef='ADJ-'+_0x4983f0['toString']()[_0x20aab4(0x180)](0x5,'0');var _0x237acf=[_0x20aab4(0x153),_0x20aab4(0x144),_0x20aab4(0x183)];if(_0x2ef966[0x0]['language']==_0x20aab4(0x136))var _0x35ac0c=users['English'];else{if(_0x2ef966[0x0][_0x20aab4(0x18a)]==_0x20aab4(0x13c))var _0x35ac0c=users[_0x20aab4(0x13c)];else{if(_0x2ef966[0x0]['language']==_0x20aab4(0x167))var _0x35ac0c=users[_0x20aab4(0x167)];else{if(_0x2ef966[0x0][_0x20aab4(0x18a)]==_0x20aab4(0x17d))var _0x35ac0c=users[_0x20aab4(0x17d)];else{if(_0x2ef966[0x0][_0x20aab4(0x18a)]=='French')var _0x35ac0c=users['French'];else{if(_0x2ef966[0x0][_0x20aab4(0x18a)]==_0x20aab4(0x1f2))var _0x35ac0c=users[_0x20aab4(0x195)];else{if(_0x2ef966[0x0][_0x20aab4(0x18a)]==_0x20aab4(0x12e))var _0x35ac0c=users[_0x20aab4(0x12e)];else{if(_0x2ef966[0x0]['language']=='Arabic\x20(ae)')var _0x35ac0c=users['Arabic'];}}}}}}}const _0x54cac8=getRandom8DigitNumber();_0x54cac8['then'](_0x1d507c=>{var _0x3a3d5=_0x20aab4;_0x42752a[_0x3a3d5(0x1e7)](_0x3a3d5(0x172),{'success':_0x155f33[_0x3a3d5(0x16f)](_0x3a3d5(0x1bb)),'errors':_0x155f33[_0x3a3d5(0x16f)](_0x3a3d5(0x125)),'role':_0x25eb04,'profile':_0x1f2e82,'warehouse':_0x26d04f,'product':_0x3f71cf,'master_shop':_0x2ef966,'language':_0x35ac0c,'rooms_data':_0x237acf,'invoice_no':_0x1d507c});})['catch'](_0x33760b=>{var _0x5af877=_0x20aab4;_0x155f33[_0x5af877(0x16f)](_0x5af877(0x125),_0x5af877(0x131)),_0x42752a[_0x5af877(0x1a9)](_0x5af877(0x1c3));});}catch(_0x4b571d){console['log'](_0x4b571d);}}),router['post'](a0_0x53e67e(0x1df),auth,async(_0x1d35e5,_0x418826)=>{var _0x12a6eb=a0_0x53e67e;try{const {warehouse_name:_0x123d09,date:_0x30344b,prod_name:_0x11408b,level:_0x250f7c,isle:_0x28d526,pallet:_0x415026,stock:_0x3280cd,types:_0x546398,adjust_qty:_0x3e5ec3,new_adjust_qty:_0x577b0d,note:_0xc34183,Room_name:_0x18ba28,invoice:_0x3d13e9,JO_number:_0x1105fa,expiry_date:_0x248eb0,PO_number:_0x5186f9,ReqBy:_0x56d2f0,dateofreq:_0x2f4d34,typeservicesData:_0x4f375e,destination:_0x28152f,deliverydate:_0x25c1d7,driver:_0x112080,plate:_0x36be6c,van:_0x38bf17,DRSI:_0x1ef9c1,typevehicle:_0x1a2906,TSU:_0x58d7dc,TFU:_0x45539f}=_0x1d35e5[_0x12a6eb(0x1bc)];if(typeof _0x11408b==_0x12a6eb(0x163))var _0x44c64c=[_0x1d35e5[_0x12a6eb(0x1bc)]['prod_name']],_0x10eff4=[_0x1d35e5['body'][_0x12a6eb(0x1b2)]],_0x26d5ec=[_0x1d35e5[_0x12a6eb(0x1bc)][_0x12a6eb(0x1f1)]],_0x1952c6=[_0x1d35e5[_0x12a6eb(0x1bc)][_0x12a6eb(0x1a5)]],_0xe43033=[_0x1d35e5[_0x12a6eb(0x1bc)][_0x12a6eb(0x1d9)]],_0x429386=[_0x1d35e5[_0x12a6eb(0x1bc)][_0x12a6eb(0x1e3)]],_0x3db903=[_0x1d35e5[_0x12a6eb(0x1bc)][_0x12a6eb(0x15d)]],_0x233fb0=[_0x1d35e5[_0x12a6eb(0x1bc)]['Secondary_units']],_0x2cb8b3=[_0x1d35e5['body'][_0x12a6eb(0x13d)]],_0x8e24f9=[_0x1d35e5['body'][_0x12a6eb(0x1a6)]],_0x2a2c7f=[_0x1d35e5[_0x12a6eb(0x1bc)][_0x12a6eb(0x171)]],_0x1f4763=[_0x1d35e5[_0x12a6eb(0x1bc)][_0x12a6eb(0x1cc)]],_0x1c5384=[_0x1d35e5[_0x12a6eb(0x1bc)]['prod_cat']],_0x4645aa=[_0x1d35e5[_0x12a6eb(0x1bc)][_0x12a6eb(0x126)]],_0x120239=[_0x1d35e5['body'][_0x12a6eb(0x185)]],_0x4a3942=[_0x1d35e5[_0x12a6eb(0x1bc)][_0x12a6eb(0x1c5)]],_0x4c92b8=[_0x1d35e5[_0x12a6eb(0x1bc)][_0x12a6eb(0x150)]],_0x145518=[_0x1d35e5[_0x12a6eb(0x1bc)]['secondary_code']],_0x15f3f0=[_0x1d35e5['body'][_0x12a6eb(0x152)]],_0x5ac87a=[_0x1d35e5['body']['prod_invoice']];else var _0x44c64c=[..._0x1d35e5['body'][_0x12a6eb(0x137)]],_0x10eff4=[..._0x1d35e5[_0x12a6eb(0x1bc)][_0x12a6eb(0x1b2)]],_0x26d5ec=[..._0x1d35e5['body']['stock']],_0x1952c6=[..._0x1d35e5[_0x12a6eb(0x1bc)][_0x12a6eb(0x1a5)]],_0xe43033=[..._0x1d35e5[_0x12a6eb(0x1bc)][_0x12a6eb(0x1d9)]],_0x429386=[..._0x1d35e5[_0x12a6eb(0x1bc)][_0x12a6eb(0x1e3)]],_0x3db903=[..._0x1d35e5['body'][_0x12a6eb(0x15d)]],_0x233fb0=[..._0x1d35e5[_0x12a6eb(0x1bc)][_0x12a6eb(0x127)]],_0x2cb8b3=[..._0x1d35e5[_0x12a6eb(0x1bc)][_0x12a6eb(0x13d)]],_0x8e24f9=[..._0x1d35e5[_0x12a6eb(0x1bc)]['batch_code']],_0x2a2c7f=[..._0x1d35e5['body'][_0x12a6eb(0x171)]],_0x1f4763=[..._0x1d35e5[_0x12a6eb(0x1bc)][_0x12a6eb(0x1cc)]],_0x1c5384=[..._0x1d35e5[_0x12a6eb(0x1bc)][_0x12a6eb(0x15f)]],_0x4645aa=[..._0x1d35e5['body'][_0x12a6eb(0x126)]],_0x120239=[..._0x1d35e5[_0x12a6eb(0x1bc)]['maxPerUnit']],_0x4a3942=[..._0x1d35e5['body'][_0x12a6eb(0x1c5)]],_0x4c92b8=[..._0x1d35e5[_0x12a6eb(0x1bc)]['primary_code']],_0x145518=[..._0x1d35e5[_0x12a6eb(0x1bc)]['secondary_code']],_0x15f3f0=[..._0x1d35e5[_0x12a6eb(0x1bc)][_0x12a6eb(0x152)]],_0x5ac87a=[..._0x1d35e5[_0x12a6eb(0x1bc)][_0x12a6eb(0x1d3)]];const _0x525ee3=_0x44c64c[_0x12a6eb(0x1c1)](_0x5f024b=>{return _0x5f024b={'product_name':_0x5f024b};});_0x4c92b8[_0x12a6eb(0x1af)]((_0x539da4,_0x2a0635)=>{var _0x3b250c=_0x12a6eb;_0x525ee3[_0x2a0635][_0x3b250c(0x150)]=_0x539da4;}),_0x145518[_0x12a6eb(0x1af)]((_0x1df459,_0x17e5de)=>{var _0x2106fb=_0x12a6eb;_0x525ee3[_0x17e5de][_0x2106fb(0x146)]=_0x1df459;}),_0x10eff4[_0x12a6eb(0x1af)]((_0xae3a6a,_0x36f744)=>{var _0x10688c=_0x12a6eb,_0x2331f9=_0xae3a6a[_0x10688c(0x141)](0x1);_0x525ee3[_0x36f744]['isle']=_0xae3a6a[0x0],_0x525ee3[_0x36f744]['pallet']=_0x2331f9;}),_0x4a3942['forEach']((_0x377992,_0x343ede)=>{var _0x195ed5=_0x12a6eb;_0x525ee3[_0x343ede][_0x195ed5(0x1b2)]=_0x377992;}),_0x26d5ec[_0x12a6eb(0x1af)]((_0x2a85d9,_0x5638ad)=>{_0x525ee3[_0x5638ad]['stockBefore']=_0x2a85d9;}),_0x1952c6[_0x12a6eb(0x1af)]((_0x5cb119,_0x14d214)=>{var _0x3fc671=_0x12a6eb;_0x525ee3[_0x14d214][_0x3fc671(0x1a5)]=_0x5cb119;}),_0xe43033[_0x12a6eb(0x1af)]((_0x34fa60,_0x37185f)=>{_0x525ee3[_0x37185f]['adjust_qty']=_0x34fa60;}),_0x429386[_0x12a6eb(0x1af)]((_0x587a61,_0x38b1e6)=>{_0x525ee3[_0x38b1e6]['new_adjust_qty']=_0x587a61;}),_0x3db903[_0x12a6eb(0x1af)]((_0x469487,_0x4aa545)=>{var _0x2bf062=_0x12a6eb;_0x525ee3[_0x4aa545][_0x2bf062(0x151)]=_0x469487;}),_0x233fb0['forEach']((_0x483168,_0x21a6be)=>{var _0x17cf0e=_0x12a6eb;_0x525ee3[_0x21a6be][_0x17cf0e(0x1d1)]=_0x483168;}),_0x2cb8b3[_0x12a6eb(0x1af)]((_0x3e68d1,_0x286585)=>{_0x525ee3[_0x286585]['product_code']=_0x3e68d1;}),_0x8e24f9[_0x12a6eb(0x1af)]((_0x4a2f1d,_0x388597)=>{var _0x348e88=_0x12a6eb;_0x525ee3[_0x388597][_0x348e88(0x1a6)]=_0x4a2f1d;}),_0x2a2c7f['forEach']((_0xb5d36,_0x4da0fb)=>{var _0x38540b=_0x12a6eb;_0x525ee3[_0x4da0fb][_0x38540b(0x171)]=_0xb5d36;}),_0x1f4763['forEach']((_0x4657f9,_0x18fe83)=>{_0x525ee3[_0x18fe83]['production_date']=_0x4657f9;}),_0x1c5384['forEach']((_0x527b8e,_0x1a5fbb)=>{var _0x5b3a3d=_0x12a6eb;_0x525ee3[_0x1a5fbb][_0x5b3a3d(0x15f)]=_0x527b8e;}),_0x4645aa[_0x12a6eb(0x1af)]((_0x21e6c8,_0x557dbc)=>{var _0x184ace=_0x12a6eb;_0x525ee3[_0x557dbc][_0x184ace(0x14a)]=_0x21e6c8;}),_0x120239[_0x12a6eb(0x1af)]((_0x1eaabd,_0x5baa58)=>{var _0x5e6459=_0x12a6eb;_0x525ee3[_0x5baa58][_0x5e6459(0x185)]=_0x1eaabd;}),_0x15f3f0[_0x12a6eb(0x1af)]((_0x4e6579,_0x34d247)=>{var _0x4bf38c=_0x12a6eb;_0x525ee3[_0x34d247][_0x4bf38c(0x152)]=_0x4e6579;}),_0x5ac87a[_0x12a6eb(0x1af)]((_0x330a50,_0x463e56)=>{var _0x137d48=_0x12a6eb;_0x525ee3[_0x463e56][_0x137d48(0x1e5)]=_0x330a50;});const _0x47dce1=_0x525ee3[_0x12a6eb(0x12c)](_0x24ffff=>_0x24ffff[_0x12a6eb(0x13e)]!=='0'&&_0x24ffff[_0x12a6eb(0x13e)]!=='');var _0x5ae4b8=0x0;_0x47dce1['forEach'](_0x3392ca=>{var _0xc8a02e=_0x12a6eb;console[_0xc8a02e(0x1bf)](_0xc8a02e(0x1eb),_0x3392ca),parseInt(_0x3392ca[_0xc8a02e(0x13e)])<0x0&&_0x5ae4b8++;});if(_0x5ae4b8!=0x0)return _0x1d35e5[_0x12a6eb(0x16f)]('errors',_0x12a6eb(0x182)),_0x418826[_0x12a6eb(0x1a9)]('back');const _0x384df1=new adjustment_finished({'warehouse_name':_0x123d09,'date':_0x30344b,'product':_0x47dce1,'note':_0xc34183,'room':_0x18ba28,'invoice':_0x3d13e9,'JO_number':_0x1105fa,'expiry_date':_0x248eb0,'PO_number':_0x5186f9,'RequestedBy':_0x56d2f0,'DateofRequest':_0x2f4d34,'typeservices':_0x4f375e,'destination':_0x28152f,'deliverydate':_0x25c1d7,'driver':_0x112080,'plate':_0x36be6c,'van':_0x38bf17,'DRSI':_0x1ef9c1,'typevehicle':_0x1a2906,'TSU':_0x58d7dc,'TFU':_0x45539f}),_0x571e10=await _0x384df1['save']();_0x1d35e5[_0x12a6eb(0x16f)]('success',_0x12a6eb(0x15c)),_0x418826[_0x12a6eb(0x1a9)]('/adjustment_finished/preview/'+_0x571e10['_id']);}catch(_0x5e5aa2){console[_0x12a6eb(0x1bf)](_0x5e5aa2),_0x418826[_0x12a6eb(0x16c)](0xc8)[_0x12a6eb(0x184)]({'message':_0x5e5aa2[_0x12a6eb(0x1d5)]});}}),router[a0_0x53e67e(0x1c7)](a0_0x53e67e(0x1d8),auth,async(_0x512367,_0x2e26d7)=>{var _0xe71aba=a0_0x53e67e;try{const {username:_0xcc76eb,email:_0x572d78,role:_0x4b2a9f}=_0x512367['user'],_0xb0c760=_0x512367['user'],_0x3b84db=await profile[_0xe71aba(0x1b8)]({'email':_0xb0c760[_0xe71aba(0x1f4)]}),_0x32e895=await master_shop['find'](),_0x5351e5=_0x512367['params']['id'],_0x535a01=await adjustment_finished[_0xe71aba(0x13a)]({'_id':_0x5351e5}),_0xf1a755=await purchases[_0xe71aba(0x169)]([{'$match':{'warehouse_name':_0x535a01[_0xe71aba(0x17e)]}},{'$unwind':_0xe71aba(0x177)},{'$group':{'_id':_0xe71aba(0x134)}}]),_0x15bf7e=await product[_0xe71aba(0x1a1)]({}),_0x53584d=await warehouse[_0xe71aba(0x169)]([{'$match':{'name':_0x535a01['warehouse_name']}},{'$unwind':'$product_details'},{'$group':{'_id':_0xe71aba(0x1ba),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':'$product_details.level'},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0xe71aba(0x1b3)},'primary_code':{'$first':_0xe71aba(0x166)},'secondary_code':{'$first':_0xe71aba(0x191)},'product_code':{'$first':_0xe71aba(0x1d4)},'storage':{'$first':_0xe71aba(0x16d)},'rack':{'$first':_0xe71aba(0x128)},'expiry_date':{'$first':_0xe71aba(0x1a7)},'production_date':{'$first':_0xe71aba(0x19d)},'batch_code':{'$first':_0xe71aba(0x168)},'maxPerUnit':{'$first':_0xe71aba(0x17a)},'room':{'$first':_0xe71aba(0x12a)}}}]);if(_0x32e895[0x0][_0xe71aba(0x18a)]==_0xe71aba(0x136)){var _0x41f85d=users['English'];console[_0xe71aba(0x1bf)](_0x41f85d);}else{if(_0x32e895[0x0][_0xe71aba(0x18a)]==_0xe71aba(0x13c))var _0x41f85d=users[_0xe71aba(0x13c)];else{if(_0x32e895[0x0][_0xe71aba(0x18a)]=='German')var _0x41f85d=users['German'];else{if(_0x32e895[0x0][_0xe71aba(0x18a)]==_0xe71aba(0x17d))var _0x41f85d=users[_0xe71aba(0x17d)];else{if(_0x32e895[0x0][_0xe71aba(0x18a)]==_0xe71aba(0x188))var _0x41f85d=users[_0xe71aba(0x188)];else{if(_0x32e895[0x0][_0xe71aba(0x18a)]=='Portuguese\x20(BR)')var _0x41f85d=users[_0xe71aba(0x195)];else{if(_0x32e895[0x0]['language']==_0xe71aba(0x12e))var _0x41f85d=users[_0xe71aba(0x12e)];else{if(_0x32e895[0x0][_0xe71aba(0x18a)]==_0xe71aba(0x14e))var _0x41f85d=users[_0xe71aba(0x19c)];}}}}}}}_0x2e26d7[_0xe71aba(0x1e7)](_0xe71aba(0x19f),{'success':_0x512367[_0xe71aba(0x16f)](_0xe71aba(0x1bb)),'errors':_0x512367[_0xe71aba(0x16f)](_0xe71aba(0x125)),'role':_0xb0c760,'profile':_0x3b84db,'adjustment':_0x535a01,'stock':_0x53584d,'master_shop':_0x32e895,'warehouse_name':_0xf1a755,'unit':_0x15bf7e,'language':_0x41f85d});}catch(_0x59fcd5){console[_0xe71aba(0x1bf)](_0x59fcd5),_0x2e26d7[_0xe71aba(0x16c)](0xc8)[_0xe71aba(0x184)]({'message':_0x59fcd5[_0xe71aba(0x1d5)]});}}),router[a0_0x53e67e(0x1ca)](a0_0x53e67e(0x1d8),auth,async(_0x2b404a,_0x402e29)=>{var _0x1a68ab=a0_0x53e67e;try{const {invoice:_0x5b10e1,warehouse_name:_0x2447b1,Room_name:_0x837553}=_0x2b404a[_0x1a68ab(0x1bc)],_0xb5e5c4=_0x2b404a['params']['id'],_0x56e1e7=await adjustment_finished['findById']({'_id':_0xb5e5c4});var _0x441d6d;const _0xa5d11a=_0x56e1e7[_0x1a68ab(0x1cb)][_0x1a68ab(0x1c1)](async _0x3d2718=>{var _0x4b252e=_0x1a68ab;if(_0x3d2718[_0x4b252e(0x16b)]>0x0){_0x441d6d=await warehouse[_0x4b252e(0x1b8)]({'name':_0x2447b1,'room':_0x3d2718[_0x4b252e(0x14a)]});const _0x25db24=_0x441d6d['product_details'][_0x4b252e(0x1c1)](_0x5b5e3f=>{var _0x27d48e=_0x4b252e;console[_0x27d48e(0x1bf)](_0x3d2718['types']);if(_0x3d2718[_0x27d48e(0x1a5)]=='minus')_0x5b5e3f[_0x27d48e(0x15e)]==_0x3d2718['product_name']&&_0x5b5e3f['level']==_0x3d2718[_0x27d48e(0x1b2)]&&_0x5b5e3f[_0x27d48e(0x138)]==_0x3d2718['isle']&&_0x5b5e3f[_0x27d48e(0x147)]==_0x3d2718[_0x27d48e(0x147)]&&_0x5b5e3f[_0x27d48e(0x171)]==_0x3d2718[_0x27d48e(0x171)]&&_0x5b5e3f[_0x27d48e(0x1ae)]==_0x3d2718['production_date']&&_0x5b5e3f['batch_code']==_0x3d2718['batch_code']&&_0x5b5e3f[_0x27d48e(0x1e5)]==_0x3d2718[_0x27d48e(0x1e5)]&&(_0x5b5e3f[_0x27d48e(0x199)]=_0x5b5e3f['product_stock']-_0x3d2718[_0x27d48e(0x16b)]);else _0x3d2718['types']==_0x27d48e(0x12d)&&(_0x5b5e3f[_0x27d48e(0x15e)]==_0x3d2718['product_name']&&_0x5b5e3f['level']==_0x3d2718[_0x27d48e(0x1b2)]&&_0x5b5e3f[_0x27d48e(0x138)]==_0x3d2718[_0x27d48e(0x138)]&&_0x5b5e3f[_0x27d48e(0x147)]==_0x3d2718[_0x27d48e(0x147)]&&_0x5b5e3f[_0x27d48e(0x171)]==_0x3d2718['expiry_date']&&_0x5b5e3f[_0x27d48e(0x1ae)]==_0x3d2718[_0x27d48e(0x1ae)]&&_0x5b5e3f['batch_code']==_0x3d2718[_0x27d48e(0x1a6)]&&_0x5b5e3f[_0x27d48e(0x1e5)]==_0x3d2718[_0x27d48e(0x1e5)]&&(_0x5b5e3f[_0x27d48e(0x199)]=_0x5b5e3f['product_stock']+_0x3d2718[_0x27d48e(0x16b)]));});}return _0x441d6d;});Promise['all'](_0xa5d11a)[_0x1a68ab(0x1f3)](async _0x1ec3a7=>{var _0xb841b2=_0x1a68ab;try{for(const _0x150a76 of _0x1ec3a7){await _0x150a76[_0xb841b2(0x178)]();}_0x56e1e7[_0xb841b2(0x1e0)]=_0xb841b2(0x1e8);const _0xbe4d2b=await _0x56e1e7['save']();var _0x120695=_0x56e1e7['product'];const _0x28c666=await master_shop[_0xb841b2(0x1a1)](),_0x26e8c3=await email_settings[_0xb841b2(0x1b8)](),_0x4c7e30=await supervisor_settings[_0xb841b2(0x1a1)]();let _0x2e02a8=nodemailer[_0xb841b2(0x19a)]({'host':_0x26e8c3[_0xb841b2(0x149)],'port':Number(_0x26e8c3[_0xb841b2(0x16e)]),'secure':![],'auth':{'user':_0x26e8c3[_0xb841b2(0x1f4)],'pass':_0x26e8c3['password']}});var _0x2628da='',_0x23103d;for(_0x23103d in _0x120695){_0x2628da+='<tr>'+_0xb841b2(0x1db)+_0x120695[_0x23103d][_0xb841b2(0x15e)]+_0xb841b2(0x1cd)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x120695[_0x23103d]['new_adjust_qty']+_0xb841b2(0x1cd)+_0xb841b2(0x1db)+_0x120695[_0x23103d][_0xb841b2(0x151)]+'</td>'+_0xb841b2(0x1db)+_0x120695[_0x23103d]['room_names']+_0xb841b2(0x1cd)+_0xb841b2(0x1db)+_0x120695[_0x23103d][_0xb841b2(0x1b2)]+_0xb841b2(0x1cd)+_0xb841b2(0x1db)+_0x120695[_0x23103d][_0xb841b2(0x138)]+_0x120695[_0x23103d][_0xb841b2(0x147)]+_0xb841b2(0x1cd)+_0xb841b2(0x1dd);}let _0x2f0216={'from':_0x26e8c3[_0xb841b2(0x1f4)],'to':_0x4c7e30[0x0][_0xb841b2(0x1a8)],'subject':_0xb841b2(0x140),'attachments':[{'filename':_0xb841b2(0x14c),'path':__dirname+_0xb841b2(0x1d0)+_0xb841b2(0x1bd)+_0x28c666[0x0]['image'],'cid':_0xb841b2(0x1b9)}],'html':_0xb841b2(0x1b4)+'<html><head><title></title>'+_0xb841b2(0x196)+_0xb841b2(0x1e4)+_0xb841b2(0x1ec)+_0xb841b2(0x1e4)+_0xb841b2(0x1ed)+_0xb841b2(0x124)+'<div>'+_0xb841b2(0x13f)+_0x28c666[0x0]['site_title']+_0xb841b2(0x1c4)+_0xb841b2(0x124)+_0xb841b2(0x124)+_0xb841b2(0x176)+_0xb841b2(0x1e4)+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x56e1e7[_0xb841b2(0x1e5)]+'\x20'+_0xb841b2(0x123)+_0xb841b2(0x1e9)+_0x56e1e7[_0xb841b2(0x129)]+'\x20'+_0xb841b2(0x19e)+_0xb841b2(0x154)+_0xb841b2(0x124)+_0xb841b2(0x19b)+_0xb841b2(0x1ea)+_0xb841b2(0x1a2)+_0xb841b2(0x14d)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Quantity\x20</th>'+_0xb841b2(0x1a0)+_0xb841b2(0x130)+_0xb841b2(0x12f)+_0xb841b2(0x1b6)+_0xb841b2(0x1dd)+_0xb841b2(0x190)+_0xb841b2(0x1aa)+'\x20'+_0x2628da+'\x20'+_0xb841b2(0x174)+'</table>'+_0xb841b2(0x1e4)+'<strong>\x20Regards\x20</strong>'+_0xb841b2(0x1a3)+_0x28c666[0x0]['site_title']+'</h5>'+_0xb841b2(0x124)+_0xb841b2(0x124)+_0xb841b2(0x179)};_0x2e02a8[_0xb841b2(0x1e1)](_0x2f0216,function(_0x584f67,_0x268d7d){var _0x2067dd=_0xb841b2;_0x584f67?(console['log'](_0x584f67),console[_0x2067dd(0x1bf)](_0x2067dd(0x18e))):console[_0x2067dd(0x1bf)](_0x2067dd(0x187));}),_0x2b404a[_0xb841b2(0x16f)](_0xb841b2(0x1bb),'Adjustment\x20Finalize\x20Successfully'),_0x402e29['redirect']('/picking_list/PDF_adjustmentFinal/'+_0xbe4d2b[_0xb841b2(0x142)]);}catch(_0x5aa254){console['error'](_0x5aa254),_0x402e29[_0xb841b2(0x16c)](0x1f4)['json']({'error':_0xb841b2(0x173)});}})[_0x1a68ab(0x1ee)](_0x14e814=>{var _0x197816=_0x1a68ab;console[_0x197816(0x1de)](_0x14e814),_0x402e29[_0x197816(0x16c)](0x1f4)['json']({'error':_0x197816(0x160)});});}catch(_0x4d200b){_0x402e29['json']({'message':_0x4d200b['message']});}}),router[a0_0x53e67e(0x1c7)](a0_0x53e67e(0x1a4),auth,async(_0x3c15d1,_0x269d9b)=>{var _0x83d5d0=a0_0x53e67e;try{const {username:_0x3fb108,email:_0x104108,role:_0x2fead0}=_0x3c15d1[_0x83d5d0(0x1c0)],_0x454595=_0x3c15d1[_0x83d5d0(0x1c0)],_0x49590=await profile[_0x83d5d0(0x1b8)]({'email':_0x454595['email']}),_0x3647ed=await master_shop[_0x83d5d0(0x1a1)]();console['log'](_0x83d5d0(0x161),_0x3647ed);const _0x15e412=_0x3c15d1['params']['id'],_0x2e2f91=await adjustment_finished[_0x83d5d0(0x13a)]({'_id':_0x15e412});let _0x5e2b16=new Date(_0x2e2f91[_0x83d5d0(0x171)]),_0x217164=('0'+_0x5e2b16['getDate']())[_0x83d5d0(0x141)](-0x2),_0x5b8272=('0'+(_0x5e2b16[_0x83d5d0(0x1b1)]()+0x1))[_0x83d5d0(0x141)](-0x2),_0x305d62=_0x5e2b16[_0x83d5d0(0x1da)](),_0x246ca0=_0x305d62+'-'+_0x5b8272+'-'+_0x217164;var _0x14df8b=[_0x83d5d0(0x153),_0x83d5d0(0x144),_0x83d5d0(0x183)];const _0x1a79a8=await purchases['aggregate']([{'$match':{'warehouse_name':_0x2e2f91[_0x83d5d0(0x17e)]}},{'$unwind':_0x83d5d0(0x177)},{'$group':{'_id':'$product.product_name'}}]);console[_0x83d5d0(0x1bf)](_0x83d5d0(0x162),_0x1a79a8);const _0xcbcd89=await product[_0x83d5d0(0x1a1)]({}),_0x433d9e=await warehouse['aggregate']([{'$match':{'name':_0x2e2f91[_0x83d5d0(0x17e)],'room':_0x2e2f91[_0x83d5d0(0x15a)]}},{'$unwind':_0x83d5d0(0x1dc)},{'$group':{'_id':_0x83d5d0(0x1ba),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x83d5d0(0x15b)},'bay':{'$first':_0x83d5d0(0x133)},'bin':{'$first':_0x83d5d0(0x1d7)},'type':{'$first':_0x83d5d0(0x192)},'floorlevel':{'$first':_0x83d5d0(0x1c9)},'primary_code':{'$first':_0x83d5d0(0x166)},'secondary_code':{'$first':_0x83d5d0(0x191)},'product_code':{'$first':_0x83d5d0(0x1d4)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x83d5d0(0x128)}}}]);if(_0x3647ed[0x0][_0x83d5d0(0x18a)]==_0x83d5d0(0x136)){var _0x18a1bd=users[_0x83d5d0(0x1f0)];console[_0x83d5d0(0x1bf)](_0x18a1bd);}else{if(_0x3647ed[0x0][_0x83d5d0(0x18a)]=='Hindi')var _0x18a1bd=users[_0x83d5d0(0x13c)];else{if(_0x3647ed[0x0]['language']==_0x83d5d0(0x167))var _0x18a1bd=users['German'];else{if(_0x3647ed[0x0][_0x83d5d0(0x18a)]=='Spanish')var _0x18a1bd=users[_0x83d5d0(0x17d)];else{if(_0x3647ed[0x0][_0x83d5d0(0x18a)]=='French')var _0x18a1bd=users['French'];else{if(_0x3647ed[0x0][_0x83d5d0(0x18a)]==_0x83d5d0(0x1f2))var _0x18a1bd=users[_0x83d5d0(0x195)];else{if(_0x3647ed[0x0][_0x83d5d0(0x18a)]==_0x83d5d0(0x12e))var _0x18a1bd=users[_0x83d5d0(0x12e)];else{if(_0x3647ed[0x0][_0x83d5d0(0x18a)]==_0x83d5d0(0x14e))var _0x18a1bd=users['Arabic'];}}}}}}}_0x269d9b[_0x83d5d0(0x1e7)](_0x83d5d0(0x1e6),{'success':_0x3c15d1[_0x83d5d0(0x16f)](_0x83d5d0(0x1bb)),'errors':_0x3c15d1[_0x83d5d0(0x16f)]('errors'),'role':_0x454595,'profile':_0x49590,'adjustment':_0x2e2f91,'stock':_0x433d9e,'master_shop':_0x3647ed,'warehouse_name':_0x1a79a8,'unit':_0xcbcd89,'language':_0x18a1bd,'rooms_data':_0x14df8b,'ed_fullDate':_0x246ca0});}catch(_0xb27488){console[_0x83d5d0(0x1bf)](_0xb27488),_0x269d9b[_0x83d5d0(0x16c)](0xc8)[_0x83d5d0(0x184)]({'message':_0xb27488[_0x83d5d0(0x1d5)]});}}),router[a0_0x53e67e(0x1ca)](a0_0x53e67e(0x1a4),auth,async(_0x438e8e,_0x318659)=>{var _0x2b4973=a0_0x53e67e;try{const _0x11bfd5=_0x438e8e[_0x2b4973(0x145)]['id'],_0x5b2fac=await adjustment_finished[_0x2b4973(0x13a)]({'_id':_0x11bfd5}),_0x11adee=await warehouse[_0x2b4973(0x1b8)]({'name':_0x5b2fac['warehouse_name'],'room':_0x5b2fac['room']}),{warehouse_name:_0x1c6515,date:_0x293ee9,prod_name:_0x260433,level:_0x5d0bf3,isle:_0x49b1f8,pallet:_0x321fbf,stock:_0x54e6a0,types:_0x404911,adjust_qty:_0x4b108d,new_adjust_qty:_0x2b9d35,note:_0x34979e,Room_name:_0x186f6e,invoice:_0x8d5da2,JO_number:_0x7d73ec}=_0x438e8e[_0x2b4973(0x1bc)];if(typeof _0x260433==_0x2b4973(0x163))var _0x439c4d=[_0x438e8e['body'][_0x2b4973(0x137)]],_0x33b487=[_0x438e8e['body'][_0x2b4973(0x1b2)]],_0x10af1f=[_0x438e8e[_0x2b4973(0x1bc)]['stock']],_0x33a1c6=[_0x438e8e['body'][_0x2b4973(0x1a5)]],_0x57b3cf=[_0x438e8e[_0x2b4973(0x1bc)][_0x2b4973(0x16b)]],_0x133fc1=[_0x438e8e[_0x2b4973(0x1bc)][_0x2b4973(0x13e)]],_0x5c80af=[_0x438e8e[_0x2b4973(0x1bc)]['prod_code']],_0x4e325a=[_0x438e8e['body']['unit']],_0x17e3bb=[_0x438e8e[_0x2b4973(0x1bc)][_0x2b4973(0x127)]],_0x3f6a3c=[_0x438e8e[_0x2b4973(0x1bc)][_0x2b4973(0x1a6)]],_0x1460fe=[_0x438e8e[_0x2b4973(0x1bc)][_0x2b4973(0x171)]];else var _0x439c4d=[..._0x438e8e[_0x2b4973(0x1bc)]['prod_name']],_0x33b487=[..._0x438e8e[_0x2b4973(0x1bc)][_0x2b4973(0x1b2)]],_0x10af1f=[..._0x438e8e[_0x2b4973(0x1bc)]['stock']],_0x33a1c6=[..._0x438e8e['body'][_0x2b4973(0x1a5)]],_0x57b3cf=[..._0x438e8e[_0x2b4973(0x1bc)]['adjust_qty']],_0x133fc1=[..._0x438e8e[_0x2b4973(0x1bc)][_0x2b4973(0x13e)]],_0x5c80af=[..._0x438e8e[_0x2b4973(0x1bc)][_0x2b4973(0x13d)]],_0x4e325a=[..._0x438e8e['body']['unit']],_0x17e3bb=[..._0x438e8e['body']['Secondary_units']],_0x3f6a3c=[..._0x438e8e[_0x2b4973(0x1bc)][_0x2b4973(0x1a6)]],_0x1460fe=[..._0x438e8e['body']['expiry_date']];const _0x5bce3b=_0x439c4d[_0x2b4973(0x1c1)](_0x1c1af4=>{return _0x1c1af4={'product_name':_0x1c1af4};});_0x33b487[_0x2b4973(0x1af)]((_0x1b38d2,_0x4a5b49)=>{_0x5bce3b[_0x4a5b49]['bay']=_0x1b38d2;}),_0x10af1f[_0x2b4973(0x1af)]((_0x553192,_0x217922)=>{_0x5bce3b[_0x217922]['stockBefore']=_0x553192;}),_0x33a1c6[_0x2b4973(0x1af)]((_0x165cd3,_0xb8a81)=>{var _0x58e0a8=_0x2b4973;_0x5bce3b[_0xb8a81][_0x58e0a8(0x1a5)]=_0x165cd3;}),_0x57b3cf[_0x2b4973(0x1af)]((_0x189f19,_0xc154ed)=>{var _0x23f062=_0x2b4973;_0x5bce3b[_0xc154ed][_0x23f062(0x16b)]=_0x189f19;}),_0x133fc1[_0x2b4973(0x1af)]((_0x116b3c,_0x1d95e4)=>{_0x5bce3b[_0x1d95e4]['new_adjust_qty']=_0x116b3c;}),_0x4e325a[_0x2b4973(0x1af)]((_0x12c28c,_0xb963a8)=>{var _0x3e7add=_0x2b4973;_0x5bce3b[_0xb963a8][_0x3e7add(0x151)]=_0x12c28c;}),_0x17e3bb[_0x2b4973(0x1af)]((_0x257aa9,_0x440559)=>{_0x5bce3b[_0x440559]['secondary_unit']=_0x257aa9;}),_0x5c80af['forEach']((_0x31cd5a,_0x17f37e)=>{var _0x31b1c6=_0x2b4973;_0x5bce3b[_0x17f37e][_0x31b1c6(0x164)]=_0x31cd5a;}),_0x3f6a3c[_0x2b4973(0x1af)]((_0xd0cc9f,_0x414ad4)=>{var _0x2b4934=_0x2b4973;_0x5bce3b[_0x414ad4][_0x2b4934(0x1a6)]=_0xd0cc9f;}),_0x1460fe[_0x2b4973(0x1af)]((_0x2065aa,_0x304eed)=>{_0x5bce3b[_0x304eed]['expiry_date']=_0x2065aa;});const _0x68a48b=_0x5bce3b[_0x2b4973(0x12c)](_0x918f33=>_0x918f33[_0x2b4973(0x16b)]!=='0'&&_0x918f33['adjust_qty']!=='');var _0x1dba5e=0x0;_0x68a48b['forEach'](_0x1a65ca=>{var _0xa206a0=_0x2b4973;console['log'](_0xa206a0(0x1eb),_0x1a65ca),parseInt(_0x1a65ca['adjust_qty'])<=0x0&&_0x1dba5e++;});if(_0x1dba5e!=0x0)return _0x438e8e[_0x2b4973(0x16f)](_0x2b4973(0x125),'You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0x318659['redirect']('back');_0x5b2fac[_0x2b4973(0x17e)]=_0x1c6515,_0x5b2fac[_0x2b4973(0x129)]=_0x293ee9,_0x5b2fac['product']=_0x68a48b,_0x5b2fac[_0x2b4973(0x18b)]=_0x34979e,_0x5b2fac[_0x2b4973(0x15a)]=_0x186f6e,_0x5b2fac['invoice']=_0x8d5da2,_0x5b2fac[_0x2b4973(0x1ab)]=_0x7d73ec;const _0x25f134=await _0x5b2fac[_0x2b4973(0x178)](),_0x2615f7=await warehouse['findOne']({'name':_0x1c6515,'room':_0x186f6e});_0x25f134[_0x2b4973(0x1cb)][_0x2b4973(0x1af)](_0x30f345=>{var _0x1b040e=_0x2b4973;const _0x13d003=_0x2615f7[_0x1b040e(0x1ac)][_0x1b040e(0x1c1)](_0x9f6ff4=>{var _0x2fd312=_0x1b040e;_0x30f345[_0x2fd312(0x1a5)]==_0x2fd312(0x158)?_0x9f6ff4[_0x2fd312(0x15e)]==_0x30f345[_0x2fd312(0x15e)]&&_0x9f6ff4[_0x2fd312(0x194)]==_0x30f345['bay']&&(_0x9f6ff4[_0x2fd312(0x199)]=parseInt(_0x9f6ff4[_0x2fd312(0x199)])-parseInt(_0x30f345[_0x2fd312(0x16b)])):_0x9f6ff4[_0x2fd312(0x15e)]==_0x30f345[_0x2fd312(0x15e)]&&_0x9f6ff4[_0x2fd312(0x194)]==_0x30f345[_0x2fd312(0x194)]&&(_0x9f6ff4[_0x2fd312(0x199)]=parseInt(_0x9f6ff4['product_stock'])+parseInt(_0x30f345['adjust_qty']));});}),await _0x2615f7[_0x2b4973(0x178)](),_0x438e8e['flash'](_0x2b4973(0x1bb),_0x2b4973(0x159)),_0x318659[_0x2b4973(0x1a9)]('/adjustment_finished/view');}catch(_0x39044e){console[_0x2b4973(0x1bf)](_0x39044e);}}),router[a0_0x53e67e(0x1ca)](a0_0x53e67e(0x156),async(_0x115733,_0x47a9e4)=>{var _0x233626=a0_0x53e67e;const {primary_code:_0x15b882,warehouse_data:_0x2187d7,rooms_data:_0x5298d2,Roomslist:_0x443549}=_0x115733[_0x233626(0x1bc)],_0x3038d6=_0x443549['split'](','),_0xbca9cd=[];async function _0x2cd842(_0x5ce5e1){var _0x3f5c49=_0x233626;const _0x593edd=await warehouse[_0x3f5c49(0x169)]([{'$match':{'name':_0x2187d7,'room':_0x5ce5e1}},{'$unwind':_0x3f5c49(0x1dc)},{'$match':{'product_details.primary_code':_0x15b882}},{'$group':{'_id':_0x3f5c49(0x1ba),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x3f5c49(0x15b)},'primary_code':{'$first':_0x3f5c49(0x166)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x3f5c49(0x1d4)},'level':{'$first':_0x3f5c49(0x17b)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x3f5c49(0x1b3)},'unit':{'$first':_0x3f5c49(0x18c)},'secondary_unit':{'$first':_0x3f5c49(0x193)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x3f5c49(0x128)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x3f5c49(0x168)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x3f5c49(0x17a)},'roomNamed':{'$first':_0x3f5c49(0x12a)},'CBM':{'$first':{'$toDouble':'$product_details.CBM'}},'maxProducts':{'$first':'$product_details.maxProducts'},'invoice':{'$first':_0x3f5c49(0x1e2)}}}]),_0xd3ddf9=await warehouse[_0x3f5c49(0x169)]([{'$match':{'name':_0x2187d7,'room':_0x5ce5e1}},{'$unwind':_0x3f5c49(0x1dc)},{'$match':{'product_details.secondary_code':_0x15b882}},{'$group':{'_id':_0x3f5c49(0x1ba),'name':{'$first':_0x3f5c49(0x157)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x3f5c49(0x166)},'secondary_code':{'$first':_0x3f5c49(0x191)},'product_code':{'$first':_0x3f5c49(0x1d4)},'level':{'$first':_0x3f5c49(0x17b)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':'$product_details.pallet'},'unit':{'$first':_0x3f5c49(0x18c)},'secondary_unit':{'$first':_0x3f5c49(0x193)},'storage':{'$first':_0x3f5c49(0x16d)},'rack':{'$first':_0x3f5c49(0x128)},'expiry_date':{'$first':_0x3f5c49(0x1a7)},'production_date':{'$first':_0x3f5c49(0x19d)},'batch_code':{'$first':_0x3f5c49(0x168)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':_0x3f5c49(0x17a)},'roomNamed':{'$first':_0x3f5c49(0x12a)},'CBM':{'$first':{'$toDouble':_0x3f5c49(0x14f)}},'maxProducts':{'$first':_0x3f5c49(0x197)},'invoice':{'$first':_0x3f5c49(0x1e2)}}}]);if(_0x593edd['length']>0x0)_0xbca9cd[_0x3f5c49(0x1c2)](_0x593edd);else _0xd3ddf9[_0x3f5c49(0x1b0)]>0x0&&_0xbca9cd[_0x3f5c49(0x1c2)](_0xd3ddf9);}const _0x59cc4a=_0x3038d6[_0x233626(0x1c1)](_0x4835b6=>_0x2cd842(_0x4835b6));await Promise[_0x233626(0x175)](_0x59cc4a),_0x47a9e4[_0x233626(0x184)](_0xbca9cd);}),router[a0_0x53e67e(0x1ca)](a0_0x53e67e(0x1cf),async(_0x179b9f,_0x32b5b0)=>{var _0x44e3b4=a0_0x53e67e;const {productCode:_0x16c0ac,bay:_0x56ab4f,warehouses:_0x38adb5,room:_0x5a5f03}=_0x179b9f[_0x44e3b4(0x1bc)];console[_0x44e3b4(0x1bf)](_0x179b9f['body']);try{const _0x5703c6=await warehouse[_0x44e3b4(0x169)]([{'$match':{'name':_0x38adb5,'room':_0x5a5f03}},{'$unwind':_0x44e3b4(0x1dc)},{'$match':{'product_details.bay':parseInt(_0x56ab4f)}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':_0x44e3b4(0x197)}}}]);_0x32b5b0['status'](0xc8)[_0x44e3b4(0x184)](_0x5703c6);}catch(_0x32eb5a){_0x32b5b0['status'](0x194)[_0x44e3b4(0x184)]({'message':_0x32eb5a[_0x44e3b4(0x1d5)]});}}),module[a0_0x53e67e(0x155)]=router;