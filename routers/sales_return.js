var a0_0x524426=a0_0x4f58;function a0_0x2eba(){var _0x3ff148=['product_code','$product_details.secondary_code','Chinese','findById','$product_details','express','6gvAQCf','types','$product_details.bay','getMonth','flash','save','redirect','Return\x20Goods','Portuguese\x20(BR)','primary_code','get','../public/language/languages.json','message','params','log','130QMpOqb','map','$product_details.type','$product_details.rack','ToRoom','aggregate','findOne','due_amount','slice','exports','2ZkpNgT','French','payment\x20successfull','$product_details.product_code','email','name','/view','secondary_code','all_data','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','warehouse_name','string','stock','bay','purchase\x20return\x20successfully','English','master','user','Sale\x20Return','German','Hindi','stocks','Portuguese','ToWarehouse','getDate','Return\x20Rooms','../models/all_models','$product_details._id','bin','forEach','product_stock','885600AeuyHm','$name','product_name','status','customer_docs','175740tbdtym','amount','type','$product_details.product_stock','sale_qty','Arabic\x20(ae)','language','body','/give_payment/:id','date','paid_amount','return_qty','suppliers','find','1022987rdSSpM','render','$customer_docs','/sales_return/view','errors','sales_quantity','success','Returned\x20Payment\x20For\x20Sale\x20Return','post','old_warehouse_data','sales_return','793269kwEgtg','customer','back','Arabic','invoice','customers','622113TnabbM','202511giEerB','product_details','1928264HJowfn','Enabled','subtract','/view/:id','English\x20(US)','new\x20new_data','return_sale','Raw\x20Materials','Spanish','floorlevel'];a0_0x2eba=function(){return _0x3ff148;};return a0_0x2eba();}(function(_0x40c9e6,_0x1b4110){var _0x594496=a0_0x4f58,_0x170e31=_0x40c9e6();while(!![]){try{var _0x10140e=-parseInt(_0x594496(0xd1))/0x1+-parseInt(_0x594496(0x8d))/0x2*(parseInt(_0x594496(0xd0))/0x3)+-parseInt(_0x594496(0xb1))/0x4+-parseInt(_0x594496(0xac))/0x5+parseInt(_0x594496(0x74))/0x6*(-parseInt(_0x594496(0xbf))/0x7)+-parseInt(_0x594496(0xd3))/0x8+-parseInt(_0x594496(0xca))/0x9*(-parseInt(_0x594496(0x83))/0xa);if(_0x10140e===_0x1b4110)break;else _0x170e31['push'](_0x170e31['shift']());}catch(_0x4f946f){_0x170e31['push'](_0x170e31['shift']());}}}(a0_0x2eba,0x1f2ea));const express=require(a0_0x524426(0x73)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,customer_payment,c_payment_data}=require(a0_0x524426(0xa7)),auth=require('../middleware/auth'),users=require(a0_0x524426(0x7f));function a0_0x4f58(_0x114b15,_0x34b152){var _0x2eba23=a0_0x2eba();return a0_0x4f58=function(_0x4f5862,_0x51690a){_0x4f5862=_0x4f5862-0x69;var _0x3a7d86=_0x2eba23[_0x4f5862];return _0x3a7d86;},a0_0x4f58(_0x114b15,_0x34b152);}router[a0_0x524426(0x7e)](a0_0x524426(0x93),auth,async(_0x579a70,_0x39990c)=>{var _0x5d9d4d=a0_0x524426;try{const {username:_0x333af7,email:_0x39c32c,role:_0x854f0e}=_0x579a70[_0x5d9d4d(0x9e)],_0x8227fe=_0x579a70[_0x5d9d4d(0x9e)],_0x408755=await profile[_0x5d9d4d(0x89)]({'email':_0x8227fe['email']}),_0x270c37=await master_shop[_0x5d9d4d(0xbe)]();console[_0x5d9d4d(0x82)](_0x5d9d4d(0x9d),_0x270c37);const _0xc8a66=await sales_return[_0x5d9d4d(0x88)]([{'$lookup':{'from':_0x5d9d4d(0xcf),'localField':_0x5d9d4d(0xcb),'foreignField':_0x5d9d4d(0x92),'as':_0x5d9d4d(0xb0)}},{'$unwind':_0x5d9d4d(0xc1)}]);console[_0x5d9d4d(0x82)](_0x5d9d4d(0x95),_0xc8a66);if(_0x270c37[0x0][_0x5d9d4d(0xb7)]==_0x5d9d4d(0xd7)){var _0x33a169=users['English'];console[_0x5d9d4d(0x82)](_0x33a169);}else{if(_0x270c37[0x0][_0x5d9d4d(0xb7)]==_0x5d9d4d(0xa1))var _0x33a169=users[_0x5d9d4d(0xa1)];else{if(_0x270c37[0x0][_0x5d9d4d(0xb7)]==_0x5d9d4d(0xa0))var _0x33a169=users[_0x5d9d4d(0xa0)];else{if(_0x270c37[0x0][_0x5d9d4d(0xb7)]==_0x5d9d4d(0x6c))var _0x33a169=users[_0x5d9d4d(0x6c)];else{if(_0x270c37[0x0][_0x5d9d4d(0xb7)]==_0x5d9d4d(0x8e))var _0x33a169=users['French'];else{if(_0x270c37[0x0]['language']==_0x5d9d4d(0x7c))var _0x33a169=users[_0x5d9d4d(0xa3)];else{if(_0x270c37[0x0][_0x5d9d4d(0xb7)]==_0x5d9d4d(0x70))var _0x33a169=users['Chinese'];else{if(_0x270c37[0x0][_0x5d9d4d(0xb7)]==_0x5d9d4d(0xb6))var _0x33a169=users[_0x5d9d4d(0xcd)];}}}}}}}_0x39990c['render'](_0x5d9d4d(0xc9),{'success':_0x579a70['flash']('success'),'errors':_0x579a70['flash'](_0x5d9d4d(0xc3)),'role':_0x8227fe,'profile':_0x408755,'master_shop':_0x270c37,'user':_0xc8a66,'language':_0x33a169});}catch(_0x349872){console[_0x5d9d4d(0x82)](_0x349872);}}),router['get'](a0_0x524426(0xd6),auth,async(_0x46b4b2,_0xd3320d)=>{var _0x29eb42=a0_0x524426;try{const {username:_0x3dca37,email:_0x3ae4a4,role:_0x435dc2}=_0x46b4b2[_0x29eb42(0x9e)],_0x5ec883=_0x46b4b2['user'],_0x34a4c6=await profile[_0x29eb42(0x89)]({'email':_0x5ec883[_0x29eb42(0x91)]}),_0x19e53d=await master_shop[_0x29eb42(0xbe)]();console[_0x29eb42(0x82)](_0x29eb42(0x9d),_0x19e53d);const _0x55aaea=_0x46b4b2[_0x29eb42(0x81)]['id'];console[_0x29eb42(0x82)](_0x55aaea);var _0x584b09=[_0x29eb42(0xa6)];const _0xd36049=await sales_return[_0x29eb42(0x71)](_0x55aaea),_0x3385d3=await warehouse[_0x29eb42(0x88)]([{'$match':{'name':_0xd36049[_0x29eb42(0xa4)],'room':_0xd36049['ToRoom']}},{'$unwind':_0x29eb42(0x72)},{'$group':{'_id':_0x29eb42(0xa8),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x29eb42(0xb4)},'bay':{'$first':_0x29eb42(0x76)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x29eb42(0x85)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x29eb42(0x6f)},'product_code':{'$first':_0x29eb42(0x90)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x29eb42(0x86)}}}]);console['log'](_0x3385d3);const _0x36969b=await warehouse['aggregate']([{'$match':{'status':_0x29eb42(0xd4),'name':_0x29eb42(0x7b),'warehouse_category':_0x29eb42(0x6b)}},{'$group':{'_id':_0x29eb42(0xad),'name':{'$first':_0x29eb42(0xad)}}},{'$sort':{'name':0x1}}]),_0x52582d=await product['find']({});if(_0x19e53d[0x0][_0x29eb42(0xb7)]==_0x29eb42(0xd7)){var _0x11dc1b=users[_0x29eb42(0x9c)];console['log'](_0x11dc1b);}else{if(_0x19e53d[0x0][_0x29eb42(0xb7)]==_0x29eb42(0xa1))var _0x11dc1b=users['Hindi'];else{if(_0x19e53d[0x0][_0x29eb42(0xb7)]=='German')var _0x11dc1b=users['German'];else{if(_0x19e53d[0x0][_0x29eb42(0xb7)]==_0x29eb42(0x6c))var _0x11dc1b=users[_0x29eb42(0x6c)];else{if(_0x19e53d[0x0]['language']=='French')var _0x11dc1b=users[_0x29eb42(0x8e)];else{if(_0x19e53d[0x0][_0x29eb42(0xb7)]==_0x29eb42(0x7c))var _0x11dc1b=users[_0x29eb42(0xa3)];else{if(_0x19e53d[0x0][_0x29eb42(0xb7)]==_0x29eb42(0x70))var _0x11dc1b=users['Chinese'];else{if(_0x19e53d[0x0][_0x29eb42(0xb7)]==_0x29eb42(0xb6))var _0x11dc1b=users['Arabic'];}}}}}}}_0xd3320d[_0x29eb42(0xc0)]('return_sale_edit',{'success':_0x46b4b2[_0x29eb42(0x78)](_0x29eb42(0xc5)),'errors':_0x46b4b2['flash']('errors'),'role':_0x5ec883,'profile':_0x34a4c6,'master_shop':_0x19e53d,'user':_0xd36049,'stock':_0x3385d3,'unit':_0x52582d,'language':_0x11dc1b,'warehouses':_0x36969b,'rooms':_0x584b09});}catch(_0x5e164e){console[_0x29eb42(0x82)](_0x5e164e);}}),router[a0_0x524426(0xc7)]('/view/:id',auth,async(_0x306ffd,_0x24de56)=>{var _0x292179=a0_0x524426;try{const _0x2c304e=_0x306ffd[_0x292179(0x81)]['id'];console[_0x292179(0x82)](_0x2c304e);const _0xe94464=await sales_return[_0x292179(0x89)]({'invoice':_0x306ffd[_0x292179(0xb8)][_0x292179(0xce)]});console['log']('old_data',_0xe94464);const _0x48cd23=await warehouse[_0x292179(0x89)]({'name':_0xe94464[_0x292179(0xa4)],'room':_0xe94464['ToRoom']});console[_0x292179(0x82)](_0x292179(0xc8),_0x48cd23);const {invoice:_0x2775d9,customer:_0x46d75a,date:_0xda4972,warehouse_name:_0x29e24f,product_name:_0xe60d9d,primary_code:_0x5b5a8c,secondary_code:_0x3d63c9,product_code:_0x1ea9d2,sales_quantity:_0x4dc87f,stocks:_0x2def25,return_qty:_0x10244c,note:_0x323014,to_warehouse_name:_0x59fb2c,to_Room_name:_0x5c04f5}=_0x306ffd['body'];console[_0x292179(0x82)](_0x306ffd[_0x292179(0xb8)]);if(typeof _0xe60d9d==_0x292179(0x98))var _0x3d887f=[_0x306ffd[_0x292179(0xb8)][_0x292179(0xae)]],_0x47aec5=[_0x306ffd[_0x292179(0xb8)][_0x292179(0x7d)]],_0x4060dc=[_0x306ffd[_0x292179(0xb8)][_0x292179(0x94)]],_0xaaf402=[_0x306ffd['body'][_0x292179(0x6e)]],_0x213ed7=[_0x306ffd['body'][_0x292179(0xc4)]],_0x5d756a=[_0x306ffd[_0x292179(0xb8)]['stocks']],_0x3e917c=[_0x306ffd[_0x292179(0xb8)][_0x292179(0xbc)]],_0x1c84a7=[_0x306ffd[_0x292179(0xb8)][_0x292179(0x9a)]],_0x25dee6=[_0x306ffd[_0x292179(0xb8)]['bin']],_0x34897e=[_0x306ffd['body'][_0x292179(0x75)]],_0x48e9c3=[_0x306ffd[_0x292179(0xb8)][_0x292179(0x6d)]];else var _0x3d887f=[..._0x306ffd[_0x292179(0xb8)][_0x292179(0xae)]],_0x47aec5=[..._0x306ffd[_0x292179(0xb8)][_0x292179(0x7d)]],_0x4060dc=[..._0x306ffd[_0x292179(0xb8)][_0x292179(0x94)]],_0xaaf402=[..._0x306ffd['body'][_0x292179(0x6e)]],_0x213ed7=[..._0x306ffd[_0x292179(0xb8)][_0x292179(0xc4)]],_0x5d756a=[..._0x306ffd[_0x292179(0xb8)][_0x292179(0xa2)]],_0x3e917c=[..._0x306ffd[_0x292179(0xb8)][_0x292179(0xbc)]],_0x1c84a7=[..._0x306ffd[_0x292179(0xb8)][_0x292179(0x9a)]],_0x25dee6=[..._0x306ffd[_0x292179(0xb8)]['bin']],_0x34897e=[..._0x306ffd['body']['types']],_0x48e9c3=[..._0x306ffd['body']['floorlevel']];const _0x30c13e=_0x3d887f['map'](_0x241fbf=>{return _0x241fbf={'product_name':_0x241fbf};});_0x47aec5[_0x292179(0xaa)]((_0x68a9d2,_0x5c6943)=>{_0x30c13e[_0x5c6943]['primary_code']=_0x68a9d2;}),_0x4060dc[_0x292179(0xaa)]((_0x194017,_0x162a3b)=>{_0x30c13e[_0x162a3b]['secondary_code']=_0x194017;}),_0xaaf402['forEach']((_0x465686,_0x470527)=>{_0x30c13e[_0x470527]['product_code']=_0x465686;}),_0x213ed7[_0x292179(0xaa)]((_0x1b428f,_0x3cd834)=>{var _0x457cdd=_0x292179;_0x30c13e[_0x3cd834][_0x457cdd(0xb5)]=_0x1b428f;}),_0x5d756a['forEach']((_0x57e757,_0x15054a)=>{var _0x479f73=_0x292179;_0x30c13e[_0x15054a][_0x479f73(0x99)]=_0x57e757;}),_0x3e917c[_0x292179(0xaa)]((_0x4056e0,_0x57eb21)=>{var _0x3effbd=_0x292179;_0x30c13e[_0x57eb21][_0x3effbd(0xbc)]=_0x4056e0;}),_0x1c84a7[_0x292179(0xaa)]((_0x3fadf5,_0x3fb488)=>{var _0x44406f=_0x292179;_0x30c13e[_0x3fb488][_0x44406f(0x9a)]=_0x3fadf5;}),_0x25dee6['forEach']((_0x52dacf,_0x5b2d85)=>{var _0x517304=_0x292179;_0x30c13e[_0x5b2d85][_0x517304(0xa9)]=_0x52dacf;}),_0x34897e[_0x292179(0xaa)]((_0x4b6f34,_0x4655f8)=>{var _0x18e1f8=_0x292179;_0x30c13e[_0x4655f8][_0x18e1f8(0xb3)]=_0x4b6f34;}),_0x48e9c3[_0x292179(0xaa)]((_0x52e287,_0x28b454)=>{var _0x3afc47=_0x292179;_0x30c13e[_0x28b454][_0x3afc47(0x6d)]=_0x52e287;});var _0x36d664=0x0;_0x30c13e[_0x292179(0xaa)](_0x4a1679=>{var _0x2d5ff3=_0x292179;console['log']('foreach\x20newproduct',_0x4a1679),(parseInt(_0x4a1679[_0x2d5ff3(0xb5)])<parseInt(_0x4a1679[_0x2d5ff3(0xbc)])||parseInt(_0x4a1679['stock'])<parseInt(_0x4a1679['return_qty'])&&parseInt(_0x4a1679[_0x2d5ff3(0xb5)])>parseInt(_0x4a1679[_0x2d5ff3(0xbc)])||parseInt(_0x4a1679[_0x2d5ff3(0xbc)])==0x0)&&_0x36d664++;});if(_0x36d664!=0x0)return _0x306ffd[_0x292179(0x78)](_0x292179(0xc3),_0x292179(0x96)),_0x24de56['redirect'](_0x292179(0xcc));_0xe94464[_0x292179(0x6a)]['forEach'](_0x134943=>{var _0x469216=_0x292179;const _0x204b2a=_0x48cd23[_0x469216(0xd2)][_0x469216(0x84)](_0x244ef5=>{var _0x4eed9c=_0x469216;_0x244ef5['product_name']==_0x134943['product_name']&&_0x244ef5[_0x4eed9c(0x6d)]==_0x134943['floorlevel']&&_0x244ef5[_0x4eed9c(0xb3)]==_0x134943['type']&&_0x244ef5[_0x4eed9c(0xa9)]==_0x134943[_0x4eed9c(0xa9)]&&_0x244ef5[_0x4eed9c(0x9a)]==_0x134943[_0x4eed9c(0x9a)]&&(_0x244ef5[_0x4eed9c(0xab)]=parseInt(_0x244ef5['product_stock'])+parseInt(_0x134943[_0x4eed9c(0xbc)]));});}),console[_0x292179(0x82)](_0x292179(0xc8),_0x48cd23),await _0x48cd23[_0x292179(0x79)](),_0xe94464[_0x292179(0xce)]=_0x2775d9,_0xe94464[_0x292179(0xcb)]=_0x46d75a,_0xe94464['date']=_0xda4972,_0xe94464[_0x292179(0x97)]=_0x29e24f,_0xe94464[_0x292179(0x6a)]=_0x30c13e,_0xe94464['note']=_0x323014,_0xe94464[_0x292179(0xa4)]=_0x59fb2c,_0xe94464[_0x292179(0x87)]=_0x5c04f5;const _0x29923e=await _0xe94464[_0x292179(0x79)]();console['log'](_0x292179(0x69),_0x29923e);const _0x5a2905=await c_payment_data['findOne']({'invoice':_0x306ffd[_0x292179(0xb8)][_0x292179(0xce)],'reason':_0x292179(0x9f)});_0x5a2905[_0x292179(0xbd)]=_0x306ffd[_0x292179(0xb8)]['suppliers'],_0x5a2905[_0x292179(0xba)]=_0x306ffd[_0x292179(0xb8)][_0x292179(0xba)],await _0x5a2905[_0x292179(0x79)](),_0x306ffd[_0x292179(0x78)]('success',_0x292179(0x9b)),_0x24de56[_0x292179(0x7a)](_0x292179(0xc2));}catch(_0x65b355){console[_0x292179(0x82)](_0x65b355),_0x24de56[_0x292179(0xaf)](0xc8)['json']({'message':_0x65b355[_0x292179(0x80)]});}}),router[a0_0x524426(0xc7)](a0_0x524426(0xb9),auth,async(_0x4a59e8,_0x3948fc)=>{var _0x542b37=a0_0x524426;try{const _0x2fda10=_0x4a59e8[_0x542b37(0x81)]['id'],{invoice:_0x4b02a1,customer:_0x5873d7,payable_to_customer:_0x3b1f70,paid_amount:_0x3e3595}=_0x4a59e8[_0x542b37(0xb8)],_0x2df3d3=await sales_return[_0x542b37(0x71)](_0x2fda10);console['log']('data',_0x2df3d3),console['log'](_0x3b1f70),console['log'](_0x3e3595);var _0x55404e=_0x3b1f70-_0x3e3595;console[_0x542b37(0x82)](_0x542b37(0xd5),_0x55404e),_0x2df3d3['paid_amount']=parseFloat(_0x3e3595)+parseFloat(_0x2df3d3[_0x542b37(0xbb)]),_0x2df3d3[_0x542b37(0x8a)]=_0x55404e,console['log'](_0x2df3d3);const _0x2f62b4=await _0x2df3d3['save']();console['log'](0x1b207);const _0x3c9100=await c_payment_data[_0x542b37(0x89)]({'invoice':_0x4a59e8['body'][_0x542b37(0xce)],'reason':_0x542b37(0x9f)});console['log']('c_payment',_0x3c9100),_0x3c9100[_0x542b37(0xb2)]=_0x55404e,await _0x3c9100[_0x542b37(0x79)]();let _0x31ba4d=new Date(),_0x5aad4f=('0'+_0x31ba4d[_0x542b37(0xa5)]())[_0x542b37(0x8b)](-0x2),_0x556a45=('0'+(_0x31ba4d[_0x542b37(0x77)]()+0x1))[_0x542b37(0x8b)](-0x2),_0x33a6a8=_0x31ba4d['getFullYear'](),_0x3dfb12=_0x33a6a8+'-'+_0x556a45+'-'+_0x5aad4f;const _0x1ea2ff=new customer_payment({'invoice':_0x4b02a1,'date':_0x33a6a8+'-'+_0x556a45+'-'+_0x5aad4f,'customer':_0x5873d7,'reason':_0x542b37(0xc6),'amount':_0x3e3595}),_0x422658=await _0x1ea2ff[_0x542b37(0x79)]();_0x4a59e8[_0x542b37(0x78)]('success',_0x542b37(0x8f)),_0x3948fc[_0x542b37(0x7a)]('/sales_return/view');}catch(_0x247bc9){console[_0x542b37(0x82)](_0x247bc9);}}),router['get']('/invoice/:id',auth,async(_0xe0f6c1,_0x4028c1)=>{var _0x12248c=a0_0x524426;try{const {username:_0x8c1732,email:_0x5250c2,role:_0x268a00}=_0xe0f6c1[_0x12248c(0x9e)],_0x49fb36=_0xe0f6c1[_0x12248c(0x9e)],_0x36451e=await profile[_0x12248c(0x89)]({'email':_0x49fb36[_0x12248c(0x91)]}),_0x568fd7=await master_shop[_0x12248c(0xbe)]();console[_0x12248c(0x82)]('master',_0x568fd7);const _0x1c5691=_0xe0f6c1[_0x12248c(0x81)]['id'],_0x2aca0c=await sales_return['findById'](_0x1c5691);console[_0x12248c(0x82)](_0x2aca0c);const _0x6f3e83=await customer[_0x12248c(0x89)]({'name':_0x2aca0c[_0x12248c(0xcb)]});console[_0x12248c(0x82)](_0x6f3e83);if(_0x568fd7[0x0][_0x12248c(0xb7)]==_0x12248c(0xd7)){var _0x231b99=users[_0x12248c(0x9c)];console[_0x12248c(0x82)](_0x231b99);}else{if(_0x568fd7[0x0][_0x12248c(0xb7)]=='Hindi')var _0x231b99=users[_0x12248c(0xa1)];else{if(_0x568fd7[0x0]['language']==_0x12248c(0xa0))var _0x231b99=users[_0x12248c(0xa0)];else{if(_0x568fd7[0x0]['language']==_0x12248c(0x6c))var _0x231b99=users['Spanish'];else{if(_0x568fd7[0x0]['language']==_0x12248c(0x8e))var _0x231b99=users['French'];else{if(_0x568fd7[0x0][_0x12248c(0xb7)]=='Portuguese\x20(BR)')var _0x231b99=users[_0x12248c(0xa3)];else{if(_0x568fd7[0x0][_0x12248c(0xb7)]==_0x12248c(0x70))var _0x231b99=users[_0x12248c(0x70)];else{if(_0x568fd7[0x0][_0x12248c(0xb7)]==_0x12248c(0xb6))var _0x231b99=users[_0x12248c(0xcd)];}}}}}}}_0x4028c1[_0x12248c(0xc0)]('sales_return_invoice',{'success':_0xe0f6c1[_0x12248c(0x78)](_0x12248c(0xc5)),'errors':_0xe0f6c1[_0x12248c(0x78)]('errors'),'role':_0x49fb36,'profile':_0x36451e,'master_shop':_0x568fd7,'customers':_0x6f3e83,'sales':_0x2aca0c,'language':_0x231b99});}catch(_0x3f9b79){console[_0x12248c(0x82)](_0x3f9b79);}}),module[a0_0x524426(0x8c)]=router;