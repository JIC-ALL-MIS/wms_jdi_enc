var a0_0x1b449e=a0_0x4dc6;function a0_0x4dc6(_0x1450e0,_0x48fea1){var _0x1303be=a0_0x1303();return a0_0x4dc6=function(_0x4dc62e,_0x1cc479){_0x4dc62e=_0x4dc62e-0x1ed;var _0xac16b8=_0x1303be[_0x4dc62e];return _0xac16b8;},a0_0x4dc6(_0x1450e0,_0x48fea1);}(function(_0x28c5c3,_0x2e5be1){var _0x220e4a=a0_0x4dc6,_0x45304f=_0x28c5c3();while(!![]){try{var _0x21b79b=parseInt(_0x220e4a(0x21b))/0x1*(-parseInt(_0x220e4a(0x2df))/0x2)+parseInt(_0x220e4a(0x21c))/0x3*(parseInt(_0x220e4a(0x2f6))/0x4)+-parseInt(_0x220e4a(0x285))/0x5*(parseInt(_0x220e4a(0x2ee))/0x6)+parseInt(_0x220e4a(0x25f))/0x7*(-parseInt(_0x220e4a(0x2b0))/0x8)+parseInt(_0x220e4a(0x1f2))/0x9+parseInt(_0x220e4a(0x2d3))/0xa+parseInt(_0x220e4a(0x24a))/0xb;if(_0x21b79b===_0x2e5be1)break;else _0x45304f['push'](_0x45304f['shift']());}catch(_0x4c126c){_0x45304f['push'](_0x45304f['shift']());}}}(a0_0x1303,0xe9db8));const express=require(a0_0x1b449e(0x21a)),app=express(),router=express[a0_0x1b449e(0x211)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings}=require(a0_0x1b449e(0x219)),auth=require('../middleware/auth'),nodemailer=require(a0_0x1b449e(0x2d1)),users=require(a0_0x1b449e(0x24e));function a0_0x1303(){var _0x160cd3=['map','Hindi','RequestedBy','primary_code_QA','secondary_code_QA','product_details','sales_invoice','prod_cat','$isAllowEdit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','An\x20error\x20occurred.','exports','sales_quantity','stock_data','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','typeservices','plate','room_name','/../public','3783230jJiKGR','port','product_name_QA1','stock','../public/language/languages.json','$product','sales_quantity_QA','$customers_docs','Sale\x20Product\x20Mail','return_qty_QA','Sales\x20Update\x20successfully','</div>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','for_categorize','sales\x20item\x20return\x20successfull','$product_details.secondary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room\x20</th>','<tbody\x20style=\x22text-align:\x20center;\x22>','/all_sales/view','host','log','5144958NrktSo','$customer','RoomAssigned','deliverydate','$product_details.isle','product_list','Spanish','findById','Chinese','Finished\x20Goods','English','secondary_code','createTransport','typevehicle','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','Error\x20Occurs','product_date','body','$product_details.storage','$sale_product.quantity','bay','/view/add_sales/:id','batch_code_QA','slice','CBM','<tr>','product_name','redirect','batch_code','status','type','OUT-','prod_invoice','getFullYear','foreach\x20newproduct','primary_code','isAllowEdit','$product.product_name','460wqvRUq','expiry_date','</thead>','logo','secondary_unit','</tbody>','/preview/:id','Portuguese','$product_details.maxPerUnit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','error','site_title','$product_details.unit','$product_details.product_cat','<h5>','</span>','Return\x20Goods','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Level\x20</th>','There\x27s\x20a\x20error\x20in\x20this\x20transaction','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','TSU','random','French','max_per_unit','True','render','Logo.png','$product_details._id','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$date','then','Sale\x20Return\x20Mail','/give_payment/:id','Ambient','all_sales_finished','concat','language','add\x20post','\x20</h2>','<h2>\x20','errors','isle','/view/add_sales','8ktQukL','get','level_QA','$warehouse_name','\x20Order\x20Date\x20:\x20','<h5\x20style=\x22text-align:\x20left;\x22>','van','password','$product_details.secondary_unit','product','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','$product_details.product_name','Received\x20Payment\x20For\x20Sale','return_qty','toString','$product_details.maxProducts','An\x20error\x20occurred\x20while\x20saving\x20data.','Arabic','$product_details.invoice','English\x20(US)','forEach','</h5>','success','staff','product_code_QA','currency_placement','$return_data','$invoice','floor','</tr>','$product_details','received_amount','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','nodemailer','$product_details.primary_code','3502680brCuyx','find','Email\x20sent\x20successfully','prod_code','edit_sales_finished_view','split','sale_qty','role','warehouse','<html><head><title></title>','push','edit_sales_finished','10DRJNKl','$product_details.rack','json','catch','sale_product','save','quantity','/view/:id','Sale','name','invoice','TFU','/all_sales_finished/view','$sale_product.level','DateofRequest','77874DwTLbx','$product_details.level','payment\x20successfull','Sale\x20Return','$product_details.pallet','room','</table>','master','20aEMmZD','$product_details.production_date','email','params','maxProducts_QA','$name','findOne','$product_details.product_stock','post','length','purchases_data','date','string','user','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','due_amount','customers_docs','<hr\x20class=\x22my-3\x22>','all','warehouse_name','message','secondary_unit_QA','expiry_date_QA','return_data','13723146lsBDvC','maxPerUnit_QA','pallet','primary_unit','<strong>\x20Regards\x20</strong>','RMSEmail','flash','return_sale_finished','<!DOCTYPE\x20html>','back','</body></html>','customer','/all_sales_finished/preview/','filter','Portuguese\x20(BR)','/view/add_sale/product','</td>','pallet_QA','<span\x20style=\x22float:\x20right;\x22>','padStart','level','$_id','Enclosed','carton','unit','$room','$product_details.CBM','QA\x20Warehouse','$product_details.batch_code','product_stock','all_sales_barcode','Router','getMonth','sendMail','image','PO_number','/upload/','production_date_QA','maxProducts','../models/all_models','express','68165ooBpKb','605265DsOWor','$product_details.expiry_date','/barcode/:id','$note','room_QA','unit_QA','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$sale_product.pallet','German','Enabled','\x20Order\x20Number\x20:\x20','driver','Arabic\x20(ae)','Sales\x20Add\x20successfully','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','DRSI','product_code','currency','$product_details.product_code','maxPerUnit','aggregate','$sale_product','<div>','False','customers','/view/return_sales/:id','production_date'];a0_0x1303=function(){return _0x160cd3;};return a0_0x1303();}router[a0_0x1b449e(0x2b1)]('/view',auth,async(_0x15b681,_0x347a89)=>{var _0x156717=a0_0x1b449e;try{const {username:_0x4dfbc2,email:_0x1eed41,role:_0x56d30e}=_0x15b681[_0x156717(0x303)],_0x17c64c=_0x15b681[_0x156717(0x303)],_0x37be0e=await profile[_0x156717(0x2fc)]({'email':_0x17c64c['email']}),_0x444449=await master_shop[_0x156717(0x2d4)]();let _0x2193d0;if(_0x17c64c['role']=='staff'){const _0x1862b9=await staff[_0x156717(0x2fc)]({'email':_0x17c64c['email']});_0x2193d0=await sales_finished[_0x156717(0x230)]([{'$lookup':{'from':_0x156717(0x234),'localField':_0x156717(0x1fd),'foreignField':_0x156717(0x2e8),'as':_0x156717(0x306)}},{'$unwind':_0x156717(0x251)},{'$unwind':_0x156717(0x231)},{'$group':{'_id':_0x156717(0x207),'invoice':{'$first':_0x156717(0x2cb)},'customers':{'$first':_0x156717(0x260)},'date':{'$first':_0x156717(0x2a2)},'warehouse_name':{'$first':_0x156717(0x2b3)},'sale_product':{'$push':_0x156717(0x231)},'note':{'$first':'$note'},'return_data':{'$first':_0x156717(0x2ca)},'customers_docs':{'$first':_0x156717(0x251)},'total_saleproduct_quantity':{'$sum':_0x156717(0x272)},'level':{'$addToSet':_0x156717(0x2ec)},'isle':{'$addToSet':'$sale_product.isle'},'pallet':{'$addToSet':_0x156717(0x223)},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':_0x156717(0x23f)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x2193d0=await sales_finished['aggregate']([{'$lookup':{'from':'customers','localField':_0x156717(0x1fd),'foreignField':_0x156717(0x2e8),'as':'customers_docs'}},{'$unwind':'$customers_docs'},{'$unwind':_0x156717(0x231)},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'customers':{'$first':'$customer'},'date':{'$first':_0x156717(0x2a2)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x156717(0x231)},'note':{'$first':_0x156717(0x21f)},'return_data':{'$first':_0x156717(0x2ca)},'customers_docs':{'$first':_0x156717(0x251)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x156717(0x2ec)},'isle':{'$addToSet':'$sale_product.isle'},'pallet':{'$addToSet':'$sale_product.pallet'},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':_0x156717(0x23f)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);if(_0x444449[0x0]['language']=='English\x20(US)'){var _0x10ff57=users['English'];console[_0x156717(0x25e)](_0x10ff57);}else{if(_0x444449[0x0][_0x156717(0x2a9)]==_0x156717(0x238))var _0x10ff57=users['Hindi'];else{if(_0x444449[0x0]['language']==_0x156717(0x224))var _0x10ff57=users[_0x156717(0x224)];else{if(_0x444449[0x0][_0x156717(0x2a9)]==_0x156717(0x265))var _0x10ff57=users[_0x156717(0x265)];else{if(_0x444449[0x0][_0x156717(0x2a9)]=='French')var _0x10ff57=users[_0x156717(0x29b)];else{if(_0x444449[0x0][_0x156717(0x2a9)]==_0x156717(0x200))var _0x10ff57=users[_0x156717(0x28c)];else{if(_0x444449[0x0][_0x156717(0x2a9)]==_0x156717(0x267))var _0x10ff57=users['Chinese'];else{if(_0x444449[0x0][_0x156717(0x2a9)]=='Arabic\x20(ae)')var _0x10ff57=users[_0x156717(0x2c1)];}}}}}}}_0x347a89[_0x156717(0x29e)](_0x156717(0x2a7),{'success':_0x15b681[_0x156717(0x1f8)]('success'),'errors':_0x15b681[_0x156717(0x1f8)](_0x156717(0x2ad)),'sales':_0x2193d0,'profile':_0x37be0e,'role':_0x17c64c,'master_shop':_0x444449,'language':_0x10ff57});}catch(_0x57dc5b){console['log'](_0x57dc5b);}});async function getRandom8DigitNumber(){var _0x5765c7=a0_0x1b449e;const _0x57cef5=0x989680,_0x2be21b=0x5f5e0ff,_0x529567=Math[_0x5765c7(0x2cc)](Math[_0x5765c7(0x29a)]()*(_0x2be21b-_0x57cef5+0x1))+_0x57cef5;var _0x391106;const _0x3c2d71=await sales_finished[_0x5765c7(0x2fc)]({'invoice':_0x5765c7(0x27e)+_0x529567});return _0x3c2d71&&_0x3c2d71['length']>0x0?_0x391106='OUT-'+_0x529567:_0x391106=_0x5765c7(0x27e)+_0x529567,_0x391106;}router['get'](a0_0x1b449e(0x2af),auth,async(_0x542253,_0x553f31)=>{var _0xdd2cc6=a0_0x1b449e;try{const {username:_0x2e3cc8,email:_0x51bd46,role:_0x22228f}=_0x542253['user'],_0x1a3201=_0x542253['user'],_0x2bb237=await profile[_0xdd2cc6(0x2fc)]({'email':_0x1a3201[_0xdd2cc6(0x2f8)]}),_0x14d497=await master_shop['find'](),_0x28e954=await customer[_0xdd2cc6(0x2d4)]({});let _0x45bed4;if(_0x1a3201['role']==_0xdd2cc6(0x2c7)){const _0x378ec4=await staff[_0xdd2cc6(0x2fc)]({'email':_0x1a3201[_0xdd2cc6(0x2f8)]});_0x45bed4=await warehouse[_0xdd2cc6(0x230)]([{'$match':{'status':_0xdd2cc6(0x225),'name':_0x378ec4['warehouse'],'name':{'$ne':_0xdd2cc6(0x20d)}}},{'$group':{'_id':_0xdd2cc6(0x2fb),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x45bed4=await warehouse[_0xdd2cc6(0x230)]([{'$match':{'status':_0xdd2cc6(0x225),'name':{'$ne':_0xdd2cc6(0x20d)}}},{'$group':{'_id':_0xdd2cc6(0x2fb),'name':{'$first':_0xdd2cc6(0x2fb)}}},{'$sort':{'name':0x1}}]);const _0x482f2e=await product[_0xdd2cc6(0x2d4)]({});var _0x4fe857=['Ambient',_0xdd2cc6(0x208)];const _0x29890d=await sales_finished[_0xdd2cc6(0x2d4)]({}),_0x59466a=_0x29890d[_0xdd2cc6(0x2ff)]+0x1,_0x526b43=_0xdd2cc6(0x27e)+_0x59466a[_0xdd2cc6(0x2be)]()[_0xdd2cc6(0x205)](0x5,'0');if(_0x14d497[0x0][_0xdd2cc6(0x2a9)]=='English\x20(US)'){var _0x27b980=users[_0xdd2cc6(0x269)];console[_0xdd2cc6(0x25e)](_0x27b980);}else{if(_0x14d497[0x0][_0xdd2cc6(0x2a9)]==_0xdd2cc6(0x238))var _0x27b980=users[_0xdd2cc6(0x238)];else{if(_0x14d497[0x0][_0xdd2cc6(0x2a9)]==_0xdd2cc6(0x224))var _0x27b980=users[_0xdd2cc6(0x224)];else{if(_0x14d497[0x0][_0xdd2cc6(0x2a9)]=='Spanish')var _0x27b980=users['Spanish'];else{if(_0x14d497[0x0][_0xdd2cc6(0x2a9)]==_0xdd2cc6(0x29b))var _0x27b980=users[_0xdd2cc6(0x29b)];else{if(_0x14d497[0x0][_0xdd2cc6(0x2a9)]==_0xdd2cc6(0x200))var _0x27b980=users[_0xdd2cc6(0x28c)];else{if(_0x14d497[0x0][_0xdd2cc6(0x2a9)]==_0xdd2cc6(0x267))var _0x27b980=users[_0xdd2cc6(0x267)];else{if(_0x14d497[0x0][_0xdd2cc6(0x2a9)]==_0xdd2cc6(0x228))var _0x27b980=users[_0xdd2cc6(0x2c1)];}}}}}}}const _0x4859ca=getRandom8DigitNumber();_0x4859ca[_0xdd2cc6(0x2a3)](_0x5a8076=>{var _0x572ec6=_0xdd2cc6;_0x553f31[_0x572ec6(0x29e)]('add_sales_finished',{'success':_0x542253[_0x572ec6(0x1f8)]('success'),'errors':_0x542253['flash']('errors'),'role':_0x1a3201,'profile':_0x2bb237,'customer':_0x28e954,'warehouse':_0x45bed4,'product':_0x482f2e,'invoice':_0x5a8076,'master_shop':_0x14d497,'language':_0x27b980,'rooms_data':_0x4fe857});})[_0xdd2cc6(0x2e2)](_0x2029de=>{var _0x46ed7e=_0xdd2cc6;_0x542253[_0x46ed7e(0x1f8)](_0x46ed7e(0x2ad),_0x46ed7e(0x297)),_0x553f31['redirect'](_0x46ed7e(0x2eb));});}catch(_0x30a8bb){console[_0xdd2cc6(0x25e)](_0x30a8bb);}}),router[a0_0x1b449e(0x2b1)](a0_0x1b449e(0x274),auth,async(_0x18809d,_0x537fbd)=>{var _0x361efb=a0_0x1b449e;try{const _0x28060f=_0x18809d[_0x361efb(0x2f9)]['id'];console[_0x361efb(0x25e)](_0x28060f);const _0x29f406=await product[_0x361efb(0x2d4)](),_0x3c2147=await purchases[_0x361efb(0x230)]([{'$match':{'warehouse_name':_0x28060f}},{'$unwind':_0x361efb(0x24f)},{'$group':{'_id':_0x361efb(0x284)}}]);console[_0x361efb(0x25e)](_0x361efb(0x300),_0x3c2147),_0x537fbd[_0x361efb(0x27c)](0xc8)[_0x361efb(0x2e1)]({'purchases_data':_0x3c2147,'product_data':_0x29f406});}catch(_0x29435b){console['log'](_0x29435b);}}),router[a0_0x1b449e(0x2fe)](a0_0x1b449e(0x201),auth,async(_0x4802d7,_0x39489b)=>{var _0x8c3ac8=a0_0x1b449e;try{const {warehouse_data:_0x5c3ff4,product_data:_0x58cd72}=_0x4802d7[_0x8c3ac8(0x270)];console[_0x8c3ac8(0x25e)](_0x4802d7[_0x8c3ac8(0x270)]['product_data']);;const _0x54ffdc=await master_shop[_0x8c3ac8(0x2d4)]();console['log'](_0x8c3ac8(0x2f5),_0x54ffdc);const _0x53d4f7=await product['findOne']({'name':_0x58cd72});console[_0x8c3ac8(0x25e)](_0x8c3ac8(0x2b9),_0x53d4f7);const _0x4cde68=await warehouse[_0x8c3ac8(0x230)]([{'$match':{'name':_0x5c3ff4}},{'$unwind':_0x8c3ac8(0x2ce)},{'$match':{'product_details.product_name':_0x58cd72}},{'$group':{'_id':_0x8c3ac8(0x2bb),'product_stock':{'$first':_0x8c3ac8(0x2fd)}}}]);console[_0x8c3ac8(0x25e)](_0x8c3ac8(0x244),_0x4cde68),_0x39489b[_0x8c3ac8(0x27c)](0xc8)[_0x8c3ac8(0x2e1)]({'master':_0x54ffdc,'new_product':_0x53d4f7,'stock_data':_0x4cde68});}catch(_0x4379e7){console['log'](_0x4379e7);}}),router[a0_0x1b449e(0x2fe)](a0_0x1b449e(0x2af),auth,async(_0x4747fe,_0x218df0)=>{var _0x499b2a=a0_0x1b449e;try{const {invoice:_0x3e002d,date:_0x291d32,warehouse_name:_0x5b3560,product_name:_0x53b929,stock:_0x5c9b42,quantity:_0x18fb60,note:_0x1220ae,room:_0x466e73,primary_code:_0x18a77b,secondary_code:_0x3c3fd8,prod_code:_0x205e94,level:_0x2fd969,isle:_0x44ab54,pallet:_0x31c630,batch_code:_0x2b5b71,SCRN:_0x54896d,expiry_date:_0x2618ed,PO_number:_0xc9cddb,ReqBy:_0x5da5b7,dateofreq:_0x45ae67,typeservicesData:_0x4256a9,destination:_0x82cad2,deliverydate:_0x81794c,driver:_0x19dd6c,plate:_0x33decc,van:_0x443dfd,DRSI:_0x54eedf,typevehicle:_0x4b4831,TSU:_0x2a437f,TFU:_0x202624}=_0x4747fe[_0x499b2a(0x270)];if(typeof _0x53b929==_0x499b2a(0x302))var _0x4fbe52=[_0x4747fe[_0x499b2a(0x270)][_0x499b2a(0x279)]],_0x5df3b7=[_0x4747fe[_0x499b2a(0x270)][_0x499b2a(0x24d)]],_0x17b29e=[_0x4747fe['body'][_0x499b2a(0x209)]],_0x4d5058=[_0x4747fe['body'][_0x499b2a(0x282)]],_0x2a8f95=[_0x4747fe[_0x499b2a(0x270)][_0x499b2a(0x26a)]],_0x32fdca=[_0x4747fe[_0x499b2a(0x270)][_0x499b2a(0x2d6)]],_0x26dcf2=[_0x4747fe['body'][_0x499b2a(0x206)]],_0x14372b=[_0x4747fe[_0x499b2a(0x270)][_0x499b2a(0x1f5)]],_0x283239=[_0x4747fe['body'][_0x499b2a(0x289)]],_0x30c20b=[_0x4747fe[_0x499b2a(0x270)][_0x499b2a(0x27b)]],_0x5b561c=[_0x4747fe[_0x499b2a(0x270)][_0x499b2a(0x286)]],_0x405a38=[_0x4747fe[_0x499b2a(0x270)][_0x499b2a(0x26f)]],_0x5a8d9c=[_0x4747fe[_0x499b2a(0x270)][_0x499b2a(0x29c)]],_0xbac14f=[_0x4747fe[_0x499b2a(0x270)][_0x499b2a(0x23e)]],_0x53618d=[_0x4747fe[_0x499b2a(0x270)][_0x499b2a(0x261)]],_0x5cce57=[_0x4747fe[_0x499b2a(0x270)][_0x499b2a(0x27d)]],_0x20185a=[_0x4747fe[_0x499b2a(0x270)][_0x499b2a(0x277)]],_0x11b7f7=[_0x4747fe[_0x499b2a(0x270)]['prod_invoice']];else var _0x4fbe52=[..._0x4747fe['body'][_0x499b2a(0x279)]],_0x5df3b7=[..._0x4747fe['body'][_0x499b2a(0x24d)]],_0x17b29e=[..._0x4747fe['body'][_0x499b2a(0x209)]],_0x4d5058=[..._0x4747fe[_0x499b2a(0x270)][_0x499b2a(0x282)]],_0x2a8f95=[..._0x4747fe['body'][_0x499b2a(0x26a)]],_0x32fdca=[..._0x4747fe[_0x499b2a(0x270)][_0x499b2a(0x2d6)]],_0x26dcf2=[..._0x4747fe['body'][_0x499b2a(0x206)]],_0x14372b=[..._0x4747fe['body'][_0x499b2a(0x1f5)]],_0x283239=[..._0x4747fe[_0x499b2a(0x270)]['secondary_unit']],_0x30c20b=[..._0x4747fe[_0x499b2a(0x270)]['batch_code']],_0x5b561c=[..._0x4747fe[_0x499b2a(0x270)][_0x499b2a(0x286)]],_0x405a38=[..._0x4747fe['body']['product_date']],_0x5a8d9c=[..._0x4747fe[_0x499b2a(0x270)]['max_per_unit']],_0xbac14f=[..._0x4747fe[_0x499b2a(0x270)][_0x499b2a(0x23e)]],_0x53618d=[..._0x4747fe['body'][_0x499b2a(0x261)]],_0x5cce57=[..._0x4747fe['body'][_0x499b2a(0x27d)]],_0x20185a=[..._0x4747fe[_0x499b2a(0x270)][_0x499b2a(0x277)]],_0x11b7f7=[..._0x4747fe[_0x499b2a(0x270)][_0x499b2a(0x27f)]];const _0x18c508=_0x4fbe52[_0x499b2a(0x237)](_0x1bb946=>{return _0x1bb946={'product_name':_0x1bb946};});_0x5df3b7[_0x499b2a(0x2c4)]((_0x171440,_0x590ad6)=>{var _0x41ccd7=_0x499b2a;_0x18c508[_0x590ad6][_0x41ccd7(0x24d)]=_0x171440;}),_0x17b29e[_0x499b2a(0x2c4)]((_0x44fd40,_0x1e6db4)=>{var _0x207e92=_0x499b2a;_0x18c508[_0x1e6db4][_0x207e92(0x2e5)]=_0x44fd40;}),_0x4d5058[_0x499b2a(0x2c4)]((_0x1ef079,_0x1efb84)=>{_0x18c508[_0x1efb84]['primary_code']=_0x1ef079;}),_0x2a8f95['forEach']((_0x5d1622,_0x2b89d5)=>{var _0x1f65b8=_0x499b2a;_0x18c508[_0x2b89d5][_0x1f65b8(0x26a)]=_0x5d1622;}),_0x32fdca[_0x499b2a(0x2c4)]((_0x27d691,_0xa81cfb)=>{_0x18c508[_0xa81cfb]['product_code']=_0x27d691;}),_0x26dcf2[_0x499b2a(0x2c4)]((_0x237afd,_0xef2fc9)=>{var _0x408fd0=_0x499b2a,_0xb91425=_0x237afd[_0x408fd0(0x276)](0x1);_0x18c508[_0xef2fc9]['isle']=_0x237afd[0x0],_0x18c508[_0xef2fc9][_0x408fd0(0x1f4)]=_0xb91425;}),_0x5cce57[_0x499b2a(0x2c4)]((_0x484c37,_0x1c9452)=>{_0x18c508[_0x1c9452]['level']=_0x484c37;}),_0x14372b[_0x499b2a(0x2c4)]((_0x2bf645,_0x26c2d3)=>{var _0x2fcc63=_0x499b2a;_0x18c508[_0x26c2d3][_0x2fcc63(0x20a)]=_0x2bf645;}),_0x283239[_0x499b2a(0x2c4)]((_0x39b860,_0x1b1197)=>{var _0x3bac42=_0x499b2a;_0x18c508[_0x1b1197][_0x3bac42(0x289)]=_0x39b860;}),_0x30c20b[_0x499b2a(0x2c4)]((_0x444e82,_0x2006e8)=>{var _0x23fc49=_0x499b2a;_0x18c508[_0x2006e8][_0x23fc49(0x27b)]=_0x444e82;}),_0x5b561c['forEach']((_0x4e9555,_0x424a92)=>{var _0x1d61aa=_0x499b2a;_0x18c508[_0x424a92][_0x1d61aa(0x286)]=_0x4e9555;}),_0x405a38[_0x499b2a(0x2c4)]((_0x6a0278,_0x4b6c3f)=>{var _0x27cbff=_0x499b2a;_0x18c508[_0x4b6c3f][_0x27cbff(0x236)]=_0x6a0278;}),_0x5a8d9c[_0x499b2a(0x2c4)]((_0x1cc243,_0x38288f)=>{_0x18c508[_0x38288f]['maxperunit']=_0x1cc243;}),_0xbac14f[_0x499b2a(0x2c4)]((_0x1da090,_0x4a0a28)=>{var _0x841c86=_0x499b2a;_0x18c508[_0x4a0a28][_0x841c86(0x23e)]=_0x1da090;}),_0x53618d[_0x499b2a(0x2c4)]((_0xe20f71,_0x21104f)=>{var _0x812e8d=_0x499b2a;_0x18c508[_0x21104f][_0x812e8d(0x248)]=_0xe20f71;}),_0x20185a[_0x499b2a(0x2c4)]((_0x2cf58f,_0x224226)=>{_0x18c508[_0x224226]['CBM']=_0x2cf58f;}),_0x11b7f7['forEach']((_0x41870a,_0x454a0d)=>{var _0x4ba8af=_0x499b2a;_0x18c508[_0x454a0d][_0x4ba8af(0x2e9)]=_0x41870a;});var _0x49941e=0x0;_0x18c508[_0x499b2a(0x2c4)](_0x1b9fd4=>{var _0xc797d9=_0x499b2a;console[_0xc797d9(0x25e)](_0xc797d9(0x281),_0x1b9fd4),(parseInt(_0x1b9fd4[_0xc797d9(0x24d)])<parseInt(_0x1b9fd4[_0xc797d9(0x2e5)])||parseInt(_0x1b9fd4[_0xc797d9(0x2e5)])==0x0)&&_0x49941e++;});if(_0x49941e!=0x0)return _0x4747fe[_0x499b2a(0x1f8)](_0x499b2a(0x2ad),_0x499b2a(0x2d0)),_0x218df0[_0x499b2a(0x27a)](_0x499b2a(0x1fb));const _0x1a3159=_0x18c508[_0x499b2a(0x1ff)](_0xea14ed=>_0xea14ed[_0x499b2a(0x2e5)]!=='0'&&_0xea14ed[_0x499b2a(0x2e5)]!==''),_0x1fe81d=new sales_finished({'invoice':_0x3e002d,'customer':_0x4747fe[_0x499b2a(0x270)][_0x499b2a(0x1fd)],'date':_0x291d32,'warehouse_name':_0x5b3560,'sale_product':_0x1a3159,'note':_0x1220ae,'room':_0x466e73,'primary_code':_0x18a77b,'secondary_code':_0x3c3fd8,'prod_code':_0x205e94,'SCRN':_0x54896d,'finalize':_0x499b2a(0x233),'PO_number':_0xc9cddb,'RequestedBy':_0x5da5b7,'DateofRequest':_0x45ae67,'typeservices':_0x4256a9,'destination':_0x82cad2,'deliverydate':_0x81794c,'driver':_0x19dd6c,'plate':_0x33decc,'van':_0x443dfd,'DRSI':_0x54eedf,'typevehicle':_0x4b4831,'TSU':_0x2a437f,'TFU':_0x202624}),_0x5e1bfe=await _0x1fe81d[_0x499b2a(0x2e4)](),_0x472556=await sales_finished['findOne']({'invoice':_0x3e002d}),_0xea7ddc=new c_payment_data({'invoice':_0x3e002d,'customer':_0x4747fe[_0x499b2a(0x270)]['customer'],'reason':_0x499b2a(0x2e7)});await _0xea7ddc[_0x499b2a(0x2e4)]();const _0x1239bc=await master_shop[_0x499b2a(0x2d4)](),_0x664a5e=await email_settings['findOne'](),_0xa13065=await customer[_0x499b2a(0x2fc)]({'name':_0x4747fe[_0x499b2a(0x270)][_0x499b2a(0x1fd)]});_0x1239bc[0x0][_0x499b2a(0x2c9)]==0x1?(right_currency=_0x1239bc[0x0][_0x499b2a(0x22d)],left_currency=''):(right_currency='',left_currency=_0x1239bc[0x0]['currency']);var _0xb9c664=_0x4fbe52,_0x808c2e=_0x17b29e,_0x2d3846='',_0x198da8;for(_0x198da8 in _0xb9c664){_0x2d3846+=_0x499b2a(0x278)+_0x499b2a(0x245)+_0xb9c664[_0x198da8]+_0x499b2a(0x202)+_0x499b2a(0x245)+_0x808c2e[_0x198da8]+_0x499b2a(0x202)+'</tr>';}_0x4747fe[_0x499b2a(0x1f8)]('success',_0x499b2a(0x229)),_0x218df0[_0x499b2a(0x27a)](_0x499b2a(0x1fe)+_0x5e1bfe['_id']);}catch(_0x35d796){console[_0x499b2a(0x25e)](_0x35d796);}}),router[a0_0x1b449e(0x2b1)](a0_0x1b449e(0x28b),auth,async(_0x408648,_0x29d038)=>{var _0x42f36c=a0_0x1b449e;try{const {username:_0x3a249c,email:_0x3bd06d,role:_0x54bc62}=_0x408648['user'],_0x486cc8=_0x408648[_0x42f36c(0x303)],_0x4c6b9c=await profile[_0x42f36c(0x2fc)]({'email':_0x486cc8[_0x42f36c(0x2f8)]}),_0x1832d7=await master_shop[_0x42f36c(0x2d4)](),_0x851dc9=_0x408648[_0x42f36c(0x2f9)]['id'],_0x444394=await sales_finished[_0x42f36c(0x266)](_0x851dc9),_0x399db1=await warehouse[_0x42f36c(0x230)]([{'$match':{'name':_0x444394['warehouse_name']}},{'$unwind':_0x42f36c(0x2ce)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x42f36c(0x2bb)},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':_0x42f36c(0x2ef)},'isle':{'$first':_0x42f36c(0x263)},'pallet':{'$first':_0x42f36c(0x2f2)},'primary_code':{'$first':_0x42f36c(0x2d2)},'secondary_code':{'$first':_0x42f36c(0x259)},'product_code':{'$first':_0x42f36c(0x22e)},'storage':{'$first':_0x42f36c(0x271)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x42f36c(0x21d)},'production_date':{'$first':_0x42f36c(0x2f7)},'batch_code':{'$first':_0x42f36c(0x20e)},'room':{'$first':_0x42f36c(0x20b)}}}]),_0x1e5d9d=await customer[_0x42f36c(0x2d4)]({});let _0x33625b;if(_0x486cc8[_0x42f36c(0x2da)]==_0x42f36c(0x2c7)){const _0x401367=await staff[_0x42f36c(0x2fc)]({'email':_0x486cc8[_0x42f36c(0x2f8)]});_0x33625b=await warehouse[_0x42f36c(0x230)]([{'$match':{'status':'Enabled','name':_0x401367[_0x42f36c(0x2db)]}},{'$group':{'_id':'$name','name':{'$first':_0x42f36c(0x2fb)}}}]);}else _0x33625b=await warehouse['aggregate']([{'$match':{'status':_0x42f36c(0x225)}},{'$group':{'_id':'$name','name':{'$first':_0x42f36c(0x2fb)}}}]);const _0x3cdcd7=await product[_0x42f36c(0x2d4)]({});if(_0x1832d7[0x0][_0x42f36c(0x2a9)]=='English\x20(US)'){var _0x40346e=users['English'];console[_0x42f36c(0x25e)](_0x40346e);}else{if(_0x1832d7[0x0][_0x42f36c(0x2a9)]==_0x42f36c(0x238))var _0x40346e=users['Hindi'];else{if(_0x1832d7[0x0][_0x42f36c(0x2a9)]=='German')var _0x40346e=users['German'];else{if(_0x1832d7[0x0]['language']==_0x42f36c(0x265))var _0x40346e=users['Spanish'];else{if(_0x1832d7[0x0][_0x42f36c(0x2a9)]==_0x42f36c(0x29b))var _0x40346e=users['French'];else{if(_0x1832d7[0x0]['language']==_0x42f36c(0x200))var _0x40346e=users[_0x42f36c(0x28c)];else{if(_0x1832d7[0x0][_0x42f36c(0x2a9)]=='Chinese')var _0x40346e=users[_0x42f36c(0x267)];else{if(_0x1832d7[0x0][_0x42f36c(0x2a9)]==_0x42f36c(0x228))var _0x40346e=users[_0x42f36c(0x2c1)];}}}}}}}_0x29d038[_0x42f36c(0x29e)](_0x42f36c(0x2d7),{'success':_0x408648[_0x42f36c(0x1f8)]('success'),'errors':_0x408648[_0x42f36c(0x1f8)](_0x42f36c(0x2ad)),'role':_0x486cc8,'profile':_0x4c6b9c,'customer':_0x1e5d9d,'warehouse':_0x33625b,'product':_0x399db1,'user':_0x444394,'master_shop':_0x1832d7,'unit':_0x3cdcd7,'language':_0x40346e});}catch(_0x4a560b){console['log'](_0x4a560b);}}),router[a0_0x1b449e(0x2fe)]('/preview/:id',auth,async(_0x18bf3a,_0x554a35)=>{var _0x32a7e5=a0_0x1b449e;try{const _0x3e8d13=_0x18bf3a[_0x32a7e5(0x2f9)]['id'],{invoice:_0x21ff31,warehouse_name:_0x2222b8,room:_0x3a629e}=_0x18bf3a[_0x32a7e5(0x270)],_0x4ef3b9=await sales_finished[_0x32a7e5(0x2fc)]({'invoice':_0x21ff31}),_0x47d7ae=_0x4ef3b9[_0x32a7e5(0x2e3)][_0x32a7e5(0x237)](async _0x14b61a=>{var _0x4b6013=_0x32a7e5,_0x18ad0c=await warehouse[_0x4b6013(0x2fc)]({'name':_0x2222b8,'room':_0x14b61a['room_name']});const _0x121c9d=_0x18ad0c[_0x4b6013(0x23c)][_0x4b6013(0x237)](_0x117d81=>{var _0x2face3=_0x4b6013;_0x117d81[_0x2face3(0x279)]==_0x14b61a['product_name']&&_0x117d81[_0x2face3(0x206)]==_0x14b61a[_0x2face3(0x206)]&&_0x117d81[_0x2face3(0x2ae)]==_0x14b61a[_0x2face3(0x2ae)]&&_0x117d81['pallet']==_0x14b61a['pallet']&&_0x117d81['expiry_date']==_0x14b61a[_0x2face3(0x286)]&&_0x117d81[_0x2face3(0x236)]==_0x14b61a[_0x2face3(0x236)]&&_0x117d81[_0x2face3(0x27b)]==_0x14b61a[_0x2face3(0x27b)]&&_0x117d81['invoice']==_0x14b61a['invoice']&&(_0x117d81[_0x2face3(0x20f)]=_0x117d81[_0x2face3(0x20f)]-_0x14b61a[_0x2face3(0x2e5)]);});return _0x18ad0c;});Promise['all'](_0x47d7ae)['then'](async _0x504148=>{var _0x3e2c27=_0x32a7e5;try{for(const _0x4f2999 of _0x504148){await _0x4f2999['save']();}_0x4ef3b9['finalize']='True';const _0x1325de=await _0x4ef3b9['save']();var _0x5f4785=_0x4ef3b9['sale_product'];const _0x262129=await master_shop[_0x3e2c27(0x2d4)](),_0x57dc41=await email_settings['findOne'](),_0x46534a=await supervisor_settings[_0x3e2c27(0x2d4)]();let _0x2e3cf1=nodemailer[_0x3e2c27(0x26b)]({'host':_0x57dc41[_0x3e2c27(0x25d)],'port':Number(_0x57dc41[_0x3e2c27(0x24b)]),'secure':![],'auth':{'user':_0x57dc41[_0x3e2c27(0x2f8)],'pass':_0x57dc41['password']}});var _0x48b8b4='',_0x5b9014;for(_0x5b9014 in _0x5f4785){_0x48b8b4+='<tr>'+_0x3e2c27(0x245)+_0x5f4785[_0x5b9014]['product_name']+_0x3e2c27(0x202)+_0x3e2c27(0x245)+_0x5f4785[_0x5b9014][_0x3e2c27(0x2e5)]+_0x3e2c27(0x202)+_0x3e2c27(0x245)+_0x5f4785[_0x5b9014][_0x3e2c27(0x248)]+_0x3e2c27(0x202)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5f4785[_0x5b9014]['level']+_0x3e2c27(0x202)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5f4785[_0x5b9014][_0x3e2c27(0x2ae)]+_0x5f4785[_0x5b9014][_0x3e2c27(0x1f4)]+_0x3e2c27(0x202)+_0x3e2c27(0x2cd);}let _0x56552b={'from':_0x57dc41[_0x3e2c27(0x2f8)],'to':_0x46534a[0x0][_0x3e2c27(0x1f7)],'subject':_0x3e2c27(0x252),'attachments':[{'filename':_0x3e2c27(0x29f),'path':__dirname+_0x3e2c27(0x249)+_0x3e2c27(0x216)+_0x262129[0x0]['image'],'cid':_0x3e2c27(0x288)}],'html':_0x3e2c27(0x1fa)+_0x3e2c27(0x2dc)+'</head><body>'+_0x3e2c27(0x232)+_0x3e2c27(0x26d)+_0x3e2c27(0x232)+_0x3e2c27(0x298)+_0x3e2c27(0x255)+_0x3e2c27(0x232)+_0x3e2c27(0x2ac)+_0x262129[0x0]['site_title']+_0x3e2c27(0x2ab)+'</div>'+_0x3e2c27(0x255)+_0x3e2c27(0x307)+_0x3e2c27(0x232)+_0x3e2c27(0x2b5)+_0x3e2c27(0x226)+_0x4ef3b9[_0x3e2c27(0x2e9)]+'\x20'+_0x3e2c27(0x204)+_0x3e2c27(0x2b4)+_0x4ef3b9['date']+'\x20'+_0x3e2c27(0x294)+_0x3e2c27(0x2c5)+_0x3e2c27(0x255)+_0x3e2c27(0x222)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x3e2c27(0x278)+_0x3e2c27(0x256)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Quantity\x20</th>'+_0x3e2c27(0x25a)+_0x3e2c27(0x296)+_0x3e2c27(0x28e)+_0x3e2c27(0x2cd)+_0x3e2c27(0x287)+_0x3e2c27(0x25b)+'\x20'+_0x48b8b4+'\x20'+_0x3e2c27(0x28a)+_0x3e2c27(0x2f4)+_0x3e2c27(0x232)+_0x3e2c27(0x1f6)+_0x3e2c27(0x293)+_0x262129[0x0][_0x3e2c27(0x290)]+'</h5>'+_0x3e2c27(0x255)+_0x3e2c27(0x255)+_0x3e2c27(0x1fc)};_0x2e3cf1[_0x3e2c27(0x213)](_0x56552b,function(_0x173b84,_0x2baf9d){var _0x11072b=_0x3e2c27;_0x173b84?(console[_0x11072b(0x25e)](_0x173b84),console[_0x11072b(0x25e)](_0x11072b(0x26e))):console[_0x11072b(0x25e)](_0x11072b(0x2d5));}),_0x18bf3a[_0x3e2c27(0x1f8)](_0x3e2c27(0x2c6),_0x3e2c27(0x254)),_0x554a35[_0x3e2c27(0x27a)]('/picking_list/PDFFinal/'+_0x3e8d13);}catch(_0x527935){console[_0x3e2c27(0x28f)](_0x527935),_0x554a35[_0x3e2c27(0x27c)](0x1f4)[_0x3e2c27(0x2e1)]({'error':_0x3e2c27(0x2c0)});}})[_0x32a7e5(0x2e2)](_0x4483f0=>{var _0x1200c5=_0x32a7e5;console['error'](_0x4483f0),_0x554a35[_0x1200c5(0x27c)](0x1f4)['json']({'error':_0x1200c5(0x241)});});}catch(_0x31f847){console[_0x32a7e5(0x25e)](_0x31f847);}}),router['get']('/view/:id',auth,async(_0x5c8079,_0x157641)=>{var _0x34025c=a0_0x1b449e;try{const {username:_0x5e5792,email:_0x2b9388,role:_0x5b3c7d}=_0x5c8079['user'],_0x2db1e0=_0x5c8079[_0x34025c(0x303)],_0x164d0a=await profile[_0x34025c(0x2fc)]({'email':_0x2db1e0[_0x34025c(0x2f8)]}),_0x4165fc=await master_shop['find'](),_0x296314=_0x5c8079['params']['id'],_0x49b5be=await sales_finished[_0x34025c(0x266)](_0x296314);var _0x5a3de1=[_0x34025c(0x2a6),_0x34025c(0x208)];const _0x37910b=await warehouse[_0x34025c(0x230)]([{'$match':{'name':_0x49b5be['warehouse_name']}},{'$unwind':_0x34025c(0x2ce)},{'$group':{'_id':_0x34025c(0x2a0),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x34025c(0x2fd)},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x34025c(0x263)},'pallet':{'$first':_0x34025c(0x2f2)},'primary_code':{'$first':_0x34025c(0x2d2)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x34025c(0x22e)},'storage':{'$first':_0x34025c(0x271)},'rack':{'$first':_0x34025c(0x2e0)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x34025c(0x2f7)},'batch_code':{'$first':_0x34025c(0x20e)},'room':{'$first':_0x34025c(0x20b)}}}]),_0xcd29bc=await customer[_0x34025c(0x2d4)]({});let _0x451845;if(_0x2db1e0[_0x34025c(0x2da)]=='staff'){const _0x3604be=await staff['findOne']({'email':_0x2db1e0['email']});_0x451845=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x3604be['warehouse']}},{'$group':{'_id':_0x34025c(0x2fb),'name':{'$first':_0x34025c(0x2fb)}}}]);}else _0x451845=await warehouse[_0x34025c(0x230)]([{'$match':{'status':_0x34025c(0x225)}},{'$group':{'_id':_0x34025c(0x2fb),'name':{'$first':_0x34025c(0x2fb)}}}]);const _0x2cdb66=await product['find']({});if(_0x4165fc[0x0][_0x34025c(0x2a9)]==_0x34025c(0x2c3)){var _0x5204b7=users[_0x34025c(0x269)];console[_0x34025c(0x25e)](_0x5204b7);}else{if(_0x4165fc[0x0]['language']==_0x34025c(0x238))var _0x5204b7=users['Hindi'];else{if(_0x4165fc[0x0]['language']=='German')var _0x5204b7=users[_0x34025c(0x224)];else{if(_0x4165fc[0x0][_0x34025c(0x2a9)]==_0x34025c(0x265))var _0x5204b7=users[_0x34025c(0x265)];else{if(_0x4165fc[0x0][_0x34025c(0x2a9)]==_0x34025c(0x29b))var _0x5204b7=users[_0x34025c(0x29b)];else{if(_0x4165fc[0x0][_0x34025c(0x2a9)]==_0x34025c(0x200))var _0x5204b7=users[_0x34025c(0x28c)];else{if(_0x4165fc[0x0][_0x34025c(0x2a9)]=='Chinese')var _0x5204b7=users['Chinese'];else{if(_0x4165fc[0x0]['language']==_0x34025c(0x228))var _0x5204b7=users['Arabic'];}}}}}}}_0x157641[_0x34025c(0x29e)](_0x34025c(0x2de),{'success':_0x5c8079['flash']('success'),'errors':_0x5c8079['flash'](_0x34025c(0x2ad)),'role':_0x2db1e0,'profile':_0x164d0a,'customer':_0xcd29bc,'warehouse':_0x451845,'product':_0x37910b,'user':_0x49b5be,'master_shop':_0x4165fc,'unit':_0x2cdb66,'language':_0x5204b7});}catch(_0xf17ae3){console[_0x34025c(0x25e)](_0xf17ae3);}}),router[a0_0x1b449e(0x2fe)](a0_0x1b449e(0x2e6),auth,async(_0x30357f,_0x3fec25)=>{var _0x32ec17=a0_0x1b449e;try{const _0x5420ab=_0x30357f[_0x32ec17(0x2f9)]['id'],_0x59b1fc=await sales_finished['findOne']({'_id':_0x30357f[_0x32ec17(0x2f9)]['id']}),_0x21a7ff=await warehouse[_0x32ec17(0x2fc)]({'name':_0x59b1fc[_0x32ec17(0x1ed)],'room':_0x30357f[_0x32ec17(0x270)][_0x32ec17(0x2f3)],'warehouse_category':_0x32ec17(0x268)}),{invoice:_0x27e88f,date:_0x2f2274,warehouse_name:_0x22d4b1,product_name:_0x57f6de,customer:_0x34a2e5,stock:_0x4eaca5,quantity:_0x27f39d,note:_0x3ba6b8,room:_0x57fa1a,primary_code:_0x27d94c,secondary_code:_0x532feb,prod_code:_0x200f5c,level:_0x5df291,isle:_0x2b617c,pallet:_0x5a651b,batch_code:_0xea1241,SCRN:_0x1840f6,expiry_date:_0x410543,PO_number:_0x35f2ce,ReqBy:_0x397a4e,dateofreq:_0xf22318,typeservicesData:_0x4fe364,destination:_0xf65276,deliverydate:_0x2c9f59,driver:_0x18c47e,plate:_0x163ec9,van:_0x1097e0,DRSI:_0x5de686,typevehicle:_0xbe749c,TSU:_0x1b760b,TFU:_0x2011c4}=_0x30357f[_0x32ec17(0x270)];if(typeof _0x57f6de==_0x32ec17(0x302))var _0x48f76=[_0x30357f['body'][_0x32ec17(0x279)]],_0x3dcedf=[_0x30357f[_0x32ec17(0x270)][_0x32ec17(0x24d)]],_0x4eff01=[_0x30357f[_0x32ec17(0x270)][_0x32ec17(0x209)]],_0x1587bf=[_0x30357f[_0x32ec17(0x270)]['primary_code']],_0x2bc612=[_0x30357f['body'][_0x32ec17(0x26a)]],_0x1d61a8=[_0x30357f[_0x32ec17(0x270)][_0x32ec17(0x2d6)]],_0x3d4cb9=[_0x30357f[_0x32ec17(0x270)][_0x32ec17(0x206)]],_0xfb53a9=[_0x30357f['body'][_0x32ec17(0x1f5)]],_0x405e8e=[_0x30357f[_0x32ec17(0x270)][_0x32ec17(0x289)]],_0x1a618e=[_0x30357f['body'][_0x32ec17(0x27b)]],_0x32e049=[_0x30357f[_0x32ec17(0x270)][_0x32ec17(0x286)]],_0x328033=[_0x30357f['body'][_0x32ec17(0x26f)]],_0x19fab4=[_0x30357f[_0x32ec17(0x270)][_0x32ec17(0x29c)]],_0x2a5fac=[_0x30357f[_0x32ec17(0x270)][_0x32ec17(0x23e)]],_0x7999c0=[_0x30357f[_0x32ec17(0x270)][_0x32ec17(0x261)]],_0x4051d0=[_0x30357f['body']['type']],_0x9f7de6=[_0x30357f[_0x32ec17(0x270)][_0x32ec17(0x277)]];else var _0x48f76=[..._0x30357f[_0x32ec17(0x270)][_0x32ec17(0x279)]],_0x3dcedf=[..._0x30357f[_0x32ec17(0x270)]['stock']],_0x4eff01=[..._0x30357f[_0x32ec17(0x270)][_0x32ec17(0x209)]],_0x1587bf=[..._0x30357f[_0x32ec17(0x270)][_0x32ec17(0x282)]],_0x2bc612=[..._0x30357f[_0x32ec17(0x270)]['secondary_code']],_0x1d61a8=[..._0x30357f['body'][_0x32ec17(0x2d6)]],_0x3d4cb9=[..._0x30357f[_0x32ec17(0x270)][_0x32ec17(0x206)]],_0xfb53a9=[..._0x30357f['body'][_0x32ec17(0x1f5)]],_0x405e8e=[..._0x30357f[_0x32ec17(0x270)][_0x32ec17(0x289)]],_0x1a618e=[..._0x30357f[_0x32ec17(0x270)]['batch_code']],_0x32e049=[..._0x30357f['body'][_0x32ec17(0x286)]],_0x328033=[..._0x30357f[_0x32ec17(0x270)][_0x32ec17(0x26f)]],_0x19fab4=[..._0x30357f[_0x32ec17(0x270)][_0x32ec17(0x29c)]],_0x2a5fac=[..._0x30357f['body'][_0x32ec17(0x23e)]],_0x7999c0=[..._0x30357f[_0x32ec17(0x270)][_0x32ec17(0x261)]],_0x4051d0=[..._0x30357f[_0x32ec17(0x270)][_0x32ec17(0x27d)]],_0x9f7de6=[..._0x30357f[_0x32ec17(0x270)]['CBM']];const _0x36f550=_0x48f76[_0x32ec17(0x237)](_0x35909d=>{return _0x35909d={'product_name':_0x35909d};});_0x3dcedf[_0x32ec17(0x2c4)]((_0x62f8bd,_0x4996f2)=>{var _0x3417a6=_0x32ec17;_0x36f550[_0x4996f2][_0x3417a6(0x24d)]=_0x62f8bd;}),_0x4eff01[_0x32ec17(0x2c4)]((_0x3e5bf1,_0x56a808)=>{var _0x1c7edb=_0x32ec17;_0x36f550[_0x56a808][_0x1c7edb(0x2e5)]=_0x3e5bf1;}),_0x1587bf[_0x32ec17(0x2c4)]((_0x236de1,_0x5edf4e)=>{_0x36f550[_0x5edf4e]['primary_code']=_0x236de1;}),_0x2bc612[_0x32ec17(0x2c4)]((_0x4f8c64,_0x55a67a)=>{var _0x3dfd31=_0x32ec17;_0x36f550[_0x55a67a][_0x3dfd31(0x26a)]=_0x4f8c64;}),_0x1d61a8[_0x32ec17(0x2c4)]((_0x46a980,_0x291318)=>{var _0x327bd5=_0x32ec17;_0x36f550[_0x291318][_0x327bd5(0x22c)]=_0x46a980;}),_0x3d4cb9['forEach']((_0x34017c,_0xdc2189)=>{var _0x2df00c=_0x32ec17,_0x28f046=_0x34017c['slice'](0x1);_0x36f550[_0xdc2189]['isle']=_0x34017c[0x0],_0x36f550[_0xdc2189][_0x2df00c(0x1f4)]=_0x28f046;}),_0x4051d0[_0x32ec17(0x2c4)]((_0x40dd98,_0x2196bc)=>{var _0x4249cc=_0x32ec17;_0x36f550[_0x2196bc][_0x4249cc(0x206)]=_0x40dd98;}),_0xfb53a9['forEach']((_0x11a68c,_0x425022)=>{var _0x9282a4=_0x32ec17;_0x36f550[_0x425022][_0x9282a4(0x20a)]=_0x11a68c;}),_0x405e8e[_0x32ec17(0x2c4)]((_0x193838,_0x290ee2)=>{var _0x34d5eb=_0x32ec17;_0x36f550[_0x290ee2][_0x34d5eb(0x289)]=_0x193838;}),_0x1a618e[_0x32ec17(0x2c4)]((_0x5b1f30,_0x4d2fce)=>{_0x36f550[_0x4d2fce]['batch_code']=_0x5b1f30;}),_0x32e049['forEach']((_0x3b50aa,_0x5505e3)=>{var _0x1084de=_0x32ec17;_0x36f550[_0x5505e3][_0x1084de(0x286)]=_0x3b50aa;}),_0x328033['forEach']((_0x2e08df,_0xb316f1)=>{var _0x2922b0=_0x32ec17;_0x36f550[_0xb316f1][_0x2922b0(0x236)]=_0x2e08df;}),_0x19fab4[_0x32ec17(0x2c4)]((_0x4b2fcf,_0x2cbfe9)=>{_0x36f550[_0x2cbfe9]['maxperunit']=_0x4b2fcf;}),_0x2a5fac[_0x32ec17(0x2c4)]((_0x177ee3,_0x559e17)=>{var _0x49b94d=_0x32ec17;_0x36f550[_0x559e17][_0x49b94d(0x23e)]=_0x177ee3;}),_0x7999c0[_0x32ec17(0x2c4)]((_0x213ca9,_0x111eec)=>{_0x36f550[_0x111eec]['room_name']=_0x213ca9;}),_0x9f7de6['forEach']((_0xae4dbb,_0x12a102)=>{var _0xca15b=_0x32ec17;_0x36f550[_0x12a102][_0xca15b(0x277)]=_0xae4dbb;});var _0x15c22c=0x0;_0x36f550[_0x32ec17(0x2c4)](_0x58f0c8=>{var _0x2f37db=_0x32ec17;console['log'](_0x2f37db(0x281),_0x58f0c8),(parseInt(_0x58f0c8['stock'])<parseInt(_0x58f0c8[_0x2f37db(0x2e5)])||parseInt(_0x58f0c8[_0x2f37db(0x2e5)])==0x0)&&_0x15c22c++;});if(_0x15c22c!=0x0)return _0x30357f[_0x32ec17(0x1f8)](_0x32ec17(0x2ad),'Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x3fec25[_0x32ec17(0x27a)]('back');const _0x177965=_0x36f550['filter'](_0x3099ad=>_0x3099ad[_0x32ec17(0x2e5)]!=='0'&&_0x3099ad[_0x32ec17(0x2e5)]!=='');_0x59b1fc['invoice']=_0x27e88f,_0x59b1fc['customer']=_0x34a2e5,_0x59b1fc[_0x32ec17(0x301)]=_0x2f2274,_0x59b1fc['warehouse_name']=_0x22d4b1,_0x59b1fc['sale_product']=_0x177965,_0x59b1fc['note']=_0x3ba6b8,_0x59b1fc[_0x32ec17(0x283)]=_0x32ec17(0x233),_0x59b1fc[_0x32ec17(0x299)]=_0x1b760b,_0x59b1fc[_0x32ec17(0x2ea)]=_0x2011c4,_0x59b1fc[_0x32ec17(0x215)]=_0x35f2ce,_0x59b1fc[_0x32ec17(0x22b)]=_0x5de686,_0x59b1fc[_0x32ec17(0x2b6)]=_0x1097e0,_0x59b1fc[_0x32ec17(0x247)]=_0x163ec9,_0x59b1fc[_0x32ec17(0x227)]=_0x18c47e,_0x59b1fc[_0x32ec17(0x262)]=_0x2c9f59,_0x59b1fc['destination']=_0xf65276,_0x59b1fc[_0x32ec17(0x26c)]=_0xbe749c,_0x59b1fc[_0x32ec17(0x246)]=_0x4fe364,_0x59b1fc[_0x32ec17(0x2ed)]=_0xf22318,_0x59b1fc[_0x32ec17(0x239)]=_0x397a4e,_0x59b1fc['finalize']=_0x32ec17(0x233),_0x59b1fc['SCRN']=_0x1840f6;const _0x4bc85d=await _0x59b1fc[_0x32ec17(0x2e4)]();_0x30357f[_0x32ec17(0x1f8)](_0x32ec17(0x2c6),_0x32ec17(0x254)),_0x3fec25[_0x32ec17(0x27a)](_0x32ec17(0x2eb));}catch(_0x224218){console['log'](_0x224218);}}),router[a0_0x1b449e(0x2fe)](a0_0x1b449e(0x2a5),auth,async(_0x153173,_0x34d66b)=>{var _0x4a489f=a0_0x1b449e;try{const _0x1f691d=_0x153173[_0x4a489f(0x2f9)]['id'],{invoice:_0xa8b72c,customer:_0x29ad5a,receivable_amount:_0x3ddb48,received_amount:_0x2e37f2}=_0x153173['body'],_0x7896aa=await sales[_0x4a489f(0x266)](_0x1f691d);console[_0x4a489f(0x25e)](_0x7896aa);var _0x1746f7=_0x3ddb48-_0x2e37f2;console[_0x4a489f(0x25e)](_0x2e37f2),_0x7896aa[_0x4a489f(0x2cf)]=parseFloat(_0x2e37f2)+parseFloat(_0x7896aa[_0x4a489f(0x2cf)]),_0x7896aa[_0x4a489f(0x305)]=_0x1746f7,console[_0x4a489f(0x25e)](_0x7896aa);const _0x4fa4da=await _0x7896aa[_0x4a489f(0x2e4)](),_0x2cc4a=await c_payment_data[_0x4a489f(0x2fc)]({'invoice':_0xa8b72c});_0x2cc4a['amount']=_0x1746f7,await _0x2cc4a['save']();let _0x2acdd8=new Date(),_0x11776f=('0'+_0x2acdd8['getDate']())['slice'](-0x2),_0x7df2a2=('0'+(_0x2acdd8[_0x4a489f(0x212)]()+0x1))[_0x4a489f(0x276)](-0x2),_0x8232d0=_0x2acdd8[_0x4a489f(0x280)](),_0x1a9b06=_0x8232d0+'-'+_0x7df2a2+'-'+_0x11776f;const _0x504716=new customer_payment({'invoice':_0xa8b72c,'date':_0x8232d0+'-'+_0x7df2a2+'-'+_0x11776f,'customer':_0x29ad5a,'reason':_0x4a489f(0x2bc),'amount':_0x2e37f2}),_0x35d1a9=await _0x504716[_0x4a489f(0x2e4)]();_0x153173[_0x4a489f(0x1f8)]('success',_0x4a489f(0x2f0)),_0x34d66b[_0x4a489f(0x27a)](_0x4a489f(0x25c));}catch(_0x240ce1){console[_0x4a489f(0x25e)](_0x240ce1);}}),router[a0_0x1b449e(0x2b1)]('/invoice/:id',auth,async(_0xff75e5,_0x42857d)=>{var _0x5b5bad=a0_0x1b449e;try{const {username:_0x39e220,email:_0x4f5d19,role:_0x38fbc6}=_0xff75e5[_0x5b5bad(0x303)],_0x2fa33c=_0xff75e5[_0x5b5bad(0x303)],_0xc64e4e=await profile[_0x5b5bad(0x2fc)]({'email':_0x2fa33c[_0x5b5bad(0x2f8)]}),_0x2b5591=await master_shop[_0x5b5bad(0x2d4)]();console[_0x5b5bad(0x25e)](_0x5b5bad(0x2f5),_0x2b5591);const _0x1b8950=_0xff75e5[_0x5b5bad(0x2f9)]['id'],_0x4ab257=await sales['findById'](_0x1b8950);console[_0x5b5bad(0x25e)](_0x4ab257);const _0x343389=await customer[_0x5b5bad(0x2fc)]({'name':_0x4ab257[_0x5b5bad(0x1fd)]});console[_0x5b5bad(0x25e)](_0x343389);if(_0x2b5591[0x0][_0x5b5bad(0x2a9)]==_0x5b5bad(0x2c3)){var _0x4c95d5=users['English'];console[_0x5b5bad(0x25e)](_0x4c95d5);}else{if(_0x2b5591[0x0]['language']==_0x5b5bad(0x238))var _0x4c95d5=users[_0x5b5bad(0x238)];else{if(_0x2b5591[0x0]['language']=='German')var _0x4c95d5=users[_0x5b5bad(0x224)];else{if(_0x2b5591[0x0][_0x5b5bad(0x2a9)]==_0x5b5bad(0x265))var _0x4c95d5=users[_0x5b5bad(0x265)];else{if(_0x2b5591[0x0][_0x5b5bad(0x2a9)]==_0x5b5bad(0x29b))var _0x4c95d5=users[_0x5b5bad(0x29b)];else{if(_0x2b5591[0x0][_0x5b5bad(0x2a9)]==_0x5b5bad(0x200))var _0x4c95d5=users['Portuguese'];else{if(_0x2b5591[0x0]['language']=='Chinese')var _0x4c95d5=users['Chinese'];else{if(_0x2b5591[0x0]['language']==_0x5b5bad(0x228))var _0x4c95d5=users[_0x5b5bad(0x2c1)];}}}}}}}_0x42857d[_0x5b5bad(0x29e)](_0x5b5bad(0x23d),{'success':_0xff75e5[_0x5b5bad(0x1f8)]('success'),'errors':_0xff75e5[_0x5b5bad(0x1f8)](_0x5b5bad(0x2ad)),'role':_0x2fa33c,'profile':_0xc64e4e,'master_shop':_0x2b5591,'customers':_0x343389,'sales':_0x4ab257,'language':_0x4c95d5});}catch(_0xa42e32){console[_0x5b5bad(0x25e)](_0xa42e32);}}),router[a0_0x1b449e(0x2b1)](a0_0x1b449e(0x235),auth,async(_0x523e30,_0x31ed2c)=>{var _0x216aab=a0_0x1b449e;try{const {username:_0x494790,email:_0x45c81c,role:_0xdde5f2}=_0x523e30['user'],_0xbfeccd=_0x523e30[_0x216aab(0x303)],_0x5c4ac5=await profile[_0x216aab(0x2fc)]({'email':_0xbfeccd[_0x216aab(0x2f8)]}),_0x2d9efb=await master_shop[_0x216aab(0x2d4)](),_0x2e6bed=_0x523e30[_0x216aab(0x2f9)]['id'],_0x2542c4=await sales_finished[_0x216aab(0x266)](_0x2e6bed),_0x3f4d57=await warehouse[_0x216aab(0x230)]([{'$match':{'name':_0x2542c4[_0x216aab(0x1ed)]}},{'$unwind':_0x216aab(0x2ce)},{'$group':{'_id':_0x216aab(0x2a0),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x216aab(0x2fd)},'level':{'$first':_0x216aab(0x2ef)},'isle':{'$first':_0x216aab(0x263)},'pallet':{'$first':_0x216aab(0x2f2)},'primary_code':{'$first':_0x216aab(0x2d2)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x216aab(0x22e)},'storage':{'$first':_0x216aab(0x271)},'rack':{'$first':_0x216aab(0x2e0)},'expiry_date':{'$first':_0x216aab(0x21d)},'production_date':{'$first':_0x216aab(0x2f7)},'unit':{'$first':_0x216aab(0x291)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'maxProducts':{'$first':_0x216aab(0x2bf)},'batch_code':{'$first':_0x216aab(0x20e)},'maxPerUnit':{'$first':_0x216aab(0x28d)},'room':{'$first':_0x216aab(0x20b)}}}]),_0x31e21c=await product[_0x216aab(0x2d4)]({}),_0x33082c=await warehouse['aggregate']([{'$match':{'status':_0x216aab(0x225),'name':{'$ne':_0x216aab(0x295)}}},{'$group':{'_id':_0x216aab(0x2fb),'name':{'$first':_0x216aab(0x2fb)}}},{'$sort':{'name':0x1}}]),_0x1899a2=await warehouse[_0x216aab(0x230)]([{'$match':{'status':_0x216aab(0x225),'name':'Return\x20Goods'}},{'$group':{'_id':'$name','name':{'$first':_0x216aab(0x2fb)}}},{'$sort':{'name':0x1}}]);if(_0x2d9efb[0x0][_0x216aab(0x2a9)]==_0x216aab(0x2c3)){var _0x1e2f53=users['English'];console[_0x216aab(0x25e)](_0x1e2f53);}else{if(_0x2d9efb[0x0][_0x216aab(0x2a9)]==_0x216aab(0x238))var _0x1e2f53=users[_0x216aab(0x238)];else{if(_0x2d9efb[0x0][_0x216aab(0x2a9)]==_0x216aab(0x224))var _0x1e2f53=users[_0x216aab(0x224)];else{if(_0x2d9efb[0x0][_0x216aab(0x2a9)]==_0x216aab(0x265))var _0x1e2f53=users[_0x216aab(0x265)];else{if(_0x2d9efb[0x0][_0x216aab(0x2a9)]==_0x216aab(0x29b))var _0x1e2f53=users[_0x216aab(0x29b)];else{if(_0x2d9efb[0x0][_0x216aab(0x2a9)]==_0x216aab(0x200))var _0x1e2f53=users[_0x216aab(0x28c)];else{if(_0x2d9efb[0x0][_0x216aab(0x2a9)]=='Chinese')var _0x1e2f53=users['Chinese'];else{if(_0x2d9efb[0x0][_0x216aab(0x2a9)]=='Arabic\x20(ae)')var _0x1e2f53=users['Arabic'];}}}}}}}_0x31ed2c[_0x216aab(0x29e)](_0x216aab(0x1f9),{'success':_0x523e30[_0x216aab(0x1f8)](_0x216aab(0x2c6)),'errors':_0x523e30[_0x216aab(0x1f8)]('errors'),'role':_0xbfeccd,'profile':_0x5c4ac5,'user':_0x2542c4,'stock':_0x3f4d57,'master_shop':_0x2d9efb,'unit':_0x31e21c,'language':_0x1e2f53,'warehouses':_0x33082c,'warehouse_QA':_0x1899a2});}catch(_0x47df40){console[_0x216aab(0x25e)](_0x47df40),_0x31ed2c[_0x216aab(0x27c)](0xc8)[_0x216aab(0x2e1)]({'message':_0x47df40['message']});}}),router['post']('/view/return_sales/:id',auth,async(_0x594bda,_0x3d982e)=>{var _0x2af1bf=a0_0x1b449e;if(_0x594bda[_0x2af1bf(0x270)][_0x2af1bf(0x257)]=='QA')try{const {invoice:_0x54f09f,date:_0xe02e42,warehouse_name:_0x55c351,product_name:_0x1028ba,primary_code:_0xf6a48a,secondary_code:_0x2b4192,product_code:_0x34ddfa,sales_quantity:_0x3a8520,stocks:_0x55c124,return_qty:_0x296978,Room_name:_0x1cbab9,to_warehouse_name_QA:_0x3dd99c,to_Room_name_QA:_0x494edf,note:_0x49bb74,for_categorize:_0x171f36,product_name_QA1:_0xb31c4a}=_0x594bda[_0x2af1bf(0x270)];if(typeof _0xb31c4a==_0x2af1bf(0x302))var _0x26edb3=[_0x594bda[_0x2af1bf(0x270)][_0x2af1bf(0x24c)]],_0x12002c=[_0x594bda['body'][_0x2af1bf(0x23a)]],_0x1ec743=[_0x594bda[_0x2af1bf(0x270)][_0x2af1bf(0x23b)]],_0x3a3a7f=[_0x594bda[_0x2af1bf(0x270)][_0x2af1bf(0x2c8)]],_0x34d156=[_0x594bda[_0x2af1bf(0x270)][_0x2af1bf(0x250)]],_0x3bea76=[_0x594bda['body']['return_qty_QA']],_0x5dd420=[_0x594bda[_0x2af1bf(0x270)][_0x2af1bf(0x1f3)]],_0x511174=[_0x594bda['body'][_0x2af1bf(0x2fa)]],_0x15b5d3=[_0x594bda[_0x2af1bf(0x270)][_0x2af1bf(0x275)]],_0x1f4c6e=[_0x594bda[_0x2af1bf(0x270)][_0x2af1bf(0x1ef)]],_0x393ecd=[_0x594bda[_0x2af1bf(0x270)][_0x2af1bf(0x221)]],_0xd51504=[_0x594bda['body'][_0x2af1bf(0x217)]],_0x3db258=[_0x594bda[_0x2af1bf(0x270)][_0x2af1bf(0x1f0)]],_0x188511=[_0x594bda['body'][_0x2af1bf(0x220)]],_0x5aaad7=[_0x594bda[_0x2af1bf(0x270)][_0x2af1bf(0x2b2)]],_0x25d229=[_0x594bda[_0x2af1bf(0x270)]['pallet_QA']];else var _0x26edb3=[..._0x594bda[_0x2af1bf(0x270)][_0x2af1bf(0x24c)]],_0x12002c=[..._0x594bda[_0x2af1bf(0x270)][_0x2af1bf(0x23a)]],_0x1ec743=[..._0x594bda[_0x2af1bf(0x270)]['secondary_code_QA']],_0x3a3a7f=[..._0x594bda[_0x2af1bf(0x270)][_0x2af1bf(0x2c8)]],_0x34d156=[..._0x594bda[_0x2af1bf(0x270)][_0x2af1bf(0x250)]],_0x3bea76=[..._0x594bda['body'][_0x2af1bf(0x253)]],_0x5dd420=[..._0x594bda[_0x2af1bf(0x270)][_0x2af1bf(0x1f3)]],_0x511174=[..._0x594bda[_0x2af1bf(0x270)][_0x2af1bf(0x2fa)]],_0x15b5d3=[..._0x594bda[_0x2af1bf(0x270)][_0x2af1bf(0x275)]],_0x1f4c6e=[..._0x594bda[_0x2af1bf(0x270)][_0x2af1bf(0x1ef)]],_0x393ecd=[..._0x594bda['body'][_0x2af1bf(0x221)]],_0xd51504=[..._0x594bda[_0x2af1bf(0x270)][_0x2af1bf(0x217)]],_0x3db258=[..._0x594bda['body'][_0x2af1bf(0x1f0)]],_0x188511=[..._0x594bda[_0x2af1bf(0x270)][_0x2af1bf(0x220)]],_0x5aaad7=[..._0x594bda[_0x2af1bf(0x270)][_0x2af1bf(0x2b2)]],_0x25d229=[..._0x594bda[_0x2af1bf(0x270)][_0x2af1bf(0x203)]];const _0x5d0abc=_0x26edb3[_0x2af1bf(0x237)](_0x528606=>{return _0x528606={'product_name':_0x528606};});_0x188511[_0x2af1bf(0x2c4)]((_0x53284f,_0x212ad6)=>{_0x5d0abc[_0x212ad6]['roombefore']=_0x53284f;}),_0x5aaad7[_0x2af1bf(0x2c4)]((_0xe20339,_0x1f5e1c)=>{var _0x20f892=_0x2af1bf;_0x5d0abc[_0x1f5e1c][_0x20f892(0x206)]=_0xe20339;}),_0x25d229['forEach']((_0x4cd55e,_0x1c7f58)=>{var _0x2a310b=_0x2af1bf,_0x504f2a=_0x4cd55e['slice'](0x1);_0x5d0abc[_0x1c7f58]['isle']=_0x4cd55e[0x0],_0x5d0abc[_0x1c7f58][_0x2a310b(0x1f4)]=_0x504f2a;}),_0x12002c[_0x2af1bf(0x2c4)]((_0x13e7a9,_0x17ce9b)=>{var _0x5b187a=_0x2af1bf;_0x5d0abc[_0x17ce9b][_0x5b187a(0x282)]=_0x13e7a9;}),_0x1ec743[_0x2af1bf(0x2c4)]((_0x244d31,_0x39b601)=>{var _0x37d6b1=_0x2af1bf;_0x5d0abc[_0x39b601][_0x37d6b1(0x26a)]=_0x244d31;}),_0x3a3a7f[_0x2af1bf(0x2c4)]((_0x1e22ca,_0x5ec477)=>{var _0x519d34=_0x2af1bf;_0x5d0abc[_0x5ec477][_0x519d34(0x22c)]=_0x1e22ca;}),_0x34d156['forEach']((_0x17130d,_0x299c9a)=>{var _0x56b80f=_0x2af1bf;_0x5d0abc[_0x299c9a][_0x56b80f(0x2d9)]=_0x17130d;}),_0x3bea76[_0x2af1bf(0x2c4)]((_0x280d83,_0x55b772)=>{_0x5d0abc[_0x55b772]['return_qty']=_0x280d83;}),_0x5dd420[_0x2af1bf(0x2c4)]((_0x5f24ed,_0x4dd50e)=>{var _0x26b60f=_0x2af1bf;_0x5d0abc[_0x4dd50e][_0x26b60f(0x22f)]=_0x5f24ed;}),_0x511174[_0x2af1bf(0x2c4)]((_0x4e20a4,_0xe92a44)=>{_0x5d0abc[_0xe92a44]['maxProducts']=_0x4e20a4;}),_0x15b5d3[_0x2af1bf(0x2c4)]((_0x4404c1,_0x245176)=>{var _0x2c79b2=_0x2af1bf;_0x5d0abc[_0x245176][_0x2c79b2(0x27b)]=_0x4404c1;}),_0x1f4c6e[_0x2af1bf(0x2c4)]((_0x526b24,_0x465216)=>{var _0x56fe1e=_0x2af1bf;_0x5d0abc[_0x465216][_0x56fe1e(0x289)]=_0x526b24;}),_0x393ecd[_0x2af1bf(0x2c4)]((_0x1cca6b,_0x4a2922)=>{var _0x4f2ba7=_0x2af1bf;_0x5d0abc[_0x4a2922][_0x4f2ba7(0x20a)]=_0x1cca6b;}),_0xd51504['forEach']((_0x35800a,_0xd45d4e)=>{_0x5d0abc[_0xd45d4e]['production_date']=_0x35800a;}),_0x3db258[_0x2af1bf(0x2c4)]((_0xc3c76a,_0x164521)=>{_0x5d0abc[_0x164521]['expiry_date']=_0xc3c76a;});const _0x3a312f=await sales_finished[_0x2af1bf(0x2fc)]({'invoice':_0x54f09f});_0x3a312f[_0x2af1bf(0x1f1)]=_0x2af1bf(0x29d);const _0x545a4f=await _0x3a312f[_0x2af1bf(0x2e4)](),_0x4cf5ff=new sales_return_finished({'invoice':_0x54f09f,'customer':_0x594bda[_0x2af1bf(0x270)][_0x2af1bf(0x1fd)],'date':_0xe02e42,'warehouse_name':_0x55c351,'room':_0x1cbab9,'ToWarehouse':_0x3dd99c,'ToRoom':_0x494edf,'return_sale_QA':_0x5d0abc,'note':_0x49bb74,'warehouse_cat':_0x171f36}),_0x407390=await _0x4cf5ff[_0x2af1bf(0x2e4)](),_0x102a5e=await sales_return_finished['findOne']({'invoice':_0x54f09f}),_0x5e10fd=await warehouse[_0x2af1bf(0x2fc)]({'name':_0x3dd99c,'room':_0x494edf});_0x102a5e['return_sale_QA'][_0x2af1bf(0x2c4)](_0x2d01c1=>{var _0x5b4479=_0x2af1bf,_0x28dc1d=0x0;const _0x872884=_0x5e10fd[_0x5b4479(0x23c)]['map'](_0x942f25=>{var _0x3c54e3=_0x5b4479;_0x942f25[_0x3c54e3(0x279)]==_0x2d01c1[_0x3c54e3(0x279)]&&_0x942f25['isle']==_0x2d01c1[_0x3c54e3(0x2ae)]&&_0x942f25[_0x3c54e3(0x206)]==_0x2d01c1[_0x3c54e3(0x206)]&&_0x942f25['pallet']==_0x2d01c1[_0x3c54e3(0x1f4)]&&_0x942f25[_0x3c54e3(0x286)]==_0x2d01c1[_0x3c54e3(0x286)]&&_0x942f25['production_date']==_0x2d01c1[_0x3c54e3(0x236)]&&_0x942f25[_0x3c54e3(0x27b)]==_0x2d01c1[_0x3c54e3(0x27b)]&&(_0x942f25['product_stock']=parseInt(_0x942f25[_0x3c54e3(0x20f)])+parseInt(_0x2d01c1[_0x3c54e3(0x2bd)]),_0x28dc1d++);});_0x28dc1d=='0'&&(_0x5e10fd[_0x5b4479(0x23c)]=_0x5e10fd[_0x5b4479(0x23c)][_0x5b4479(0x2a8)]({'product_name':_0x2d01c1[_0x5b4479(0x279)],'product_stock':_0x2d01c1[_0x5b4479(0x2bd)],'primary_code':_0x2d01c1[_0x5b4479(0x282)],'secondary_code':_0x2d01c1[_0x5b4479(0x26a)],'product_code':_0x2d01c1[_0x5b4479(0x22c)],'batch_code':_0x2d01c1['batch_code'],'maxPerUnit':_0x2d01c1[_0x5b4479(0x22f)],'production_date':_0x2d01c1[_0x5b4479(0x236)],'expiry_date':_0x2d01c1[_0x5b4479(0x286)],'secondary_unit':_0x2d01c1['secondary_unit'],'unit':_0x2d01c1[_0x5b4479(0x20a)],'maxProducts':_0x2d01c1['maxProducts'],'level':_0x2d01c1['level'],'isle':_0x2d01c1[_0x5b4479(0x2ae)],'pallet':_0x2d01c1[_0x5b4479(0x1f4)]}));}),await _0x5e10fd['save']();const _0x155aea=new c_payment_data({'invoice':_0x54f09f,'customer':_0x594bda[_0x2af1bf(0x270)]['customer'],'reason':_0x2af1bf(0x2f1)});await _0x155aea[_0x2af1bf(0x2e4)]();const _0x4dffa0=await master_shop[_0x2af1bf(0x2d4)](),_0x31cf15=await email_settings[_0x2af1bf(0x2fc)](),_0x2eba6e=await customer['findOne']({'name':_0x594bda[_0x2af1bf(0x270)][_0x2af1bf(0x1fd)]});_0x4dffa0[0x0][_0x2af1bf(0x2c9)]==0x1?(right_currency=_0x4dffa0[0x0][_0x2af1bf(0x22d)],left_currency=''):(right_currency='',left_currency=_0x4dffa0[0x0][_0x2af1bf(0x22d)]);var _0x2056f1=_0x26edb3,_0x3e650a=_0x3bea76,_0x18cad1='',_0x568baa;for(_0x568baa in _0x2056f1){_0x18cad1+=_0x2af1bf(0x278)+_0x2af1bf(0x245)+_0x2056f1[_0x568baa]+_0x2af1bf(0x202)+_0x2af1bf(0x245)+_0x3e650a[_0x568baa]+_0x2af1bf(0x202)+_0x2af1bf(0x2cd);}console[_0x2af1bf(0x25e)](_0x2af1bf(0x264),_0x18cad1);let _0x3e01ac=nodemailer['createTransport']({'service':'gmail','auth':{'user':_0x31cf15[_0x2af1bf(0x2f8)],'pass':_0x31cf15[_0x2af1bf(0x2b7)]}}),_0xd0a2df={'from':_0x31cf15[_0x2af1bf(0x2f8)],'to':_0x2eba6e[_0x2af1bf(0x2f8)],'subject':_0x2af1bf(0x2a4),'attachments':[{'filename':'Logo.png','path':__dirname+_0x2af1bf(0x249)+_0x2af1bf(0x216)+_0x4dffa0[0x0][_0x2af1bf(0x214)],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+_0x2af1bf(0x2dc)+'</head><body>'+_0x2af1bf(0x232)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x2af1bf(0x232)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x2af1bf(0x255)+'<div>'+_0x2af1bf(0x2ac)+_0x4dffa0[0x0][_0x2af1bf(0x290)]+_0x2af1bf(0x2ab)+_0x2af1bf(0x255)+_0x2af1bf(0x255)+'<hr\x20class=\x22my-3\x22>'+_0x2af1bf(0x232)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x2af1bf(0x226)+_0x54f09f+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x2af1bf(0x2b4)+_0xe02e42+'\x20'+_0x2af1bf(0x294)+_0x2af1bf(0x2c5)+_0x2af1bf(0x255)+_0x2af1bf(0x222)+_0x2af1bf(0x2a1)+_0x2af1bf(0x278)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x2af1bf(0x2ba)+_0x2af1bf(0x240)+_0x2af1bf(0x22a)+_0x2af1bf(0x2cd)+_0x2af1bf(0x287)+_0x2af1bf(0x25b)+'\x20'+_0x18cad1+'\x20'+_0x2af1bf(0x28a)+'</table>'+'<div>'+_0x2af1bf(0x1f6)+_0x2af1bf(0x293)+_0x4dffa0[0x0][_0x2af1bf(0x290)]+_0x2af1bf(0x2c5)+'</div>'+'</div>'+_0x2af1bf(0x1fc)};_0x3e01ac['sendMail'](_0xd0a2df,function(_0x238581,_0x5da18b){var _0x247316=_0x2af1bf;_0x238581?(console[_0x247316(0x25e)](_0x238581),console[_0x247316(0x25e)]('Error\x20Occurs')):console[_0x247316(0x25e)](_0x247316(0x2d5));}),_0x594bda[_0x2af1bf(0x1f8)](_0x2af1bf(0x2c6),_0x2af1bf(0x258)),_0x3d982e[_0x2af1bf(0x27a)](_0x2af1bf(0x2eb));}catch(_0x5221ee){_0x3d982e[_0x2af1bf(0x27c)](0xc8)[_0x2af1bf(0x2e1)]({'message1':_0x5221ee[_0x2af1bf(0x1ee)]});}else{if(_0x594bda[_0x2af1bf(0x270)][_0x2af1bf(0x257)]=='GS')try{const {invoice:_0x5a9af8,date:_0x37ae1a,warehouse_name:_0x22cfed,product_name:_0x18309a,primary_code:_0x9ab755,secondary_code:_0x4bb93f,product_code:_0x691a8d,sales_quantity:_0x54b96c,stocks:_0x2ccdde,return_qty:_0x24e7bc,Room_name:_0x4fdf0d,to_warehouse_name:_0x197c3a,to_Room_name:_0x412bc9,note:_0x1a40ac,level:_0x3ffc88,isle:_0x1836a7,pallet:_0x298eb7,for_categorize:_0x426c25}=_0x594bda['body'];if(typeof _0x18309a==_0x2af1bf(0x302))var _0x26edb3=[_0x594bda[_0x2af1bf(0x270)][_0x2af1bf(0x279)]],_0x12002c=[_0x594bda[_0x2af1bf(0x270)][_0x2af1bf(0x282)]],_0x1ec743=[_0x594bda['body'][_0x2af1bf(0x26a)]],_0x3a3a7f=[_0x594bda[_0x2af1bf(0x270)]['product_code']],_0x34d156=[_0x594bda[_0x2af1bf(0x270)][_0x2af1bf(0x243)]],_0x3bea76=[_0x594bda[_0x2af1bf(0x270)]['return_qty']],_0x5e121d=[_0x594bda[_0x2af1bf(0x270)][_0x2af1bf(0x273)]],_0x17f593=[_0x594bda[_0x2af1bf(0x270)][_0x2af1bf(0x1f4)]],_0x5dd420=[_0x594bda[_0x2af1bf(0x270)][_0x2af1bf(0x22f)]],_0x511174=[_0x594bda[_0x2af1bf(0x270)][_0x2af1bf(0x218)]],_0x15b5d3=[_0x594bda[_0x2af1bf(0x270)][_0x2af1bf(0x27b)]],_0x1f4c6e=[_0x594bda[_0x2af1bf(0x270)]['secondary_unit']],_0x393ecd=[_0x594bda[_0x2af1bf(0x270)]['unit']],_0xd51504=[_0x594bda[_0x2af1bf(0x270)][_0x2af1bf(0x236)]],_0x3db258=[_0x594bda[_0x2af1bf(0x270)]['expiry_date']];else var _0x26edb3=[..._0x594bda[_0x2af1bf(0x270)][_0x2af1bf(0x279)]],_0x12002c=[..._0x594bda[_0x2af1bf(0x270)][_0x2af1bf(0x282)]],_0x1ec743=[..._0x594bda[_0x2af1bf(0x270)][_0x2af1bf(0x26a)]],_0x3a3a7f=[..._0x594bda['body'][_0x2af1bf(0x22c)]],_0x34d156=[..._0x594bda['body'][_0x2af1bf(0x243)]],_0x3bea76=[..._0x594bda[_0x2af1bf(0x270)][_0x2af1bf(0x2bd)]],_0x5e121d=[..._0x594bda[_0x2af1bf(0x270)][_0x2af1bf(0x273)]],_0x5dd420=[..._0x594bda[_0x2af1bf(0x270)][_0x2af1bf(0x22f)]],_0x511174=[..._0x594bda[_0x2af1bf(0x270)][_0x2af1bf(0x218)]],_0x15b5d3=[..._0x594bda[_0x2af1bf(0x270)]['batch_code']],_0x1f4c6e=[..._0x594bda[_0x2af1bf(0x270)]['secondary_unit']],_0x393ecd=[..._0x594bda[_0x2af1bf(0x270)]['unit']],_0xd51504=[..._0x594bda[_0x2af1bf(0x270)][_0x2af1bf(0x236)]],_0x3db258=[..._0x594bda['body']['expiry_date']],_0x17f593=[..._0x594bda[_0x2af1bf(0x270)][_0x2af1bf(0x1f4)]];const _0x2325ad=_0x26edb3['map'](_0x3fbaac=>{return _0x3fbaac={'product_name':_0x3fbaac};});_0x12002c[_0x2af1bf(0x2c4)]((_0x112615,_0x2aac45)=>{_0x2325ad[_0x2aac45]['primary_code']=_0x112615;}),_0x1ec743['forEach']((_0x40e4aa,_0x95445b)=>{var _0x58ec86=_0x2af1bf;_0x2325ad[_0x95445b][_0x58ec86(0x26a)]=_0x40e4aa;}),_0x3a3a7f['forEach']((_0x4901d7,_0x18e47c)=>{var _0x23f7a5=_0x2af1bf;_0x2325ad[_0x18e47c][_0x23f7a5(0x22c)]=_0x4901d7;}),_0x34d156[_0x2af1bf(0x2c4)]((_0x251e90,_0x3ae677)=>{_0x2325ad[_0x3ae677]['sale_qty']=_0x251e90;}),_0x3bea76[_0x2af1bf(0x2c4)]((_0x2ef3e3,_0xc5cd27)=>{var _0x2f49a3=_0x2af1bf;_0x2325ad[_0xc5cd27][_0x2f49a3(0x2bd)]=_0x2ef3e3;}),_0x5e121d[_0x2af1bf(0x2c4)]((_0x114020,_0x3e06e4)=>{_0x2325ad[_0x3e06e4]['level']=_0x114020;}),_0x17f593[_0x2af1bf(0x2c4)]((_0x3a8b2e,_0x1fba86)=>{var _0x25ed18=_0x2af1bf,_0x385d55=_0x3a8b2e[_0x25ed18(0x276)](0x1);_0x2325ad[_0x1fba86][_0x25ed18(0x2ae)]=_0x3a8b2e[0x0],_0x2325ad[_0x1fba86][_0x25ed18(0x1f4)]=_0x385d55;}),_0x5dd420[_0x2af1bf(0x2c4)]((_0x2fd501,_0x39a120)=>{var _0x2336dd=_0x2af1bf;_0x2325ad[_0x39a120][_0x2336dd(0x22f)]=_0x2fd501;}),_0x511174['forEach']((_0x25509a,_0x222c55)=>{var _0x653b63=_0x2af1bf;_0x2325ad[_0x222c55][_0x653b63(0x218)]=_0x25509a;}),_0x15b5d3[_0x2af1bf(0x2c4)]((_0x3932dc,_0x79262e)=>{var _0x5eca26=_0x2af1bf;_0x2325ad[_0x79262e][_0x5eca26(0x27b)]=_0x3932dc;}),_0x1f4c6e['forEach']((_0x50070b,_0x9cc84e)=>{_0x2325ad[_0x9cc84e]['secondary_unit']=_0x50070b;}),_0x393ecd[_0x2af1bf(0x2c4)]((_0x55d291,_0x1acd52)=>{var _0x40d24f=_0x2af1bf;_0x2325ad[_0x1acd52][_0x40d24f(0x20a)]=_0x55d291;}),_0xd51504[_0x2af1bf(0x2c4)]((_0x25a265,_0x38f7ac)=>{_0x2325ad[_0x38f7ac]['production_date']=_0x25a265;}),_0x3db258[_0x2af1bf(0x2c4)]((_0x76844,_0x2faf7e)=>{var _0x30c85f=_0x2af1bf;_0x2325ad[_0x2faf7e][_0x30c85f(0x286)]=_0x76844;});var _0x3b1394=0x0;_0x2325ad['forEach'](_0x9f668a=>{var _0x55df96=_0x2af1bf;console[_0x55df96(0x25e)](_0x55df96(0x281),_0x9f668a),(parseInt(_0x9f668a[_0x55df96(0x2d9)])<parseInt(_0x9f668a[_0x55df96(0x2bd)])||parseInt(_0x9f668a['stock'])<parseInt(_0x9f668a[_0x55df96(0x2bd)])&&parseInt(_0x9f668a[_0x55df96(0x2d9)])>parseInt(_0x9f668a[_0x55df96(0x2bd)])||parseInt(_0x9f668a[_0x55df96(0x2bd)])==0x0)&&_0x3b1394++;});if(_0x3b1394!=0x0)return _0x594bda[_0x2af1bf(0x1f8)](_0x2af1bf(0x2ad),_0x2af1bf(0x304)),_0x3d982e[_0x2af1bf(0x27a)](_0x2af1bf(0x1fb));const _0x3599c2=await sales_finished['findOne']({'invoice':_0x5a9af8});_0x3599c2['return_data']=_0x2af1bf(0x29d);const _0x1a26f9=await _0x3599c2[_0x2af1bf(0x2e4)](),_0x52bab5=new sales_return_finished({'invoice':_0x5a9af8,'customer':_0x594bda[_0x2af1bf(0x270)][_0x2af1bf(0x1fd)],'date':_0x37ae1a,'warehouse_name':_0x22cfed,'room':_0x4fdf0d,'ToWarehouse':_0x197c3a,'ToRoom':_0x412bc9,'return_sale':_0x2325ad,'note':_0x1a40ac,'warehouse_cat':_0x426c25}),_0x427d0a=await _0x52bab5[_0x2af1bf(0x2e4)](),_0x164a0a=await sales_return_finished[_0x2af1bf(0x2fc)]({'invoice':_0x5a9af8}),_0x20c7cd=await warehouse[_0x2af1bf(0x2fc)]({'name':_0x197c3a,'room':_0x412bc9});_0x164a0a['return_sale'][_0x2af1bf(0x2c4)](_0x1ef3e4=>{var _0x240f23=_0x2af1bf,_0x5cba24=0x0;const _0xddc331=_0x20c7cd[_0x240f23(0x23c)]['map'](_0xf07af3=>{var _0x3f79c6=_0x240f23;_0xf07af3[_0x3f79c6(0x279)]==_0x1ef3e4['product_name']&&_0xf07af3['level']==_0x1ef3e4[_0x3f79c6(0x206)]&&_0xf07af3['isle']==_0x1ef3e4[_0x3f79c6(0x2ae)]&&_0xf07af3[_0x3f79c6(0x1f4)]==_0x1ef3e4[_0x3f79c6(0x1f4)]&&_0xf07af3['expiry_date']==_0x1ef3e4[_0x3f79c6(0x286)]&&_0xf07af3['production_date']==_0x1ef3e4[_0x3f79c6(0x236)]&&_0xf07af3[_0x3f79c6(0x27b)]==_0x1ef3e4[_0x3f79c6(0x27b)]&&(_0xf07af3[_0x3f79c6(0x20f)]=parseInt(_0xf07af3['product_stock'])+parseInt(_0x1ef3e4[_0x3f79c6(0x2bd)]),_0x5cba24++);});_0x5cba24=='0'&&(_0x20c7cd['product_details']=_0x20c7cd[_0x240f23(0x23c)][_0x240f23(0x2a8)]({'product_name':_0x1ef3e4[_0x240f23(0x279)],'product_stock':_0x1ef3e4[_0x240f23(0x2bd)],'primary_code':_0x1ef3e4[_0x240f23(0x282)],'secondary_code':_0x1ef3e4[_0x240f23(0x26a)],'product_code':_0x1ef3e4[_0x240f23(0x22c)],'level':_0x1ef3e4[_0x240f23(0x206)],'isle':_0x1ef3e4['isle'],'pallet':_0x1ef3e4[_0x240f23(0x1f4)],'batch_code':_0x1ef3e4[_0x240f23(0x27b)],'maxPerUnit':_0x1ef3e4['maxPerUnit'],'production_date':_0x1ef3e4[_0x240f23(0x236)],'expiry_date':_0x1ef3e4[_0x240f23(0x286)],'secondary_unit':_0x1ef3e4[_0x240f23(0x289)],'unit':_0x1ef3e4[_0x240f23(0x20a)],'maxProducts':_0x1ef3e4[_0x240f23(0x218)]}));}),await _0x20c7cd[_0x2af1bf(0x2e4)]();const _0x4dbd63=await master_shop[_0x2af1bf(0x2d4)]();console[_0x2af1bf(0x25e)](_0x2af1bf(0x2aa),_0x4dbd63[0x0][_0x2af1bf(0x214)]);const _0x145b49=await email_settings['findOne']();_0x594bda[_0x2af1bf(0x1f8)](_0x2af1bf(0x2c6),'sales\x20item\x20return\x20successfull'),_0x3d982e[_0x2af1bf(0x27a)](_0x2af1bf(0x2eb));}catch(_0x314b7c){console['log'](_0x314b7c),_0x3d982e[_0x2af1bf(0x27c)](0xc8)[_0x2af1bf(0x2e1)]({'message1':_0x314b7c[_0x2af1bf(0x1ee)]});}}}),router[a0_0x1b449e(0x2b1)](a0_0x1b449e(0x21e),auth,async(_0x508ec1,_0x401f4d)=>{var _0x3589e5=a0_0x1b449e;try{const {username:_0x487efe,email:_0x3d5ac8,role:_0x1a1de5}=_0x508ec1['user'],_0x1f4c86=_0x508ec1[_0x3589e5(0x303)],_0x80cd90=await profile['findOne']({'email':_0x1f4c86[_0x3589e5(0x2f8)]}),_0x4b4d5b=await master_shop[_0x3589e5(0x2d4)]();console[_0x3589e5(0x25e)]('barcode\x20Product\x20master',_0x4b4d5b);const _0x2b297b=_0x508ec1['params']['id'],_0x51914f=await sales[_0x3589e5(0x266)](_0x2b297b);console['log']('barcode\x20user_id',_0x51914f);if(_0x4b4d5b[0x0][_0x3589e5(0x2a9)]=='English\x20(US)')var _0x3dda0f=users[_0x3589e5(0x269)];else{if(_0x4b4d5b[0x0][_0x3589e5(0x2a9)]==_0x3589e5(0x238))var _0x3dda0f=users[_0x3589e5(0x238)];else{if(_0x4b4d5b[0x0]['language']=='German')var _0x3dda0f=users[_0x3589e5(0x224)];else{if(_0x4b4d5b[0x0][_0x3589e5(0x2a9)]==_0x3589e5(0x265))var _0x3dda0f=users[_0x3589e5(0x265)];else{if(_0x4b4d5b[0x0][_0x3589e5(0x2a9)]=='French')var _0x3dda0f=users['French'];else{if(_0x4b4d5b[0x0][_0x3589e5(0x2a9)]==_0x3589e5(0x200))var _0x3dda0f=users[_0x3589e5(0x28c)];else{if(_0x4b4d5b[0x0][_0x3589e5(0x2a9)]==_0x3589e5(0x267))var _0x3dda0f=users[_0x3589e5(0x267)];else{if(_0x4b4d5b[0x0][_0x3589e5(0x2a9)]==_0x3589e5(0x228))var _0x3dda0f=users['Arabic'];}}}}}}}_0x401f4d[_0x3589e5(0x29e)](_0x3589e5(0x210),{'success':_0x508ec1[_0x3589e5(0x1f8)](_0x3589e5(0x2c6)),'errors':_0x508ec1[_0x3589e5(0x1f8)](_0x3589e5(0x2ad)),'role':_0x1f4c86,'profile':_0x80cd90,'alldata':_0x51914f,'master_shop':_0x4b4d5b,'language':_0x3dda0f});}catch(_0x21875e){console[_0x3589e5(0x25e)](_0x21875e);}}),router[a0_0x1b449e(0x2fe)]('/barcode_scanner',async(_0x400e23,_0x4f018e)=>{var _0x4979b0=a0_0x1b449e;const {product_code:_0x47e6be,warehouse_name:_0x5e6033,rooms_data:_0x5bac7b,Roomslist:_0x3a9e74}=_0x400e23[_0x4979b0(0x270)],_0x214d1d=_0x3a9e74[_0x4979b0(0x2d8)](','),_0x5b0a6e=[];async function _0x1a2293(_0x3884d9){var _0x352005=_0x4979b0;const _0x4e078f=await warehouse[_0x352005(0x230)]([{'$match':{'name':_0x5e6033,'room':_0x3884d9}},{'$unwind':_0x352005(0x2ce)},{'$match':{'product_details.primary_code':_0x47e6be}},{'$group':{'_id':_0x352005(0x2a0),'name':{'$first':_0x352005(0x2bb)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x352005(0x2d2)},'secondary_code':{'$first':_0x352005(0x259)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x352005(0x2ef)},'isle':{'$first':_0x352005(0x263)},'pallet':{'$first':_0x352005(0x2f2)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x352005(0x2b8)},'storage':{'$first':_0x352005(0x271)},'rack':{'$first':_0x352005(0x2e0)},'expiry_date':{'$first':_0x352005(0x21d)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x352005(0x28d)},'batch_code':{'$first':_0x352005(0x20e)},'product_cat':{'$first':_0x352005(0x292)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x352005(0x20b)},'CBM':{'$first':{'$toDouble':_0x352005(0x20c)}},'invoice':{'$first':'$product_details.invoice'}}}]),_0x27c989=await warehouse['aggregate']([{'$match':{'name':_0x5e6033,'room':_0x3884d9}},{'$unwind':_0x352005(0x2ce)},{'$match':{'product_details.secondary_code':_0x47e6be}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x352005(0x2bb)},'product_stock':{'$first':_0x352005(0x2fd)},'primary_code':{'$first':_0x352005(0x2d2)},'secondary_code':{'$first':_0x352005(0x259)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x352005(0x2ef)},'isle':{'$first':_0x352005(0x263)},'pallet':{'$first':_0x352005(0x2f2)},'unit':{'$first':_0x352005(0x291)},'secondary_unit':{'$first':_0x352005(0x2b8)},'storage':{'$first':_0x352005(0x271)},'rack':{'$first':_0x352005(0x2e0)},'expiry_date':{'$first':_0x352005(0x21d)},'production_date':{'$first':_0x352005(0x2f7)},'maxPerUnit':{'$first':_0x352005(0x28d)},'batch_code':{'$first':_0x352005(0x20e)},'product_cat':{'$first':_0x352005(0x292)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x352005(0x20b)},'CBM':{'$first':{'$toDouble':_0x352005(0x20c)}},'invoice':{'$first':_0x352005(0x2c2)}}}]);if(_0x4e078f[_0x352005(0x2ff)]>0x0)_0x5b0a6e[_0x352005(0x2dd)](_0x4e078f);else _0x27c989[_0x352005(0x2ff)]>0x0&&_0x5b0a6e[_0x352005(0x2dd)](_0x27c989);}const _0x347953=_0x214d1d['map'](_0x221832=>_0x1a2293(_0x221832));await Promise[_0x4979b0(0x308)](_0x347953),_0x4f018e[_0x4979b0(0x2e1)](_0x5b0a6e);}),module[a0_0x1b449e(0x242)]=router;