var a0_0x289ad4=a0_0x5b41;(function(_0x232c0c,_0x4a79bc){var _0xe8b306=a0_0x5b41,_0x38f97e=_0x232c0c();while(!![]){try{var _0x52d01a=parseInt(_0xe8b306(0x2af))/0x1*(-parseInt(_0xe8b306(0x2a8))/0x2)+parseInt(_0xe8b306(0x20b))/0x3*(parseInt(_0xe8b306(0x1f5))/0x4)+-parseInt(_0xe8b306(0x1f3))/0x5+-parseInt(_0xe8b306(0x25f))/0x6+-parseInt(_0xe8b306(0x20e))/0x7+-parseInt(_0xe8b306(0x1ef))/0x8+parseInt(_0xe8b306(0x200))/0x9;if(_0x52d01a===_0x4a79bc)break;else _0x38f97e['push'](_0x38f97e['shift']());}catch(_0x2fc416){_0x38f97e['push'](_0x38f97e['shift']());}}}(a0_0x4c49,0xd52ac));const express=require('express'),app=express(),router=express[a0_0x289ad4(0x22b)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,email_settings,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,transfers,transfers_finished,supervisor_settings}=require(a0_0x289ad4(0x204)),auth=require(a0_0x289ad4(0x1ec)),users=require(a0_0x289ad4(0x22c)),nodemailer=require(a0_0x289ad4(0x232));router[a0_0x289ad4(0x251)]('/view',auth,async(_0x380750,_0x55d3e5)=>{var _0x153172=a0_0x289ad4;try{const {username:_0x13c766,email:_0x24cc9c,role:_0x2b5038}=_0x380750[_0x153172(0x1f2)],_0x5efb40=_0x380750[_0x153172(0x1f2)],_0x5f3be7=await profile['findOne']({'email':_0x5efb40['email']}),_0x434c76=await master_shop[_0x153172(0x22f)]();let _0x3377eb;if(_0x5efb40[_0x153172(0x263)]==_0x153172(0x2b1)){const _0x5ccf78=await staff[_0x153172(0x1fa)]({'email':_0x5efb40['email']});_0x3377eb=await transfers_finished[_0x153172(0x22f)]({'from_warehouse':_0x5ccf78[_0x153172(0x288)]});}else _0x3377eb=await transfers_finished[_0x153172(0x2ac)]([{'$unwind':_0x153172(0x274)},{'$group':{'_id':_0x153172(0x276),'invoice':{'$first':_0x153172(0x2a6)},'date':{'$first':_0x153172(0x2a2)},'from_warehouse':{'$first':_0x153172(0x256)},'to_warehouse':{'$first':_0x153172(0x229)},'from_room_name':{'$addToSet':'$product.from_room_name'},'to_room_name':{'$addToSet':_0x153172(0x1ea)},'finalize':{'$first':_0x153172(0x242)}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'from_warehouse':0x1,'to_warehouse':0x1,'from_room_name':0x1,'to_room_name':0x1,'finalize':0x1}}]);if(_0x434c76[0x0][_0x153172(0x1f9)]==_0x153172(0x257))var _0x449293=users[_0x153172(0x2c5)];else{if(_0x434c76[0x0]['language']==_0x153172(0x224))var _0x449293=users[_0x153172(0x224)];else{if(_0x434c76[0x0][_0x153172(0x1f9)]==_0x153172(0x2c0))var _0x449293=users[_0x153172(0x2c0)];else{if(_0x434c76[0x0][_0x153172(0x1f9)]==_0x153172(0x23d))var _0x449293=users[_0x153172(0x23d)];else{if(_0x434c76[0x0][_0x153172(0x1f9)]==_0x153172(0x241))var _0x449293=users['French'];else{if(_0x434c76[0x0][_0x153172(0x1f9)]==_0x153172(0x2ad))var _0x449293=users[_0x153172(0x285)];else{if(_0x434c76[0x0][_0x153172(0x1f9)]==_0x153172(0x1fe))var _0x449293=users[_0x153172(0x1fe)];else{if(_0x434c76[0x0][_0x153172(0x1f9)]=='Arabic\x20(ae)')var _0x449293=users[_0x153172(0x295)];}}}}}}}_0x55d3e5[_0x153172(0x23b)]('transfer_finished',{'success':_0x380750[_0x153172(0x2bf)]('success'),'errors':_0x380750[_0x153172(0x2bf)](_0x153172(0x2a9)),'role':_0x5efb40,'profile':_0x5f3be7,'master_shop':_0x434c76,'transfer':_0x3377eb,'language':_0x449293});}catch(_0xc82365){console['log'](_0xc82365);}});function a0_0x5b41(_0x2d4c73,_0x28520e){var _0x4c49e8=a0_0x4c49();return a0_0x5b41=function(_0x5b4104,_0x4b239e){_0x5b4104=_0x5b4104-0x1e6;var _0xa42806=_0x4c49e8[_0x5b4104];return _0xa42806;},a0_0x5b41(_0x2d4c73,_0x28520e);}async function getRandom8DigitNumber(){var _0x34b38b=a0_0x289ad4;const _0x31e8f8=0x989680,_0x44d40b=0x5f5e0ff,_0x497308=Math[_0x34b38b(0x27b)](Math[_0x34b38b(0x26a)]()*(_0x44d40b-_0x31e8f8+0x1))+_0x31e8f8;var _0x3e3ef8;const _0x5cf85a=await transfers_finished[_0x34b38b(0x1fa)]({'invoice':_0x34b38b(0x24e)+_0x497308});return _0x5cf85a&&_0x5cf85a['length']>0x0?_0x3e3ef8=_0x34b38b(0x24e)+_0x497308:_0x3e3ef8=_0x34b38b(0x24e)+_0x497308,_0x3e3ef8;}router[a0_0x289ad4(0x251)](a0_0x289ad4(0x24c),auth,async(_0x6d0fe0,_0x413995)=>{var _0x2b353b=a0_0x289ad4;try{const {username:_0x430e30,email:_0x150790,role:_0x20aefb}=_0x6d0fe0[_0x2b353b(0x1f2)],_0x1180a4=_0x6d0fe0[_0x2b353b(0x1f2)],_0x1d029b=await profile[_0x2b353b(0x1fa)]({'email':_0x1180a4['email']}),_0x1c31e4=await master_shop[_0x2b353b(0x22f)]();let _0x5d6ba8;if(_0x1180a4[_0x2b353b(0x263)]==_0x2b353b(0x2b1)){const _0x19f822=await staff['findOne']({'email':_0x1180a4[_0x2b353b(0x252)]});_0x5d6ba8=await warehouse[_0x2b353b(0x2ac)]([{'$match':{'status':_0x2b353b(0x272),'name':_0x19f822['warehouse'],'name':{'$ne':_0x2b353b(0x266)}}},{'$group':{'_id':_0x2b353b(0x222),'name':{'$first':'$name'}}}]);}else _0x5d6ba8=await warehouse['aggregate']([{'$match':{'status':_0x2b353b(0x272),'name':{'$ne':_0x2b353b(0x266)}}},{'$group':{'_id':'$name','name':{'$first':_0x2b353b(0x222)}}}]);var _0x3564dd=[_0x2b353b(0x299),_0x2b353b(0x2a7),'Return\x20Rooms'];const _0x1d7a1e=await transfers_finished['find']({}),_0x8c73af=_0x1d7a1e['length']+0x1,_0x38a489=_0x2b353b(0x24e)+_0x8c73af[_0x2b353b(0x25a)]()['padStart'](0x5,'0');if(_0x1c31e4[0x0][_0x2b353b(0x1f9)]==_0x2b353b(0x257))var _0x17967f=users['English'];else{if(_0x1c31e4[0x0][_0x2b353b(0x1f9)]==_0x2b353b(0x224))var _0x17967f=users['Hindi'];else{if(_0x1c31e4[0x0][_0x2b353b(0x1f9)]==_0x2b353b(0x2c0))var _0x17967f=users[_0x2b353b(0x2c0)];else{if(_0x1c31e4[0x0][_0x2b353b(0x1f9)]==_0x2b353b(0x23d))var _0x17967f=users[_0x2b353b(0x23d)];else{if(_0x1c31e4[0x0][_0x2b353b(0x1f9)]=='French')var _0x17967f=users[_0x2b353b(0x241)];else{if(_0x1c31e4[0x0]['language']==_0x2b353b(0x2ad))var _0x17967f=users[_0x2b353b(0x285)];else{if(_0x1c31e4[0x0]['language']==_0x2b353b(0x1fe))var _0x17967f=users[_0x2b353b(0x1fe)];else{if(_0x1c31e4[0x0][_0x2b353b(0x1f9)]==_0x2b353b(0x21d))var _0x17967f=users['Arabic'];}}}}}}}const _0x4056ce=getRandom8DigitNumber();_0x4056ce[_0x2b353b(0x235)](_0x18e6d5=>{var _0x2b9a62=_0x2b353b;_0x413995['render'](_0x2b9a62(0x290),{'success':_0x6d0fe0['flash'](_0x2b9a62(0x291)),'errors':_0x6d0fe0[_0x2b9a62(0x2bf)](_0x2b9a62(0x2a9)),'role':_0x1180a4,'profile':_0x1d029b,'master_shop':_0x1c31e4,'warehouse':_0x5d6ba8,'language':_0x17967f,'rooms_data':_0x3564dd,'invoice':_0x18e6d5});})[_0x2b353b(0x2bc)](_0x287bbc=>{var _0x1411a5=_0x2b353b;_0x6d0fe0[_0x1411a5(0x2bf)](_0x1411a5(0x2a9),_0x1411a5(0x29c)),_0x413995[_0x1411a5(0x28f)]('/transfer_finished/view');});}catch(_0x154592){console[_0x2b353b(0x294)](_0x154592);}}),router[a0_0x289ad4(0x225)](a0_0x289ad4(0x24c),auth,async(_0xac36d8,_0x368179)=>{var _0x560365=a0_0x289ad4;try{const {date:_0x2821aa,from_warehouse:_0x3f0dc4,FromRoom_name:_0x5e4e2d,to_warehouse:_0xb10575,ToRoom_name:_0x34840c,prod_name:_0x24f518,from_prod_qty:_0x1152d9,from_prod_level:_0x22c38a,from_prod_isle:_0xdd642f,from_prod_pallet:_0x4dabf8,to_prod_qty:_0x48d61a,to_prod_level:_0x474acc,to_prod_isle:_0x5892b5,to_prod_pallet:_0x516a5d,primary_code:_0x30654b,secondary_code:_0x4cf39a,product_code3:_0x2113ee,note:_0x496705,MaxStocks_data2:_0x4843ce,invoice:_0x5e384b,expiry_date:_0x734c45,PO_number:_0x57e590,ReqBy:_0x4df63a,dateofreq:_0x410df7,typeservicesData:_0x3c187b,destination:_0x8a3e88,deliverydate:_0x22b06a,driver:_0x1a5ee8,plate:_0x29ef3e,van:_0x1dd8eb,DRSI:_0x532b2b,typevehicle:_0x4a8846,TSU:_0x499e4b,TFU:_0x29531f}=_0xac36d8['body'];if(typeof _0x24f518==_0x560365(0x211))var _0x31dbec=[_0xac36d8[_0x560365(0x269)][_0x560365(0x240)]],_0x3a2b7b=[_0xac36d8['body'][_0x560365(0x1ff)]],_0x148eca=[_0xac36d8[_0x560365(0x269)][_0x560365(0x233)]],_0x58f217=[_0xac36d8[_0x560365(0x269)]['from_prod_leveling']],_0x4c0682=[_0xac36d8[_0x560365(0x269)]['New_Qty_Converted']],_0x4cdce9=[_0xac36d8[_0x560365(0x269)]['to_prod_level']],_0x1ec520=[_0xac36d8['body'][_0x560365(0x254)]],_0x36cec5=[_0xac36d8[_0x560365(0x269)][_0x560365(0x26e)]],_0x3e153a=[_0xac36d8['body'][_0x560365(0x23f)]],_0x39f894=[_0xac36d8[_0x560365(0x269)][_0x560365(0x1fd)]],_0x4f5fde=[_0xac36d8[_0x560365(0x269)][_0x560365(0x1f6)]],_0x194fcc=[_0xac36d8['body'][_0x560365(0x230)]],_0x301b77=[_0xac36d8['body'][_0x560365(0x287)]],_0x11a3c9=[_0xac36d8['body'][_0x560365(0x208)]],_0x23cf08=[_0xac36d8[_0x560365(0x269)][_0x560365(0x2aa)]],_0x1099b5=[_0xac36d8[_0x560365(0x269)]['product_date']],_0x44d937=[_0xac36d8['body'][_0x560365(0x25e)]],_0xe98f5b=[_0xac36d8['body'][_0x560365(0x259)]],_0x4b8dee=[_0xac36d8[_0x560365(0x269)][_0x560365(0x202)]],_0x403011=[_0xac36d8[_0x560365(0x269)][_0x560365(0x27f)]],_0x1b9f23=[_0xac36d8[_0x560365(0x269)][_0x560365(0x205)]],_0x1dc655=[_0xac36d8[_0x560365(0x269)][_0x560365(0x21f)]],_0x2bed13=[_0xac36d8[_0x560365(0x269)][_0x560365(0x237)]],_0x596222=[_0xac36d8[_0x560365(0x269)][_0x560365(0x253)]];else var _0x31dbec=[..._0xac36d8['body'][_0x560365(0x240)]],_0x3a2b7b=[..._0xac36d8[_0x560365(0x269)][_0x560365(0x1ff)]],_0x148eca=[..._0xac36d8[_0x560365(0x269)]['from_prod_level']],_0x58f217=[..._0xac36d8[_0x560365(0x269)][_0x560365(0x1ee)]],_0x4c0682=[..._0xac36d8[_0x560365(0x269)][_0x560365(0x28b)]],_0x4cdce9=[..._0xac36d8['body'][_0x560365(0x2bb)]],_0x1ec520=[..._0xac36d8[_0x560365(0x269)]['type']],_0x36cec5=[..._0xac36d8[_0x560365(0x269)][_0x560365(0x26e)]],_0x3e153a=[..._0xac36d8[_0x560365(0x269)]['secondary_code']],_0x39f894=[..._0xac36d8[_0x560365(0x269)][_0x560365(0x1fd)]],_0x4f5fde=[..._0xac36d8[_0x560365(0x269)]['MaxStocks_data2']],_0x194fcc=[..._0xac36d8[_0x560365(0x269)]['primary_unit']],_0x301b77=[..._0xac36d8[_0x560365(0x269)][_0x560365(0x287)]],_0x11a3c9=[..._0xac36d8[_0x560365(0x269)]['batch_code']],_0x23cf08=[..._0xac36d8[_0x560365(0x269)][_0x560365(0x2aa)]],_0x1099b5=[..._0xac36d8['body'][_0x560365(0x228)]],_0x44d937=[..._0xac36d8['body'][_0x560365(0x25e)]],_0xe98f5b=[..._0xac36d8[_0x560365(0x269)]['maxPerUnit']],_0x4b8dee=[..._0xac36d8[_0x560365(0x269)][_0x560365(0x202)]],_0x403011=[..._0xac36d8[_0x560365(0x269)]['RoomAssigned']],_0x1b9f23=[..._0xac36d8[_0x560365(0x269)][_0x560365(0x205)]],_0x1dc655=[..._0xac36d8[_0x560365(0x269)]['CBM']],_0x2bed13=[..._0xac36d8['body'][_0x560365(0x237)]],_0x596222=[..._0xac36d8[_0x560365(0x269)]['to_invoice']];const _0x3243ca=_0x31dbec[_0x560365(0x28e)](_0x497571=>{return _0x497571={'product_name':_0x497571};});_0x3a2b7b[_0x560365(0x279)]((_0x242ecc,_0x56fbf0)=>{_0x3243ca[_0x56fbf0]['from_quantity']=_0x242ecc;}),_0x2bed13[_0x560365(0x279)]((_0x26af4e,_0x28a9c7)=>{_0x3243ca[_0x28a9c7]['from_invoice']=_0x26af4e;}),_0x596222[_0x560365(0x279)]((_0x5b7b6d,_0x3970eb)=>{var _0x54403b=_0x560365;_0x3243ca[_0x3970eb][_0x54403b(0x253)]=_0x5b7b6d;}),_0x148eca[_0x560365(0x279)]((_0x35635d,_0x1660bd)=>{var _0x37306f=_0x560365,_0x47deca=_0x35635d[_0x37306f(0x28a)](0x1);_0x3243ca[_0x1660bd]['from_isle']=_0x35635d[0x0],_0x3243ca[_0x1660bd][_0x37306f(0x217)]=_0x47deca;}),_0x58f217[_0x560365(0x279)]((_0x17f2d7,_0x3bc201)=>{var _0x739cc4=_0x560365;_0x3243ca[_0x3bc201][_0x739cc4(0x268)]=_0x17f2d7;}),_0x4c0682[_0x560365(0x279)]((_0x504a95,_0x59fb57)=>{_0x3243ca[_0x59fb57]['to_quantity']=_0x504a95;}),_0x4cdce9[_0x560365(0x279)]((_0x5685e9,_0x2fa2c0)=>{var _0x1a697b=_0x560365,_0x113c7d=_0x5685e9[_0x1a697b(0x28a)](0x1);_0x3243ca[_0x2fa2c0][_0x1a697b(0x1f7)]=_0x5685e9[0x0],_0x3243ca[_0x2fa2c0]['to_pallet']=_0x113c7d;}),_0x1ec520['forEach']((_0xac8dc,_0x4cd131)=>{_0x3243ca[_0x4cd131]['to_level']=_0xac8dc;}),_0x36cec5[_0x560365(0x279)]((_0x505bc2,_0x39b6f4)=>{var _0x11e2a8=_0x560365;_0x3243ca[_0x39b6f4][_0x11e2a8(0x26e)]=_0x505bc2;}),_0x3e153a[_0x560365(0x279)]((_0x4b153d,_0x3b98cc)=>{var _0xa6421a=_0x560365;_0x3243ca[_0x3b98cc][_0xa6421a(0x23f)]=_0x4b153d;}),_0x39f894[_0x560365(0x279)]((_0x55fc2c,_0x4f1918)=>{_0x3243ca[_0x4f1918]['product_code']=_0x55fc2c;}),_0x4f5fde[_0x560365(0x279)]((_0x184a02,_0x3e62ef)=>{var _0x46e5fd=_0x560365;_0x3243ca[_0x3e62ef][_0x46e5fd(0x2c3)]=_0x184a02;}),_0x194fcc[_0x560365(0x279)]((_0x38e697,_0x146590)=>{_0x3243ca[_0x146590]['unit']=_0x38e697;}),_0x301b77[_0x560365(0x279)]((_0x2dd640,_0x12980d)=>{var _0x135e67=_0x560365;_0x3243ca[_0x12980d][_0x135e67(0x287)]=_0x2dd640;}),_0x11a3c9[_0x560365(0x279)]((_0x35839b,_0x1f8272)=>{var _0x2c9f2d=_0x560365;_0x3243ca[_0x1f8272][_0x2c9f2d(0x208)]=_0x35839b;}),_0x23cf08[_0x560365(0x279)]((_0x1c2493,_0x53c565)=>{var _0x199942=_0x560365;_0x3243ca[_0x53c565][_0x199942(0x2aa)]=_0x1c2493;}),_0x1099b5['forEach']((_0x3222fd,_0x43c244)=>{_0x3243ca[_0x43c244]['production_date']=_0x3222fd;}),_0x44d937['forEach']((_0x30ad8d,_0x197efe)=>{var _0x3caa1f=_0x560365;_0x3243ca[_0x197efe][_0x3caa1f(0x2c3)]=_0x30ad8d;}),_0xe98f5b['forEach']((_0x2d9693,_0x1bd04e)=>{var _0xffd123=_0x560365;_0x3243ca[_0x1bd04e][_0xffd123(0x259)]=_0x2d9693;}),_0x4b8dee[_0x560365(0x279)]((_0x16bd7a,_0x24d9a7)=>{var _0x8c585b=_0x560365;_0x3243ca[_0x24d9a7][_0x8c585b(0x202)]=_0x16bd7a;}),_0x403011[_0x560365(0x279)]((_0x3cb2c5,_0x4efd77)=>{var _0x48ae46=_0x560365;_0x3243ca[_0x4efd77][_0x48ae46(0x243)]=_0x3cb2c5;}),_0x1b9f23['forEach']((_0x517974,_0x5e1b5f)=>{_0x3243ca[_0x5e1b5f]['to_room_name']=_0x517974;}),_0x1dc655[_0x560365(0x279)]((_0x43a702,_0x23eba5)=>{var _0x5379c2=_0x560365;_0x3243ca[_0x23eba5][_0x5379c2(0x21f)]=_0x43a702;});const _0x3124e2=_0x3243ca[_0x560365(0x1f4)](_0x4103a5=>_0x4103a5['to_quantity']!=='0'&&_0x4103a5[_0x560365(0x265)]!==''||_0x4103a5[_0x560365(0x236)]!=='0'&&_0x4103a5[_0x560365(0x236)]!=='');var _0x22804f=0x0;_0x3124e2['forEach'](_0x163f18=>{var _0x278d88=_0x560365;parseInt(_0x163f18[_0x278d88(0x227)])<parseInt(_0x163f18[_0x278d88(0x265)])&&_0x22804f++;});if(_0x22804f!=0x0)return _0xac36d8[_0x560365(0x2bf)](_0x560365(0x2a9),_0x560365(0x261)),_0x368179[_0x560365(0x28f)](_0x560365(0x21a));const _0x54512a=new transfers_finished({'date':_0x2821aa,'from_warehouse':_0x3f0dc4,'to_warehouse':_0xb10575,'product':_0x3124e2,'note':_0x496705,'invoice':_0x5e384b,'PO_number':_0x57e590,'RequestedBy':_0x4df63a,'DateofRequest':_0x410df7,'typeservices':_0x3c187b,'destination':_0x8a3e88,'deliverydate':_0x22b06a,'driver':_0x1a5ee8,'plate':_0x29ef3e,'van':_0x1dd8eb,'DRSI':_0x532b2b,'typevehicle':_0x4a8846,'TSU':_0x499e4b,'TFU':_0x29531f}),_0x1fd9b0=await _0x54512a[_0x560365(0x231)]();_0xac36d8[_0x560365(0x2bf)](_0x560365(0x291),_0x560365(0x209)),_0x368179[_0x560365(0x28f)](_0x560365(0x2be)+_0x1fd9b0['_id']);}catch(_0x14ce3c){console['log'](_0x14ce3c),_0x368179['status'](0xc8)[_0x560365(0x1eb)]({'errorMessage':_0x14ce3c[_0x560365(0x282)]});}}),router[a0_0x289ad4(0x251)](a0_0x289ad4(0x201),auth,async(_0x2829bb,_0x4907b0)=>{var _0xdec692=a0_0x289ad4;try{const {username:_0x1e300d,email:_0x2316f5,role:_0x21db5b}=_0x2829bb['user'],_0x4a58db=_0x2829bb[_0xdec692(0x1f2)],_0x22c345=await profile[_0xdec692(0x1fa)]({'email':_0x4a58db[_0xdec692(0x252)]}),_0x299b6b=await master_shop['find'](),_0x90b8bd=await transfers_finished[_0xdec692(0x24a)](_0x2829bb[_0xdec692(0x27e)]['id']);let _0x3b64b1;if(_0x4a58db[_0xdec692(0x263)]=='staff'){const _0x3a59c0=await staff[_0xdec692(0x1fa)]({'email':_0x4a58db[_0xdec692(0x252)]});_0x3b64b1=await warehouse[_0xdec692(0x22f)]({'status':'Enabled','name':_0x3a59c0['warehouse']});}else _0x3b64b1=await warehouse['find']({'status':'Enabled'});const _0x44a791=await warehouse[_0xdec692(0x2ac)]([{'$match':{'name':_0x90b8bd[_0xdec692(0x280)]}},{'$unwind':_0xdec692(0x250)},{'$group':{'_id':_0xdec692(0x221),'name':{'$first':_0xdec692(0x278)},'product_stock':{'$first':_0xdec692(0x292)},'level':{'$first':_0xdec692(0x2b0)},'isle':{'$first':_0xdec692(0x223)},'pallet':{'$first':_0xdec692(0x29a)},'primary_code':{'$first':_0xdec692(0x2c1)},'secondary_code':{'$first':_0xdec692(0x21e)},'product_code':{'$first':_0xdec692(0x29b)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0xdec692(0x289)},'expiry_date':{'$first':_0xdec692(0x21b)},'production_date':{'$first':_0xdec692(0x2b8)},'room':{'$first':_0xdec692(0x234)},'warehoue_name':{'$first':_0xdec692(0x222)}}}]),_0x1d0983=await product[_0xdec692(0x22f)]({});if(_0x299b6b[0x0][_0xdec692(0x1f9)]==_0xdec692(0x257)){var _0x478ccd=users[_0xdec692(0x2c5)];console['log'](_0x478ccd);}else{if(_0x299b6b[0x0][_0xdec692(0x1f9)]=='Hindi')var _0x478ccd=users['Hindi'];else{if(_0x299b6b[0x0][_0xdec692(0x1f9)]==_0xdec692(0x2c0))var _0x478ccd=users[_0xdec692(0x2c0)];else{if(_0x299b6b[0x0]['language']=='Spanish')var _0x478ccd=users['Spanish'];else{if(_0x299b6b[0x0]['language']==_0xdec692(0x241))var _0x478ccd=users[_0xdec692(0x241)];else{if(_0x299b6b[0x0][_0xdec692(0x1f9)]==_0xdec692(0x2ad))var _0x478ccd=users[_0xdec692(0x285)];else{if(_0x299b6b[0x0][_0xdec692(0x1f9)]==_0xdec692(0x1fe))var _0x478ccd=users[_0xdec692(0x1fe)];else{if(_0x299b6b[0x0][_0xdec692(0x1f9)]==_0xdec692(0x21d))var _0x478ccd=users[_0xdec692(0x295)];}}}}}}}_0x4907b0[_0xdec692(0x23b)]('edit_transfer_finished_view',{'success':_0x2829bb['flash'](_0xdec692(0x291)),'errors':_0x2829bb[_0xdec692(0x2bf)](_0xdec692(0x2a9)),'role':_0x4a58db,'profile':_0x22c345,'master_shop':_0x299b6b,'warehouse':_0x3b64b1,'transfer':_0x90b8bd,'stock':_0x44a791,'unit':_0x1d0983,'language':_0x478ccd});}catch(_0x4f64ee){console[_0xdec692(0x294)](_0x4f64ee);}}),router[a0_0x289ad4(0x225)](a0_0x289ad4(0x201),auth,async(_0x306625,_0x8392b3)=>{var _0x4b94d3=a0_0x289ad4;try{const {invoice:_0x37df96,from_warehouse:_0x5c9f82,FromRoom_name:_0xb49c35,to_warehouse:_0x543cbf,ToRoom_name:_0x32fbed}=_0x306625[_0x4b94d3(0x269)],_0x55453f=await transfers_finished['findById'](_0x306625[_0x4b94d3(0x27e)]['id']),_0x4fdeaa=_0x55453f[_0x4b94d3(0x283)]['map'](async _0x302f32=>{var _0x4b34da=_0x4b94d3;if(_0x302f32['to_quantity']>0x0){var _0x4f4c31=await warehouse['findOne']({'name':_0x5c9f82,'room':_0x302f32['from_room_name']});const _0x46a7b3=_0x4f4c31[_0x4b34da(0x20a)][_0x4b34da(0x28e)](_0xd8bfc9=>{var _0x139e09=_0x4b34da;_0xd8bfc9[_0x139e09(0x2ab)]==_0x302f32['product_name']&&_0xd8bfc9[_0x139e09(0x2a5)]==_0x302f32[_0x139e09(0x268)]&&_0xd8bfc9[_0x139e09(0x23a)]==_0x302f32[_0x139e09(0x248)]&&_0xd8bfc9[_0x139e09(0x2a4)]==_0x302f32['from_pallet']&&_0xd8bfc9[_0x139e09(0x2aa)]==_0x302f32[_0x139e09(0x2aa)]&&_0xd8bfc9[_0x139e09(0x2b5)]==_0x302f32[_0x139e09(0x2b5)]&&_0xd8bfc9[_0x139e09(0x208)]==_0x302f32[_0x139e09(0x208)]&&_0xd8bfc9[_0x139e09(0x29d)]==_0x302f32[_0x139e09(0x237)]&&(_0xd8bfc9['product_stock']=_0xd8bfc9['product_stock']-_0x302f32[_0x139e09(0x265)]);});}return _0x4f4c31;});Promise[_0x4b94d3(0x210)](_0x4fdeaa)[_0x4b94d3(0x235)](async _0x2fe913=>{var _0x29bf2c=_0x4b94d3;try{for(const _0x2e6723 of _0x2fe913){await _0x2e6723[_0x29bf2c(0x231)]();}const _0xbb9fd7=_0x55453f[_0x29bf2c(0x283)]['map'](async _0x4cb514=>{var _0x10761f=_0x29bf2c,_0x5edbbf=await warehouse['findOne']({'name':_0x543cbf,'room':_0x4cb514[_0x10761f(0x247)]});if(_0x4cb514[_0x10761f(0x265)]>0x0){var _0x1539c9=0x0;const _0x25b83a=_0x5edbbf[_0x10761f(0x20a)][_0x10761f(0x28e)](_0x5ea484=>{var _0xabb82e=_0x10761f;_0x5ea484[_0xabb82e(0x2ab)]==_0x4cb514[_0xabb82e(0x2ab)]&&_0x5ea484['level']==_0x4cb514['to_level']&&_0x5ea484[_0xabb82e(0x23a)]==_0x4cb514['to_isle']&&_0x5ea484[_0xabb82e(0x2a4)]==_0x4cb514[_0xabb82e(0x214)]&&_0x5ea484['expiry_date']==_0x4cb514[_0xabb82e(0x2aa)]&&_0x5ea484[_0xabb82e(0x2b5)]==_0x4cb514['production_date']&&_0x5ea484[_0xabb82e(0x208)]==_0x4cb514[_0xabb82e(0x208)]&&_0x5ea484[_0xabb82e(0x29d)]==_0x4cb514[_0xabb82e(0x253)]&&(_0x5ea484['product_stock']=_0x5ea484['product_stock']+_0x4cb514['to_quantity'],_0x1539c9++);});_0x1539c9=='0'&&(_0x5edbbf['product_details']=_0x5edbbf[_0x10761f(0x20a)][_0x10761f(0x2b6)]({'product_name':_0x4cb514[_0x10761f(0x2ab)],'product_stock':_0x4cb514['to_quantity'],'level':_0x4cb514['to_level'],'isle':_0x4cb514[_0x10761f(0x1f7)],'pallet':_0x4cb514[_0x10761f(0x214)],'product_code':_0x4cb514[_0x10761f(0x27d)],'primary_code':_0x4cb514[_0x10761f(0x26e)],'secondary_code':_0x4cb514[_0x10761f(0x23f)],'expiry_date':_0x4cb514[_0x10761f(0x2aa)],'production_date':_0x4cb514[_0x10761f(0x2b5)],'maxProducts':_0x4cb514[_0x10761f(0x2c3)],'batch_code':_0x4cb514[_0x10761f(0x208)],'secondary_unit':_0x4cb514['secondary_unit'],'unit':_0x4cb514['unit'],'maxProducts':_0x4cb514['maxProducts'],'maxPerUnit':_0x4cb514[_0x10761f(0x259)],'CBM':_0x4cb514[_0x10761f(0x21f)]}));}return _0x5edbbf;});Promise[_0x29bf2c(0x210)](_0xbb9fd7)[_0x29bf2c(0x235)](async _0x16846e=>{var _0x1f1bb6=_0x29bf2c;try{for(const _0x252c50 of _0x16846e){await warehouse[_0x1f1bb6(0x207)]({'_id':_0x252c50[_0x1f1bb6(0x245)]},{'$addToSet':{'product_details':{'$each':_0x252c50['product_details']}}});}_0x55453f[_0x1f1bb6(0x24f)]=_0x1f1bb6(0x26f);const _0x13de22=await _0x55453f['save']();var _0x37f89a=_0x55453f['product'];const _0x1e0e95=await master_shop['find'](),_0x598142=await email_settings['findOne'](),_0x3e8847=await supervisor_settings[_0x1f1bb6(0x22f)]();let _0xf72368=nodemailer[_0x1f1bb6(0x24b)]({'host':_0x598142[_0x1f1bb6(0x281)],'port':Number(_0x598142[_0x1f1bb6(0x238)]),'secure':![],'auth':{'user':_0x598142[_0x1f1bb6(0x252)],'pass':_0x598142[_0x1f1bb6(0x296)]}});var _0x5115e9='',_0x3daea8;for(_0x3daea8 in _0x37f89a){_0x5115e9+=_0x1f1bb6(0x22e)+_0x1f1bb6(0x212)+_0x37f89a[_0x3daea8][_0x1f1bb6(0x2ab)]+_0x1f1bb6(0x220)+_0x1f1bb6(0x212)+_0x37f89a[_0x3daea8][_0x1f1bb6(0x265)]+_0x1f1bb6(0x220)+_0x1f1bb6(0x212)+_0x37f89a[_0x3daea8][_0x1f1bb6(0x247)]+_0x1f1bb6(0x220)+_0x1f1bb6(0x212)+_0x37f89a[_0x3daea8][_0x1f1bb6(0x25d)]+_0x1f1bb6(0x220)+_0x1f1bb6(0x212)+_0x37f89a[_0x3daea8][_0x1f1bb6(0x1f7)]+_0x37f89a[_0x3daea8][_0x1f1bb6(0x214)]+_0x1f1bb6(0x220)+_0x1f1bb6(0x273);}let _0x4711fb={'from':_0x598142['email'],'to':_0x3e8847[0x0][_0x1f1bb6(0x2b3)],'subject':_0x1f1bb6(0x264),'attachments':[{'filename':'Logo.png','path':__dirname+_0x1f1bb6(0x28c)+'/upload/'+_0x1e0e95[0x0][_0x1f1bb6(0x20c)],'cid':_0x1f1bb6(0x271)}],'html':_0x1f1bb6(0x206)+'<html><head><title></title>'+_0x1f1bb6(0x26b)+_0x1f1bb6(0x293)+_0x1f1bb6(0x2a1)+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x1f1bb6(0x2b4)+_0x1f1bb6(0x293)+'<h2>\x20'+_0x1e0e95[0x0][_0x1f1bb6(0x1fb)]+_0x1f1bb6(0x246)+_0x1f1bb6(0x2b4)+'</div>'+_0x1f1bb6(0x1e6)+_0x1f1bb6(0x293)+_0x1f1bb6(0x1f1)+_0x1f1bb6(0x267)+_0x55453f[_0x1f1bb6(0x29d)]+'\x20'+_0x1f1bb6(0x1e7)+'\x20Order\x20Date\x20:\x20'+_0x55453f[_0x1f1bb6(0x298)]+'\x20'+_0x1f1bb6(0x258)+'</h5>'+'</div>'+_0x1f1bb6(0x29e)+_0x1f1bb6(0x25c)+_0x1f1bb6(0x22e)+_0x1f1bb6(0x26c)+_0x1f1bb6(0x23c)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room\x20</th>'+_0x1f1bb6(0x2a0)+_0x1f1bb6(0x2b7)+'</tr>'+'</thead>'+_0x1f1bb6(0x277)+'\x20'+_0x5115e9+'\x20'+'</tbody>'+_0x1f1bb6(0x29f)+_0x1f1bb6(0x293)+'<strong>\x20Regards\x20</strong>'+_0x1f1bb6(0x2ae)+_0x1e0e95[0x0]['site_title']+'</h5>'+_0x1f1bb6(0x2b4)+_0x1f1bb6(0x2b4)+_0x1f1bb6(0x286)};_0xf72368['sendMail'](_0x4711fb,function(_0x485ece,_0x50bc1c){var _0x18da11=_0x1f1bb6;_0x485ece?(console['log'](_0x485ece),console[_0x18da11(0x294)](_0x18da11(0x2a3))):console['log']('Email\x20sent\x20successfully');}),_0x306625[_0x1f1bb6(0x2bf)]('success',_0x1f1bb6(0x20d)),_0x8392b3[_0x1f1bb6(0x28f)](_0x1f1bb6(0x2c2)+_0x13de22[_0x1f1bb6(0x245)]);}catch(_0x2ede51){console[_0x1f1bb6(0x1ed)](_0x2ede51),_0x8392b3[_0x1f1bb6(0x28d)](0x1f4)[_0x1f1bb6(0x1eb)]({'error':_0x1f1bb6(0x270)});}})['catch'](_0xd88aa8=>{var _0x497d78=_0x29bf2c;console['error'](_0xd88aa8),_0x8392b3[_0x497d78(0x28d)](0x1f4)[_0x497d78(0x1eb)]({'error':_0x497d78(0x275)});});}catch(_0x2845ad){console[_0x29bf2c(0x1ed)](_0x2845ad),_0x8392b3[_0x29bf2c(0x28d)](0x1f4)[_0x29bf2c(0x1eb)]({'error':_0x29bf2c(0x1f8)});}})[_0x4b94d3(0x2bc)](_0x6c8232=>{var _0x144960=_0x4b94d3;console[_0x144960(0x1ed)](_0x6c8232),_0x8392b3[_0x144960(0x28d)](0x1f4)[_0x144960(0x1eb)]({'error':_0x144960(0x275)});});}catch(_0x499b78){_0x8392b3[_0x4b94d3(0x1eb)]({'message':_0x499b78['message']});}});function a0_0x4c49(){var _0xcac6ab=['$product_details.product_stock','<div>','log','Arabic','password','$product_details.secondary_unit','date','Ambient','$product_details.pallet','$product_details.product_code','There\x27s\x20a\x20error\x20in\x20this\x20transaction','invoice','<table\x20style=\x22width:\x20100%\x20!important;\x22>','</table>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Level\x20</th>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$date','Error\x20Occurs','pallet','level','$invoice','Enclosed','92eQBfAs','errors','expiry_date','product_name','aggregate','Portuguese\x20(BR)','<h5>','7952XUuLJb','$product_details.level','staff','to_warehouse','RMSEmail','</div>','production_date','concat','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','$product_details.production_date','Rack\x202','exports','to_prod_level','catch','$product_details.maxPerUnit','/transfer_finished/preview/','flash','German','$product_details.primary_code','/picking_list/PDF_transferFinal/','maxProducts','getDate','English','<hr\x20class=\x22my-3\x22>','<span\x20style=\x22float:\x20right;\x22>','getMonth','to_room','$product.to_room_name','json','../middleware/auth','error','from_prod_leveling','11547112BVdKyw','/barcode_scanner3','<h5\x20style=\x22text-align:\x20left;\x22>','user','8282145ZVlGHP','filter','1903988DuuWmB','MaxStocks_data2','to_isle','An\x20error\x20occurred\x20while\x20saving\x20data.','language','findOne','site_title','from_bay','product_code3','Chinese','from_prod_qty','53750619SWSwTu','/preview/:id','prod_cat','$product_details.unit','../models/all_models','ToRoomAssigned','<!DOCTYPE\x20html>','updateOne','batch_code','Product\x20Transfer\x20successfully','product_details','6hgiCfC','image','Transfer\x20Finalize\x20Successfully','9580613GEcmpE','split','all','string','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','bay','to_pallet','transfer_data','/CheckingWarehouse','from_pallet','/view/:id','unit','back','$product_details.expiry_date','to_bay','Arabic\x20(ae)','$product_details.secondary_code','CBM','</td>','$product_details._id','$name','$product_details.isle','Hindi','post','to_prod_qty','from_quantity','product_date','$to_warehouse','product_stock','Router','../public/language/languages.json','/barcode_scanner','<tr>','find','primary_unit','save','nodemailer','from_prod_level','$room','then','to_floorlevel','from_invoice','port','from_room','isle','render','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Quantity\x20</th>','Spanish','$product_details.batch_code','secondary_code','prod_name','French','$finalize','from_room_name','$product_details.CBM','_id','\x20</h2>','to_room_name','from_isle','push','findById','createTransport','/view/add_transfer','getFullYear','TRF-','finalize','$product_details','get','email','to_invoice','type','Rack\x201','$from_warehouse','English\x20(US)','</span>','maxPerUnit','toString','$product_details.storage','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','to_level','MaxStocks_data','7301304PbMswU','Transfer\x20Edit\x20Successfully','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','/transfer_finished/view','role','Transfer\x20Product\x20Mail','to_quantity','QA\x20Warehouse','\x20Order\x20Number\x20:\x20','from_level','body','random','</head><body>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$product_details.maxProducts','primary_code','True','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','logo','Enabled','</tr>','$product','An\x20error\x20occurred.','$_id','<tbody\x20style=\x22text-align:\x20center;\x22>','$product_details.product_name','forEach','Finished\x20Goods','floor','$product_details.invoice','product_code','params','RoomAssigned','from_warehouse','host','message','product','edit_transfer_finished','Portuguese','</body></html>','secondary_unit','warehouse','$product_details.rack','slice','New_Qty_Converted','/../public','status','map','redirect','add_transfer_finished','success'];a0_0x4c49=function(){return _0xcac6ab;};return a0_0x4c49();}function BayBinSelected(_0x8a35b4,_0x471638){var _0x2a3f7f=a0_0x289ad4,_0x372ee7=[];let _0x39f38a=[];var _0x41f72d=[];if(_0x8a35b4=='DRY\x20GOODS'){switch(_0x471638){case _0x2a3f7f(0x255):_0x372ee7=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x2a3f7f(0x2b9):_0x372ee7=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x41f72d=['DG'];}else{if(_0x8a35b4=='FROZEN\x20GOODS'){switch(_0x471638){case'Rack\x201':_0x372ee7=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x2a3f7f(0x2b9):_0x372ee7=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x41f72d=['FG'];}}return{'levels':_0x372ee7,'identify':_0x41f72d};}router['get']('/view/:id',auth,async(_0xf120db,_0x37ca97)=>{var _0x15a591=a0_0x289ad4;try{const {username:_0x45556a,email:_0x457e67,role:_0x53c9e6}=_0xf120db[_0x15a591(0x1f2)],_0x1dd048=_0xf120db[_0x15a591(0x1f2)],_0x37700d=await profile['findOne']({'email':_0x1dd048['email']}),_0x49fb3e=await master_shop[_0x15a591(0x22f)](),_0x2d58aa=await transfers_finished[_0x15a591(0x24a)](_0xf120db[_0x15a591(0x27e)]['id']);let _0xac8121=new Date(_0x2d58aa[_0x15a591(0x2aa)]),_0x1a0d59=('0'+_0xac8121[_0x15a591(0x2c4)]())[_0x15a591(0x28a)](-0x2),_0x1e98a7=('0'+(_0xac8121[_0x15a591(0x1e8)]()+0x1))['slice'](-0x2),_0x349c7f=_0xac8121[_0x15a591(0x24d)](),_0x4d46f2=_0x349c7f+'-'+_0x1e98a7+'-'+_0x1a0d59,_0x5a4caf;if(_0x1dd048[_0x15a591(0x263)]==_0x15a591(0x2b1)){const _0xec55f2=await staff[_0x15a591(0x1fa)]({'email':_0x1dd048['email']});_0x5a4caf=await warehouse[_0x15a591(0x22f)]({'status':_0x15a591(0x272),'name':_0xec55f2[_0x15a591(0x288)],'warehouse_category':_0x15a591(0x27a)});}else _0x5a4caf=await warehouse[_0x15a591(0x22f)]({'status':_0x15a591(0x272),'warehouse_category':_0x15a591(0x27a)});const _0x2528f8=await warehouse[_0x15a591(0x2ac)]([{'$match':{'name':_0x2d58aa['from_warehouse'],'room':_0x2d58aa[_0x15a591(0x239)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x15a591(0x221),'name':{'$first':_0x15a591(0x278)},'product_stock':{'$first':_0x15a591(0x292)},'level':{'$first':_0x15a591(0x2b0)},'isle':{'$first':_0x15a591(0x223)},'pallet':{'$first':_0x15a591(0x29a)},'primary_code':{'$first':_0x15a591(0x2c1)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x15a591(0x29b)},'storage':{'$first':_0x15a591(0x25b)},'rack':{'$first':_0x15a591(0x289)}}}]);var _0x1e9be6=[0x1,0x2,0x3,0x4],_0x431784=['A','B','C','D','E','F','G','H','I','J'],_0x341826=[_0x15a591(0x299),'Enclosed'];const _0x234fea=await product['find']({}),_0x4c873a=BayBinSelected(_0x2d58aa[_0x15a591(0x2b2)],_0x2d58aa[_0x15a591(0x1e9)]);if(_0x49fb3e[0x0]['language']==_0x15a591(0x257)){var _0x5984cd=users[_0x15a591(0x2c5)];console['log'](_0x5984cd);}else{if(_0x49fb3e[0x0][_0x15a591(0x1f9)]==_0x15a591(0x224))var _0x5984cd=users[_0x15a591(0x224)];else{if(_0x49fb3e[0x0]['language']==_0x15a591(0x2c0))var _0x5984cd=users[_0x15a591(0x2c0)];else{if(_0x49fb3e[0x0][_0x15a591(0x1f9)]=='Spanish')var _0x5984cd=users[_0x15a591(0x23d)];else{if(_0x49fb3e[0x0][_0x15a591(0x1f9)]==_0x15a591(0x241))var _0x5984cd=users[_0x15a591(0x241)];else{if(_0x49fb3e[0x0][_0x15a591(0x1f9)]==_0x15a591(0x2ad))var _0x5984cd=users['Portuguese'];else{if(_0x49fb3e[0x0][_0x15a591(0x1f9)]==_0x15a591(0x1fe))var _0x5984cd=users['Chinese'];else{if(_0x49fb3e[0x0][_0x15a591(0x1f9)]==_0x15a591(0x21d))var _0x5984cd=users[_0x15a591(0x295)];}}}}}}}_0x37ca97[_0x15a591(0x23b)](_0x15a591(0x284),{'success':_0xf120db['flash'](_0x15a591(0x291)),'errors':_0xf120db['flash'](_0x15a591(0x2a9)),'role':_0x1dd048,'profile':_0x37700d,'master_shop':_0x49fb3e,'warehouse':_0x5a4caf,'transfer':_0x2d58aa,'stock':_0x2528f8,'unit':_0x234fea,'language':_0x5984cd,'levels':_0x1e9be6,'Isle':_0x431784,'rooms_data':_0x341826,'ed_fullDate':_0x4d46f2,'dataSelected':_0x4c873a});}catch(_0x1a6038){console['log'](_0x1a6038);}}),router[a0_0x289ad4(0x225)](a0_0x289ad4(0x218),auth,async(_0x178179,_0x4fea35)=>{var _0x12fc0e=a0_0x289ad4;try{const _0x27d44d=_0x178179[_0x12fc0e(0x27e)]['id'];console['log'](_0x178179[_0x12fc0e(0x269)]);const _0x174843=await transfers_finished['findById'](_0x27d44d);console[_0x12fc0e(0x294)](_0x12fc0e(0x215),_0x174843);const {date:_0x492363,from_warehouse:_0x4cc2e1,FromRoom_name:_0x3ef867,to_warehouse:_0x1448fe,ToRoom_name:_0x461081,prod_name:_0x48812c,from_prod_qty:_0xfdd411,from_prod_level:_0x377deb,from_prod_isle:_0x9d0527,from_prod_pallet:_0x2cc6ba,to_prod_qty:_0x6fba29,to_prod_level:_0x2b8c04,to_prod_isle:_0x57fdbf,to_prod_pallet:_0x86b5ec,primary_code:_0x51936c,secondary_code:_0x4905e4,product_code3:_0xcaa024,note:_0x3ef8b2,invoice:_0x33eece,expiry_date:_0x5432cd}=_0x178179['body'];if(typeof _0x48812c==_0x12fc0e(0x211))var _0x1df448=[_0x178179[_0x12fc0e(0x269)]['prod_name']],_0x32b783=[_0x178179[_0x12fc0e(0x269)][_0x12fc0e(0x1ff)]],_0x305de5=[_0x178179[_0x12fc0e(0x269)]['from_prod_level']],_0x39b4c0=[_0x178179[_0x12fc0e(0x269)][_0x12fc0e(0x226)]],_0xb8a1e8=[_0x178179[_0x12fc0e(0x269)][_0x12fc0e(0x2bb)]],_0x71d730=[_0x178179['body'][_0x12fc0e(0x26e)]],_0x27cf0d=[_0x178179[_0x12fc0e(0x269)][_0x12fc0e(0x23f)]],_0x25c527=[_0x178179[_0x12fc0e(0x269)]['product_code3']],_0x3671bf=[_0x178179['body'][_0x12fc0e(0x1f6)]],_0x2c39da=[_0x178179[_0x12fc0e(0x269)]['unit']],_0x872913=[_0x178179[_0x12fc0e(0x269)][_0x12fc0e(0x287)]],_0xed49b7=[_0x178179[_0x12fc0e(0x269)][_0x12fc0e(0x208)]],_0xdf29ca=[_0x178179[_0x12fc0e(0x269)]['expiry_date']];else var _0x1df448=[..._0x178179[_0x12fc0e(0x269)][_0x12fc0e(0x240)]],_0x32b783=[..._0x178179[_0x12fc0e(0x269)][_0x12fc0e(0x1ff)]],_0x305de5=[..._0x178179[_0x12fc0e(0x269)][_0x12fc0e(0x233)]],_0x39b4c0=[..._0x178179['body'][_0x12fc0e(0x226)]],_0xb8a1e8=[..._0x178179[_0x12fc0e(0x269)][_0x12fc0e(0x2bb)]],_0x71d730=[..._0x178179[_0x12fc0e(0x269)]['primary_code']],_0x27cf0d=[..._0x178179[_0x12fc0e(0x269)][_0x12fc0e(0x23f)]],_0x25c527=[..._0x178179[_0x12fc0e(0x269)][_0x12fc0e(0x1fd)]],_0x3671bf=[..._0x178179[_0x12fc0e(0x269)][_0x12fc0e(0x1f6)]],_0x2c39da=[..._0x178179[_0x12fc0e(0x269)][_0x12fc0e(0x219)]],_0x872913=[..._0x178179[_0x12fc0e(0x269)]['secondary_unit']],_0xed49b7=[..._0x178179['body']['batch_code']],_0xdf29ca=[..._0x178179[_0x12fc0e(0x269)][_0x12fc0e(0x2aa)]];const _0x30c03d=_0x1df448[_0x12fc0e(0x28e)](_0x4119f1=>{return _0x4119f1={'product_name':_0x4119f1};});_0x32b783[_0x12fc0e(0x279)]((_0xe5ac95,_0x45274c)=>{var _0x1d109e=_0x12fc0e;_0x30c03d[_0x45274c][_0x1d109e(0x227)]=_0xe5ac95;}),_0x305de5[_0x12fc0e(0x279)]((_0x1cf8d3,_0x55eb26)=>{_0x30c03d[_0x55eb26]['from_bay']=_0x1cf8d3;}),_0x39b4c0[_0x12fc0e(0x279)]((_0xb736cb,_0x281640)=>{_0x30c03d[_0x281640]['to_quantity']=_0xb736cb;}),_0xb8a1e8[_0x12fc0e(0x279)]((_0x2d8f82,_0x448ffb)=>{var _0x21b86d=_0x12fc0e;_0x30c03d[_0x448ffb][_0x21b86d(0x21c)]=_0x2d8f82;}),_0x71d730[_0x12fc0e(0x279)]((_0x554573,_0x4e9cec)=>{var _0x598b54=_0x12fc0e;_0x30c03d[_0x4e9cec][_0x598b54(0x26e)]=_0x554573;}),_0x27cf0d[_0x12fc0e(0x279)]((_0x5c6463,_0x34a1bc)=>{_0x30c03d[_0x34a1bc]['secondary_code']=_0x5c6463;}),_0x25c527[_0x12fc0e(0x279)]((_0x424311,_0x3988ae)=>{var _0x5013bd=_0x12fc0e;_0x30c03d[_0x3988ae][_0x5013bd(0x27d)]=_0x424311;}),_0x3671bf['forEach']((_0x37bbda,_0x3d99f7)=>{var _0x1f91e4=_0x12fc0e;_0x30c03d[_0x3d99f7][_0x1f91e4(0x2c3)]=_0x37bbda;}),_0x2c39da[_0x12fc0e(0x279)]((_0x2d1107,_0x2fffce)=>{var _0x2bbb9b=_0x12fc0e;_0x30c03d[_0x2fffce][_0x2bbb9b(0x219)]=_0x2d1107;}),_0x872913[_0x12fc0e(0x279)]((_0x275191,_0x26468b)=>{var _0x450e72=_0x12fc0e;_0x30c03d[_0x26468b][_0x450e72(0x287)]=_0x275191;}),_0xed49b7['forEach']((_0x56767c,_0xab9e2c)=>{var _0x142405=_0x12fc0e;_0x30c03d[_0xab9e2c][_0x142405(0x208)]=_0x56767c;}),_0xdf29ca[_0x12fc0e(0x279)]((_0x523450,_0x1fe125)=>{_0x30c03d[_0x1fe125]['expiry_date']=_0x523450;});const _0x269641=_0x30c03d['filter'](_0xeb2489=>_0xeb2489['to_quantity']!=='0'&&_0xeb2489[_0x12fc0e(0x265)]!==''||_0xeb2489[_0x12fc0e(0x236)]!=='0'&&_0xeb2489[_0x12fc0e(0x236)]!=='');var _0x375ce7=0x0;_0x269641[_0x12fc0e(0x279)](_0x387e82=>{var _0x155d89=_0x12fc0e;parseInt(_0x387e82[_0x155d89(0x227)])<parseInt(_0x387e82['to_quantity'])&&_0x375ce7++;});if(_0x375ce7!=0x0)return _0x178179[_0x12fc0e(0x2bf)](_0x12fc0e(0x2a9),_0x12fc0e(0x261)),_0x4fea35['redirect']('back');const _0xe8e89d=await warehouse['findOne']({'name':_0x174843[_0x12fc0e(0x280)],'room':_0x174843[_0x12fc0e(0x239)]});_0x174843[_0x12fc0e(0x283)]['forEach'](_0x32f672=>{var _0x327b00=_0x12fc0e;if(_0x32f672[_0x327b00(0x265)]>0x0){const _0x2e5326=_0xe8e89d[_0x327b00(0x20a)]['map'](_0x34ce7b=>{var _0x26cdaf=_0x327b00;_0x34ce7b[_0x26cdaf(0x2ab)]==_0x32f672['product_name']&&_0x34ce7b[_0x26cdaf(0x213)]==_0x32f672[_0x26cdaf(0x1fc)]&&(_0x34ce7b[_0x26cdaf(0x22a)]=parseInt(_0x34ce7b[_0x26cdaf(0x22a)])+parseInt(_0x32f672[_0x26cdaf(0x265)]));});}}),await _0xe8e89d['save']();const _0x1e4420=await warehouse[_0x12fc0e(0x1fa)]({'name':_0x174843['to_warehouse'],'room':_0x174843[_0x12fc0e(0x1e9)]});_0x174843[_0x12fc0e(0x283)][_0x12fc0e(0x279)](_0x3217bc=>{var _0x4d64f6=_0x12fc0e;if(_0x3217bc['to_quantity']>0x0){const _0x100d08=_0x1e4420[_0x4d64f6(0x20a)]['map'](_0x297d40=>{var _0x5e6d39=_0x4d64f6;_0x297d40['product_name']==_0x3217bc[_0x5e6d39(0x2ab)]&&_0x297d40[_0x5e6d39(0x213)]==_0x3217bc[_0x5e6d39(0x21c)]&&(_0x297d40['product_stock']=parseInt(_0x297d40[_0x5e6d39(0x22a)])-parseInt(_0x3217bc[_0x5e6d39(0x265)]));});}}),await _0x1e4420['save'](),_0x174843[_0x12fc0e(0x298)]=_0x492363,_0x174843[_0x12fc0e(0x280)]=_0x4cc2e1,_0x174843[_0x12fc0e(0x2b2)]=_0x1448fe,_0x174843[_0x12fc0e(0x283)]=_0x269641,_0x174843['note']=_0x3ef8b2,_0x174843[_0x12fc0e(0x29d)]=_0x33eece;const _0x1f1bd0=await _0x174843['save'](),_0x452c7b=await warehouse[_0x12fc0e(0x1fa)]({'name':_0x4cc2e1,'room':_0x3ef867});_0x1f1bd0[_0x12fc0e(0x283)][_0x12fc0e(0x279)](_0x5a95a4=>{var _0x27ce5b=_0x12fc0e;if(_0x5a95a4[_0x27ce5b(0x265)]>0x0){const _0x3aed38=_0x452c7b['product_details'][_0x27ce5b(0x28e)](_0x2dd13b=>{var _0x579c3d=_0x27ce5b;_0x2dd13b[_0x579c3d(0x2ab)]==_0x5a95a4['product_name']&&_0x2dd13b['bay']==_0x5a95a4['from_bay']&&(_0x2dd13b['product_stock']=parseInt(_0x2dd13b['product_stock'])-parseInt(_0x5a95a4[_0x579c3d(0x265)]));});}}),await _0x452c7b[_0x12fc0e(0x231)]();const _0x5351c7=await warehouse['findOne']({'name':_0x1448fe,'room':_0x461081});_0x1f1bd0[_0x12fc0e(0x283)][_0x12fc0e(0x279)](_0x379861=>{var _0x4d89c0=_0x12fc0e;if(_0x379861['to_quantity']>0x0){var _0x24458e=0x0;const _0x2f9e57=_0x5351c7[_0x4d89c0(0x20a)][_0x4d89c0(0x28e)](_0x5b3038=>{var _0x293327=_0x4d89c0;_0x5b3038['product_name']==_0x379861[_0x293327(0x2ab)]&&_0x5b3038[_0x293327(0x213)]==_0x379861[_0x293327(0x21c)]&&(_0x5b3038[_0x293327(0x22a)]=parseInt(_0x5b3038[_0x293327(0x22a)])+parseInt(_0x379861['to_quantity']),_0x24458e++);});_0x24458e=='0'&&(_0x5351c7['product_details']=_0x5351c7[_0x4d89c0(0x20a)][_0x4d89c0(0x2b6)]({'product_name':_0x379861[_0x4d89c0(0x2ab)],'product_stock':_0x379861[_0x4d89c0(0x265)],'bay':_0x379861[_0x4d89c0(0x21c)],'product_code':_0x379861[_0x4d89c0(0x27d)],'primary_code':_0x379861[_0x4d89c0(0x26e)],'secondary_code':_0x379861[_0x4d89c0(0x23f)],'maxProducts':_0x379861[_0x4d89c0(0x2c3)]}));}}),await _0x5351c7['save'](),_0x178179[_0x12fc0e(0x2bf)]('success',_0x12fc0e(0x260)),_0x4fea35['redirect'](_0x12fc0e(0x262));}catch(_0x318dfc){console[_0x12fc0e(0x294)](_0x318dfc);}}),router['post'](a0_0x289ad4(0x22d),async(_0x38d1d0,_0x34d5b0)=>{var _0x44dfcf=a0_0x289ad4;const {FromWareHouse:_0x6b6582,FromRoom:_0x33c3ee,ToWarehouse:_0x34cedd,ToRoom:_0x56f947,primary_code:_0x5eec8d,Roomslist:_0x5ce613}=_0x38d1d0[_0x44dfcf(0x269)],_0x516a88=_0x5ce613[_0x44dfcf(0x20f)](','),_0x48d484=[];async function _0x268e1c(_0x1ac707){var _0x5a3207=_0x44dfcf;const _0x493b8b=await warehouse[_0x5a3207(0x2ac)]([{'$match':{'name':_0x6b6582,'room':_0x1ac707}},{'$unwind':_0x5a3207(0x250)},{'$match':{'product_details.primary_code':_0x5eec8d}},{'$group':{'_id':_0x5a3207(0x221),'name':{'$first':_0x5a3207(0x278)},'instock':{'$first':_0x5a3207(0x292)},'primary_code':{'$first':_0x5a3207(0x2c1)},'secondary_code':{'$first':_0x5a3207(0x21e)},'product_code':{'$first':_0x5a3207(0x29b)},'level':{'$first':_0x5a3207(0x2b0)},'isle':{'$first':_0x5a3207(0x223)},'pallet':{'$first':_0x5a3207(0x29a)},'unit':{'$first':_0x5a3207(0x203)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x5a3207(0x25b)},'rack':{'$first':_0x5a3207(0x289)},'expiry_date':{'$first':_0x5a3207(0x21b)},'production_date':{'$first':_0x5a3207(0x2b8)},'batch_code':{'$first':_0x5a3207(0x23e)},'maxPerUnit':{'$first':_0x5a3207(0x2bd)},'roomNamed':{'$first':_0x5a3207(0x234)},'prod_cat':{'$first':'P'},'maxProducts':{'$first':_0x5a3207(0x26d)},'CBM':{'$first':{'$toDouble':'$product_details.CBM'}},'invoice':{'$first':'$product_details.invoice'}}}]),_0x46c56f=await warehouse[_0x5a3207(0x2ac)]([{'$match':{'name':_0x6b6582,'room':_0x1ac707}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x5eec8d}},{'$group':{'_id':_0x5a3207(0x221),'name':{'$first':_0x5a3207(0x278)},'instock':{'$first':_0x5a3207(0x292)},'primary_code':{'$first':_0x5a3207(0x2c1)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x5a3207(0x29b)},'level':{'$first':_0x5a3207(0x2b0)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x5a3207(0x29a)},'unit':{'$first':_0x5a3207(0x203)},'secondary_unit':{'$first':_0x5a3207(0x297)},'storage':{'$first':_0x5a3207(0x25b)},'rack':{'$first':_0x5a3207(0x289)},'expiry_date':{'$first':_0x5a3207(0x21b)},'production_date':{'$first':_0x5a3207(0x2b8)},'batch_code':{'$first':_0x5a3207(0x23e)},'maxPerUnit':{'$first':_0x5a3207(0x2bd)},'roomNamed':{'$first':_0x5a3207(0x234)},'prod_cat':{'$first':'S'},'maxProducts':{'$first':_0x5a3207(0x26d)},'CBM':{'$first':{'$toDouble':_0x5a3207(0x244)}},'invoice':{'$first':_0x5a3207(0x27c)}}}]);if(_0x493b8b['length']>0x0)_0x48d484[_0x5a3207(0x249)](_0x493b8b);else _0x46c56f['length']>0x0&&_0x48d484['push'](_0x46c56f);}const _0x2db356=_0x516a88[_0x44dfcf(0x28e)](_0x3d900a=>_0x268e1c(_0x3d900a));await Promise[_0x44dfcf(0x210)](_0x2db356),_0x34d5b0[_0x44dfcf(0x1eb)](_0x48d484);}),router[a0_0x289ad4(0x225)]('/barcode_scanner2',async(_0x251217,_0x4b5800)=>{var _0x14f67d=a0_0x289ad4;try{const {FromWareHouse:_0x174341,FromRoom:_0x2cdc49,ToWarehouse:_0x5afc82,ToRoom:_0xaeebd6,secondary_code:_0x53353f}=_0x251217[_0x14f67d(0x269)],_0x534249=await warehouse[_0x14f67d(0x2ac)]([{'$match':{'name':_0x174341}},{'$unwind':_0x14f67d(0x250)},{'$match':{'product_details.secondary_code':_0x53353f}},{'$group':{'_id':_0x14f67d(0x221),'name':{'$first':_0x14f67d(0x278)},'primary_code':{'$first':_0x14f67d(0x2c1)},'secondary_code':{'$first':_0x14f67d(0x21e)},'product_code':{'$first':_0x14f67d(0x29b)},'instock':{'$first':'$product_details.product_stock'},'warehouse':{'$first':_0x14f67d(0x222)},'level':{'$first':_0x14f67d(0x2b0)},'isle':{'$first':_0x14f67d(0x223)},'pallet':{'$first':_0x14f67d(0x29a)},'maxProducts':{'$first':'$product_details.maxProducts'},'unit':{'$first':_0x14f67d(0x203)},'expiry_date':{'$first':_0x14f67d(0x21b)},'production_date':{'$first':_0x14f67d(0x2b8)}}}]);_0x4b5800[_0x14f67d(0x28d)](0xc8)['json'](_0x534249);}catch(_0x16cc0c){_0x4b5800['status'](0x194)[_0x14f67d(0x1eb)]({'message':_0x16cc0c[_0x14f67d(0x282)]});}}),router[a0_0x289ad4(0x225)](a0_0x289ad4(0x1f0),async(_0x5bf72b,_0x2e9dae)=>{var _0x5e6b6d=a0_0x289ad4;try{const {FromWareHouse:_0x4be2a2,FromRoom:_0x394871,ToWarehouse:_0x33dd91,ToRoom:_0x2c73e3,product_code:_0x3e53b1}=_0x5bf72b['body'],_0x3a31fc=await warehouse[_0x5e6b6d(0x2ac)]([{'$match':{'name':_0x4be2a2}},{'$unwind':_0x5e6b6d(0x250)},{'$match':{'product_details.product_code':_0x3e53b1}},{'$group':{'_id':_0x5e6b6d(0x221),'name':{'$first':_0x5e6b6d(0x278)},'primary_code':{'$first':_0x5e6b6d(0x2c1)},'secondary_code':{'$first':_0x5e6b6d(0x21e)},'product_code':{'$first':_0x5e6b6d(0x29b)},'instock':{'$first':'$product_details.product_stock'},'warehouse':{'$first':_0x5e6b6d(0x222)},'level':{'$first':_0x5e6b6d(0x2b0)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':'$product_details.pallet'},'maxProducts':{'$first':_0x5e6b6d(0x26d)},'unit':{'$first':'$product_details.unit'}}}]);_0x2e9dae[_0x5e6b6d(0x28d)](0xc8)[_0x5e6b6d(0x1eb)](_0x3a31fc);}catch(_0xdb1d33){_0x2e9dae[_0x5e6b6d(0x28d)](0x194)[_0x5e6b6d(0x1eb)]({'message':_0xdb1d33[_0x5e6b6d(0x282)]});}}),router[a0_0x289ad4(0x225)](a0_0x289ad4(0x216),async(_0x15ab7c,_0x44d7b1)=>{var _0x12ac14=a0_0x289ad4;const {productCode:_0x968abf,bay:_0x3f2999,warehouses:_0x344b5c,room:_0x4d8f09}=_0x15ab7c['body'];try{const _0x57754a=await warehouse['aggregate']([{'$match':{'name':_0x344b5c,'room':_0x4d8f09}},{'$unwind':_0x12ac14(0x250)},{'$match':{'product_details.pallet':parseInt(_0x3f2999)}},{'$group':{'_id':_0x12ac14(0x278),'name':{'$first':_0x12ac14(0x278)},'product_stock':{'$sum':_0x12ac14(0x292)},'pallet':{'$first':_0x12ac14(0x29a)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);console[_0x12ac14(0x294)](_0x57754a),_0x44d7b1['status'](0xc8)[_0x12ac14(0x1eb)](_0x57754a);}catch(_0x4dca65){_0x44d7b1[_0x12ac14(0x28d)](0x194)[_0x12ac14(0x1eb)]({'message':_0x4dca65[_0x12ac14(0x282)]});}}),module[a0_0x289ad4(0x2ba)]=router;